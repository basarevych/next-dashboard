(window.webpackJsonp=window.webpackJsonp||[]).push([["4e32"],{"/uLY":function(t,e,n){"use strict";var i=n("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(n("q1tI")),a=(0,i(n("8/g6")).default)(r.default.createElement(r.default.Fragment,null,r.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),r.default.createElement("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"})),"MyLocation");e.default=a},0:function(t,e){},"0/m4":function(t,e,n){!function(t){"use strict";var e=t.S2={L:{}};e.L.LatLng=function(t,e,n){var i=parseFloat(t,10),r=parseFloat(e,10);if(isNaN(i)||isNaN(r))throw new Error("Invalid LatLng object: ("+t+", "+e+")");return!0!==n&&(i=Math.max(Math.min(i,90),-90),r=(r+180)%360+(r<-180||180===r?180:-180)),{lat:i,lng:r}},e.L.LatLng.DEG_TO_RAD=Math.PI/180,e.L.LatLng.RAD_TO_DEG=180/Math.PI,e.LatLngToXYZ=function(t){var n=e.L.LatLng.DEG_TO_RAD,i=t.lat*n,r=t.lng*n,a=Math.cos(i);return[Math.cos(r)*a,Math.sin(r)*a,Math.sin(i)]},e.XYZToLatLng=function(t){var n=e.L.LatLng.RAD_TO_DEG,i=Math.atan2(t[2],Math.sqrt(t[0]*t[0]+t[1]*t[1])),r=Math.atan2(t[1],t[0]);return e.L.LatLng(i*n,r*n)};e.XYZToFaceUV=function(t){var e=function(t){var e=[Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2])];return e[0]>e[1]?e[0]>e[2]?0:2:e[1]>e[2]?1:2}(t);return t[e]<0&&(e+=3),[e,function(t,e){var n,i;switch(t){case 0:n=e[1]/e[0],i=e[2]/e[0];break;case 1:n=-e[0]/e[1],i=e[2]/e[1];break;case 2:n=-e[0]/e[2],i=-e[1]/e[2];break;case 3:n=e[2]/e[0],i=e[1]/e[0];break;case 4:n=e[2]/e[1],i=-e[0]/e[1];break;case 5:n=-e[1]/e[2],i=-e[0]/e[2];break;default:throw{error:"Invalid face"}}return[n,i]}(e,t)]},e.FaceUVToXYZ=function(t,e){var n=e[0],i=e[1];switch(t){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw{error:"Invalid face"}}};var i=function(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))};e.STToUV=function(t){return[i(t[0]),i(t[1])]};var r=function(t){return t>=0?.5*Math.sqrt(1+3*t):1-.5*Math.sqrt(1-3*t)};e.UVToST=function(t){return[r(t[0]),r(t[1])]},e.STToIJ=function(t,e){var n=1<<e,i=function(t){var e=Math.floor(t*n);return Math.max(0,Math.min(n-1,e))};return[i(t[0]),i(t[1])]},e.IJToST=function(t,e,n){var i=1<<e;return[(t[0]+n[0])/i,(t[1]+n[1])/i]};var a=function(t,e,n,i){if(0==i){1==n&&(e.x=t-1-e.x,e.y=t-1-e.y);var r=e.x;e.x=e.y,e.y=r}},o=function(t,e,n,i){var r={a:[[0,"d"],[1,"a"],[3,"b"],[2,"a"]],b:[[2,"b"],[1,"b"],[3,"a"],[0,"c"]],c:[[2,"c"],[3,"d"],[1,"c"],[0,"b"]],d:[[0,"a"],[3,"c"],[1,"d"],[2,"d"]]};"number"!=typeof i&&console.warn(new Error("called pointToHilbertQuadList without face value, defaulting to '0'").stack);for(var a=i%2?"d":"a",o=[],s=n-1;s>=0;s--){var u=1<<s,l=r[a][2*(t&u?1:0)+(e&u?1:0)];o.push(l[0]),a=l[1]}return o};e.S2Cell=function(){},e.S2Cell.FromHilbertQuadKey=function(t){var n,i,r,o,s,u,l=t.split("/"),c=parseInt(l[0]),h=l[1],f=h.length,p={x:0,y:0};for(n=f-1;n>=0;n--)i=f-n,o=0,s=0,"1"===(r=h[n])?s=1:"2"===r?(o=1,s=1):"3"===r&&(o=1),u=Math.pow(2,i-1),a(u,p,o,s),p.x+=u*o,p.y+=u*s;if(c%2==1){var A=p.x;p.x=p.y,p.y=A}return e.S2Cell.FromFaceIJ(parseInt(c),[p.x,p.y],i)},e.S2Cell.FromLatLng=function(t,n){if(!t.lat&&0!==t.lat||!t.lng&&0!==t.lng)throw new Error("Pass { lat: lat, lng: lng } to S2.S2Cell.FromLatLng");var i=e.LatLngToXYZ(t),r=e.XYZToFaceUV(i),a=e.UVToST(r[1]),o=e.STToIJ(a,n);return e.S2Cell.FromFaceIJ(r[0],o,n)},e.S2Cell.FromFaceIJ=function(t,n,i){var r=new e.S2Cell;return r.face=t,r.ij=n,r.level=i,r},e.S2Cell.prototype.toString=function(){return"F"+this.face+"ij["+this.ij[0]+","+this.ij[1]+"]@"+this.level},e.S2Cell.prototype.getLatLng=function(){var t=e.IJToST(this.ij,this.level,[.5,.5]),n=e.STToUV(t),i=e.FaceUVToXYZ(this.face,n);return e.XYZToLatLng(i)},e.S2Cell.prototype.getCornerLatLngs=function(){for(var t=[],n=[[0,0],[0,1],[1,1],[1,0]],i=0;i<4;i++){var r=e.IJToST(this.ij,this.level,n[i]),a=e.STToUV(r),o=e.FaceUVToXYZ(this.face,a);t.push(e.XYZToLatLng(o))}return t},e.S2Cell.prototype.getFaceAndQuads=function(){var t=o(this.ij[0],this.ij[1],this.level,this.face);return[this.face,t]},e.S2Cell.prototype.toHilbertQuadkey=function(){var t=o(this.ij[0],this.ij[1],this.level,this.face);return this.face.toString(10)+"/"+t.join("")},e.latLngToNeighborKeys=e.S2Cell.latLngToNeighborKeys=function(t,n,i){return e.S2Cell.FromLatLng({lat:t,lng:n},i).getNeighbors().map(function(t){return t.toHilbertQuadkey()})},e.S2Cell.prototype.getNeighbors=function(){var t=function(t,n,i){var r=1<<i;if(n[0]>=0&&n[1]>=0&&n[0]<r&&n[1]<r)return e.S2Cell.FromFaceIJ(t,n,i);var a=e.IJToST(n,i,[.5,.5]),o=e.STToUV(a),s=e.FaceUVToXYZ(t,o),u=e.XYZToFaceUV(s);return t=u[0],o=u[1],a=e.UVToST(o),n=e.STToIJ(a,i),e.S2Cell.FromFaceIJ(t,n,i)},n=this.face,i=this.ij[0],r=this.ij[1],a=this.level;return[t(n,[i-1,r],a),t(n,[i,r-1],a),t(n,[i+1,r],a),t(n,[i,r+1],a)]},e.FACE_BITS=3,e.MAX_LEVEL=30,e.POS_BITS=2*e.MAX_LEVEL+1,e.facePosLevelToId=e.S2Cell.facePosLevelToId=e.fromFacePosLevel=function(i,r,a){var o,s,u,l=t.dcodeIO&&t.dcodeIO.Long||n("yXba");for(a||(a=r.length),r.length>a&&(r=r.substr(0,a)),o=l.fromString(i.toString(10),!0,10).toString(2);o.length<e.FACE_BITS;)o="0"+o;for(s=l.fromString(r,!0,4).toString(2);s.length<2*a;)s="0"+s;for(u=o+s,u+="1";u.length<e.FACE_BITS+e.POS_BITS;)u+="0";return l.fromString(u,!0,2).toString(10)},e.keyToId=e.S2Cell.keyToId=e.toId=e.toCellId=e.fromKey=function(t){var n=t.split("/");return e.fromFacePosLevel(n[0],n[1],n[1].length)},e.idToKey=e.S2Cell.idToKey=e.S2Cell.toKey=e.toKey=e.fromId=e.fromCellId=e.S2Cell.toHilbertQuadkey=e.toHilbertQuadkey=function(i){for(var r=t.dcodeIO&&t.dcodeIO.Long||n("yXba"),a=r.fromString(i,!0,10).toString(2);a.length<e.FACE_BITS+e.POS_BITS;)a="0"+a;for(var o=a.lastIndexOf("1"),s=a.substring(0,3),u=a.substring(3,o),l=u.length/2,c=r.fromString(s,!0,2).toString(10),h=r.fromString(u,!0,2).toString(4);h.length<l;)h="0"+h;return c+"/"+h},e.keyToLatLng=e.S2Cell.keyToLatLng=function(t){return e.S2Cell.FromHilbertQuadKey(t).getLatLng()},e.idToLatLng=e.S2Cell.idToLatLng=function(t){var n=e.idToKey(t);return e.keyToLatLng(n)},e.S2Cell.latLngToKey=e.latLngToKey=e.latLngToQuadkey=function(t,n,i){if(isNaN(i)||i<1||i>30)throw new Error("'level' is not a number between 1 and 30 (but it should be)");return e.S2Cell.FromLatLng({lat:t,lng:n},i).toHilbertQuadkey()},e.stepKey=function(e,i){var r,a=t.dcodeIO&&t.dcodeIO.Long||n("yXba"),o=e.split("/"),s=o[0],u=o[1],l=o[1].length,c=a.fromString(u,!0,4);i>0?r=c.add(Math.abs(i)):i<0&&(r=c.subtract(Math.abs(i)));var h=r.toString(4);for("0"===h&&console.warning(new Error("face/position wrapping is not yet supported"));h.length<l;)h="0"+h;return s+"/"+h},e.S2Cell.prevKey=e.prevKey=function(t){return e.stepKey(t,-1)},e.S2Cell.nextKey=e.nextKey=function(t){return e.stepKey(t,1)}}(t.exports)},"1A8y":function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("JX7q"),l=n("ODXe"),c=n("VKpO"),h=n("B7nP"),f=n("ZaHm"),p=Object(c.a)(),A=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=e.height,a=e.viewMatrix,o=void 0===a?p:a,s=e.projectionMatrix,u=void 0===s?p:s;Object(i.a)(this,t),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=u;var l=Object(c.a)();f.g(l,l,this.projectionMatrix),f.g(l,l,this.viewMatrix),this.viewProjectionMatrix=l;var h=Object(c.a)();f.n(h,h,[this.width/2,-this.height/2,1]),f.o(h,h,[1,-1,0]),f.g(h,h,this.viewProjectionMatrix);var A=f.e(Object(c.a)(),h);if(!A)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=h,this.pixelUnprojectionMatrix=A,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(r.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&f.b(e.projectionMatrix,this.projectionMatrix)&&f.b(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,n=void 0===e||e,i=this.projectPosition(t),r=Object(h.k)(i,this.pixelProjectionMatrix),a=Object(l.a)(r,2),o=a[0],s=a[1],u=n?s:this.height-s;return 2===t.length?[o,u]:[o,u,r[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,i=void 0===n||n,r=e.targetZ,a=Object(l.a)(t,3),o=a[0],s=a[1],u=a[2],c=i?s:this.height-s,f=r&&r*this.pixelsPerMeter,p=Object(h.h)([o,c,u],this.pixelUnprojectionMatrix,f),A=this.unprojectPosition(p),d=Object(l.a)(A,3),v=d[0],g=d[1],m=d[2];return Number.isFinite(u)?[v,g,m]:Number.isFinite(r)?[v,g,r]:[v,g]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=Object(l.a)(e,2);return[n[0],n[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=Object(l.a)(e,2);return[n[0],n[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}}]),t}(),d=n("w+ko"),v=n("ZxFD");n.d(e,"a",function(){return g});var g=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,s=n.height,l=n.latitude,c=void 0===l?0:l,f=n.longitude,p=void 0===f?0:f,A=n.zoom,d=void 0===A?0:A,v=n.pitch,g=void 0===v?0:v,m=n.bearing,y=void 0===m?0:m,_=n.altitude,b=void 0===_?1.5:_,x=n.nearZMultiplier,w=n.farZMultiplier;Object(i.a)(this,e),r=r||1,s=s||1;var S=Object(h.l)(d);b=Math.max(.75,b);var k=Object(h.g)([p,c],S);k[2]=0;var O=Object(h.d)({width:r,height:s,pitch:g,bearing:y,altitude:b,nearZMultiplier:x||1/s,farZMultiplier:w||1.01}),P=Object(h.f)({height:s,center:k,pitch:g,bearing:y,altitude:b,flipY:!0});return(t=Object(a.a)(this,Object(o.a)(e).call(this,{width:r,height:s,viewMatrix:P,projectionMatrix:O}))).latitude=c,t.longitude=p,t.zoom=d,t.pitch=g,t.bearing=y,t.altitude=b,t.scale=S,t.center=k,t.pixelsPerMeter=Object(h.b)(Object(u.a)(Object(u.a)(t))).pixelsPerMeter[2],Object.freeze(Object(u.a)(Object(u.a)(t))),t}return Object(s.a)(e,t),Object(r.a)(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(h.g)(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(h.j)(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=t.pos,i=Object(h.h)(n,this.pixelUnprojectionMatrix),r=Object(h.g)(e,this.scale),a=v.a([],r,v.e([],i)),o=v.a([],this.center,a);return Object(h.j)(o,this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,r=this.height,a=Object(d.a)(Object.assign({width:i,height:r,bounds:t},n));return new e({width:i,height:r,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}(A)},"1OyB":function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return i})},"1eIE":function(t,e,n){"use strict";function i(t,e){if(t===e)return!0;var n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}n.d(e,"a",function(){return i})},"23rh":function(t,e,n){"use strict";(function(t,i){n.d(e,"a",function(){return a});var r=n("U8pU"),a="object"!==(void 0===t?"undefined":Object(r.a)(t))||"[object process]"!==String(t)||!0;"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof document&&document}).call(this,n("8oxB"),n("3r9c"))},"2lZV":function(t,e,n){"use strict";(function(t){n.d(e,"b",function(){return i}),n.d(e,"a",function(){return r});var i="undefined"!=typeof window?window:t,r=(void 0!==t||window,"undefined"!=typeof document?document:{})}).call(this,n("3r9c"))},"49sm":function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},"4ZJM":function(t,e,n){t.exports=function(){"use strict";var t,e,n;function i(i,r){if(t)if(e){var a="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",o={};t(o),(n=r(o)).workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"}))}else e=r;else t=r}return i(0,function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=i;function i(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=i}i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var n,i,r,a,o;for(void 0===e&&(e=1e-6),r=t,o=0;o<8;o++){if(a=this.sampleCurveX(r)-t,Math.abs(a)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=a/s}if((r=t)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(a=this.sampleCurveX(r),Math.abs(a-t)<e)return r;t>a?n=r:i=r,r=.5*(i-n)+n}return r},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var r=a;function a(t,e){this.x=t,this.y=e}function o(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!o(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(!o(t[i],e[i]))return!1;return!0}return t===e}function s(t,e,i,r){var a=new n(t,e,i,r);return function(t){return a.solve(t)}}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=i,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.x+n*(this.x-e.x)-i*(this.y-e.y),a=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=r,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var u=s(.25,.1,.25,1);function l(t,e,n){return Math.min(n,Math.max(e,t))}function c(t,e,n){var i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r}function h(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=e;i<r.length;i+=1){var a=r[i];for(var o in a)t[o]=a[o]}return t}var f=1;function p(){return f++}function A(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function d(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function v(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})}function g(t,e){return-1!==t.indexOf(e,t.length-e.length)}function m(t,e,n){var i={};for(var r in t)i[r]=e.call(n||this,t[r],r,t);return i}function y(t,e,n){var i={};for(var r in t)e.call(n||this,t[r],r,t)&&(i[r]=t[r]);return i}function _(t){return Array.isArray(t)?t.map(_):"object"==typeof t&&t?m(t,_):t}var b={};function x(t){b[t]||("undefined"!=typeof console&&console.warn(t),b[t]=!0)}function w(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function S(t){for(var e=0,n=0,i=t.length,r=i-1,a=void 0,o=void 0;n<i;r=n++)a=t[n],e+=((o=t[r]).x-a.x)*(a.y+o.y);return e}function k(t){try{var e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var O,P,E,C=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),T=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,M=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,j={now:C,frame:function(t){var e=T(t);return{cancel:function(){return M(e)}}},getImageData:function(t){var e=self.document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(0,0,t.width,t.height)},resolveURL:function(t){return O||(O=self.document.createElement("a")),O.href=t,O.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio}},L={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},I={supported:!1,testSupport:function(t){!z&&E&&(D?B(t):P=t)}},z=!1,D=!1;function B(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,E),t.isContextLost())return;I.supported=!0}catch(t){}t.deleteTexture(e),z=!0}self.document&&((E=self.document.createElement("img")).onload=function(){P&&B(P),P=null,D=!0},E.onerror=function(){z=!0,P=null},E.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var R="01",F=function(t){this._transformRequestFn=t,this._createSkuToken()};F.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",R,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},F.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},F.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},F.prototype.normalizeStyleURL=function(t,e){return H(t,e)},F.prototype.normalizeGlyphsURL=function(t,e){return q(t,e)},F.prototype.normalizeSourceURL=function(t,e){return Z(t,e)},F.prototype.normalizeSpriteURL=function(t,e,n,i){return X(t,e,n,i)},F.prototype.normalizeTileURL=function(t,e,n){return this._isSkuTokenExpired()&&this._createSkuToken(),Y(t,e,n,this._skuToken)},F.prototype.canonicalizeTileURL=function(t){return J(t)},F.prototype.canonicalizeTileset=function(t,e){return $(t,e)};var N="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes";function U(t,e){var n=et(L.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"/"!==n.path&&(t.path=""+n.path+t.path),!L.REQUIRE_ACCESS_TOKEN)return nt(t);if(!(e=e||L.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+N);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+N);return t.params.push("access_token="+e),nt(t)}function V(t){return 0===t.indexOf("mapbox:")}var G=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function W(t){return G.test(t)}var H=function(t,e){if(!V(t))return t;var n=et(t);return n.path="/styles/v1"+n.path,U(n,e)},q=function(t,e){if(!V(t))return t;var n=et(t);return n.path="/fonts/v1"+n.path,U(n,e)},Z=function(t,e){if(!V(t))return t;var n=et(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),U(n,e)},X=function(t,e,n,i){var r=et(t);return V(t)?(r.path="/styles/v1"+r.path+"/sprite"+e+n,U(r,i)):(r.path+=""+e+n,nt(r))},Q=/(\.(png|jpg)\d*)(?=$)/,Y=function(t,e,n,i){if(!e||!V(e))return t;var r=et(t),a=j.devicePixelRatio>=2||512===n?"@2x":"",o=I.supported?".webp":"$1";return r.path=r.path.replace(Q,""+a+o),r.path="/v4"+r.path,L.REQUIRE_ACCESS_TOKEN&&L.ACCESS_TOKEN&&i&&r.params.push("sku="+i),U(r)},K=/\.[\w]+$/,J=function(t){var e=et(t);if(!e.path.match(/(^\/v4\/)/)||!e.path.match(K))return t;var n="mapbox://tiles/";n+=e.path.replace("/v4/","");var i=e.params.filter(function(t){return!t.match(/^access_token=/)});return i.length&&(n+="?"+i.join("&")),n},$=function(t,e){if(!V(e))return t.tiles||[];for(var n=[],i=0,r=t.tiles;i<r.length;i+=1){var a=r[i],o=J(a);n.push(o)}return n},tt=/^(\w+):\/\/([^\/?]*)(\/[^?]+)?\??(.+)?/;function et(t){var e=t.match(tt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function nt(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function it(t){if(!t)return null;var e,n=t.split(".");if(!n||3!==n.length)return null;try{return JSON.parse((e=n[1],decodeURIComponent(self.atob(e).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))))}catch(t){return null}}var rt=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};rt.prototype.getStorageKey=function(t){var e,n=it(L.ACCESS_TOKEN),i="";return n&&n.u?(e=n.u,i=self.btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(Number("0x"+e))}))):i=L.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+i:"mapbox.eventData:"+i},rt.prototype.fetchEventData=function(){var t=k("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{var i=self.localStorage.getItem(e);i&&(this.eventData=JSON.parse(i));var r=self.localStorage.getItem(n);r&&(this.anonId=r)}catch(t){x("Unable to read from LocalStorage")}},rt.prototype.saveEventData=function(){var t=k("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{self.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&self.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){x("Unable to write to LocalStorage")}},rt.prototype.processRequests=function(){},rt.prototype.postEvent=function(t,e,n){var i=this;if(L.EVENTS_URL){var r=et(L.EVENTS_URL);r.params.push("access_token="+(L.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.0.0",skuId:R,userId:this.anonId},o=e?h(a,e):a,s={url:nt(r),headers:{"Content-Type":"text/plain"},body:JSON.stringify([o])};this.pendingRequest=mt(s,function(t){i.pendingRequest=null,n(t),i.saveEventData(),i.processRequests()})}},rt.prototype.queueRequest=function(t){this.queue.push(t),this.processRequests()};var at=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postMapLoadEvent=function(t,e,n){this.skuToken=n,L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return V(t)||W(t)})&&this.queueRequest({id:e,timestamp:Date.now()})},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var e=this.queue.shift(),n=e.id,i=e.timestamp;n&&this.success[n]||(this.anonId||this.fetchEventData(),d(this.anonId)||(this.anonId=A()),this.postEvent(i,{skuToken:this.skuToken},function(e){e||n&&(t.success[n]=!0)}))}},e}(rt),ot=new(function(t){function e(){t.call(this,"appUserTurnstile")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postTurnstileEvent=function(t){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return V(t)||W(t)})&&this.queueRequest(Date.now())},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var e=it(L.ACCESS_TOKEN),n=e?e.u:L.ACCESS_TOKEN,i=n!==this.eventData.tokenU;d(this.anonId)||(this.anonId=A(),i=!0);var r=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),o=new Date(r),s=(r-this.eventData.lastSuccess)/864e5;i=i||s>=1||s<-1||a.getDate()!==o.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(r,{"enabled.telemetry":!1},function(e){e||(t.eventData.lastSuccess=r,t.eventData.tokenU=n)})}},e}(rt)),st=ot.postTurnstileEvent.bind(ot),ut=new at,lt=ut.postMapLoadEvent.bind(ut),ct={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ct);var ht=function(t){function e(e,n,i){401===n&&W(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=n,this.url=i,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error);function ft(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}var pt,At,dt=ft()?function(){return self.worker&&self.worker.referrer}:function(){var t=self.location.origin;if(t&&"null"!==t&&"file://"!==t)return t+self.location.pathname},vt=function(t,e){if(!/^file:/.test(t.url)){if(self.fetch&&self.Request&&self.AbortController&&self.Request.prototype.hasOwnProperty("signal"))return function(t,e){var n=new self.AbortController,i=new self.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:dt(),signal:n.signal});return"json"===t.type&&i.headers.set("Accept","application/json"),self.fetch(i).then(function(n){n.ok?n[t.type||"text"]().then(function(t){e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires"))}).catch(function(t){return e(new Error(t.message))}):e(new ht(n.statusText,n.status,t.url))}).catch(function(t){20!==t.code&&e(new Error(t.message))}),{cancel:function(){return n.abort()}}}(t,e);if(ft()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e)}return function(t,e){var n=new self.XMLHttpRequest;for(var i in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&n.setRequestHeader("Accept","application/json"),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===t.type)try{i=JSON.parse(n.response)}catch(t){return e(t)}e(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new ht(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,e)},gt=function(t,e){return vt(h(t,{type:"arrayBuffer"}),e)},mt=function(t,e){return vt(h(t,{method:"POST"}),e)};pt=[],At=0;var yt=function(t,e){if(At>=L.MAX_PARALLEL_IMAGE_REQUESTS){var n={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return pt.push(n),n}At++;var i=!1,r=function(){if(!i)for(i=!0,At--;pt.length&&At<L.MAX_PARALLEL_IMAGE_REQUESTS;){var t=pt.shift(),e=t.requestParameters,n=t.callback;t.cancelled||(t.cancel=yt(e,n).cancel)}},a=gt(t,function(t,n,i,a){if(r(),t)e(t);else if(n){var o=new self.Image,s=self.URL||self.webkitURL;o.onload=function(){e(null,o),s.revokeObjectURL(o.src)},o.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var u=new self.Blob([new Uint8Array(n)],{type:"image/png"});o.cacheControl=i,o.expires=a,o.src=n.byteLength?s.createObjectURL(u):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}});return{cancel:function(){a.cancel(),r()}}};function _t(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function bt(t,e,n){if(n&&n[t]){var i=n[t].indexOf(e);-1!==i&&n[t].splice(i,1)}}var xt=function(t,e){void 0===e&&(e={}),h(this,e),this.type=t},wt=function(t){function e(e,n){void 0===n&&(n={}),t.call(this,"error",h({error:e},n))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(xt),St=function(){};St.prototype.on=function(t,e){return this._listeners=this._listeners||{},_t(t,e,this._listeners),this},St.prototype.off=function(t,e){return bt(t,e,this._listeners),bt(t,e,this._oneTimeListeners),this},St.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},_t(t,e,this._oneTimeListeners),this},St.prototype.fire=function(t,e){"string"==typeof t&&(t=new xt(t,e||{}));var n=t.type;if(this.listens(n)){t.target=this;for(var i=0,r=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];i<r.length;i+=1)r[i].call(this,t);for(var a=0,o=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];a<o.length;a+=1){var s=o[a];bt(n,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(h(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof wt&&console.error(t.error);return this},St.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},St.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var kt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:[{"!":"text-offset"}],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:[{"!":"text-anchor"},{"!":"text-offset"},{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",requires:["text-field"],values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}}},Ot=function(t,e,n,i){this.message=(t?t+": ":"")+n,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)};function Pt(t){var e=t.key,n=t.value;return n?[new Ot(e,n,"constants have been deprecated as of v8")]:[]}function Et(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=e;i<r.length;i+=1){var a=r[i];for(var o in a)t[o]=a[o]}return t}function Ct(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Tt(t){return Array.isArray(t)?t.map(Tt):Ct(t)}var Mt=function(t){function e(e,n){t.call(this,n),this.message=n,this.key=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),jt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,i=e;n<i.length;n+=1){var r=i[n],a=r[0],o=r[1];this.bindings[a]=o}};jt.prototype.concat=function(t){return new jt(this,t)},jt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},jt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Lt={kind:"null"},It={kind:"number"},zt={kind:"string"},Dt={kind:"boolean"},Bt={kind:"color"},Rt={kind:"object"},Ft={kind:"value"},Nt={kind:"collator"},Ut={kind:"formatted"};function Vt(t,e){return{kind:"array",itemType:t,N:e}}function Gt(t){if("array"===t.kind){var e=Gt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Wt=[Lt,It,zt,Dt,Bt,Ut,Rt,Vt(Ft)];function Ht(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Ht(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,i=Wt;n<i.length;n+=1)if(!Ht(i[n],e))return null}return"Expected "+Gt(t)+" but found "+Gt(e)+" instead."}var qt=e(function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return t<0?0:t>1?1:t}function a(t){return"%"===t[t.length-1]?i(parseFloat(t)/100*255):i(parseInt(t))}function o(t){return"%"===t[t.length-1]?r(parseFloat(t)/100):r(parseFloat(t))}function s(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in n)return n[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=r.indexOf("("),l=r.indexOf(")");if(-1!==u&&l+1===r.length){var c=r.substr(0,u),h=r.substr(u+1,l-(u+1)).split(","),f=1;switch(c){case"rgba":if(4!==h.length)return null;f=o(h.pop());case"rgb":return 3!==h.length?null:[a(h[0]),a(h[1]),a(h[2]),f];case"hsla":if(4!==h.length)return null;f=o(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,A=o(h[1]),d=o(h[2]),v=d<=.5?d*(A+1):d+A-d*A,g=2*d-v;return[i(255*s(g,v,p+1/3)),i(255*s(g,v,p)),i(255*s(g,v,p-1/3)),f];default:return null}}return null}}catch(t){}}).parseCSSColor,Zt=function(t,e,n,i){void 0===i&&(i=1),this.r=t,this.g=e,this.b=n,this.a=i};Zt.parse=function(t){if(t){if(t instanceof Zt)return t;if("string"==typeof t){var e=qt(t);if(e)return new Zt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},Zt.prototype.toString=function(){var t=this.toArray(),e=t[0],n=t[1],i=t[2],r=t[3];return"rgba("+Math.round(e)+","+Math.round(n)+","+Math.round(i)+","+r+")"},Zt.prototype.toArray=function(){var t=this.r,e=this.g,n=this.b,i=this.a;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*n/i,i]},Zt.black=new Zt(0,0,0,1),Zt.white=new Zt(1,1,1,1),Zt.transparent=new Zt(0,0,0,0),Zt.red=new Zt(1,0,0,1);var Xt=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Xt.prototype.compare=function(t,e){return this.collator.compare(t,e)},Xt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Qt=function(t,e,n){this.text=t,this.scale=e,this.fontStack=n},Yt=function(t){this.sections=t};function Kt(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value ["+[t,e,n,i].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Jt(t){if(null===t)return Lt;if("string"==typeof t)return zt;if("boolean"==typeof t)return Dt;if("number"==typeof t)return It;if(t instanceof Zt)return Bt;if(t instanceof Xt)return Nt;if(t instanceof Yt)return Ut;if(Array.isArray(t)){for(var e,n=t.length,i=0,r=t;i<r.length;i+=1){var a=Jt(r[i]);if(e){if(e===a)continue;e=Ft;break}e=a}return Vt(e||Ft,n)}return Rt}function $t(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Zt||t instanceof Yt?t.toString():JSON.stringify(t)}Yt.fromString=function(t){return new Yt([new Qt(t,null,null)])},Yt.prototype.toString=function(){return this.sections.map(function(t){return t.text}).join("")},Yt.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var i=n[e];t.push(i.text);var r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),t.push(r)}return t};var te=function(t,e){this.type=t,this.value=e};te.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Zt)return!0;if(e instanceof Xt)return!0;if(e instanceof Yt)return!0;if(Array.isArray(e)){for(var n=0,i=e;n<i.length;n+=1)if(!t(i[n]))return!1;return!0}if("object"==typeof e){for(var r in e)if(!t(e[r]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var n=t[1],i=Jt(n),r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new te(i,n)},te.prototype.evaluate=function(){return this.value},te.prototype.eachChild=function(){},te.prototype.possibleOutputs=function(){return[this.value]},te.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Zt?["rgba"].concat(this.value.toArray()):this.value instanceof Yt?this.value.serialize():this.value};var ee=function(t){this.name="ExpressionEvaluationError",this.message=t};ee.prototype.toJSON=function(){return this.message};var ne={string:zt,number:It,boolean:Dt,object:Rt},ie=function(t,e){this.type=t,this.args=e};ie.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n,i=1,r=t[0];if("array"===r){var a,o;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in ne)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);a=ne[s],i++}else a=Ft;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],i++}n=Vt(a,o)}else n=ne[r];for(var u=[];i<t.length;i++){var l=e.parse(t[i],i,Ft);if(!l)return null;u.push(l)}return new ie(n,u)},ie.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!Ht(this.type,Jt(n)))return n;if(e===this.args.length-1)throw new ee("Expected value to be of type "+Gt(this.type)+", but found "+Gt(Jt(n))+" instead.")}return null},ie.prototype.eachChild=function(t){this.args.forEach(t)},ie.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},ie.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);var i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map(function(t){return t.serialize()}))};var re=function(t){this.type=Ut,this.sections=t};re.parse=function(t,e){if(t.length<3)return e.error("Expected at least two arguments.");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");for(var n=[],i=1;i<t.length-1;i+=2){var r=e.parse(t[i],1,Ft);if(!r)return null;var a=r.type.kind;if("string"!==a&&"value"!==a&&"null"!==a)return e.error("Formatted text type must be 'string', 'value', or 'null'.");var o=t[i+1];if("object"!=typeof o||Array.isArray(o))return e.error("Format options argument must be an object.");var s=null;if(o["font-scale"]&&!(s=e.parse(o["font-scale"],1,It)))return null;var u=null;if(o["text-font"]&&!(u=e.parse(o["text-font"],1,Vt(zt))))return null;n.push({text:r,scale:s,font:u})}return new re(n)},re.prototype.evaluate=function(t){return new Yt(this.sections.map(function(e){return new Qt($t(e.text.evaluate(t)),e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null)}))},re.prototype.eachChild=function(t){for(var e=0,n=this.sections;e<n.length;e+=1){var i=n[e];t(i.text),i.scale&&t(i.scale),i.font&&t(i.font)}},re.prototype.possibleOutputs=function(){return[void 0]},re.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var i=n[e];t.push(i.text.serialize());var r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),t.push(r)}return t};var ae={"to-boolean":Dt,"to-color":Bt,"to-number":It,"to-string":zt},oe=function(t,e){this.type=t,this.args=e};oe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");for(var i=ae[n],r=[],a=1;a<t.length;a++){var o=e.parse(t[a],a,Ft);if(!o)return null;r.push(o)}return new oe(i,r)},oe.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,n,i=0,r=this.args;i<r.length;i+=1){if(n=null,(e=r[i].evaluate(t))instanceof Zt)return e;if("string"==typeof e){var a=t.parseColor(e);if(a)return a}else if(Array.isArray(e)&&!(n=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":Kt(e[0],e[1],e[2],e[3])))return new Zt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ee(n||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var o=null,s=0,u=this.args;s<u.length;s+=1){if(null===(o=u[s].evaluate(t)))return 0;var l=Number(o);if(!isNaN(l))return l}throw new ee("Could not convert "+JSON.stringify(o)+" to number.")}return"formatted"===this.type.kind?Yt.fromString($t(this.args[0].evaluate(t))):$t(this.args[0].evaluate(t))},oe.prototype.eachChild=function(t){this.args.forEach(t)},oe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},oe.prototype.serialize=function(){if("formatted"===this.type.kind)return new re([{text:this.args[0],scale:null,font:null}]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize())}),t};var se=["Unknown","Point","LineString","Polygon"],ue=function(){this.globals=null,this.feature=null,this.featureState=null,this._parseColorCache={}};ue.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ue.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?se[this.feature.type]:this.feature.type:null},ue.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ue.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Zt.parse(t)),e};var le=function(t,e,n,i){this.name=t,this.type=e,this._evaluate=n,this.args=i};le.prototype.evaluate=function(t){return this._evaluate(t,this.args)},le.prototype.eachChild=function(t){this.args.forEach(t)},le.prototype.possibleOutputs=function(){return[void 0]},le.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},le.parse=function(t,e){var n,i=t[0],r=le.definitions[i];if(!r)return e.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0);for(var a=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter(function(e){var n=e[0];return!Array.isArray(n)||n.length===t.length-1}),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],f=h[0],p=h[1];u=new de(e.registry,e.path,null,e.scope);for(var A=[],d=!1,v=1;v<t.length;v++){var g=t[v],m=Array.isArray(f)?f[v-1]:f.type,y=u.parse(g,1+A.length,m);if(!y){d=!0;break}A.push(y)}if(!d)if(Array.isArray(f)&&f.length!==A.length)u.error("Expected "+f.length+" arguments, but found "+A.length+" instead.");else{for(var _=0;_<A.length;_++){var b=Array.isArray(f)?f[_]:f.type,x=A[_];u.concat(_+1).checkSubtype(b,x.type)}if(0===u.errors.length)return new le(i,a,p,A)}}if(1===s.length)(n=e.errors).push.apply(n,u.errors);else{for(var w=(s.length?s:o).map(function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Gt).join(", ")+")":"("+Gt(e.type)+"...)"}).join(" | "),S=[],k=1;k<t.length;k++){var O=e.parse(t[k],1+S.length);if(!O)return null;S.push(Gt(O.type))}e.error("Expected arguments of type "+w+", but found ("+S.join(", ")+") instead.")}return null},le.register=function(t,e){for(var n in le.definitions=e,e)t[n]=le};var ce=function(t,e,n){this.type=Nt,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e};function he(t){if(t instanceof le){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild(function(t){e&&!he(t)&&(e=!1)}),e}function fe(t){if(t instanceof le&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild(function(t){e&&!fe(t)&&(e=!1)}),e}function pe(t,e){if(t instanceof le&&e.indexOf(t.name)>=0)return!1;var n=!0;return t.eachChild(function(t){n&&!pe(t,e)&&(n=!1)}),n}ce.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");var i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Dt);if(!i)return null;var r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Dt);if(!r)return null;var a=null;return n.locale&&!(a=e.parse(n.locale,1,zt))?null:new ce(i,r,a)},ce.prototype.evaluate=function(t){return new Xt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},ce.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},ce.prototype.possibleOutputs=function(){return[void 0]},ce.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ae=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};Ae.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new Ae(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},Ae.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ae.prototype.eachChild=function(){},Ae.prototype.possibleOutputs=function(){return[void 0]},Ae.prototype.serialize=function(){return["var",this.name]};var de=function(t,e,n,i,r){void 0===e&&(e=[]),void 0===i&&(i=new jt),void 0===r&&(r=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=i,this.errors=r,this.expectedType=n};function ve(t,e){for(var n,i,r=0,a=t.length-1,o=0;r<=a;){if(n=t[o=Math.floor((r+a)/2)],i=t[o+1],e===n||e>n&&e<i)return o;if(n<e)r=o+1;else{if(!(n>e))throw new ee("Input is not a number.");a=o-1}}return Math.max(o-1,0)}de.prototype.parse=function(t,e,n,i,r){return void 0===r&&(r={}),e?this.concat(e,n,i)._parse(t,r):this._parse(t,r)},de.prototype._parse=function(t,e){function n(t,e,n){return"assert"===n?new ie(e,[t]):"coerce"===n?new oe(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var i=t[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found "+typeof i+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var r=this.registry[i];if(r){var a=r.parse(t,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=n(a,o,e.typeAnnotation||"coerce");else a=n(a,o,e.typeAnnotation||"assert")}if(!(a instanceof te)&&function t(e){if(e instanceof Ae)return t(e.boundExpression);if(e instanceof le&&"error"===e.name)return!1;if(e instanceof ce)return!1;var n=e instanceof oe||e instanceof ie,i=!0;return e.eachChild(function(e){i=n?i&&t(e):i&&e instanceof te}),!!i&&he(e)&&pe(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(a)){var u=new ue;try{a=new te(a.type,a.evaluate(u))}catch(t){return this.error(t.message),null}}return a}return this.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},de.prototype.concat=function(t,e,n){var i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new de(this.registry,i,e||null,r,this.errors)},de.prototype.error=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var i=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new Mt(i,t))},de.prototype.checkSubtype=function(t,e){var n=Ht(t,e);return n&&this.error(n),n};var ge=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var i=0,r=n;i<r.length;i+=1){var a=r[i],o=a[0],s=a[1];this.labels.push(o),this.outputs.push(s)}};function me(t,e,n){return t*(1-n)+e*n}ge.parse=function(t,e){var n=t[1],i=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(n=e.parse(n,1,It)))return null;var r=[],a=null;e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType),i.unshift(-1/0);for(var o=0;o<i.length;o+=2){var s=i[o],u=i[o+1],l=o+1,c=o+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(r.length&&r[r.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var h=e.parse(u,c,a);if(!h)return null;a=a||h.type,r.push([s,h])}return new ge(a,n,r)},ge.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);var r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[ve(e,i)].evaluate(t)},ge.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},ge.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},ge.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var ye=Object.freeze({number:me,color:function(t,e,n){return new Zt(me(t.r,e.r,n),me(t.g,e.g,n),me(t.b,e.b,n),me(t.a,e.a,n))},array:function(t,e,n){return t.map(function(t,i){return me(t,e[i],n)})}}),_e=.95047,be=1,xe=1.08883,we=4/29,Se=6/29,ke=3*Se*Se,Oe=Se*Se*Se,Pe=Math.PI/180,Ee=180/Math.PI;function Ce(t){return t>Oe?Math.pow(t,1/3):t/ke+we}function Te(t){return t>Se?t*t*t:ke*(t-we)}function Me(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function je(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Le(t){var e=je(t.r),n=je(t.g),i=je(t.b),r=Ce((.4124564*e+.3575761*n+.1804375*i)/_e),a=Ce((.2126729*e+.7151522*n+.072175*i)/be);return{l:116*a-16,a:500*(r-a),b:200*(a-Ce((.0193339*e+.119192*n+.9503041*i)/xe)),alpha:t.a}}function Ie(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=be*Te(e),n=_e*Te(n),i=xe*Te(i),new Zt(Me(3.2404542*n-1.5371385*e-.4985314*i),Me(-.969266*n+1.8760108*e+.041556*i),Me(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function ze(t,e,n){var i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}var De={forward:Le,reverse:Ie,interpolate:function(t,e,n){return{l:me(t.l,e.l,n),a:me(t.a,e.a,n),b:me(t.b,e.b,n),alpha:me(t.alpha,e.alpha,n)}}},Be={forward:function(t){var e=Le(t),n=e.l,i=e.a,r=e.b,a=Math.atan2(r,i)*Ee;return{h:a<0?a+360:a,c:Math.sqrt(i*i+r*r),l:n,alpha:t.a}},reverse:function(t){var e=t.h*Pe,n=t.c;return Ie({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:ze(t.h,e.h,n),c:me(t.c,e.c,n),l:me(t.l,e.l,n),alpha:me(t.alpha,e.alpha,n)}}},Re=Object.freeze({lab:De,hcl:Be}),Fe=function(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(var a=0,o=r;a<o.length;a+=1){var s=o[a],u=s[0],l=s[1];this.labels.push(u),this.outputs.push(l)}};function Ne(t,e,n,i){var r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}Fe.interpolationFactor=function(t,e,i,r){var a=0;if("exponential"===t.name)a=Ne(e,t.base,i,r);else if("linear"===t.name)a=Ne(e,1,i,r);else if("cubic-bezier"===t.name){var o=t.controlPoints;a=new n(o[0],o[1],o[2],o[3]).solve(Ne(e,1,i,r))}return a},Fe.parse=function(t,e){var n=t[0],i=t[1],r=t[2],a=t.slice(3);if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){var o=i[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:o}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type "+String(i[0]),1,0);var s=i.slice(1);if(4!==s.length||s.some(function(t){return"number"!=typeof t||t<0||t>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(r=e.parse(r,2,It)))return null;var u=[],l=null;"interpolate-hcl"===n||"interpolate-lab"===n?l=Bt:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<a.length;c+=2){var h=a[c],f=a[c+1],p=c+3,A=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);var d=e.parse(f,A,l);if(!d)return null;l=l||d.type,u.push([h,d])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new Fe(l,n,i,r,u):e.error("Type "+Gt(l)+" is not interpolatable.")},Fe.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);var r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);var a=ve(e,i),o=e[a],s=e[a+1],u=Fe.interpolationFactor(this.interpolation,i,o,s),l=n[a].evaluate(t),c=n[a+1].evaluate(t);return"interpolate"===this.operator?ye[this.type.kind.toLowerCase()](l,c,u):"interpolate-hcl"===this.operator?Be.reverse(Be.interpolate(Be.forward(l),Be.forward(c),u)):De.reverse(De.interpolate(De.forward(l),De.forward(c),u))},Fe.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},Fe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},Fe.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e};var Ue=function(t,e){this.type=t,this.args=e};Ue.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,i=e.expectedType;i&&"value"!==i.kind&&(n=i);for(var r=[],a=0,o=t.slice(1);a<o.length;a+=1){var s=o[a],u=e.parse(s,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!u)return null;n=n||u.type,r.push(u)}var l=i&&r.some(function(t){return Ht(i,t.type)});return new Ue(l?Ft:n,r)},Ue.prototype.evaluate=function(t){for(var e=null,n=0,i=this.args;n<i.length&&null===(e=i[n].evaluate(t));n+=1);return e},Ue.prototype.eachChild=function(t){this.args.forEach(t)},Ue.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},Ue.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Ve=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Ve.prototype.evaluate=function(t){return this.result.evaluate(t)},Ve.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1)t(n[e][1]);t(this.result)},Ve.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],i=1;i<t.length-1;i+=2){var r=t[i];if("string"!=typeof r)return e.error("Expected string, but found "+typeof r+" instead.",i);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);var a=e.parse(t[i+1],i+1);if(!a)return null;n.push([r,a])}var o=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return o?new Ve(n,o):null},Ve.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},Ve.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var i=n[e],r=i[0],a=i[1];t.push(r,a.serialize())}return t.push(this.result.serialize()),t};var Ge=function(t,e,n){this.type=t,this.index=e,this.input=n};Ge.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,It),i=e.parse(t[2],2,Vt(e.expectedType||Ft));if(!n||!i)return null;var r=i.type;return new Ge(r.itemType,n,i)},Ge.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new ee("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new ee("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new ee("Array index must be an integer, but found "+e+" instead.");return n[e]},Ge.prototype.eachChild=function(t){t(this.index),t(this.input)},Ge.prototype.possibleOutputs=function(){return[void 0]},Ge.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var We=function(t,e,n,i,r,a){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=a};We.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var r={},a=[],o=2;o<t.length-1;o+=2){var s=t[o],u=t[o+1];Array.isArray(s)||(s=[s]);var l=e.concat(o);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var f=h[c];if("number"!=typeof f&&"string"!=typeof f)return l.error("Branch labels must be numbers or strings.");if("number"==typeof f&&Math.abs(f)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof f&&Math.floor(f)!==f)return l.error("Numeric branch labels must be integer values.");if(n){if(l.checkSubtype(n,Jt(f)))return null}else n=Jt(f);if(void 0!==r[String(f)])return l.error("Branch labels must be unique.");r[String(f)]=a.length}var p=e.parse(u,o,i);if(!p)return null;i=i||p.type,a.push(p)}var A=e.parse(t[1],1,Ft);if(!A)return null;var d=e.parse(t[t.length-1],t.length-1,i);return d?"value"!==A.type.kind&&e.concat(1).checkSubtype(n,A.type)?null:new We(n,i,A,r,a,d):null},We.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(Jt(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},We.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},We.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs())},We.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],n=[],i={},r=0,a=Object.keys(this.cases).sort();r<a.length;r+=1){var o=a[r];void 0===(h=i[this.cases[o]])?(i[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[h][1].push(o)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=n;u<l.length;u+=1){var c=l[u],h=c[0],f=c[1];1===f.length?e.push(s(f[0])):e.push(f.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var He=function(t,e,n){this.type=t,this.branches=e,this.otherwise=n};function qe(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Ze(t,e,n,i){return 0===i.compare(e,n)}function Xe(t,e,n){var i="=="!==t&&"!="!==t;return function(){function r(t,e,n){this.type=Dt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return r.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=t[0],a=e.parse(t[1],1,Ft);if(!a)return null;if(!qe(n,a.type))return e.concat(1).error('"'+n+"\" comparisons are not supported for type '"+Gt(a.type)+"'.");var o=e.parse(t[2],2,Ft);if(!o)return null;if(!qe(n,o.type))return e.concat(2).error('"'+n+"\" comparisons are not supported for type '"+Gt(o.type)+"'.");if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '"+Gt(a.type)+"' and '"+Gt(o.type)+"'.");i&&("value"===a.type.kind&&"value"!==o.type.kind?a=new ie(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new ie(a.type,[o])));var s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Nt)))return null}return new r(a,o,s)},r.prototype.evaluate=function(r){var a=this.lhs.evaluate(r),o=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){var s=Jt(a),u=Jt(o);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new ee('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!i&&this.hasUntypedArgument){var l=Jt(a),c=Jt(o);if("string"!==l.kind||"string"!==c.kind)return e(r,a,o)}return this.collator?n(r,a,o,this.collator.evaluate(r)):e(r,a,o)},r.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},r.prototype.possibleOutputs=function(){return[!0,!1]},r.prototype.serialize=function(){var e=[t];return this.eachChild(function(t){e.push(t.serialize())}),e},r}()}He.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i=[],r=1;r<t.length-1;r+=2){var a=e.parse(t[r],r,Dt);if(!a)return null;var o=e.parse(t[r+1],r+1,n);if(!o)return null;i.push([a,o]),n=n||o.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?new He(n,i,s):null},He.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var i=n[e],r=i[0],a=i[1];if(r.evaluate(t))return a.evaluate(t)}return this.otherwise.evaluate(t)},He.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var i=n[e],r=i[0],a=i[1];t(r),t(a)}t(this.otherwise)},He.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.branches.map(function(t){return t[0],t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs())},He.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Qe=Xe("==",function(t,e,n){return e===n},Ze),Ye=Xe("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!Ze(0,e,n,i)}),Ke=Xe("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),Je=Xe(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),$e=Xe("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),tn=Xe(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0}),en=function(t,e,n,i,r){this.type=zt,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r};en.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,It);if(!n)return null;var i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");var r=null;if(i.locale&&!(r=e.parse(i.locale,1,zt)))return null;var a=null;if(i.currency&&!(a=e.parse(i.currency,1,zt)))return null;var o=null;if(i["min-fraction-digits"]&&!(o=e.parse(i["min-fraction-digits"],1,It)))return null;var s=null;return i["max-fraction-digits"]&&!(s=e.parse(i["max-fraction-digits"],1,It))?null:new en(n,r,a,o,s)},en.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},en.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},en.prototype.possibleOutputs=function(){return[void 0]},en.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var nn=function(t){this.type=It,this.input=t};nn.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+Gt(n.type)+" instead."):new nn(n):null},nn.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ee("Expected value to be of type string or array, but found "+Gt(Jt(e))+" instead.")},nn.prototype.eachChild=function(t){t(this.input)},nn.prototype.possibleOutputs=function(){return[void 0]},nn.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize())}),t};var rn={"==":Qe,"!=":Ye,">":Je,"<":Ke,">=":tn,"<=":$e,array:ie,at:Ge,boolean:ie,case:He,coalesce:Ue,collator:ce,format:re,interpolate:Fe,"interpolate-hcl":Fe,"interpolate-lab":Fe,length:nn,let:Ve,literal:te,match:We,number:ie,"number-format":en,object:ie,step:ge,string:ie,"to-boolean":oe,"to-color":oe,"to-number":oe,"to-string":oe,var:Ae};function an(t,e){var n=e[0],i=e[1],r=e[2],a=e[3];n=n.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);var o=a?a.evaluate(t):1,s=Kt(n,i,r,o);if(s)throw new ee(s);return new Zt(n/255*o,i/255*o,r/255*o,o)}function on(t,e){return t in e}function sn(t,e){var n=e[t];return void 0===n?null:n}function un(t){return{type:t}}function ln(t){return{result:"success",value:t}}function cn(t){return{result:"error",value:t}}function hn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function fn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function pn(t){return!!t.expression&&t.expression.interpolated}function An(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function dn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function vn(t){return t}function gn(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function mn(t,e,n,i,r){return gn(typeof n===r?i[n]:void 0,t.default,e.default)}function yn(t,e,n){if("number"!==An(n))return gn(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var r=xn(t.stops,n);return t.stops[r][1]}function _n(t,e,n){var i=void 0!==t.base?t.base:1;if("number"!==An(n))return gn(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var a=xn(t.stops,n),o=function(t,e,n,i){var r=i-n,a=t-n;return 0===r?0:1===e?a/r:(Math.pow(e,a)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],u=t.stops[a+1][1],l=ye[e.type]||vn;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=Re[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),o))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),i=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==i)return l(n,i,o)}}:l(s,u,o)}function bn(t,e,n){return"color"===e.type?n=Zt.parse(n):"formatted"===e.type?n=Yt.fromString(n.toString()):An(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),gn(n,t.default,e.default)}function xn(t,e){for(var n,i,r=0,a=t.length-1,o=0;r<=a;){if(n=t[o=Math.floor((r+a)/2)][0],i=t[o+1][0],e===n||e>n&&e<i)return o;n<e?r=o+1:n>e&&(a=o-1)}return Math.max(o-1,0)}le.register(rn,{error:[{kind:"error"},[zt],function(t,e){var n=e[0];throw new ee(n.evaluate(t))}],typeof:[zt,[Ft],function(t,e){return Gt(Jt(e[0].evaluate(t)))}],"to-rgba":[Vt(It,4),[Bt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Bt,[It,It,It],an],rgba:[Bt,[It,It,It,It],an],has:{type:Dt,overloads:[[[zt],function(t,e){return on(e[0].evaluate(t),t.properties())}],[[zt,Rt],function(t,e){var n=e[0],i=e[1];return on(n.evaluate(t),i.evaluate(t))}]]},get:{type:Ft,overloads:[[[zt],function(t,e){return sn(e[0].evaluate(t),t.properties())}],[[zt,Rt],function(t,e){var n=e[0],i=e[1];return sn(n.evaluate(t),i.evaluate(t))}]]},"feature-state":[Ft,[zt],function(t,e){return sn(e[0].evaluate(t),t.featureState||{})}],properties:[Rt,[],function(t){return t.properties()}],"geometry-type":[zt,[],function(t){return t.geometryType()}],id:[Ft,[],function(t){return t.id()}],zoom:[It,[],function(t){return t.globals.zoom}],"heatmap-density":[It,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[It,[],function(t){return t.globals.lineProgress||0}],accumulated:[Ft,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[It,un(It),function(t,e){for(var n=0,i=0,r=e;i<r.length;i+=1)n+=r[i].evaluate(t);return n}],"*":[It,un(It),function(t,e){for(var n=1,i=0,r=e;i<r.length;i+=1)n*=r[i].evaluate(t);return n}],"-":{type:It,overloads:[[[It,It],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)-i.evaluate(t)}],[[It],function(t,e){return-e[0].evaluate(t)}]]},"/":[It,[It,It],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)/i.evaluate(t)}],"%":[It,[It,It],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)%i.evaluate(t)}],ln2:[It,[],function(){return Math.LN2}],pi:[It,[],function(){return Math.PI}],e:[It,[],function(){return Math.E}],"^":[It,[It,It],function(t,e){var n=e[0],i=e[1];return Math.pow(n.evaluate(t),i.evaluate(t))}],sqrt:[It,[It],function(t,e){var n=e[0];return Math.sqrt(n.evaluate(t))}],log10:[It,[It],function(t,e){var n=e[0];return Math.log(n.evaluate(t))/Math.LN10}],ln:[It,[It],function(t,e){var n=e[0];return Math.log(n.evaluate(t))}],log2:[It,[It],function(t,e){var n=e[0];return Math.log(n.evaluate(t))/Math.LN2}],sin:[It,[It],function(t,e){var n=e[0];return Math.sin(n.evaluate(t))}],cos:[It,[It],function(t,e){var n=e[0];return Math.cos(n.evaluate(t))}],tan:[It,[It],function(t,e){var n=e[0];return Math.tan(n.evaluate(t))}],asin:[It,[It],function(t,e){var n=e[0];return Math.asin(n.evaluate(t))}],acos:[It,[It],function(t,e){var n=e[0];return Math.acos(n.evaluate(t))}],atan:[It,[It],function(t,e){var n=e[0];return Math.atan(n.evaluate(t))}],min:[It,un(It),function(t,e){return Math.min.apply(Math,e.map(function(e){return e.evaluate(t)}))}],max:[It,un(It),function(t,e){return Math.max.apply(Math,e.map(function(e){return e.evaluate(t)}))}],abs:[It,[It],function(t,e){var n=e[0];return Math.abs(n.evaluate(t))}],round:[It,[It],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[It,[It],function(t,e){var n=e[0];return Math.floor(n.evaluate(t))}],ceil:[It,[It],function(t,e){var n=e[0];return Math.ceil(n.evaluate(t))}],"filter-==":[Dt,[zt,Ft],function(t,e){var n=e[0],i=e[1];return t.properties()[n.value]===i.value}],"filter-id-==":[Dt,[Ft],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[Dt,[zt],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[Dt,[zt,Ft],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<a}],"filter-id-<":[Dt,[Ft],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i<r}],"filter->":[Dt,[zt,Ft],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>a}],"filter-id->":[Dt,[Ft],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i>r}],"filter-<=":[Dt,[zt,Ft],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[Dt,[Ft],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i<=r}],"filter->=":[Dt,[zt,Ft],function(t,e){var n=e[0],i=e[1],r=t.properties()[n.value],a=i.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[Dt,[Ft],function(t,e){var n=e[0],i=t.id(),r=n.value;return typeof i==typeof r&&i>=r}],"filter-has":[Dt,[Ft],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Dt,[],function(t){return null!==t.id()}],"filter-type-in":[Dt,[Vt(zt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Dt,[Vt(Ft)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Dt,[zt,Vt(Ft)],function(t,e){var n=e[0];return e[1].value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[Dt,[zt,Vt(Ft)],function(t,e){var n=e[0],i=e[1];return function(t,e,n,i){for(;n<=i;){var r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:Dt,overloads:[[[Dt,Dt],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)&&i.evaluate(t)}],[un(Dt),function(t,e){for(var n=0,i=e;n<i.length;n+=1)if(!i[n].evaluate(t))return!1;return!0}]]},any:{type:Dt,overloads:[[[Dt,Dt],function(t,e){var n=e[0],i=e[1];return n.evaluate(t)||i.evaluate(t)}],[un(Dt),function(t,e){for(var n=0,i=e;n<i.length;n+=1)if(i[n].evaluate(t))return!0;return!1}]]},"!":[Dt,[Dt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Dt,[zt],function(t,e){var n=e[0],i=t.globals&&t.globals.isSupportedScript;return!i||i(n.evaluate(t))}],upcase:[zt,[zt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[zt,[zt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[zt,un(Ft),function(t,e){return e.map(function(e){return $t(e.evaluate(t))}).join("")}],"resolved-locale":[zt,[Nt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var wn=function(t,e){var n;this.expression=t,this._warningHistory={},this._evaluator=new ue,this._defaultValue=e?"color"===(n=e).type&&dn(n.default)?new Zt(0,0,0,0):"color"===n.type?Zt.parse(n.default)||null:void 0===n.default?null:n.default:null,this._enumValues=e&&"enum"===e.type?e.values:null};function Sn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in rn}function kn(t,e){var n=new de(rn,[],e?function(t){var e={color:Bt,string:zt,number:It,enum:zt,boolean:Dt,formatted:Ut};return"array"===t.type?Vt(e[t.value]||Ft,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?ln(new wn(i,e)):cn(n.errors)}wn.prototype.evaluateWithoutErrorHandling=function(t,e,n){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this.expression.evaluate(this._evaluator)},wn.prototype.evaluate=function(t,e,n){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null;try{var i=this.expression.evaluate(this._evaluator);if(null==i)return this._defaultValue;if(this._enumValues&&!(i in this._enumValues))throw new ee("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(i)+" instead.");return i}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var On=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!fe(e.expression)};On.prototype.evaluateWithoutErrorHandling=function(t,e,n){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n)},On.prototype.evaluate=function(t,e,n){return this._styleExpression.evaluate(t,e,n)};var Pn=function(t,e,n){this.kind=t,this.zoomStops=n.labels,this._styleExpression=e,this.isStateDependent="camera"!==t&&!fe(e.expression),n instanceof Fe&&(this._interpolationType=n.interpolation)};function En(t,e){if("error"===(t=kn(t,e)).result)return t;var n=t.value.expression,i=he(n);if(!i&&!hn(e))return cn([new Mt("","data expressions not supported")]);var r=pe(n,["zoom"]);if(!r&&!fn(e))return cn([new Mt("","zoom expressions not supported")]);var a=function t(e){var n=null;if(e instanceof Ve)n=t(e.result);else if(e instanceof Ue)for(var i=0,r=e.args;i<r.length;i+=1){var a=r[i];if(n=t(a))break}else(e instanceof ge||e instanceof Fe)&&e.input instanceof le&&"zoom"===e.input.name&&(n=e);return n instanceof Mt?n:(e.eachChild(function(e){var i=t(e);i instanceof Mt?n=i:!n&&i?n=new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&i&&n!==i&&(n=new Mt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n)}(n);return a||r?a instanceof Mt?cn([a]):a instanceof Fe&&!pn(e)?cn([new Mt("",'"interpolate" expressions cannot be used with this property')]):ln(a?new Pn(i?"camera":"composite",t.value,a):new On(i?"constant":"source",t.value)):cn([new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Pn.prototype.evaluateWithoutErrorHandling=function(t,e,n){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n)},Pn.prototype.evaluate=function(t,e,n){return this._styleExpression.evaluate(t,e,n)},Pn.prototype.interpolationFactor=function(t,e,n){return this._interpolationType?Fe.interpolationFactor(this._interpolationType,t,e,n):0};var Cn=function(t,e){this._parameters=t,this._specification=e,Et(this,function t(e,n){var i,r,a,o="color"===n.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||void 0!==e.property,l=s||!u,c=e.type||(pn(n)?"exponential":"interval");if(o&&((e=Et({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],Zt.parse(t[1])]})),e.default?e.default=Zt.parse(e.default):e.default=Zt.parse(n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Re[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===c)i=_n;else if("interval"===c)i=yn;else if("categorical"===c){i=mn,r=Object.create(null);for(var h=0,f=e.stops;h<f.length;h+=1){var p=f[h];r[p[0]]=p[1]}a=typeof e.stops[0][0]}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');i=bn}if(s){for(var A={},d=[],v=0;v<e.stops.length;v++){var g=e.stops[v],m=g[0].zoom;void 0===A[m]&&(A[m]={zoom:m,type:e.type,property:e.property,default:e.default,stops:[]},d.push(m)),A[m].stops.push([g[0].value,g[1]])}for(var y=[],_=0,b=d;_<b.length;_+=1){var x=b[_];y.push([A[x].zoom,t(A[x],n)])}return{kind:"composite",interpolationFactor:Fe.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:y.map(function(t){return t[0]}),evaluate:function(t,i){var r=t.zoom;return _n({stops:y,base:e.base},n,r).evaluate(r,i)}}}return l?{kind:"camera",interpolationFactor:"exponential"===c?Fe.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):function(){return 0},zoomStops:e.stops.map(function(t){return t[0]}),evaluate:function(t){var o=t.zoom;return i(e,n,o,r,a)}}:{kind:"source",evaluate:function(t,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?gn(e.default,n.default):i(e,n,s,r,a)}}}(this._parameters,this._specification))};function Tn(t,e){if(dn(t))return new Cn(t,e);if(Sn(t)){var n=En(t,e);if("error"===n.result)throw new Error(n.value.map(function(t){return t.key+": "+t.message}).join(", "));return n.value}var i=t;return"string"==typeof t&&"color"===e.type&&(i=Zt.parse(t)),{kind:"constant",evaluate:function(){return i}}}function Mn(t){var e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=[],u=An(n);if("object"!==u)return[new Ot(e,n,"object expected, "+u+" found")];for(var l in n){var c=l.split(".")[0],h=i[c]||i["*"],f=void 0;if(r[c])f=r[c];else if(i[c])f=ei;else if(r["*"])f=r["*"];else{if(!i["*"]){s.push(new Ot(e,n[l],'unknown property "'+l+'"'));continue}f=ei}s=s.concat(f({key:(e?e+".":e)+l,value:n[l],valueSpec:h,style:a,styleSpec:o,object:n,objectKey:l},n))}for(var p in i)r[p]||i[p].required&&void 0===i[p].default&&void 0===n[p]&&s.push(new Ot(e,n,'missing required property "'+p+'"'));return s}function jn(t){var e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,a=t.key,o=t.arrayElementValidator||ei;if("array"!==An(e))return[new Ot(a,e,"array expected, "+An(e)+" found")];if(n.length&&e.length!==n.length)return[new Ot(a,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new Ot(a,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value,values:n.values};r.$version<7&&(s.function=n.function),"object"===An(n.value)&&(s=n.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(o({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:i,styleSpec:r,key:a+"["+l+"]"}));return u}function Ln(t){var e=t.key,n=t.value,i=t.valueSpec,r=An(n);return"number"!==r?[new Ot(e,n,"number expected, "+r+" found")]:"minimum"in i&&n<i.minimum?[new Ot(e,n,n+" is less than the minimum value "+i.minimum)]:"maximum"in i&&n>i.maximum?[new Ot(e,n,n+" is greater than the maximum value "+i.maximum)]:[]}function In(t){var e,n,i,r=t.valueSpec,a=Ct(t.value.type),o={},s="categorical"!==a&&void 0===t.value.property,u=!s,l="array"===An(t.value.stops)&&"array"===An(t.value.stops[0])&&"object"===An(t.value.stops[0][0]),c=Mn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===a)return[new Ot(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat(jn({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===An(n)&&0===n.length&&e.push(new Ot(t.key,n,"array must have at least one stop")),e},default:function(t){return ei({key:t.key,value:t.value,valueSpec:r,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===a&&s&&c.push(new Ot(t.key,t.value,'missing required property "property"')),"identity"===a||t.value.stops||c.push(new Ot(t.key,t.value,'missing required property "stops"')),"exponential"===a&&t.valueSpec.expression&&!pn(t.valueSpec)&&c.push(new Ot(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!hn(t.valueSpec)?c.push(new Ot(t.key,t.value,"property functions not supported")):s&&!fn(t.valueSpec)&&c.push(new Ot(t.key,t.value,"zoom functions not supported"))),"categorical"!==a&&!l||void 0!==t.value.property||c.push(new Ot(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],a=t.value,s=t.key;if("array"!==An(a))return[new Ot(s,a,"array expected, "+An(a)+" found")];if(2!==a.length)return[new Ot(s,a,"array length 2 expected, length "+a.length+" found")];if(l){if("object"!==An(a[0]))return[new Ot(s,a,"object expected, "+An(a[0])+" found")];if(void 0===a[0].zoom)return[new Ot(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new Ot(s,a,"object stop key must have value")];if(i&&i>Ct(a[0].zoom))return[new Ot(s,a[0].zoom,"stop zoom values must appear in ascending order")];Ct(a[0].zoom)!==i&&(i=Ct(a[0].zoom),n=void 0,o={}),e=e.concat(Mn({key:s+"[0]",value:a[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Ln,value:f}}))}else e=e.concat(f({key:s+"[0]",value:a[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},a));return Sn(Tt(a[1]))?e.concat([new Ot(s+"[1]",a[1],"expressions are not allowed in function stops.")]):e.concat(ei({key:s+"[1]",value:a[1],valueSpec:r,style:t.style,styleSpec:t.styleSpec}))}function f(t,i){var s=An(t.value),u=Ct(t.value),l=null!==t.value?t.value:i;if(e){if(s!==e)return[new Ot(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Ot(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var c="number expected, "+s+" found";return hn(r)&&void 0===a&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ot(t.key,l,c)]}return"categorical"!==a||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==a&&"number"===s&&void 0!==n&&u<n?[new Ot(t.key,l,"stop domain values must appear in ascending order")]:(n=u,"categorical"===a&&u in o?[new Ot(t.key,l,"stop domain values must be unique")]:(o[u]=!0,[])):[new Ot(t.key,l,"integer expected, found "+u)]}}function zn(t){var e=("property"===t.expressionContext?En:kn)(Tt(t.value),t.valueSpec);if("error"===e.result)return e.value.map(function(e){return new Ot(""+t.key+e.key,t.value,e.message)});var n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==n.possibleOutputs().indexOf(void 0))return[new Ot(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!fe(n))return[new Ot(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!fe(n))return[new Ot(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!pe(n,["zoom","feature-state"]))return[new Ot(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!he(n))return[new Ot(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Dn(t){var e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(Ct(n))&&r.push(new Ot(e,n,"expected one of ["+i.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(i.values).indexOf(Ct(n))&&r.push(new Ot(e,n,"expected one of ["+Object.keys(i.values).join(", ")+"], "+JSON.stringify(n)+" found")),r}function Bn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var i=n[e];if(!Bn(i)&&"boolean"!=typeof i)return!1}return!0;default:return!0}}Cn.deserialize=function(t){return new Cn(t._parameters,t._specification)},Cn.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var Rn={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fn(t){if(null==t)return function(){return!0};Bn(t)||(t=Un(t));var e=kn(t,Rn);if("error"===e.result)throw new Error(e.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,n){return e.value.evaluate(t,n)}}function Nn(t,e){return t<e?-1:t>e?1:0}function Un(t){if(!t)return!0;var e,n=t[0];return t.length<=1?"any"!==n:"=="===n?Vn(t[1],t[2],"=="):"!="===n?Hn(Vn(t[1],t[2],"==")):"<"===n||">"===n||"<="===n||">="===n?Vn(t[1],t[2],n):"any"===n?(e=t.slice(1),["any"].concat(e.map(Un))):"all"===n?["all"].concat(t.slice(1).map(Un)):"none"===n?["all"].concat(t.slice(1).map(Un).map(Hn)):"in"===n?Gn(t[1],t.slice(2)):"!in"===n?Hn(Gn(t[1],t.slice(2))):"has"===n?Wn(t[1]):"!has"!==n||Hn(Wn(t[1]))}function Vn(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function Gn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(Nn)]]:["filter-in-small",t,["literal",e]]}}function Wn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Hn(t){return["!",t]}function qn(t){return Bn(Tt(t.value))?zn(Et({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value,i=e.key;if("array"!==An(n))return[new Ot(i,n,"array expected, "+An(n)+" found")];var r,a=e.styleSpec,o=[];if(n.length<1)return[new Ot(i,n,"filter array must have at least 1 element")];switch(o=o.concat(Dn({key:i+"[0]",value:n[0],valueSpec:a.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ct(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Ct(n[1])&&o.push(new Ot(i,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&o.push(new Ot(i,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(r=An(n[1]))&&o.push(new Ot(i+"[1]",n[1],"string expected, "+r+" found"));for(var s=2;s<n.length;s++)r=An(n[s]),"$type"===Ct(n[1])?o=o.concat(Dn({key:i+"["+s+"]",value:n[s],valueSpec:a.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Ot(i+"["+s+"]",n[s],"string, number, or boolean expected, "+r+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)o=o.concat(t({key:i+"["+u+"]",value:n[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=An(n[1]),2!==n.length?o.push(new Ot(i,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==r&&o.push(new Ot(i+"[1]",n[1],"string expected, "+r+" found"))}return o}(t)}function Zn(t,e){var n=t.key,i=t.style,r=t.styleSpec,a=t.value,o=t.objectKey,s=r[e+"_"+t.layerType];if(!s)return[];var u=o.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return ei({key:n,value:a,valueSpec:r.transition,style:i,styleSpec:r});var l,c=t.valueSpec||s[o];if(!c)return[new Ot(n,a,'unknown property "'+o+'"')];if("string"===An(a)&&hn(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(a)))return[new Ot(n,a,'"'+o+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===o&&i&&!i.glyphs&&h.push(new Ot(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&dn(Tt(a))&&"identity"===Ct(a.type)&&h.push(new Ot(n,a,'"text-font" does not support identity functions'))),h.concat(ei({key:t.key,value:a,valueSpec:c,style:i,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:o}))}function Xn(t){return Zn(t,"paint")}function Qn(t){return Zn(t,"layout")}function Yn(t){var e=[],n=t.value,i=t.key,r=t.style,a=t.styleSpec;n.type||n.ref||e.push(new Ot(i,n,'either "type" or "ref" is required'));var o,s=Ct(n.type),u=Ct(n.ref);if(n.id)for(var l=Ct(n.id),c=0;c<t.arrayIndex;c++){var h=r.layers[c];Ct(h.id)===l&&e.push(new Ot(i,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach(function(t){t in n&&e.push(new Ot(i,n[t],'"'+t+'" is prohibited for ref layers'))}),r.layers.forEach(function(t){Ct(t.id)===u&&(o=t)}),o?o.ref?e.push(new Ot(i,n.ref,"ref cannot reference another ref layer")):s=Ct(o.type):e.push(new Ot(i,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var f=r.sources&&r.sources[n.source],p=f&&Ct(f.type);f?"vector"===p&&"raster"===s?e.push(new Ot(i,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===p&&"raster"!==s?e.push(new Ot(i,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==p||n["source-layer"]?"raster-dem"===p&&"hillshade"!==s?e.push(new Ot(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===p&&f.lineMetrics||e.push(new Ot(i,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Ot(i,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new Ot(i,n.source,'source "'+n.source+'" not found'))}else e.push(new Ot(i,n,'missing required property "source"'));return e=e.concat(Mn({key:i,value:n,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ei({key:i+".type",value:n.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:qn,layout:function(t){return Mn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Qn(Et({layerType:s},t))}}})},paint:function(t){return Mn({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Xn(Et({layerType:s},t))}}})}}}))}function Kn(t){var e=t.value,n=t.key,i=t.styleSpec,r=t.style;if(!e.type)return[new Ot(n,e,'"type" is required')];var a,o=Ct(e.type);switch(o){case"vector":case"raster":case"raster-dem":if(a=Mn({key:n,value:e,valueSpec:i["source_"+o.replace("-","_")],style:t.style,styleSpec:i}),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&a.push(new Ot(n+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return a;case"geojson":if(a=Mn({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i}),e.cluster)for(var u in e.clusterProperties){var l=e.clusterProperties[u],c=l[0],h=l[1],f="string"==typeof c?[c,["accumulated"],["get",u]]:c;a.push.apply(a,zn({key:n+"."+u+".map",value:h,expressionContext:"cluster-map"})),a.push.apply(a,zn({key:n+"."+u+".reduce",value:f,expressionContext:"cluster-reduce"}))}return a;case"video":return Mn({key:n,value:e,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return Mn({key:n,value:e,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new Ot(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dn({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:i})}}function Jn(t){var e=t.value,n=t.styleSpec,i=n.light,r=t.style,a=[],o=An(e);if(void 0===e)return a;if("object"!==o)return a.concat([new Ot("light",e,"object expected, "+o+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);a=u&&i[u[1]]&&i[u[1]].transition?a.concat(ei({key:s,value:e[s],valueSpec:n.transition,style:r,styleSpec:n})):i[s]?a.concat(ei({key:s,value:e[s],valueSpec:i[s],style:r,styleSpec:n})):a.concat([new Ot(s,e[s],'unknown property "'+s+'"')])}return a}function $n(t){var e=t.value,n=t.key,i=An(e);return"string"!==i?[new Ot(n,e,"string expected, "+i+" found")]:[]}var ti={"*":function(){return[]},array:jn,boolean:function(t){var e=t.value,n=t.key,i=An(e);return"boolean"!==i?[new Ot(n,e,"boolean expected, "+i+" found")]:[]},number:Ln,color:function(t){var e=t.key,n=t.value,i=An(n);return"string"!==i?[new Ot(e,n,"color expected, "+i+" found")]:null===qt(n)?[new Ot(e,n,'color expected, "'+n+'" found')]:[]},constants:Pt,enum:Dn,filter:qn,function:In,layer:Yn,object:Mn,source:Kn,light:Jn,string:$n,formatted:function(t){return 0===$n(t).length?[]:zn(t)}};function ei(t){var e=t.value,n=t.valueSpec,i=t.styleSpec;return n.expression&&dn(Ct(e))?In(t):n.expression&&Sn(Tt(e))?zn(t):n.type&&ti[n.type]?ti[n.type](t):Mn(Et({},t,{valueSpec:n.type?i[n.type]:n}))}function ni(t){var e=t.value,n=t.key,i=$n(t);return i.length?i:(-1===e.indexOf("{fontstack}")&&i.push(new Ot(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Ot(n,e,'"glyphs" url must include a "{range}" token')),i)}function ii(t,e){e=e||kt;var n=[];return n=n.concat(ei({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ni,"*":function(){return[]}}})),t.constants&&(n=n.concat(Pt({key:"constants",value:t.constants,style:t,styleSpec:e}))),ri(n)}function ri(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function ai(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return ri(t.apply(this,e))}}ii.source=ai(Kn),ii.light=ai(Jn),ii.layer=ai(Yn),ii.filter=ai(qn),ii.paintProperty=ai(Xn),ii.layoutProperty=ai(Qn);var oi=ii,si=ii.light,ui=ii.paintProperty,li=ii.layoutProperty;function ci(t,e){var n=!1;if(e&&e.length)for(var i=0,r=e;i<r.length;i+=1){var a=r[i];t.fire(new wt(new Error(a.message))),n=!0}return n}var hi=pi,fi=3;function pi(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],e=r[1],n=r[2],this.d=e+2*n;for(var a=0;a<this.d*this.d;a++){var o=r[fi+a],s=r[fi+a+1];i.push(o===s?null:r.subarray(o,s))}var u=r[fi+i.length],l=r[fi+i.length+1];this.keys=r.subarray(u,l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var h=n/e*t;this.min=-h,this.max=t+h}pi.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},pi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},pi.prototype._insertCell=function(t,e,n,i,r,a){this.cells[r].push(a)},pi.prototype.query=function(t,e,n,i,r){var a=this.min,o=this.max;if(t<=a&&e<=a&&o<=n&&o<=i&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,i,this._queryCell,s,{},r),s},pi.prototype._queryCell=function(t,e,n,i,r,a,o,s){var u=this.cells[r];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var f=u[h];if(void 0===o[f]){var p=4*f;(s?s(c[p+0],c[p+1],c[p+2],c[p+3]):t<=c[p+2]&&e<=c[p+3]&&n>=c[p+0]&&i>=c[p+1])?(o[f]=!0,a.push(l[f])):o[f]=!1}}},pi.prototype._forEachCell=function(t,e,n,i,r,a,o,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(n),h=this._convertToCellCoord(i),f=u;f<=c;f++)for(var p=l;p<=h;p++){var A=this.d*p+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(p),this._convertFromCellCoord(f+1),this._convertFromCellCoord(p+1)))&&r.call(this,t,e,n,i,A,a,o,s))return}},pi.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},pi.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},pi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=fi+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(e+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var a=e,o=0;o<t.length;o++){var s=t[o];r[fi+o]=a,r.set(s,a),a+=s.length}return r[fi+t.length]=a,r.set(this.keys,a),a+=this.keys.length,r[fi+t.length+1]=a,r.set(this.bboxes,a),a+=this.bboxes.length,r.buffer};var Ai=self.ImageData,di={};function vi(t,e,n){void 0===n&&(n={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),di[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var gi in vi("Object",Object),hi.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},hi.deserialize=function(t){return new hi(t.buffer)},vi("Grid",hi),vi("Color",Zt),vi("Error",Error),vi("StylePropertyFunction",Cn),vi("StyleExpression",wn,{omit:["_evaluator"]}),vi("ZoomDependentExpression",Pn),vi("ZoomConstantExpression",On),vi("CompoundExpression",le,{omit:["_evaluate"]}),rn)rn[gi]._classRegistryKey||vi("Expression_"+gi,rn[gi]);function mi(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof Ai)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var i=[],r=0,a=t;r<a.length;r+=1){var o=a[r];i.push(mi(o,e))}return i}if("object"==typeof t){var s=t.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");var l=s.serialize?s.serialize(t,e):{};if(!s.serialize){for(var c in t)if(t.hasOwnProperty(c)&&!(di[u].omit.indexOf(c)>=0)){var h=t[c];l[c]=di[u].shallow.indexOf(c)>=0?h:mi(h,e)}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(l.$name=u),l}throw new Error("can't serialize object of type "+typeof t)}function yi(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof Ai)return t;if(Array.isArray(t))return t.map(yi);if("object"==typeof t){var e=t.$name||"Object",n=di[e].klass;if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);for(var i=Object.create(n.prototype),r=0,a=Object.keys(t);r<a.length;r+=1){var o=a[r];if("$name"!==o){var s=t[o];i[o]=di[e].shallow.indexOf(o)>=0?s:yi(s)}}return i}throw new Error("can't deserialize object of type "+typeof t)}var _i=function(){this.first=!0};_i.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};var bi={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function xi(t){for(var e=0,n=t;e<n.length;e+=1)if(ki(n[e].charCodeAt(0)))return!0;return!1}function wi(t){for(var e=0,n=t;e<n.length;e+=1)if(!Si(n[e].charCodeAt(0)))return!1;return!0}function Si(t){return!(bi.Arabic(t)||bi["Arabic Supplement"](t)||bi["Arabic Extended-A"](t)||bi["Arabic Presentation Forms-A"](t)||bi["Arabic Presentation Forms-B"](t))}function ki(t){return!(746!==t&&747!==t&&(t<4352||!(bi["Bopomofo Extended"](t)||bi.Bopomofo(t)||bi["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||bi["CJK Compatibility Ideographs"](t)||bi["CJK Compatibility"](t)||bi["CJK Radicals Supplement"](t)||bi["CJK Strokes"](t)||!(!bi["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||bi["CJK Unified Ideographs Extension A"](t)||bi["CJK Unified Ideographs"](t)||bi["Enclosed CJK Letters and Months"](t)||bi["Hangul Compatibility Jamo"](t)||bi["Hangul Jamo Extended-A"](t)||bi["Hangul Jamo Extended-B"](t)||bi["Hangul Jamo"](t)||bi["Hangul Syllables"](t)||bi.Hiragana(t)||bi["Ideographic Description Characters"](t)||bi.Kanbun(t)||bi["Kangxi Radicals"](t)||bi["Katakana Phonetic Extensions"](t)||bi.Katakana(t)&&12540!==t||!(!bi["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!bi["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||bi["Unified Canadian Aboriginal Syllabics"](t)||bi["Unified Canadian Aboriginal Syllabics Extended"](t)||bi["Vertical Forms"](t)||bi["Yijing Hexagram Symbols"](t)||bi["Yi Syllables"](t)||bi["Yi Radicals"](t))))}function Oi(t){return!(ki(t)||function(t){return!!(bi["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||bi["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||bi["Letterlike Symbols"](t)||bi["Number Forms"](t)||bi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||bi["Control Pictures"](t)&&9251!==t||bi["Optical Character Recognition"](t)||bi["Enclosed Alphanumerics"](t)||bi["Geometric Shapes"](t)||bi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||bi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||bi["CJK Symbols and Punctuation"](t)||bi.Katakana(t)||bi["Private Use Area"](t)||bi["CJK Compatibility Forms"](t)||bi["Small Form Variants"](t)||bi["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Pi(t,e){return!(!e&&(t>=1424&&t<=2303||bi["Arabic Presentation Forms-A"](t)||bi["Arabic Presentation Forms-B"](t))||t>=2304&&t<=3583||t>=3840&&t<=4255||bi.Khmer(t))}var Ei,Ci=!1,Ti=null,Mi=!1,ji=new St,Li={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Mi||null!=Li.applyArabicShaping}},Ii=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _i,this.transition={})};Ii.prototype.isSupportedScript=function(t){return function(t,e){for(var n=0,i=t;n<i.length;n+=1)if(!Pi(i[n].charCodeAt(0),e))return!1;return!0}(t,Li.isLoaded())},Ii.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ii.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}};var zi=function(t,e){this.property=t,this.value=e,this.expression=Tn(void 0===e?t.specification.default:e,t.specification)};zi.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},zi.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var Di=function(t){this.property=t,this.value=new zi(t,void 0)};Di.prototype.transitioned=function(t,e){return new Ri(this.property,this.value,e,h({},t.transition,this.transition),t.now)},Di.prototype.untransitioned=function(){return new Ri(this.property,this.value,null,{},0)};var Bi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Bi.prototype.getValue=function(t){return _(this._values[t].value.value)},Bi.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Di(this._values[t].property)),this._values[t].value=new zi(this._values[t].property,null===e?void 0:_(e))},Bi.prototype.getTransition=function(t){return _(this._values[t].transition)},Bi.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Di(this._values[t].property)),this._values[t].transition=_(e)||void 0},Bi.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e],r=this.getValue(i);void 0!==r&&(t[i]=r);var a=this.getTransition(i);void 0!==a&&(t[i+"-transition"]=a)}return t},Bi.prototype.transitioned=function(t,e){for(var n=new Fi(this._properties),i=0,r=Object.keys(this._values);i<r.length;i+=1){var a=r[i];n._values[a]=this._values[a].transitioned(t,e._values[a])}return n},Bi.prototype.untransitioned=function(){for(var t=new Fi(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e];t._values[i]=this._values[i].untransitioned()}return t};var Ri=function(t,e,n,i,r){this.property=t,this.value=e,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)};Ri.prototype.possiblyEvaluate=function(t){var e=t.now||0,n=this.value.possiblyEvaluate(t),i=this.prior;if(i){if(e>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(e<this.begin)return i.possiblyEvaluate(t);var r=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(i.possiblyEvaluate(t),n,function(t){if(r<=0)return 0;if(r>=1)return 1;var e=r*r,n=e*r;return 4*(r<.5?n:3*(r-e)+n-.75)}())}return n};var Fi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Fi.prototype.possiblyEvaluate=function(t){for(var e=new Vi(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var r=i[n];e._values[r]=this._values[r].possiblyEvaluate(t)}return e},Fi.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var n=e[t];if(this._values[n].prior)return!0}return!1};var Ni=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Ni.prototype.getValue=function(t){return _(this._values[t].value)},Ni.prototype.setValue=function(t,e){this._values[t]=new zi(this._values[t].property,null===e?void 0:_(e))},Ni.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var i=n[e],r=this.getValue(i);void 0!==r&&(t[i]=r)}return t},Ni.prototype.possiblyEvaluate=function(t){for(var e=new Vi(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var r=i[n];e._values[r]=this._values[r].possiblyEvaluate(t)}return e};var Ui=function(t,e,n){this.property=t,this.value=e,this.parameters=n};Ui.prototype.isConstant=function(){return"constant"===this.value.kind},Ui.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},Ui.prototype.evaluate=function(t,e){return this.property.evaluate(this.value,this.parameters,t,e)};var Vi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Vi.prototype.get=function(t){return this._values[t]};var Gi=function(t){this.specification=t};Gi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},Gi.prototype.interpolate=function(t,e,n){var i=ye[this.specification.type];return i?i(t,e,n):t};var Wi=function(t){this.specification=t};Wi.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new Ui(this,{kind:"constant",value:t.expression.evaluate(e)},e):new Ui(this,t.expression,e)},Wi.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Ui(this,{kind:"constant",value:void 0},t.parameters);var i=ye[this.specification.type];return i?new Ui(this,{kind:"constant",value:i(t.value.value,e.value.value,n)},t.parameters):t},Wi.prototype.evaluate=function(t,e,n,i){return"constant"===t.kind?t.value:t.evaluate(e,n,i)};var Hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(t,e){if(void 0===t.value)return new Ui(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var n=t.expression.evaluate(e),i=this._calculate(n,n,n,e);return new Ui(this,{kind:"constant",value:i},e)}if("camera"===t.expression.kind){var r=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Ui(this,{kind:"constant",value:r},e)}return new Ui(this,t.expression,e)},e.prototype.evaluate=function(t,e,n,i){if("source"===t.kind){var r=t.evaluate(e,n,i);return this._calculate(r,r,r,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,i),t.evaluate({zoom:Math.floor(e.zoom)},n,i),t.evaluate({zoom:Math.floor(e.zoom)+1},n,i),e):t.value},e.prototype._calculate=function(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},e.prototype.interpolate=function(t){return t},e}(Wi),qi=function(t){this.specification=t};qi.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"===t.expression.kind){var n=t.expression.evaluate(e);return this._calculate(n,n,n,e)}return this._calculate(t.expression.evaluate(new Ii(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Ii(Math.floor(e.zoom),e)),t.expression.evaluate(new Ii(Math.floor(e.zoom+1),e)),e)}},qi.prototype._calculate=function(t,e,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},qi.prototype.interpolate=function(t){return t};var Zi=function(t){this.specification=t};Zi.prototype.possiblyEvaluate=function(t,e){return!!t.expression.evaluate(e)},Zi.prototype.interpolate=function(){return!1};var Xi=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var n=t[e],i=this.defaultPropertyValues[e]=new zi(n,void 0),r=this.defaultTransitionablePropertyValues[e]=new Di(n);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}};vi("DataDrivenProperty",Wi),vi("DataConstantProperty",Gi),vi("CrossFadedDataDrivenProperty",Hi),vi("CrossFadedProperty",qi),vi("ColorRampProperty",Zi);var Qi=function(t){function e(e,n){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter=function(){return!0},"custom"!==e.type&&(e=e,this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Ni(n.layout)),n.paint)){for(var i in this._transitionablePaint=new Bi(n.paint),e.paint)this.setPaintProperty(i,e.paint[i],{validate:!1});for(var r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e){var i="layers."+this.id+".layout."+t;if(this._validate(li,i,t,e,n))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e},e.prototype.getPaintProperty=function(t){return g(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e){var i="layers."+this.id+".paint."+t;if(this._validate(ui,i,t,e,n))return!1}if(g(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var r=this._transitionablePaint._values[t],a="cross-faded-data-driven"===r.property.specification["property-type"]&&!r.value.value&&e,o=this._transitionablePaint._values[t].value.isDataDriven();this._transitionablePaint.setValue(t,e);var s=this._transitionablePaint._values[t].value.isDataDriven();return this._handleSpecialPaintPropertyUpdate(t),s||o||a},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),y(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},e.prototype._validate=function(t,e,n,i,r){return void 0===r&&(r={}),(!r||!1!==r.validate)&&ci(this,t.call(oi,{key:e,layerType:this.type,objectKey:n,value:i,styleSpec:kt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof Ui&&hn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(St),Yi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ki=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ji=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function $i(t,e){void 0===e&&(e=1);var n=0,i=0;return{members:t.map(function(t){var r,a=(r=t.type,Yi[r].BYTES_PER_ELEMENT),o=n=tr(n,Math.max(e,a)),s=t.components||1;return i=Math.max(i,a),n+=a*s,{name:t.name,type:t.type,components:s,offset:o}}),size:tr(n,Math.max(i,e)),alignment:e}}function tr(t,e){return Math.ceil(t/e)*e}Ji.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ji.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Ji.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ji.prototype.clear=function(){this.length=0},Ji.prototype.resize=function(t){this.reserve(t),this.length=t},Ji.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Ji.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var er=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var i=2*t;return this.int16[i+0]=e,this.int16[i+1]=n,t},e}(Ji);er.prototype.bytesPerElement=4,vi("StructArrayLayout2i4",er);var nr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)},e.prototype.emplace=function(t,e,n,i,r){var a=4*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,t},e}(Ji);nr.prototype.bytesPerElement=8,vi("StructArrayLayout4i8",nr);var ir=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)},e.prototype.emplace=function(t,e,n,i,r,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Ji);ir.prototype.bytesPerElement=12,vi("StructArrayLayout2i4i12",ir);var rr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,a,o,s)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u){var l=6*t,c=12*t;return this.int16[l+0]=e,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+3]=r,this.uint8[c+8]=a,this.uint8[c+9]=o,this.uint8[c+10]=s,this.uint8[c+11]=u,t},e}(Ji);rr.prototype.bytesPerElement=12,vi("StructArrayLayout4i4ub12",rr);var ar=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,a,o,s)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u){var l=8*t;return this.uint16[l+0]=e,this.uint16[l+1]=n,this.uint16[l+2]=i,this.uint16[l+3]=r,this.uint16[l+4]=a,this.uint16[l+5]=o,this.uint16[l+6]=s,this.uint16[l+7]=u,t},e}(Ji);ar.prototype.bytesPerElement=16,vi("StructArrayLayout8ui16",ar);var or=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,i,r,a,o,s)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u){var l=8*t;return this.int16[l+0]=e,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+3]=r,this.uint16[l+4]=a,this.uint16[l+5]=o,this.uint16[l+6]=s,this.uint16[l+7]=u,t},e}(Ji);or.prototype.bytesPerElement=16,vi("StructArrayLayout4i4ui16",or);var sr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=3*t;return this.float32[r+0]=e,this.float32[r+1]=n,this.float32[r+2]=i,t},e}(Ji);sr.prototype.bytesPerElement=12,vi("StructArrayLayout3f12",sr);var ur=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var n=1*t;return this.uint32[n+0]=e,t},e}(Ji);ur.prototype.bytesPerElement=4,vi("StructArrayLayout1ul4",ur);var lr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s,u,l,c){var h=this.length;return this.resize(h+1),this.emplace(h,t,e,n,i,r,a,o,s,u,l,c)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u,l,c,h){var f=12*t,p=6*t;return this.int16[f+0]=e,this.int16[f+1]=n,this.int16[f+2]=i,this.int16[f+3]=r,this.int16[f+4]=a,this.int16[f+5]=o,this.uint32[p+3]=s,this.uint16[f+8]=u,this.uint16[f+9]=l,this.int16[f+10]=c,this.int16[f+11]=h,t},e}(Ji);lr.prototype.bytesPerElement=24,vi("StructArrayLayout6i1ul2ui2i24",lr);var cr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,i,r,a)},e.prototype.emplace=function(t,e,n,i,r,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=i,this.int16[s+3]=r,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Ji);cr.prototype.bytesPerElement=12,vi("StructArrayLayout2i2i2i12",cr);var hr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)},e.prototype.emplace=function(t,e,n,i,r){var a=12*t,o=3*t;return this.uint8[a+0]=e,this.uint8[a+1]=n,this.float32[o+1]=i,this.float32[o+2]=r,t},e}(Ji);hr.prototype.bytesPerElement=12,vi("StructArrayLayout2ub2f12",hr);var fr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s,u,l,c,h,f,p,A){var d=this.length;return this.resize(d+1),this.emplace(d,t,e,n,i,r,a,o,s,u,l,c,h,f,p,A)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u,l,c,h,f,p,A,d){var v=22*t,g=11*t,m=44*t;return this.int16[v+0]=e,this.int16[v+1]=n,this.uint16[v+2]=i,this.uint16[v+3]=r,this.uint32[g+2]=a,this.uint32[g+3]=o,this.uint32[g+4]=s,this.uint16[v+10]=u,this.uint16[v+11]=l,this.uint16[v+12]=c,this.float32[g+7]=h,this.float32[g+8]=f,this.uint8[m+36]=p,this.uint8[m+37]=A,this.uint32[g+10]=d,t},e}(Ji);fr.prototype.bytesPerElement=44,vi("StructArrayLayout2i2ui3ul3ui2f2ub1ul44",fr);var pr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i,r,a,o,s,u,l,c,h,f,p,A,d,v,g){var m=this.length;return this.resize(m+1),this.emplace(m,t,e,n,i,r,a,o,s,u,l,c,h,f,p,A,d,v,g)},e.prototype.emplace=function(t,e,n,i,r,a,o,s,u,l,c,h,f,p,A,d,v,g,m){var y=22*t,_=11*t;return this.int16[y+0]=e,this.int16[y+1]=n,this.int16[y+2]=i,this.int16[y+3]=r,this.int16[y+4]=a,this.int16[y+5]=o,this.uint16[y+6]=s,this.uint16[y+7]=u,this.uint16[y+8]=l,this.uint16[y+9]=c,this.uint16[y+10]=h,this.uint16[y+11]=f,this.uint16[y+12]=p,this.uint16[y+13]=A,this.uint16[y+14]=d,this.uint32[_+8]=v,this.float32[_+9]=g,this.float32[_+10]=m,t},e}(Ji);pr.prototype.bytesPerElement=44,vi("StructArrayLayout6i9ui1ul2f44",pr);var Ar=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var n=1*t;return this.float32[n+0]=e,t},e}(Ji);Ar.prototype.bytesPerElement=4,vi("StructArrayLayout1f4",Ar);var dr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=3*t;return this.int16[r+0]=e,this.int16[r+1]=n,this.int16[r+2]=i,t},e}(Ji);dr.prototype.bytesPerElement=6,vi("StructArrayLayout3i6",dr);var vr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=2*t,a=4*t;return this.uint32[r+0]=e,this.uint16[a+2]=n,this.uint16[a+3]=i,t},e}(Ji);vr.prototype.bytesPerElement=8,vi("StructArrayLayout1ul2ui8",vr);var gr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n)},e.prototype.emplace=function(t,e,n,i){var r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,this.uint16[r+2]=i,t},e}(Ji);gr.prototype.bytesPerElement=6,vi("StructArrayLayout3ui6",gr);var mr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,t},e}(Ji);mr.prototype.bytesPerElement=4,vi("StructArrayLayout2ui4",mr);var yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var n=1*t;return this.uint16[n+0]=e,t},e}(Ji);yr.prototype.bytesPerElement=2,vi("StructArrayLayout1ui2",yr);var _r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var i=2*t;return this.float32[i+0]=e,this.float32[i+1]=n,t},e}(Ji);_r.prototype.bytesPerElement=8,vi("StructArrayLayout2f8",_r);var br=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,i){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n,i)},e.prototype.emplace=function(t,e,n,i,r){var a=4*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=r,t},e}(Ji);br.prototype.bytesPerElement=16,vi("StructArrayLayout4f16",br);var xr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},n.radius.get=function(){return this._structArray.int16[this._pos2+10]},n.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},n.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},n.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},n.anchorPoint.get=function(){return new r(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(Ki);xr.prototype.size=24;var wr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new xr(this,t)},e}(lr);vi("CollisionBoxArray",wr);var Sr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},Object.defineProperties(e.prototype,n),e}(Ki);Sr.prototype.size=44;var kr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Sr(this,t)},e}(fr);vi("PlacedSymbolArray",kr);var Or=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},radialTextOffset:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.rightJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+2]=t},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.centerJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+3]=t},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.leftJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+4]=t},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.verticalPlacedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+5]=t},n.key.get=function(){return this._structArray.uint16[this._pos2+6]},n.key.set=function(t){this._structArray.uint16[this._pos2+6]=t},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+7]},n.textBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+7]=t},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.iconBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.iconBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+10]=t},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.featureIndex.set=function(t){this._structArray.uint16[this._pos2+11]=t},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+12]},n.numHorizontalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+12]=t},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+13]},n.numVerticalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+13]=t},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+14]},n.numIconVertices.set=function(t){this._structArray.uint16[this._pos2+14]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+8]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+8]=t},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+9]},n.textBoxScale.set=function(t){this._structArray.float32[this._pos4+9]=t},n.radialTextOffset.get=function(){return this._structArray.float32[this._pos4+10]},n.radialTextOffset.set=function(t){this._structArray.float32[this._pos4+10]=t},Object.defineProperties(e.prototype,n),e}(Ki);Or.prototype.size=44;var Pr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Or(this,t)},e}(pr);vi("SymbolInstanceArray",Pr);var Er=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={offsetX:{configurable:!0}};return n.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},n.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,n),e}(Ki);Er.prototype.size=4;var Cr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new Er(this,t)},e}(Ar);vi("GlyphOffsetArray",Cr);var Tr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return n.x.get=function(){return this._structArray.int16[this._pos2+0]},n.x.set=function(t){this._structArray.int16[this._pos2+0]=t},n.y.get=function(){return this._structArray.int16[this._pos2+1]},n.y.set=function(t){this._structArray.int16[this._pos2+1]=t},n.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},n.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,n),e}(Ki);Tr.prototype.size=6;var Mr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new Tr(this,t)},e}(dr);vi("SymbolLineVertexArray",Mr);var jr=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},n.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,n),e}(Ki);jr.prototype.size=8;var Lr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new jr(this,t)},e}(vr);vi("FeatureIndexArray",Lr);var Ir=$i([{name:"a_pos",components:2,type:"Int16"}],4).members,zr=function(t){void 0===t&&(t=[]),this.segments=t};function Dr(t,e){return 256*(t=l(Math.floor(t),0,255))+l(Math.floor(e),0,255)}zr.prototype.prepareSegment=function(t,e,n,i){var r=this.segments[this.segments.length-1];return t>zr.MAX_VERTEX_ARRAY_LENGTH&&x("Max vertices per segment is "+zr.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!r||r.vertexLength+t>zr.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r},zr.prototype.get=function(){return this.segments},zr.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var i in n.vaos)n.vaos[i].destroy()}},zr.simpleSegment=function(t,e,n,i){return new zr([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])},zr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vi("SegmentVector",zr);var Br=function(){this.ids=[],this.positions=[],this.indexed=!1};function Rr(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}Br.prototype.add=function(t,e,n,i){this.ids.push(t),this.positions.push(e,n,i)},Br.prototype.getPositions=function(t){for(var e=0,n=this.ids.length-1;e<n;){var i=e+n>>1;this.ids[i]>=t?n=i:e=i+1}for(var r=[];this.ids[e]===t;){var a=this.positions[3*e],o=this.positions[3*e+1],s=this.positions[3*e+2];r.push({index:a,start:o,end:s}),e++}return r},Br.serialize=function(t,e){var n=new Float64Array(t.ids),i=new Uint32Array(t.positions);return function t(e,n,i,r){if(!(i>=r)){for(var a=e[i+r>>1],o=i-1,s=r+1;;){do{o++}while(e[o]<a);do{s--}while(e[s]>a);if(o>=s)break;Rr(e,o,s),Rr(n,3*o,3*s),Rr(n,3*o+1,3*s+1),Rr(n,3*o+2,3*s+2)}t(e,n,i,s),t(e,n,s+1,r)}}(n,i,0,n.length-1),e.push(n.buffer,i.buffer),{ids:n,positions:i}},Br.deserialize=function(t){var e=new Br;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e},vi("FeaturePositionMap",Br);var Fr=function(t,e){this.gl=t.gl,this.location=e},Nr=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(Fr),Ur=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(Fr),Vr=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(Fr),Gr=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(Fr),Wr=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(Fr),Hr=function(t){function e(e,n){t.call(this,e,n),this.current=Zt.transparent}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(Fr),qr=new Float32Array(16),Zr=function(t){function e(e,n){t.call(this,e,n),this.current=qr}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(Fr);function Xr(t){return[Dr(255*t.r,255*t.g),Dr(255*t.b,255*t.a)]}var Qr=function(t,e,n){this.value=t,this.names=e,this.uniformNames=this.names.map(function(t){return"u_"+t}),this.type=n,this.maxValue=-1/0};Qr.prototype.defines=function(){return this.names.map(function(t){return"#define HAS_UNIFORM_u_"+t})},Qr.prototype.setConstantPatternPositions=function(){},Qr.prototype.populatePaintArray=function(){},Qr.prototype.updatePaintArray=function(){},Qr.prototype.upload=function(){},Qr.prototype.destroy=function(){},Qr.prototype.setUniforms=function(t,e,n,i){e.set(i.constantOr(this.value))},Qr.prototype.getBinding=function(t,e){return"color"===this.type?new Hr(t,e):new Ur(t,e)},Qr.serialize=function(t){var e=t.value,n=t.names,i=t.type;return{value:mi(e),names:n,type:i}},Qr.deserialize=function(t){var e=t.value,n=t.names,i=t.type;return new Qr(yi(e),n,i)};var Yr=function(t,e,n){this.value=t,this.names=e,this.uniformNames=this.names.map(function(t){return"u_"+t}),this.type=n,this.maxValue=-1/0,this.patternPositions={patternTo:null,patternFrom:null}};Yr.prototype.defines=function(){return this.names.map(function(t){return"#define HAS_UNIFORM_u_"+t})},Yr.prototype.populatePaintArray=function(){},Yr.prototype.updatePaintArray=function(){},Yr.prototype.upload=function(){},Yr.prototype.destroy=function(){},Yr.prototype.setConstantPatternPositions=function(t,e){this.patternPositions.patternTo=t.tlbr,this.patternPositions.patternFrom=e.tlbr},Yr.prototype.setUniforms=function(t,e,n,i,r){var a=this.patternPositions;"u_pattern_to"===r&&a.patternTo&&e.set(a.patternTo),"u_pattern_from"===r&&a.patternFrom&&e.set(a.patternFrom)},Yr.prototype.getBinding=function(t,e){return new Wr(t,e)};var Kr=function(t,e,n,i){this.expression=t,this.names=e,this.type=n,this.uniformNames=this.names.map(function(t){return"a_"+t}),this.maxValue=-1/0,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0}}),this.paintVertexArray=new i};Kr.prototype.defines=function(){return[]},Kr.prototype.setConstantPatternPositions=function(){},Kr.prototype.populatePaintArray=function(t,e){var n=this.paintVertexArray,i=n.length;n.reserve(t);var r=this.expression.evaluate(new Ii(0),e,{});if("color"===this.type)for(var a=Xr(r),o=i;o<t;o++)n.emplaceBack(a[0],a[1]);else{for(var s=i;s<t;s++)n.emplaceBack(r);this.maxValue=Math.max(this.maxValue,r)}},Kr.prototype.updatePaintArray=function(t,e,n,i){var r=this.paintVertexArray,a=this.expression.evaluate({zoom:0},n,i);if("color"===this.type)for(var o=Xr(a),s=t;s<e;s++)r.emplace(s,o[0],o[1]);else{for(var u=t;u<e;u++)r.emplace(u,a);this.maxValue=Math.max(this.maxValue,a)}},Kr.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Kr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Kr.prototype.setUniforms=function(t,e){e.set(0)},Kr.prototype.getBinding=function(t,e){return new Ur(t,e)};var Jr=function(t,e,n,i,r,a){this.expression=t,this.names=e,this.uniformNames=this.names.map(function(t){return"a_"+t+"_t"}),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=-1/0;var o=a;this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0}}),this.paintVertexArray=new o};Jr.prototype.defines=function(){return[]},Jr.prototype.setConstantPatternPositions=function(){},Jr.prototype.populatePaintArray=function(t,e){var n=this.paintVertexArray,i=n.length;n.reserve(t);var r=this.expression.evaluate(new Ii(this.zoom),e,{}),a=this.expression.evaluate(new Ii(this.zoom+1),e,{});if("color"===this.type)for(var o=Xr(r),s=Xr(a),u=i;u<t;u++)n.emplaceBack(o[0],o[1],s[0],s[1]);else{for(var l=i;l<t;l++)n.emplaceBack(r,a);this.maxValue=Math.max(this.maxValue,r,a)}},Jr.prototype.updatePaintArray=function(t,e,n,i){var r=this.paintVertexArray,a=this.expression.evaluate({zoom:this.zoom},n,i),o=this.expression.evaluate({zoom:this.zoom+1},n,i);if("color"===this.type)for(var s=Xr(a),u=Xr(o),l=t;l<e;l++)r.emplace(l,s[0],s[1],u[0],u[1]);else{for(var c=t;c<e;c++)r.emplace(c,a,o);this.maxValue=Math.max(this.maxValue,a,o)}},Jr.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Jr.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Jr.prototype.interpolationFactor=function(t){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(t),this.zoom,this.zoom+1):this.expression.interpolationFactor(t,this.zoom,this.zoom+1)},Jr.prototype.setUniforms=function(t,e,n){e.set(this.interpolationFactor(n.zoom))},Jr.prototype.getBinding=function(t,e){return new Ur(t,e)};var $r=function(t,e,n,i,r,a,o){this.expression=t,this.names=e,this.type=n,this.uniformNames=this.names.map(function(t){return"a_"+t+"_t"}),this.useIntegerZoom=i,this.zoom=r,this.maxValue=-1/0,this.layerId=o,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Uint16",components:4,offset:0}}),this.zoomInPaintVertexArray=new a,this.zoomOutPaintVertexArray=new a};$r.prototype.defines=function(){return[]},$r.prototype.setConstantPatternPositions=function(){},$r.prototype.populatePaintArray=function(t,e,n){var i=this.zoomInPaintVertexArray,r=this.zoomOutPaintVertexArray,a=this.layerId,o=i.length;if(i.reserve(t),r.reserve(t),n&&e.patterns&&e.patterns[a]){var s=e.patterns[a],u=s.min,l=s.mid,c=s.max,h=n[u],f=n[l],p=n[c];if(!h||!f||!p)return;for(var A=o;A<t;A++)i.emplaceBack(f.tl[0],f.tl[1],f.br[0],f.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1]),r.emplaceBack(f.tl[0],f.tl[1],f.br[0],f.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1])}},$r.prototype.updatePaintArray=function(t,e,n,i,r){var a=this.zoomInPaintVertexArray,o=this.zoomOutPaintVertexArray,s=this.layerId;if(r&&n.patterns&&n.patterns[s]){var u=n.patterns[s],l=u.min,c=u.mid,h=u.max,f=r[l],p=r[c],A=r[h];if(!f||!p||!A)return;for(var d=t;d<e;d++)a.emplace(d,p.tl[0],p.tl[1],p.br[0],p.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1]),o.emplace(d,p.tl[0],p.tl[1],p.br[0],p.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1])}},$r.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},$r.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()},$r.prototype.setUniforms=function(t,e){e.set(0)},$r.prototype.getBinding=function(t,e){return new Ur(t,e)};var ta=function(){this.binders={},this.cacheKey="",this._buffers=[],this._featureMap=new Br,this._bufferOffset=0};ta.createDynamic=function(t,e,n){var i=new ta,r=[];for(var a in t.paint._values)if(n(a)){var o=t.paint.get(a);if(o instanceof Ui&&hn(o.property.specification)){var s=na(a,t.type),u=o.property.specification.type,l=o.property.useIntegerZoom;if("cross-faded"===o.property.specification["property-type"]||"cross-faded-data-driven"===o.property.specification["property-type"])if("constant"===o.value.kind)i.binders[a]=new Yr(o.value.value,s,u),r.push("/u_"+a);else{var c=ia(a,u,"source");i.binders[a]=new $r(o.value,s,u,l,e,c,t.id),r.push("/a_"+a)}else if("constant"===o.value.kind)i.binders[a]=new Qr(o.value.value,s,u),r.push("/u_"+a);else if("source"===o.value.kind){var h=ia(a,u,"source");i.binders[a]=new Kr(o.value,s,u,h),r.push("/a_"+a)}else{var f=ia(a,u,"composite");i.binders[a]=new Jr(o.value,s,u,l,e,f),r.push("/z_"+a)}}}return i.cacheKey=r.sort().join(""),i},ta.prototype.populatePaintArrays=function(t,e,n,i){for(var r in this.binders)this.binders[r].populatePaintArray(t,e,i);void 0!==e.id&&this._featureMap.add(+e.id,n,this._bufferOffset,t),this._bufferOffset=t},ta.prototype.setConstantPatternPositions=function(t,e){for(var n in this.binders)this.binders[n].setConstantPatternPositions(t,e)},ta.prototype.updatePaintArrays=function(t,e,n,i){var r=!1;for(var a in t)for(var o=0,s=this._featureMap.getPositions(+a);o<s.length;o+=1){var u=s[o],l=e.feature(u.index);for(var c in this.binders){var h=this.binders[c];if(!(h instanceof Qr||h instanceof Yr)&&!0===h.expression.isStateDependent){var f=n.paint.get(c);h.expression=f.value,h.updatePaintArray(u.start,u.end,l,t[a],i),r=!0}}}return r},ta.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},ta.prototype.getPaintVertexBuffers=function(){return this._buffers},ta.prototype.getUniforms=function(t,e){var n=[];for(var i in this.binders)for(var r=this.binders[i],a=0,o=r.uniformNames;a<o.length;a+=1){var s=o[a];if(e[s]){var u=r.getBinding(t,e[s]);n.push({name:s,property:i,binding:u})}}return n},ta.prototype.setUniforms=function(t,e,n,i){for(var r=0,a=e;r<a.length;r+=1){var o=a[r],s=o.name,u=o.property,l=o.binding;this.binders[u].setUniforms(t,l,i,n.get(u),s)}},ta.prototype.updatePatternPaintBuffers=function(t){var e=[];for(var n in this.binders){var i=this.binders[n];if(i instanceof $r){var r=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;r&&e.push(r)}else(i instanceof Kr||i instanceof Jr)&&i.paintVertexBuffer&&e.push(i.paintVertexBuffer)}this._buffers=e},ta.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var n=[];for(var i in this.binders){var r=this.binders[i];(r instanceof Kr||r instanceof Jr)&&r.paintVertexBuffer&&n.push(r.paintVertexBuffer)}this._buffers=n},ta.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};var ea=function(t,e,n,i){void 0===i&&(i=function(){return!0}),this.programConfigurations={};for(var r=0,a=e;r<a.length;r+=1){var o=a[r];this.programConfigurations[o.id]=ta.createDynamic(o,n,i),this.programConfigurations[o.id].layoutAttributes=t}this.needsUpload=!1};function na(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from"],"fill-pattern":["pattern_to","pattern_from"],"fill-extrusion-pattern":["pattern_to","pattern_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function ia(t,e,n){var i={color:{source:_r,composite:br},number:{source:Ar,composite:_r}},r=function(t){return{"line-pattern":{source:ar,composite:ar},"fill-pattern":{source:ar,composite:ar},"fill-extrusion-pattern":{source:ar,composite:ar}}[t]}(t);return r&&r[n]||i[e][n]}ea.prototype.populatePaintArrays=function(t,e,n,i){for(var r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(t,e,n,i);this.needsUpload=!0},ea.prototype.updatePaintArrays=function(t,e,n,i){for(var r=0,a=n;r<a.length;r+=1){var o=a[r];this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,e,o,i)||this.needsUpload}},ea.prototype.get=function(t){return this.programConfigurations[t]},ea.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},ea.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},vi("ConstantBinder",Qr),vi("CrossFadedConstantBinder",Yr),vi("SourceExpressionBinder",Kr),vi("CrossFadedCompositeBinder",$r),vi("CompositeExpressionBinder",Jr),vi("ProgramConfiguration",ta,{omit:["_buffers"]}),vi("ProgramConfigurationSet",ea);var ra=8192,aa={min:-1*Math.pow(2,15),max:Math.pow(2,15)-1};function oa(t){for(var e=ra/t.extent,n=t.loadGeometry(),i=0;i<n.length;i++)for(var r=n[i],a=0;a<r.length;a++){var o=r[a];o.x=Math.round(o.x*e),o.y=Math.round(o.y*e),(o.x<aa.min||o.x>aa.max||o.y<aa.min||o.y>aa.max)&&x("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function sa(t,e,n,i,r){t.emplaceBack(2*e+(i+1)/2,2*n+(r+1)/2)}var ua=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new er,this.indexArray=new gr,this.segments=new zr,this.programConfigurations=new ea(Ir,t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function la(t,e){for(var n=0;n<t.length;n++)if(ma(e,t[n]))return!0;for(var i=0;i<e.length;i++)if(ma(t,e[i]))return!0;return!!pa(t,e)}function ca(t,e,n){return!!ma(t,e)||!!da(e,t,n)}function ha(t,e){if(1===t.length)return ga(e,t[0]);for(var n=0;n<e.length;n++)for(var i=e[n],r=0;r<i.length;r++)if(ma(t,i[r]))return!0;for(var a=0;a<t.length;a++)if(ga(e,t[a]))return!0;for(var o=0;o<e.length;o++)if(pa(t,e[o]))return!0;return!1}function fa(t,e,n){if(t.length>1){if(pa(t,e))return!0;for(var i=0;i<e.length;i++)if(da(e[i],t,n))return!0}for(var r=0;r<t.length;r++)if(da(t[r],e,n))return!0;return!1}function pa(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var i=t[n],r=t[n+1],a=0;a<e.length-1;a++)if(Aa(i,r,e[a],e[a+1]))return!0;return!1}function Aa(t,e,n,i){return w(t,n,i)!==w(e,n,i)&&w(t,e,n)!==w(t,e,i)}function da(t,e,n){var i=n*n;if(1===e.length)return t.distSqr(e[0])<i;for(var r=1;r<e.length;r++)if(va(t,e[r-1],e[r])<i)return!0;return!1}function va(t,e,n){var i=e.distSqr(n);if(0===i)return t.distSqr(e);var r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return r<0?t.distSqr(e):r>1?t.distSqr(n):t.distSqr(n.sub(e)._mult(r)._add(e))}function ga(t,e){for(var n,i,r,a=!1,o=0;o<t.length;o++)for(var s=0,u=(n=t[o]).length-1;s<n.length;u=s++)i=n[s],r=n[u],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(a=!a);return a}function ma(t,e){for(var n=!1,i=0,r=t.length-1;i<t.length;r=i++){var a=t[i],o=t[r];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(n=!n)}return n}function ya(t,e,n){var i=n[0],r=n[2];if(t.x<i.x&&e.x<i.x||t.x>r.x&&e.x>r.x||t.y<i.y&&e.y<i.y||t.y>r.y&&e.y>r.y)return!1;var a=w(t,e,n[0]);return a!==w(t,e,n[1])||a!==w(t,e,n[2])||a!==w(t,e,n[3])}function _a(t,e,n){var i=e.paint.get(t).value;return"constant"===i.kind?i.value:n.programConfigurations.get(e.id).binders[t].maxValue}function ba(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function xa(t,e,n,i,a){if(!e[0]&&!e[1])return t;var o=r.convert(e)._mult(a);"viewport"===n&&o._rotate(-i);for(var s=[],u=0;u<t.length;u++){var l=t[u];s.push(l.sub(o))}return s}ua.prototype.populate=function(t,e){for(var n=0,i=t;n<i.length;n+=1){var r=i[n],a=r.feature,o=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ii(this.zoom),a)){var u=oa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index)}}},ua.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},ua.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ua.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ua.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ir),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ua.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ua.prototype.addFeature=function(t,e,n){for(var i=0,r=e;i<r.length;i+=1)for(var a=0,o=r[i];a<o.length;a+=1){var s=o[a],u=s.x,l=s.y;if(!(u<0||u>=ra||l<0||l>=ra)){var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=c.vertexLength;sa(this.layoutVertexArray,u,l,-1,-1),sa(this.layoutVertexArray,u,l,1,-1),sa(this.layoutVertexArray,u,l,1,1),sa(this.layoutVertexArray,u,l,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),c.vertexLength+=4,c.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{})},vi("CircleBucket",ua,{omit:["layers"]});var wa={paint:new Xi({"circle-radius":new Wi(kt.paint_circle["circle-radius"]),"circle-color":new Wi(kt.paint_circle["circle-color"]),"circle-blur":new Wi(kt.paint_circle["circle-blur"]),"circle-opacity":new Wi(kt.paint_circle["circle-opacity"]),"circle-translate":new Gi(kt.paint_circle["circle-translate"]),"circle-translate-anchor":new Gi(kt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gi(kt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gi(kt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wi(kt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wi(kt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wi(kt.paint_circle["circle-stroke-opacity"])})},Sa="undefined"!=typeof Float32Array?Float32Array:Array;function ka(){var t=new Sa(9);return Sa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Oa(){var t=new Sa(3);return Sa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Pa(t,e,n){var i=new Sa(3);return i[0]=t,i[1]=e,i[2]=n,i}function Ea(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,t}function Ca(){var t=new Sa(4);return Sa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.PI,Oa(),function(){var t;t=new Sa(4),Sa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}(),Oa(),Pa(1,0,0),Pa(0,1,0),Ca(),Ca(),ka(),function(){var t;t=new Sa(2),Sa!=Float32Array&&(t[0]=0,t[1]=0)}();var Ta=function(t){function e(e){t.call(this,e,wa)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new ua(t)},e.prototype.queryRadius=function(t){var e=t;return _a("circle-radius",this,e)+_a("circle-stroke-width",this,e)+ba(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,i,r,a,o,s){for(var u=xa(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,o),l=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(t,e){return u.map(function(t){return Ma(t,e)})}(0,s),f=c?l*o:l,p=0,A=i;p<A.length;p+=1)for(var d=0,v=A[p];d<v.length;d+=1){var g=v[d],m=c?g:Ma(g,s),y=f,_=Ea([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?y*=_[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(y*=a.cameraToCenterDistance/_[3]),ca(h,m,y))return!0}return!1},e}(Qi);function Ma(t,e){var n=Ea([],[t.x,t.y,0,1],e);return new r(n[0]/n[3],n[1]/n[3])}var ja=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ua);function La(t,e,n,i){var r=e.width,a=e.height;if(i){if(i.length!==r*a*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(r*a*n);return t.width=r,t.height=a,t.data=i,t}function Ia(t,e,n){var i=e.width,r=e.height;if(i!==t.width||r!==t.height){var a=La({},{width:i,height:r},n);za(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,r)},n),t.width=i,t.height=r,t.data=a.data}}function za(t,e,n,i,r,a){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=t.data,s=e.data,u=0;u<r.height;u++)for(var l=((n.y+u)*t.width+n.x)*a,c=((i.y+u)*e.width+i.x)*a,h=0;h<r.width*a;h++)s[c+h]=o[l+h];return e}vi("HeatmapBucket",ja,{omit:["layers"]});var Da=function(t,e){La(this,t,1,e)};Da.prototype.resize=function(t){Ia(this,t,1)},Da.prototype.clone=function(){return new Da({width:this.width,height:this.height},new Uint8Array(this.data))},Da.copy=function(t,e,n,i,r){za(t,e,n,i,r,1)};var Ba=function(t,e){La(this,t,4,e)};Ba.prototype.resize=function(t){Ia(this,t,4)},Ba.prototype.replace=function(t,e){e?this.data.set(t):this.data=t},Ba.prototype.clone=function(){return new Ba({width:this.width,height:this.height},new Uint8Array(this.data))},Ba.copy=function(t,e,n,i,r){za(t,e,n,i,r,4)},vi("AlphaImage",Da),vi("RGBAImage",Ba);var Ra={paint:new Xi({"heatmap-radius":new Wi(kt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wi(kt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gi(kt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zi(kt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gi(kt.paint_heatmap["heatmap-opacity"])})};function Fa(t,e){for(var n=new Uint8Array(1024),i={},r=0,a=0;r<256;r++,a+=4){i[e]=r/255;var o=t.evaluate(i);n[a+0]=Math.floor(255*o.r/o.a),n[a+1]=Math.floor(255*o.g/o.a),n[a+2]=Math.floor(255*o.b/o.a),n[a+3]=Math.floor(255*o.a)}return new Ba({width:256,height:1},n)}var Na=function(t){function e(e){t.call(this,e,Ra),this._updateColorRamp()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new ja(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Fa(t,"heatmapDensity"),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Qi),Ua={paint:new Xi({"hillshade-illumination-direction":new Gi(kt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gi(kt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gi(kt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gi(kt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gi(kt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gi(kt.paint_hillshade["hillshade-accent-color"])})},Va=function(t){function e(e){t.call(this,e,Ua)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Qi),Ga=$i([{name:"a_pos",components:2,type:"Int16"}],4).members,Wa=qa,Ha=qa;function qa(t,e,n){n=n||2;var i,r,a,o,s,u,l,c=e&&e.length,h=c?e[0]*n:t.length,f=Za(t,0,h,n,!0),p=[];if(!f||f.next===f.prev)return p;if(c&&(f=function(t,e,n,i){var r,a,o,s=[];for(r=0,a=e.length;r<a;r++)(o=Za(t,e[r]*i,r<a-1?e[r+1]*i:t.length,i,!1))===o.next&&(o.steiner=!0),s.push(io(o));for(s.sort(to),r=0;r<s.length;r++)eo(s[r],n),n=Xa(n,n.next);return n}(t,e,f,n)),t.length>80*n){i=a=t[0],r=o=t[1];for(var A=n;A<h;A+=n)(s=t[A])<i&&(i=s),(u=t[A+1])<r&&(r=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-i,o-r))?1/l:0}return Qa(f,p,n,i,r,l),p}function Za(t,e,n,i,r){var a,o;if(r===Ao(t,e,n,i)>0)for(a=e;a<n;a+=i)o=ho(a,t[a],t[a+1],o);else for(a=n-i;a>=e;a-=i)o=ho(a,t[a],t[a+1],o);return o&&so(o,o.next)&&(fo(o),o=o.next),o}function Xa(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!so(i,i.next)&&0!==oo(i.prev,i,i.next))i=i.next;else{if(fo(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Qa(t,e,n,i,r,a,o){if(t){!o&&a&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=no(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,a,o,s,u,l=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,i=n,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(t,i,r,a);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?Ka(t,i,r,a):Ya(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),fo(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?Qa(t=Ja(t,e,n),e,n,i,r,a,2):2===o&&$a(t,e,n,i,r,a):Qa(Xa(t),e,n,i,r,a,1);break}}}function Ya(t){var e=t.prev,n=t,i=t.next;if(oo(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(ro(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&oo(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Ka(t,e,n,i){var r=t.prev,a=t,o=t.next;if(oo(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,u=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,c=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=no(s,u,e,n,i),f=no(l,c,e,n,i),p=t.prevZ,A=t.nextZ;p&&p.z>=h&&A&&A.z<=f;){if(p!==t.prev&&p!==t.next&&ro(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&oo(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,A!==t.prev&&A!==t.next&&ro(r.x,r.y,a.x,a.y,o.x,o.y,A.x,A.y)&&oo(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&ro(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&oo(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;A&&A.z<=f;){if(A!==t.prev&&A!==t.next&&ro(r.x,r.y,a.x,a.y,o.x,o.y,A.x,A.y)&&oo(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function Ja(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!so(r,a)&&uo(r,i,i.next,a)&&lo(r,a)&&lo(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),fo(i),fo(i.next),i=t=a),i=i.next}while(i!==t);return i}function $a(t,e,n,i,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&ao(o,s)){var u=co(o,s);return o=Xa(o,o.next),u=Xa(u,u.next),Qa(o,e,n,i,r,a),void Qa(u,e,n,i,r,a)}s=s.next}o=o.next}while(o!==t)}function to(t,e){return t.x-e.x}function eo(t,e){if(e=function(t,e){var n,i=e,r=t.x,a=t.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===o)return n.prev;var u,l=n,c=n.x,h=n.y,f=1/0;for(i=n.next;i!==l;)r>=i.x&&i.x>=c&&r!==i.x&&ro(a<h?r:o,a,c,h,a<h?o:r,a,i.x,i.y)&&((u=Math.abs(a-i.y)/(r-i.x))<f||u===f&&i.x>n.x)&&lo(i,t)&&(n=i,f=u),i=i.next;return n}(t,e)){var n=co(e,t);Xa(n,n.next)}}function no(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function io(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function ro(t,e,n,i,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function ao(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&uo(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&lo(t,e)&&lo(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}function oo(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function so(t,e){return t.x===e.x&&t.y===e.y}function uo(t,e,n,i){return!!(so(t,e)&&so(n,i)||so(t,i)&&so(n,e))||oo(t,e,n)>0!=oo(t,e,i)>0&&oo(n,i,t)>0!=oo(n,i,e)>0}function lo(t,e){return oo(t.prev,t,t.next)<0?oo(t,e,t.next)>=0&&oo(t,t.prev,e)>=0:oo(t,e,t.prev)<0||oo(t,t.next,e)<0}function co(t,e){var n=new po(t.i,t.x,t.y),i=new po(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function ho(t,e,n,i){var r=new po(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function fo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function po(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ao(t,e,n,i){for(var r=0,a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}function vo(t,e,n,i,r){!function t(e,n,i,r,a){for(;r>i;){if(r-i>600){var o=r-i+1,s=n-i+1,u=Math.log(o),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(o-l)/o)*(s-o/2<0?-1:1);t(e,n,Math.max(i,Math.floor(n-s*l/o+c)),Math.min(r,Math.floor(n+(o-s)*l/o+c)),a)}var h=e[n],f=i,p=r;for(go(e,i,n),a(e[r],h)>0&&go(e,i,r);f<p;){for(go(e,f,p),f++,p--;a(e[f],h)<0;)f++;for(;a(e[p],h)>0;)p--}0===a(e[i],h)?go(e,i,p):go(e,++p,r),p<=n&&(i=p+1),n<=p&&(r=p-1)}}(t,e,n||0,i||t.length-1,r||mo)}function go(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function mo(t,e){return t<e?-1:t>e?1:0}function yo(t,e){var n=t.length;if(n<=1)return[t];for(var i,r,a=[],o=0;o<n;o++){var s=S(t[o]);0!==s&&(t[o].area=Math.abs(s),void 0===r&&(r=s<0),r===s<0?(i&&a.push(i),i=[t[o]]):i.push(t[o]))}if(i&&a.push(i),e>1)for(var u=0;u<a.length;u++)a[u].length<=e||(vo(a[u],e,1,a[u].length-1,_o),a[u]=a[u].slice(0,e));return a}function _o(t,e){return e.area-t.area}function bo(t,e,n){for(var i=n.patternDependencies,r=!1,a=0,o=e;a<o.length;a+=1){var s=o[a].paint.get(t+"-pattern");s.isConstant()||(r=!0);var u=s.constantOr(null);u&&(r=!0,i[u.to]=!0,i[u.from]=!0)}return r}function xo(t,e,n,i,r){for(var a=r.patternDependencies,o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:i-1},n,{}),h=l.evaluate({zoom:i},n,{}),f=l.evaluate({zoom:i+1},n,{});a[c]=!0,a[h]=!0,a[f]=!0,n.patterns[u.id]={min:c,mid:h,max:f}}}return n}qa.deviation=function(t,e,n,i){var r=e&&e.length,a=r?e[0]*n:t.length,o=Math.abs(Ao(t,0,a,n));if(r)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;o-=Math.abs(Ao(t,l,c,n))}var h=0;for(s=0;s<i.length;s+=3){var f=i[s]*n,p=i[s+1]*n,A=i[s+2]*n;h+=Math.abs((t[f]-t[A])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[A+1]-t[f+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},qa.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var a=0;a<t[r].length;a++)for(var o=0;o<e;o++)n.vertices.push(t[r][a][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n},Wa.default=Ha;var wo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new er,this.indexArray=new gr,this.indexArray2=new mr,this.programConfigurations=new ea(Ga,t.layers,t.zoom),this.segments=new zr,this.segments2=new zr,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};wo.prototype.populate=function(t,e){this.features=[],this.hasPattern=bo("fill",this.layers,e);for(var n=0,i=t;n<i.length;n+=1){var r=i[n],a=r.feature,o=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ii(this.zoom),a)){var u=oa(a),l={sourceLayerIndex:s,index:o,geometry:u,properties:a.properties,type:a.type,patterns:{}};void 0!==a.id&&(l.id=a.id),this.hasPattern?this.features.push(xo("fill",this.layers,l,this.zoom,e)):this.addFeature(l,u,o,{}),e.featureIndex.insert(a,u,o,s,this.index)}}},wo.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},wo.prototype.addFeatures=function(t,e){for(var n=0,i=this.features;n<i.length;n+=1){var r=i[n],a=r.geometry;this.addFeature(r,a,r.index,e)}},wo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},wo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},wo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ga),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},wo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},wo.prototype.addFeature=function(t,e,n,i){for(var r=0,a=yo(e,500);r<a.length;r+=1){for(var o=a[r],s=0,u=0,l=o;u<l.length;u+=1)s+=l[u].length;for(var c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray),h=c.vertexLength,f=[],p=[],A=0,d=o;A<d.length;A+=1){var v=d[A];if(0!==v.length){v!==o[0]&&p.push(f.length/2);var g=this.segments2.prepareSegment(v.length,this.layoutVertexArray,this.indexArray2),m=g.vertexLength;this.layoutVertexArray.emplaceBack(v[0].x,v[0].y),this.indexArray2.emplaceBack(m+v.length-1,m),f.push(v[0].x),f.push(v[0].y);for(var y=1;y<v.length;y++)this.layoutVertexArray.emplaceBack(v[y].x,v[y].y),this.indexArray2.emplaceBack(m+y-1,m+y),f.push(v[y].x),f.push(v[y].y);g.vertexLength+=v.length,g.primitiveLength+=v.length}}for(var _=Wa(f,p),b=0;b<_.length;b+=3)this.indexArray.emplaceBack(h+_[b],h+_[b+1],h+_[b+2]);c.vertexLength+=s,c.primitiveLength+=_.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i)},vi("FillBucket",wo,{omit:["layers","features"]});var So={paint:new Xi({"fill-antialias":new Gi(kt.paint_fill["fill-antialias"]),"fill-opacity":new Wi(kt.paint_fill["fill-opacity"]),"fill-color":new Wi(kt.paint_fill["fill-color"]),"fill-outline-color":new Wi(kt.paint_fill["fill-outline-color"]),"fill-translate":new Gi(kt.paint_fill["fill-translate"]),"fill-translate-anchor":new Gi(kt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hi(kt.paint_fill["fill-pattern"])})},ko=function(t){function e(e){t.call(this,e,So)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e);var n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new wo(t)},e.prototype.queryRadius=function(){return ba(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,i,r,a,o){return ha(xa(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,o),i)},e.prototype.isTileClipped=function(){return!0},e}(Qi),Oo=$i([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Po=Eo;function Eo(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(Co,this,e)}function Co(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function To(t){for(var e,n,i=0,r=0,a=t.length,o=a-1;r<a;o=r++)e=t[r],i+=((n=t[o]).x-e.x)*(e.y+n.y);return i}Eo.types=["Unknown","Point","LineString","Polygon"],Eo.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,a=0,o=0,s=0,u=[];t.pos<n;){if(a<=0){var l=t.readVarint();i=7&l,a=l>>3}if(a--,1===i||2===i)o+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new r(o,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},Eo.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,a=0,o=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(i<=0){var c=t.readVarint();n=7&c,i=c>>3}if(i--,1===n||2===n)(r+=t.readSVarint())<o&&(o=r),r>s&&(s=r),(a+=t.readSVarint())<u&&(u=a),a>l&&(l=a);else if(7!==n)throw new Error("unknown command "+n)}return[o,u,s,l]},Eo.prototype.toGeoJSON=function(t,e,n){var i,r,a=this.extent*Math.pow(2,n),o=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=Eo.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e],i=180-360*(n.y+s)/a;t[e]=[360*(n.x+o)/a-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<u.length;i++)h[i]=u[i][0];c(u=h);break;case 2:for(i=0;i<u.length;i++)c(u[i]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],a=0;a<e;a++){var o=To(t[a]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(n&&r.push(n),n=[t[a]]):n.push(t[a]))}return n&&r.push(n),r}(u),i=0;i<u.length;i++)for(r=0;r<u[i].length;r++)c(u[i][r])}1===u.length?u=u[0]:l="Multi"+l;var f={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var Mo=jo;function jo(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Lo,this,e),this.length=this._features.length}function Lo(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(n))}function Io(t,e,n){if(3===t){var i=new Mo(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}jo.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Po(this._pbf,e,this.extent,this._keys,this._values)};var zo={VectorTile:function(t,e){this.layers=t.readFields(Io,{},e)},VectorTileFeature:Po,VectorTileLayer:Mo},Do=zo.VectorTileFeature.types,Bo=Math.pow(2,13);function Ro(t,e,n,i,r,a,o,s){t.emplaceBack(e,n,2*Math.floor(i*Bo)+o,r*Bo*2,a*Bo*2,Math.round(s))}var Fo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ir,this.indexArray=new gr,this.programConfigurations=new ea(Oo,t.layers,t.zoom),this.segments=new zr,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function No(t,e){return t.x===e.x&&(t.x<0||t.x>ra)||t.y===e.y&&(t.y<0||t.y>ra)}function Uo(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>ra})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>ra})}Fo.prototype.populate=function(t,e){this.features=[],this.hasPattern=bo("fill-extrusion",this.layers,e);for(var n=0,i=t;n<i.length;n+=1){var r=i[n],a=r.feature,o=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ii(this.zoom),a)){var u=oa(a),l={sourceLayerIndex:s,index:o,geometry:u,properties:a.properties,type:a.type,patterns:{}};void 0!==a.id&&(l.id=a.id),this.hasPattern?this.features.push(xo("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,u,o,{}),e.featureIndex.insert(a,u,o,s,this.index,!0)}}},Fo.prototype.addFeatures=function(t,e){for(var n=0,i=this.features;n<i.length;n+=1){var r=i[n],a=r.geometry;this.addFeature(r,a,r.index,e)}},Fo.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Fo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Fo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Fo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Oo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Fo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Fo.prototype.addFeature=function(t,e,n,i){for(var r=0,a=yo(e,500);r<a.length;r+=1){for(var o=a[r],s=0,u=0,l=o;u<l.length;u+=1)s+=l[u].length;for(var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=0,f=o;h<f.length;h+=1){var p=f[h];if(0!==p.length&&!Uo(p))for(var A=0,d=0;d<p.length;d++){var v=p[d];if(d>=1){var g=p[d-1];if(!No(v,g)){c.vertexLength+4>zr.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var m=v.sub(g)._perp()._unit(),y=g.dist(v);A+y>32768&&(A=0),Ro(this.layoutVertexArray,v.x,v.y,m.x,m.y,0,0,A),Ro(this.layoutVertexArray,v.x,v.y,m.x,m.y,0,1,A),A+=y,Ro(this.layoutVertexArray,g.x,g.y,m.x,m.y,0,0,A),Ro(this.layoutVertexArray,g.x,g.y,m.x,m.y,0,1,A);var _=c.vertexLength;this.indexArray.emplaceBack(_,_+2,_+1),this.indexArray.emplaceBack(_+1,_+2,_+3),c.vertexLength+=4,c.primitiveLength+=2}}}}if(c.vertexLength+s>zr.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray)),"Polygon"===Do[t.type]){for(var b=[],x=[],w=c.vertexLength,S=0,k=o;S<k.length;S+=1){var O=k[S];if(0!==O.length){O!==o[0]&&x.push(b.length/2);for(var P=0;P<O.length;P++){var E=O[P];Ro(this.layoutVertexArray,E.x,E.y,0,0,1,1,0),b.push(E.x),b.push(E.y)}}}for(var C=Wa(b,x),T=0;T<C.length;T+=3)this.indexArray.emplaceBack(w+C[T],w+C[T+2],w+C[T+1]);c.primitiveLength+=C.length/3,c.vertexLength+=s}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i)},vi("FillExtrusionBucket",Fo,{omit:["layers","features"]});var Vo={paint:new Xi({"fill-extrusion-opacity":new Gi(kt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wi(kt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gi(kt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gi(kt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hi(kt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wi(kt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wi(kt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gi(kt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Go=function(t){function e(e){t.call(this,e,Vo)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Fo(t)},e.prototype.queryRadius=function(){return ba(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,n,i,a,o,s,u){var l=xa(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,n),h=this.paint.get("fill-extrusion-base").evaluate(e,n),f=function(t,e,n,i){for(var a=[],o=0,s=t;o<s.length;o+=1){var u=s[o],l=[u.x,u.y,0,1];Ea(l,l,e),a.push(new r(l[0]/l[3],l[1]/l[3]))}return a}(l,u),p=function(t,e,n,i){for(var a=[],o=[],s=i[8]*e,u=i[9]*e,l=i[10]*e,c=i[11]*e,h=i[8]*n,f=i[9]*n,p=i[10]*n,A=i[11]*n,d=0,v=t;d<v.length;d+=1){for(var g=[],m=[],y=0,_=v[d];y<_.length;y+=1){var b=_[y],x=b.x,w=b.y,S=i[0]*x+i[4]*w+i[12],k=i[1]*x+i[5]*w+i[13],O=i[2]*x+i[6]*w+i[14],P=i[3]*x+i[7]*w+i[15],E=O+l,C=P+c,T=S+h,M=k+f,j=O+p,L=P+A,I=new r((S+s)/C,(k+u)/C);I.z=E/C,g.push(I);var z=new r(T/L,M/L);z.z=j/L,m.push(z)}a.push(g),o.push(m)}return[a,o]}(i,h,c,u);return function(t,e,n){var i=1/0;ha(n,e)&&(i=Ho(n,e[0]));for(var r=0;r<e.length;r++)for(var a=e[r],o=t[r],s=0;s<a.length-1;s++){var u=a[s],l=a[s+1],c=o[s],h=[u,l,o[s+1],c,u];la(n,h)&&(i=Math.min(i,Ho(n,h)))}return i!==1/0&&i}(p[0],p[1],f)},e}(Qi);function Wo(t,e){return t.x*e.x+t.y*e.y}function Ho(t,e){if(1===t.length){var n=e[0],i=e[1],r=e[3],a=t[0],o=i.sub(n),s=r.sub(n),u=a.sub(n),l=Wo(o,o),c=Wo(o,s),h=Wo(s,s),f=Wo(u,o),p=Wo(u,s),A=l*h-c*c,d=(h*f-c*p)/A,v=(l*p-c*f)/A,g=1-d-v;return n.z*g+i.z*d+r.z*v}for(var m=1/0,y=0,_=e;y<_.length;y+=1){var b=_[y];m=Math.min(m,b.z)}return m}var qo=$i([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Zo=zo.VectorTileFeature.types,Xo=63,Qo=Math.cos(Math.PI/180*37.5),Yo=.5,Ko=Math.pow(2,14)/Yo;function Jo(t,e,n,i,r,a,o){t.emplaceBack(e.x,e.y,i?1:0,r?1:-1,Math.round(Xo*n.x)+128,Math.round(Xo*n.y)+128,1+(0===a?0:a<0?-1:1)|(o*Yo&63)<<2,o*Yo>>6)}var $o=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.features=[],this.hasPattern=!1,this.layoutVertexArray=new rr,this.indexArray=new gr,this.programConfigurations=new ea(qo,t.layers,t.zoom),this.segments=new zr,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function ts(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(Ko-1)}$o.prototype.populate=function(t,e){this.features=[],this.hasPattern=bo("line",this.layers,e);for(var n=0,i=t;n<i.length;n+=1){var r=i[n],a=r.feature,o=r.index,s=r.sourceLayerIndex;if(this.layers[0]._featureFilter(new Ii(this.zoom),a)){var u=oa(a),l={sourceLayerIndex:s,index:o,geometry:u,properties:a.properties,type:a.type,patterns:{}};void 0!==a.id&&(l.id=a.id),this.hasPattern?this.features.push(xo("line",this.layers,l,this.zoom,e)):this.addFeature(l,u,o,{}),e.featureIndex.insert(a,u,o,s,this.index)}}},$o.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},$o.prototype.addFeatures=function(t,e){for(var n=0,i=this.features;n<i.length;n+=1){var r=i[n],a=r.geometry;this.addFeature(r,a,r.index,e)}},$o.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},$o.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$o.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},$o.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$o.prototype.addFeature=function(t,e,n,i){for(var r=this.layers[0].layout,a=r.get("line-join").evaluate(t,{}),o=r.get("line-cap"),s=r.get("line-miter-limit"),u=r.get("line-round-limit"),l=0,c=e;l<c.length;l+=1){var h=c[l];this.addLine(h,t,a,o,s,u,n,i)}},$o.prototype.addLine=function(t,e,n,i,r,a,o,s){var u=null;e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")&&(u={start:e.properties.mapbox_clip_start,end:e.properties.mapbox_clip_end,tileTotal:void 0});for(var l="Polygon"===Zo[e.type],c=t.length;c>=2&&t[c-1].equals(t[c-2]);)c--;for(var h=0;h<c-1&&t[h].equals(t[h+1]);)h++;if(!(c<(l?3:2))){u&&(u.tileTotal=function(t,e,n){for(var i,r,a=0,o=h;o<n-1;o++)i=t[o],r=t[o+1],a+=i.dist(r);return a}(t,0,c)),"bevel"===n&&(r=1.05);var f=ra/(512*this.overscaling)*15,p=t[h],A=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);this.distance=0;var d,v,g,m=i,y=l?"butt":i,_=!0,b=void 0,x=void 0,w=void 0,S=void 0;this.e1=this.e2=this.e3=-1,l&&(d=t[c-2],S=p.sub(d)._unit()._perp());for(var k=h;k<c;k++)if(!(x=l&&k===c-1?t[h+1]:t[k+1])||!t[k].equals(x)){S&&(w=S),d&&(b=d),d=t[k],S=x?x.sub(d)._unit()._perp():w;var O=(w=w||S).add(S);0===O.x&&0===O.y||O._unit();var P=O.x*S.x+O.y*S.y,E=0!==P?1/P:1/0,C=P<Qo&&b&&x;if(C&&k>h){var T=d.dist(b);if(T>2*f){var M=d.sub(d.sub(b)._mult(f/T)._round());this.distance+=M.dist(b),this.addCurrentVertex(M,this.distance,w.mult(1),0,0,!1,A,u),b=M}}var j=b&&x,L=j?n:x?m:y;if(j&&"round"===L&&(E<a?L="miter":E<=2&&(L="fakeround")),"miter"===L&&E>r&&(L="bevel"),"bevel"===L&&(E>2&&(L="flipbevel"),E<r&&(L="miter")),b&&(this.distance+=d.dist(b)),"miter"===L)O._mult(E),this.addCurrentVertex(d,this.distance,O,0,0,!1,A,u);else if("flipbevel"===L){if(E>100)O=S.clone().mult(-1);else{var I=w.x*S.y-w.y*S.x>0?-1:1,z=E*w.add(S).mag()/w.sub(S).mag();O._perp()._mult(z*I)}this.addCurrentVertex(d,this.distance,O,0,0,!1,A,u),this.addCurrentVertex(d,this.distance,O.mult(-1),0,0,!1,A,u)}else if("bevel"===L||"fakeround"===L){var D=w.x*S.y-w.y*S.x>0,B=-Math.sqrt(E*E-1);if(D?(g=0,v=B):(v=0,g=B),_||this.addCurrentVertex(d,this.distance,w,v,g,!1,A,u),"fakeround"===L){for(var R=Math.floor(8*(.5-(P-.5))),F=void 0,N=0;N<R;N++)F=S.mult((N+1)/(R+1))._add(w)._unit(),this.addPieSliceVertex(d,this.distance,F,D,A,u);this.addPieSliceVertex(d,this.distance,O,D,A,u);for(var U=R-1;U>=0;U--)F=w.mult((U+1)/(R+1))._add(S)._unit(),this.addPieSliceVertex(d,this.distance,F,D,A,u)}x&&this.addCurrentVertex(d,this.distance,S,-v,-g,!1,A,u)}else"butt"===L?(_||this.addCurrentVertex(d,this.distance,w,0,0,!1,A,u),x&&this.addCurrentVertex(d,this.distance,S,0,0,!1,A,u)):"square"===L?(_||(this.addCurrentVertex(d,this.distance,w,1,1,!1,A,u),this.e1=this.e2=-1),x&&this.addCurrentVertex(d,this.distance,S,-1,-1,!1,A,u)):"round"===L&&(_||(this.addCurrentVertex(d,this.distance,w,0,0,!1,A,u),this.addCurrentVertex(d,this.distance,w,1,1,!0,A,u),this.e1=this.e2=-1),x&&(this.addCurrentVertex(d,this.distance,S,-1,-1,!0,A,u),this.addCurrentVertex(d,this.distance,S,0,0,!1,A,u)));if(C&&k<c-1){var V=d.dist(x);if(V>2*f){var G=d.add(x.sub(d)._mult(f/V)._round());this.distance+=G.dist(d),this.addCurrentVertex(G,this.distance,S.mult(1),0,0,!1,A,u),d=G}}_=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,s)}},$o.prototype.addCurrentVertex=function(t,e,n,i,r,a,o,s){var u,l=this.layoutVertexArray,c=this.indexArray;s&&(e=ts(e,s)),u=n.clone(),i&&u._sub(n.perp()._mult(i)),Jo(l,t,u,a,!1,i,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=n.mult(-1),r&&u._sub(n.perp()._mult(r)),Jo(l,t,u,a,!0,-r,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Ko/2&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,n,i,r,a,o))},$o.prototype.addPieSliceVertex=function(t,e,n,i,r,a){n=n.mult(i?-1:1);var o=this.layoutVertexArray,s=this.indexArray;a&&(e=ts(e,a)),Jo(o,t,n,!1,i,0,e),this.e3=r.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),r.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},vi("LineBucket",$o,{omit:["layers","features"]});var es=new Xi({"line-cap":new Gi(kt.layout_line["line-cap"]),"line-join":new Wi(kt.layout_line["line-join"]),"line-miter-limit":new Gi(kt.layout_line["line-miter-limit"]),"line-round-limit":new Gi(kt.layout_line["line-round-limit"])}),ns={paint:new Xi({"line-opacity":new Wi(kt.paint_line["line-opacity"]),"line-color":new Wi(kt.paint_line["line-color"]),"line-translate":new Gi(kt.paint_line["line-translate"]),"line-translate-anchor":new Gi(kt.paint_line["line-translate-anchor"]),"line-width":new Wi(kt.paint_line["line-width"]),"line-gap-width":new Wi(kt.paint_line["line-gap-width"]),"line-offset":new Wi(kt.paint_line["line-offset"]),"line-blur":new Wi(kt.paint_line["line-blur"]),"line-dasharray":new qi(kt.paint_line["line-dasharray"]),"line-pattern":new Hi(kt.paint_line["line-pattern"]),"line-gradient":new Zi(kt.paint_line["line-gradient"])}),layout:es},is=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,n){return n=new Ii(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),t.prototype.possiblyEvaluate.call(this,e,n)},e.prototype.evaluate=function(e,n,i,r){return n=h({},n,{zoom:Math.floor(n.zoom)}),t.prototype.evaluate.call(this,e,n,i,r)},e}(Wi))(ns.paint.properties["line-width"].specification);is.useIntegerZoom=!0;var rs=function(t){function e(e){t.call(this,e,ns)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient()},e.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=Fa(t,"lineProgress"),this.gradientTexture=null},e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=is.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new $o(t)},e.prototype.queryRadius=function(t){var e=t,n=as(_a("line-width",this,e),_a("line-gap-width",this,e)),i=_a("line-offset",this,e);return n/2+Math.abs(i)+ba(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,i,a,o,s){var u=xa(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,s),l=s/2*as(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(i=function(t,e){for(var n=[],i=new r(0,0),a=0;a<t.length;a++){for(var o=t[a],s=[],u=0;u<o.length;u++){var l=o[u-1],c=o[u],h=o[u+1],f=0===u?i:c.sub(l)._unit()._perp(),p=u===o.length-1?i:h.sub(c)._unit()._perp(),A=f._add(p)._unit(),d=A.x*p.x+A.y*p.y;A._mult(1/d),s.push(A._mult(e)._add(c))}n.push(s)}return n}(i,c*s)),function(t,e,n){for(var i=0;i<e.length;i++){var r=e[i];if(t.length>=3)for(var a=0;a<r.length;a++)if(ma(t,r[a]))return!0;if(fa(t,r,n))return!0}return!1}(u,i,l)},e.prototype.isTileClipped=function(){return!0},e}(Qi);function as(t,e){return e>0?e+2*t:t}var os=$i([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),ss=$i([{name:"a_projected_pos",components:3,type:"Float32"}],4),us=($i([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),$i([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ls=($i([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),$i([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),cs=$i([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function hs(t,e,n){return t.sections.forEach(function(t){t.text=function(t,e,n){var i=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),Li.applyArabicShaping&&(t=Li.applyArabicShaping(t)),t}(t.text,e,n)}),t}$i([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"}]),$i([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"radialTextOffset"}]),$i([{type:"Float32",name:"offsetX"}]),$i([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var fs={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},ps=function(t){function e(e,n,i,r){t.call(this,e,n),this.angle=i,void 0!==r&&(this.segment=r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(r);vi("Anchor",ps);var As=256;function ds(t,e){var n=e.expression;if("constant"===n.kind)return{functionType:"constant",layoutSize:n.evaluate(new Ii(t+1))};if("source"===n.kind)return{functionType:"source"};for(var i=n.zoomStops,r=0;r<i.length&&i[r]<=t;)r++;for(var a=r=Math.max(0,r-1);a<i.length&&i[a]<t+1;)a++;a=Math.min(i.length-1,a);var o={min:i[r],max:i[a]};return"composite"===n.kind?{functionType:"composite",zoomRange:o,propertyValue:e.value}:{functionType:"camera",layoutSize:n.evaluate(new Ii(t+1)),zoomRange:o,sizeRange:{min:n.evaluate(new Ii(o.min)),max:n.evaluate(new Ii(o.max))},propertyValue:e.value}}function vs(t,e,n){var i=e;return"source"===t.functionType?n.lowerSize/As:"composite"===t.functionType?me(n.lowerSize/As,n.upperSize/As,i.uSizeT):i.uSize}function gs(t,e,n){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var i=t.propertyValue,r=t.zoomRange,a=t.sizeRange,o=l(Tn(i,n.specification).interpolationFactor(e,r.min,r.max),0,1);return{uSizeT:0,uSize:a.min+o*(a.max-a.min)}}var s=t.propertyValue,u=t.zoomRange;return{uSizeT:l(Tn(s,n.specification).interpolationFactor(e,u.min,u.max),0,1),uSize:0}}var ms=Object.freeze({getSizeData:ds,evaluateSizeForFeature:vs,evaluateSizeForZoom:gs,SIZE_PACK_FACTOR:As}),ys=zo.VectorTileFeature.types,_s=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bs(t,e,n,i,r,a,o,s){t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),a,o,s?s[0]:0,s?s[1]:0)}function xs(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}var ws=function(t){this.layoutVertexArray=new or,this.indexArray=new gr,this.programConfigurations=t,this.segments=new zr,this.dynamicLayoutVertexArray=new sr,this.opacityVertexArray=new ur,this.placedSymbolArray=new kr};ws.prototype.upload=function(t,e,n,i){n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,os.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ss.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_s,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(t)},ws.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},vi("SymbolBuffers",ws);var Ss=function(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new zr,this.collisionVertexArray=new hr};Ss.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,us.members,!0)},Ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},vi("CollisionBuffers",Ss);var ks=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ds(this.zoom,e["text-size"]),this.iconSizeData=ds(this.zoom,e["icon-size"]);var n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1);var a="viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey;this.sortFeaturesByY=a&&(n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement")),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id}),this.sourceID=t.sourceID};ks.prototype.createArrays=function(){this.text=new ws(new ea(os.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new ws(new ea(os.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new Ss(cr,ls.members,mr),this.collisionCircle=new Ss(cr,cs.members,gr),this.glyphOffsetArray=new Cr,this.lineVertexArray=new Mr,this.symbolInstances=new Pr},ks.prototype.calculateGlyphDependencies=function(t,e,n,i){for(var r=0;r<t.length;r++)if(e[t.charCodeAt(r)]=!0,n&&i){var a=fs[t.charAt(r)];a&&(e[a.charCodeAt(0)]=!0)}},ks.prototype.populate=function(t,e){var n=this.layers[0],i=n.layout,r=i.get("text-font"),a=i.get("text-field"),o=i.get("icon-image"),s=("constant"!==a.value.kind||a.value.value.toString().length>0)&&("constant"!==r.value.kind||r.value.value.length>0),u="constant"!==o.value.kind||o.value.value&&o.value.value.length>0,l=i.get("symbol-sort-key");if(this.features=[],s||u){for(var c=e.iconDependencies,h=e.glyphDependencies,f=new Ii(this.zoom),p=0,A=t;p<A.length;p+=1){var d=A[p],v=d.feature,g=d.index,m=d.sourceLayerIndex;if(n._featureFilter(f,v)){var y=void 0;if(s){var _=n.getValueAndResolveTokens("text-field",v);y=hs(_ instanceof Yt?_:Yt.fromString(_),n,v)}var b=void 0;if(u&&(b=n.getValueAndResolveTokens("icon-image",v)),y||b){var x=this.sortFeaturesByKey?l.evaluate(v,{}):void 0,w={text:y,icon:b,index:g,sourceLayerIndex:m,geometry:oa(v),properties:v.properties,type:ys[v.type],sortKey:x};if(void 0!==v.id&&(w.id=v.id),this.features.push(w),b&&(c[b]=!0),y)for(var S=r.evaluate(v,{}).join(","),k="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),O=0,P=y.sections;O<P.length;O+=1){var E=P[O],C=xi(y.toString()),T=E.fontStack||S,M=h[T]=h[T]||{};this.calculateGlyphDependencies(E.text,M,k,C)}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},n={},i=[],r=0;function a(e){i.push(t[e]),r++}function o(t,e,r){var a=n[t];return delete n[t],n[e]=a,i[a].geometry[0].pop(),i[a].geometry[0]=i[a].geometry[0].concat(r[0]),a}function s(t,n,r){var a=e[n];return delete e[n],e[t]=a,i[a].geometry[0].shift(),i[a].geometry[0]=r[0].concat(i[a].geometry[0]),a}function u(t,e,n){var i=n?e[0][e[0].length-1]:e[0][0];return t+":"+i.x+":"+i.y}for(var l=0;l<t.length;l++){var c=t[l],h=c.geometry,f=c.text?c.text.toString():null;if(f){var p=u(f,h),A=u(f,h,!0);if(p in n&&A in e&&n[p]!==e[A]){var d=s(p,A,h),v=o(p,A,i[d].geometry);delete e[p],delete n[A],n[u(f,i[v].geometry,!0)]=v,i[d].geometry=null}else p in n?o(p,A,h):A in e?s(p,A,h):(a(l),e[p]=r-1,n[A]=r-1)}else a(l)}return i.filter(function(t){return t.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(t,e){return t.sortKey-e.sortKey})}},ks.prototype.update=function(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))},ks.prototype.isEmpty=function(){return 0===this.symbolInstances.length},ks.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ks.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ks.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},ks.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var i=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]),a={},o=t.segment+1;o<e.length;o++)a[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:i},o<e.length-1&&(i+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)a[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:r},s>0&&(r+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=a[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},ks.prototype.addSymbols=function(t,e,n,i,r,a,o,s,u,l){for(var c=t.indexArray,h=t.layoutVertexArray,f=t.dynamicLayoutVertexArray,p=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray,a.sortKey),A=this.glyphOffsetArray.length,d=p.vertexLength,v=0,g=e;v<g.length;v+=1){var m=g[v],y=m.tl,_=m.tr,b=m.bl,x=m.br,w=m.tex,S=p.vertexLength,k=m.glyphOffset[1];bs(h,s.x,s.y,y.x,k+y.y,w.x,w.y,n),bs(h,s.x,s.y,_.x,k+_.y,w.x+w.w,w.y,n),bs(h,s.x,s.y,b.x,k+b.y,w.x,w.y+w.h,n),bs(h,s.x,s.y,x.x,k+x.y,w.x+w.w,w.y+w.h,n),xs(f,s,0),c.emplaceBack(S,S+1,S+2),c.emplaceBack(S+1,S+2,S+3),p.vertexLength+=4,p.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(m.glyphOffset[0])}t.placedSymbolArray.emplaceBack(s.x,s.y,A,this.glyphOffsetArray.length-A,d,u,l,s.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],o,!1,0),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,a,a.index,{})},ks.prototype._addCollisionDebugVertex=function(t,e,n,i,r,a){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,i,r,Math.round(a.x),Math.round(a.y))},ks.prototype.addCollisionDebugVertices=function(t,e,n,i,a,o,s,u){var l=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),c=l.vertexLength,h=a.layoutVertexArray,f=a.collisionVertexArray,p=s.anchorX,A=s.anchorY;if(this._addCollisionDebugVertex(h,f,o,p,A,new r(t,e)),this._addCollisionDebugVertex(h,f,o,p,A,new r(n,e)),this._addCollisionDebugVertex(h,f,o,p,A,new r(n,i)),this._addCollisionDebugVertex(h,f,o,p,A,new r(t,i)),l.vertexLength+=4,u){var d=a.indexArray;d.emplaceBack(c,c+1,c+2),d.emplaceBack(c,c+2,c+3),l.primitiveLength+=2}else{var v=a.indexArray;v.emplaceBack(c,c+1),v.emplaceBack(c+1,c+2),v.emplaceBack(c+2,c+3),v.emplaceBack(c+3,c),l.primitiveLength+=4}},ks.prototype.addDebugCollisionBoxes=function(t,e,n){for(var i=t;i<e;i++){var r=this.collisionBoxArray.get(i),a=r.x1,o=r.y1,s=r.x2,u=r.y2,l=r.radius>0;this.addCollisionDebugVertices(a,o,s,u,l?this.collisionCircle:this.collisionBox,r.anchorPoint,n,l)}},ks.prototype.generateCollisionDebugBuffers=function(){for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e)}},ks.prototype._deserializeCollisionBoxesForSymbol=function(t,e,n,i,r){for(var a={},o=e;o<n;o++){var s=t.get(o);if(0===s.radius){a.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},a.textFeatureIndex=s.featureIndex;break}a.textCircles||(a.textCircles=[],a.textFeatureIndex=s.featureIndex),a.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var u=i;u<r;u++){var l=t.get(u);if(0===l.radius){a.iconBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY},a.iconFeatureIndex=l.featureIndex;break}}return a},ks.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex))}},ks.prototype.hasTextData=function(){return this.text.segments.get().length>0},ks.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ks.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},ks.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},ks.prototype.addIndicesForPlacedTextSymbol=function(t){for(var e=this.text.placedSymbolArray.get(t),n=e.vertexStartIndex+4*e.numGlyphs,i=e.vertexStartIndex;i<n;i+=4)this.text.indexArray.emplaceBack(i,i+1,i+2),this.text.indexArray.emplaceBack(i+1,i+2,i+3)},ks.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var n=[],i=0;i<this.symbolInstances.length;i++)n.push(i);for(var r=Math.sin(t),a=Math.cos(t),o=[],s=[],u=0;u<this.symbolInstances.length;u++){var l=this.symbolInstances.get(u);o.push(0|Math.round(r*l.anchorX+a*l.anchorY)),s.push(l.featureIndex)}n.sort(function(t,e){return o[t]-o[e]||s[e]-s[t]}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,h=n;c<h.length;c+=1){var f=h[c],p=this.symbolInstances.get(f);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(function(t,n,i){t>=0&&i.indexOf(t)===n&&e.addIndicesForPlacedTextSymbol(t)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedTextSymbol(p.verticalPlacedTextSymbolIndex);var A=this.icon.placedSymbolArray.get(f);if(A.numGlyphs){var d=A.vertexStartIndex;this.icon.indexArray.emplaceBack(d,d+1,d+2),this.icon.indexArray.emplaceBack(d+1,d+2,d+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},vi("SymbolBucket",ks,{omit:["layers","collisionBoxArray","features","compareText"]}),ks.MAX_GLYPHS=65535,ks.addDynamicAttributes=xs;var Os=new Xi({"symbol-placement":new Gi(kt.layout_symbol["symbol-placement"]),"symbol-spacing":new Gi(kt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gi(kt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wi(kt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gi(kt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Gi(kt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Gi(kt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gi(kt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gi(kt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wi(kt.layout_symbol["icon-size"]),"icon-text-fit":new Gi(kt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gi(kt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wi(kt.layout_symbol["icon-image"]),"icon-rotate":new Wi(kt.layout_symbol["icon-rotate"]),"icon-padding":new Gi(kt.layout_symbol["icon-padding"]),"icon-keep-upright":new Gi(kt.layout_symbol["icon-keep-upright"]),"icon-offset":new Wi(kt.layout_symbol["icon-offset"]),"icon-anchor":new Wi(kt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gi(kt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gi(kt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gi(kt.layout_symbol["text-rotation-alignment"]),"text-field":new Wi(kt.layout_symbol["text-field"]),"text-font":new Wi(kt.layout_symbol["text-font"]),"text-size":new Wi(kt.layout_symbol["text-size"]),"text-max-width":new Wi(kt.layout_symbol["text-max-width"]),"text-line-height":new Gi(kt.layout_symbol["text-line-height"]),"text-letter-spacing":new Wi(kt.layout_symbol["text-letter-spacing"]),"text-justify":new Wi(kt.layout_symbol["text-justify"]),"text-radial-offset":new Wi(kt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gi(kt.layout_symbol["text-variable-anchor"]),"text-anchor":new Wi(kt.layout_symbol["text-anchor"]),"text-max-angle":new Gi(kt.layout_symbol["text-max-angle"]),"text-rotate":new Wi(kt.layout_symbol["text-rotate"]),"text-padding":new Gi(kt.layout_symbol["text-padding"]),"text-keep-upright":new Gi(kt.layout_symbol["text-keep-upright"]),"text-transform":new Wi(kt.layout_symbol["text-transform"]),"text-offset":new Wi(kt.layout_symbol["text-offset"]),"text-allow-overlap":new Gi(kt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Gi(kt.layout_symbol["text-ignore-placement"]),"text-optional":new Gi(kt.layout_symbol["text-optional"])}),Ps={paint:new Xi({"icon-opacity":new Wi(kt.paint_symbol["icon-opacity"]),"icon-color":new Wi(kt.paint_symbol["icon-color"]),"icon-halo-color":new Wi(kt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wi(kt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wi(kt.paint_symbol["icon-halo-blur"]),"icon-translate":new Gi(kt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gi(kt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wi(kt.paint_symbol["text-opacity"]),"text-color":new Wi(kt.paint_symbol["text-color"]),"text-halo-color":new Wi(kt.paint_symbol["text-halo-color"]),"text-halo-width":new Wi(kt.paint_symbol["text-halo-width"]),"text-halo-blur":new Wi(kt.paint_symbol["text-halo-blur"]),"text-translate":new Gi(kt.paint_symbol["text-translate"]),"text-translate-anchor":new Gi(kt.paint_symbol["text-translate-anchor"])}),layout:Os},Es=function(t){function e(e){t.call(this,e,Ps)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},e.prototype.getValueAndResolveTokens=function(t,e){var n,i=this.layout.get(t).evaluate(e,{}),r=this._unevaluatedLayout._values[t];return r.isDataDriven()||Sn(r.value)?i:(n=e.properties,i.replace(/{([^{}]+)}/g,function(t,e){return e in n?String(n[e]):""}))},e.prototype.createBucket=function(t){return new ks(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e}(Qi),Cs={paint:new Xi({"background-color":new Gi(kt.paint_background["background-color"]),"background-pattern":new qi(kt.paint_background["background-pattern"]),"background-opacity":new Gi(kt.paint_background["background-opacity"])})},Ts=function(t){function e(e){t.call(this,e,Cs)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Qi),Ms={paint:new Xi({"raster-opacity":new Gi(kt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Gi(kt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gi(kt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gi(kt.paint_raster["raster-brightness-max"]),"raster-saturation":new Gi(kt.paint_raster["raster-saturation"]),"raster-contrast":new Gi(kt.paint_raster["raster-contrast"]),"raster-resampling":new Gi(kt.paint_raster["raster-resampling"]),"raster-fade-duration":new Gi(kt.paint_raster["raster-fade-duration"])})},js=function(t){function e(e){t.call(this,e,Ms)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Qi),Ls=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t)},e}(Qi),Is={circle:Ta,heatmap:Na,hillshade:Va,fill:ko,"fill-extrusion":Go,line:rs,symbol:Es,background:Ts,raster:js};function zs(t){for(var e=0,n=0,i=0,r=t;i<r.length;i+=1){var a=r[i];e+=a.w*a.h,n=Math.max(n,a.w)}t.sort(function(t,e){return e.h-t.h});for(var o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var h=c[l],f=o.length-1;f>=0;f--){var p=o[f];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===p.w&&h.h===p.h){var A=o.pop();f<o.length&&(o[f]=A)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(o.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}var Ds=function(t,e){var n=e.pixelRatio,i=e.version;this.paddedRect=t,this.pixelRatio=n,this.version=i},Bs={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Bs.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Bs.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Bs.tlbr.get=function(){return this.tl.concat(this.br)},Bs.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Ds.prototype,Bs);var Rs=function(t,e){var n={},i={};this.haveRenderCallbacks=[];var r=[];this.addImages(t,n,r),this.addImages(e,i,r);var a=zs(r),o=a.w,s=a.h,u=new Ba({width:o||1,height:s||1});for(var l in t){var c=t[l],h=n[l].paddedRect;Ba.copy(c.data,u,{x:0,y:0},{x:h.x+1,y:h.y+1},c.data)}for(var f in e){var p=e[f],A=i[f].paddedRect,d=A.x+1,v=A.y+1,g=p.data.width,m=p.data.height;Ba.copy(p.data,u,{x:0,y:0},{x:d,y:v},p.data),Ba.copy(p.data,u,{x:0,y:m-1},{x:d,y:v-1},{width:g,height:1}),Ba.copy(p.data,u,{x:0,y:0},{x:d,y:v+m},{width:g,height:1}),Ba.copy(p.data,u,{x:g-1,y:0},{x:d-1,y:v},{width:1,height:m}),Ba.copy(p.data,u,{x:0,y:0},{x:d+g,y:v},{width:1,height:m})}this.image=u,this.iconPositions=n,this.patternPositions=i};Rs.prototype.addImages=function(t,e,n){for(var i in t){var r=t[i],a={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(a),e[i]=new Ds(a,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}},Rs.prototype.patchUpdatedImages=function(t,e){for(var n in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)},Rs.prototype.patchUpdatedImage=function(t,e,n){if(t&&e&&t.version!==e.version){t.version=e.version;var i=t.tl,r=i[0],a=i[1];n.update(e.data,void 0,{x:r,y:a})}},vi("ImagePosition",Ds),vi("ImageAtlas",Rs);var Fs=self.HTMLImageElement,Ns=self.HTMLCanvasElement,Us=self.HTMLVideoElement,Vs=self.ImageData,Gs=function(t,e,n,i){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,i)};Gs.prototype.update=function(t,e,n){var i=t.width,r=t.height,a=!(this.size&&this.size[0]===i&&this.size[1]===r||n),o=this.context,s=o.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),a)this.size=[i,r],t instanceof Fs||t instanceof Ns||t instanceof Us||t instanceof Vs?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,i,r,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=n||{x:0,y:0},l=u.x,c=u.y;t instanceof Fs||t instanceof Ns||t instanceof Us||t instanceof Vs?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,i,r,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Gs.prototype.bind=function(t,e,n){var i=this.context.gl;i.bindTexture(i.TEXTURE_2D,this.texture),n!==i.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=i.LINEAR),t!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrap=e)},Gs.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Gs.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ws=function(t,e,n,i,r){var a,o,s=8*r-i-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?r-1:0,f=n?-1:1,p=t[e+h];for(h+=f,a=p&(1<<-c)-1,p>>=-c,c+=s;c>0;a=256*a+t[e+h],h+=f,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+t[e+h],h+=f,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),a-=l}return(p?-1:1)*o*Math.pow(2,a-i)},Hs=function(t,e,n,i,r,a){var o,s,u,l=8*a-r-1,c=(1<<l)-1,h=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:a-1,A=i?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(e*u-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[n+p]=255&s,p+=A,s/=256,r-=8);for(o=o<<r|s,l+=r;l>0;t[n+p]=255&o,p+=A,o/=256,l-=8);t[n+p-A]|=128*d},qs=Zs;function Zs(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function Xs(t){return t.type===Zs.Bytes?t.readVarint()+t.pos:t.pos+1}function Qs(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Ys(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function Ks(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Js(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function $s(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function tu(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function eu(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function nu(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function iu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function ru(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function au(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function ou(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function su(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function uu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Zs.Varint=0,Zs.Fixed64=1,Zs.Bytes=2,Zs.Fixed32=5,Zs.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,a=this.pos;this.type=7&i,t(r,e,this),this.pos===a&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ou(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=uu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ou(this.buf,this.pos)+4294967296*ou(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=ou(this.buf,this.pos)+4294967296*uu(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Ws(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ws(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,a=n.buf;if(i=(112&(r=a[n.pos++]))>>4,r<128)return Qs(t,i,e);if(i|=(127&(r=a[n.pos++]))<<3,r<128)return Qs(t,i,e);if(i|=(127&(r=a[n.pos++]))<<10,r<128)return Qs(t,i,e);if(i|=(127&(r=a[n.pos++]))<<17,r<128)return Qs(t,i,e);if(i|=(127&(r=a[n.pos++]))<<24,r<128)return Qs(t,i,e);if(i|=(1&(r=a[n.pos++]))<<31,r<128)return Qs(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,n){for(var i="",r=e;r<n;){var a,o,s,u=t[r],l=null,c=u>239?4:u>223?3:u>191?2:1;if(r+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(a=t[r+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===c?(a=t[r+1],o=t[r+2],128==(192&a)&&128==(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=t[r+1],o=t[r+2],s=t[r+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var n=Xs(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=Xs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=Xs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=Xs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=Xs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=Xs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=Xs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=Xs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=Xs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Zs.Varint)for(;this.buf[this.pos++]>127;);else if(e===Zs.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Zs.Fixed32)this.pos+=4;else{if(e!==Zs.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),su(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),su(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),su(this.buf,-1&t,this.pos),su(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),su(this.buf,-1&t,this.pos),su(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,a=0;a<e.length;a++){if((i=e.charCodeAt(a))>55295&&i<57344){if(!r){i>56319||a+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Ys(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Hs(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Hs(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&Ys(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,Zs.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){this.writeMessage(t,Ks,e)},writePackedSVarint:function(t,e){this.writeMessage(t,Js,e)},writePackedBoolean:function(t,e){this.writeMessage(t,eu,e)},writePackedFloat:function(t,e){this.writeMessage(t,$s,e)},writePackedDouble:function(t,e){this.writeMessage(t,tu,e)},writePackedFixed32:function(t,e){this.writeMessage(t,nu,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,iu,e)},writePackedFixed64:function(t,e){this.writeMessage(t,ru,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,au,e)},writeBytesField:function(t,e){this.writeTag(t,Zs.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Zs.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Zs.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Zs.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Zs.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Zs.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Zs.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Zs.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Zs.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Zs.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var lu=3;function cu(t,e,n){1===t&&n.readMessage(hu,e)}function hu(t,e,n){if(3===t){var i=n.readMessage(fu,{}),r=i.id,a=i.bitmap,o=i.width,s=i.height,u=i.left,l=i.top,c=i.advance;e.push({id:r,bitmap:new Da({width:o+2*lu,height:s+2*lu},a),metrics:{width:o,height:s,left:u,top:l,advance:c}})}}function fu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}var pu=lu,Au=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.callbackID=0,v(["receive"],this),this.target.addEventListener("message",this.receive,!1)};function du(t,e,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}Au.prototype.send=function(t,e,n,i){var r=this,a=n?this.mapId+":"+this.callbackID++:null;n&&(this.callbacks[a]=n);var o=[];if(this.target.postMessage({targetMapId:i,sourceMapId:this.mapId,type:t,id:String(a),data:mi(e,o)},o),n)return{cancel:function(){return r.target.postMessage({targetMapId:i,sourceMapId:r.mapId,type:"<cancel>",id:String(a)})}}},Au.prototype.receive=function(t){var e,n=this,i=t.data,r=i.id;if(!i.targetMapId||this.mapId===i.targetMapId){var a=function(t,e){delete n.callbacks[r];var i=[];n.target.postMessage({sourceMapId:n.mapId,type:"<response>",id:String(r),error:t?mi(t):null,data:mi(e,i)},i)};if("<response>"===i.type||"<cancel>"===i.type)e=this.callbacks[i.id],delete this.callbacks[i.id],e&&i.error?e(yi(i.error)):e&&e(null,yi(i.data));else if(void 0!==i.id&&this.parent[i.type]){this.callbacks[i.id]=null;var o=this.parent[i.type](i.sourceMapId,yi(i.data),a);o&&null===this.callbacks[i.id]&&(this.callbacks[i.id]=o.cancel)}else if(void 0!==i.id&&this.parent.getWorkerSource){var s=i.type.split("."),u=yi(i.data);this.parent.getWorkerSource(i.sourceMapId,s[0],u.source)[s[1]](u,a)}else this.parent[i.type](yi(i.data))}},Au.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)};var vu=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};vu.prototype.setNorthEast=function(t){return this._ne=t instanceof gu?new gu(t.lng,t.lat):gu.convert(t),this},vu.prototype.setSouthWest=function(t){return this._sw=t instanceof gu?new gu(t.lng,t.lat):gu.convert(t),this},vu.prototype.extend=function(t){var e,n,i=this._sw,r=this._ne;if(t instanceof gu)e=t,n=t;else{if(!(t instanceof vu))return Array.isArray(t)?t.every(Array.isArray)?this.extend(vu.convert(t)):this.extend(gu.convert(t)):this;if(e=t._sw,n=t._ne,!e||!n)return this}return i||r?(i.lng=Math.min(e.lng,i.lng),i.lat=Math.min(e.lat,i.lat),r.lng=Math.max(n.lng,r.lng),r.lat=Math.max(n.lat,r.lat)):(this._sw=new gu(e.lng,e.lat),this._ne=new gu(n.lng,n.lat)),this},vu.prototype.getCenter=function(){return new gu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},vu.prototype.getSouthWest=function(){return this._sw},vu.prototype.getNorthEast=function(){return this._ne},vu.prototype.getNorthWest=function(){return new gu(this.getWest(),this.getNorth())},vu.prototype.getSouthEast=function(){return new gu(this.getEast(),this.getSouth())},vu.prototype.getWest=function(){return this._sw.lng},vu.prototype.getSouth=function(){return this._sw.lat},vu.prototype.getEast=function(){return this._ne.lng},vu.prototype.getNorth=function(){return this._ne.lat},vu.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},vu.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},vu.prototype.isEmpty=function(){return!(this._sw&&this._ne)},vu.convert=function(t){return!t||t instanceof vu?t:new vu(t)};var gu=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};function mu(t){return 2*Math.PI*6378137*Math.cos(t*Math.PI/180)}function yu(t){return(180+t)/360}function _u(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function bu(t,e){return t/mu(e)}function xu(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}gu.prototype.wrap=function(){return new gu(c(this.lng,-180,180),this.lat)},gu.prototype.toArray=function(){return[this.lng,this.lat]},gu.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},gu.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new vu(new gu(this.lng-n,this.lat-e),new gu(this.lng+n,this.lat+e))},gu.convert=function(t){if(t instanceof gu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new gu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new gu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var wu=function(t,e,n){void 0===n&&(n=0),this.x=+t,this.y=+e,this.z=+n};wu.fromLngLat=function(t,e){void 0===e&&(e=0);var n=gu.convert(t);return new wu(yu(n.lng),_u(n.lat),bu(e,n.lat))},wu.prototype.toLngLat=function(){return new gu(360*this.x-180,xu(this.y))},wu.prototype.toAltitude=function(){return this.z*mu(xu(this.y))};var Su=function(t,e,n){this.z=t,this.x=e,this.y=n,this.key=Pu(0,t,e,n)};Su.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Su.prototype.url=function(t,e){var n,i,r,a,o,s=(n=this.x,i=this.y,r=this.z,a=du(256*n,256*(i=Math.pow(2,r)-i-1),r),o=du(256*(n+1),256*(i+1),r),a[0]+","+a[1]+","+o[0]+","+o[1]),u=function(t,e,n){for(var i,r="",a=t;a>0;a--)r+=(e&(i=1<<a-1)?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Su.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new r((t.x*e-this.x)*ra,(t.y*e-this.y)*ra)};var ku=function(t,e){this.wrap=t,this.canonical=e,this.key=Pu(t,e.z,e.x,e.y)},Ou=function(t,e,n,i,r){this.overscaledZ=t,this.wrap=e,this.canonical=new Su(n,+i,+r),this.key=Pu(e,t,i,r)};function Pu(t,e,n,i){(t*=2)<0&&(t=-1*t-1);var r=1<<e;return 32*(r*r*t+r*i+n)+e}Ou.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Ou.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Ou(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ou(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Ou.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Ou.prototype.children=function(t){if(this.overscaledZ>=t)return[new Ou(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Ou(e,this.wrap,e,n,i),new Ou(e,this.wrap,e,n+1,i),new Ou(e,this.wrap,e,n,i+1),new Ou(e,this.wrap,e,n+1,i+1)]},Ou.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Ou.prototype.wrapped=function(){return new Ou(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Ou.prototype.unwrapTo=function(t){return new Ou(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Ou.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Ou.prototype.toUnwrapped=function(){return new ku(this.wrap,this.canonical)},Ou.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Ou.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new wu(t.x-this.wrap,t.y))},vi("CanonicalTileID",Su),vi("OverscaledTileID",Ou,{omit:["posMatrix"]});var Eu=function(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return x('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');var i=this.dim=e.height;this.stride=this.dim+2,this.data=new Int32Array(this.stride*this.stride);for(var r=e.data,a="terrarium"===n?this._unpackTerrarium:this._unpackMapbox,o=0;o<i;o++)for(var s=0;s<i;s++){var u=4*(o*i+s);this.set(s,o,a(r[u],r[u+1],r[u+2]))}for(var l=0;l<i;l++)this.set(-1,l,this.get(0,l)),this.set(i,l,this.get(i-1,l)),this.set(l,-1,this.get(l,0)),this.set(l,i,this.get(l,i-1));this.set(-1,-1,this.get(0,0)),this.set(i,-1,this.get(i-1,0)),this.set(-1,i,this.get(0,i-1)),this.set(i,i,this.get(i-1,i-1))};Eu.prototype.set=function(t,e,n){this.data[this._idx(t,e)]=n+65536},Eu.prototype.get=function(t,e){return this.data[this._idx(t,e)]-65536},Eu.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Eu.prototype._unpackMapbox=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},Eu.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},Eu.prototype.getPixels=function(){return new Ba({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Eu.prototype.backfillBorder=function(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var i=e*this.dim,r=e*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(e){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}for(var s=-e*this.dim,u=-n*this.dim,l=a;l<o;l++)for(var c=i;c<r;c++)this.set(c,l,t.get(c+s,l+u))},vi("DEMData",Eu);var Cu=$i([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Tu=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};Tu.prototype.encode=function(t){return this._stringToNumber[t]},Tu.prototype.decode=function(t){return this._numberToString[t]};var Mu=function(t,e,n,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=i,this.properties=t.properties,null!=t.id&&(this.id=t.id)},ju={geometry:{configurable:!0}};ju.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},ju.geometry.set=function(t){this._geometry=t},Mu.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Mu.prototype,ju);var Lu=function(){this.state={},this.stateChanges={},this.deletedStates={}};Lu.prototype.updateState=function(t,e,n){var i=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},h(this.stateChanges[t][i],n),null===this.deletedStates[t])for(var r in this.deletedStates[t]={},this.state[t])r!==i&&(this.deletedStates[t][r]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][i])for(var a in this.deletedStates[t][i]={},this.state[t][i])n[a]||(this.deletedStates[t][i][a]=null);else for(var o in n)this.deletedStates[t]&&this.deletedStates[t][i]&&null===this.deletedStates[t][i][o]&&delete this.deletedStates[t][i][o]},Lu.prototype.removeFeatureState=function(t,e,n){if(null!==this.deletedStates[t]){var i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&e)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][n]=null);else if(e)if(this.stateChanges[t]&&this.stateChanges[t][i])for(n in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][n]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}},Lu.prototype.getState=function(t,e){var n=String(e),i=this.state[t]||{},r=this.stateChanges[t]||{},a=h({},i[n],r[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var o=this.deletedStates[t][e];if(null===o)return{};for(var s in o)delete a[s]}return a},Lu.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},Lu.prototype.coalesceChanges=function(t,e){var n={};for(var i in this.stateChanges){this.state[i]=this.state[i]||{};var r={};for(var a in this.stateChanges[i])this.state[i][a]||(this.state[i][a]={}),h(this.state[i][a],this.stateChanges[i][a]),r[a]=this.state[i][a];n[i]=r}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var u in this.state[o])s[u]={},this.state[o][u]={};else for(var l in this.deletedStates[o]){if(null===this.deletedStates[o][l])this.state[o][l]={};else for(var c=0,f=Object.keys(this.deletedStates[o][l]);c<f.length;c+=1){var p=f[c];delete this.state[o][l][p]}s[l]=this.state[o][l]}n[o]=n[o]||{},h(n[o],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var A in t)t[A].setFeatureState(n,e)};var Iu=function(t,e,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new hi(ra,16,0),this.grid3D=new hi(ra,16,0),this.featureIndexArray=n||new Lr};function zu(t){for(var e=1/0,n=1/0,i=-1/0,r=-1/0,a=0,o=t;a<o.length;a+=1){var s=o[a];e=Math.min(e,s.x),n=Math.min(n,s.y),i=Math.max(i,s.x),r=Math.max(r,s.y)}return{minX:e,minY:n,maxX:i,maxY:r}}function Du(t,e){return e-t}Iu.prototype.insert=function(t,e,n,i,r,a){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);for(var s=a?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var f=l[h];c[0]=Math.min(c[0],f.x),c[1]=Math.min(c[1],f.y),c[2]=Math.max(c[2],f.x),c[3]=Math.max(c[3],f.y)}c[0]<ra&&c[1]<ra&&c[2]>=0&&c[3]>=0&&s.insert(o,c[0],c[1],c[2],c[3])}},Iu.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new zo.VectorTile(new qs(this.rawTileData)).layers,this.sourceLayerCoder=new Tu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Iu.prototype.query=function(t,e,n){var i=this;this.loadVTLayers();for(var a=t.params||{},o=ra/t.tileSize/t.scale,s=Fn(a.filter),u=t.queryGeometry,l=t.queryPadding*o,c=zu(u),h=this.grid.query(c.minX-l,c.minY-l,c.maxX+l,c.maxY+l),f=zu(t.cameraQueryGeometry),p=0,A=this.grid3D.query(f.minX-l,f.minY-l,f.maxX+l,f.maxY+l,function(e,n,i,a){return function(t,e,n,i,a){for(var o=0,s=t;o<s.length;o+=1){var u=s[o];if(e<=u.x&&n<=u.y&&i>=u.x&&a>=u.y)return!0}var l=[new r(e,n),new r(e,a),new r(i,a),new r(i,n)];if(t.length>2)for(var c=0,h=l;c<h.length;c+=1)if(ma(t,h[c]))return!0;for(var f=0;f<t.length-1;f++)if(ya(t[f],t[f+1],l))return!0;return!1}(t.cameraQueryGeometry,e-l,n-l,i+l,a+l)});p<A.length;p+=1){var d=A[p];h.push(d)}h.sort(Du);for(var v,g={},m=function(r){var l=h[r];if(l!==v){v=l;var c=i.featureIndexArray.get(l),f=null;i.loadMatchingFeature(g,c.bucketIndex,c.sourceLayerIndex,c.featureIndex,s,a.layers,e,function(e,r){f||(f=oa(e));var a={};return e.id&&(a=n.getState(r.sourceLayer||"_geojsonTileLayer",e.id)),r.queryIntersectsFeature(u,e,a,f,i.z,t.transform,o,t.pixelPosMatrix)})}},y=0;y<h.length;y++)m(y);return g},Iu.prototype.loadMatchingFeature=function(t,e,n,i,r,a,o,s){var u=this.bucketLayerIDs[e];if(!a||function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(a,u)){var l=this.sourceLayerCoder.decode(n),c=this.vtLayers[l].feature(i);if(r(new Ii(this.tileID.overscaledZ),c))for(var h=0;h<u.length;h++){var f=u[h];if(!(a&&a.indexOf(f)<0)){var p=o[f];if(p){var A=!s||s(c,p);if(A){var d=new Mu(c,this.z,this.x,this.y);d.layer=p.serialize();var v=t[f];void 0===v&&(v=t[f]=[]),v.push({featureIndex:i,feature:d,intersectionZ:A})}}}}}},Iu.prototype.lookupSymbolFeatures=function(t,e,n,i,r,a){var o={};this.loadVTLayers();for(var s=Fn(i),u=0,l=t;u<l.length;u+=1){var c=l[u];this.loadMatchingFeature(o,e,n,c,s,r,a)}return o},Iu.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var i=0,r=n[e];i<r.length;i+=1)if(t===r[i])return!0;return!1},vi("FeatureIndex",Iu,{omit:["rawTileData","sourceLayerCoder"]});var Bu=function(t,e){this.tileID=t,this.uid=p(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.expiredRequestCount=0,this.state="loading"};Bu.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<j.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},Bu.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},Bu.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var i in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var i=function(){var t=a[r],i=t.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==i.length){t.layers=i,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map(function(t){return i.filter(function(e){return e.id===t})[0]}));for(var o=0,s=i;o<s.length;o+=1){var u=s[o];n[u.id]=t}}},r=0,a=t;r<a.length;r+=1)i();return n}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var r=this.buckets[i];if(r instanceof ks){if(this.hasSymbolBuckets=!0,!n)break;r.justReloaded=!0}}for(var a in this.queryPadding=0,this.buckets){var o=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(a).queryRadius(o))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new wr},Bu.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Bu.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},Bu.prototype.getBucket=function(t){return this.buckets[t.id]},Bu.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploadPending()&&n.upload(t)}var i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Gs(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gs(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)},Bu.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Bu.prototype.queryRenderedFeatures=function(t,e,n,i,r,a,o,s,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:i,scale:r,tileSize:this.tileSize,pixelPosMatrix:u,transform:o,params:a,queryPadding:this.queryPadding*s},t,e):{}},Bu.prototype.querySourceFeatures=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var n=this.latestFeatureIndex.loadVTLayers(),i=e?e.sourceLayer:"",r=n._geojsonTileLayer||n[i];if(r)for(var a=Fn(e&&e.filter),o=this.tileID.canonical,s=o.z,u=o.x,l=o.y,c={z:s,x:u,y:l},h=0;h<r.length;h++){var f=r.feature(h);if(a(new Ii(this.tileID.overscaledZ),f)){var p=new Mu(f,s,u,l);p.tile=c,t.push(p)}}}},Bu.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},Bu.prototype.setMask=function(t,e){if(!o(this.mask,t)&&(this.mask=t,this.clearMask(),!o(t,{0:!0}))){var n=new nr,i=new gr;this.segments=new zr,this.segments.prepareSegment(0,n,i);for(var a=Object.keys(t),s=0;s<a.length;s++){var u=t[a[s]],l=ra>>u.z,c=new r(u.x*l,u.y*l),h=new r(c.x+l,c.y+l),f=this.segments.prepareSegment(4,n,i);n.emplaceBack(c.x,c.y,c.x,c.y),n.emplaceBack(h.x,c.y,h.x,c.y),n.emplaceBack(c.x,h.y,c.x,h.y),n.emplaceBack(h.x,h.y,h.x,h.y);var p=f.vertexLength;i.emplaceBack(p,p+1,p+2),i.emplaceBack(p+1,p+2,p+3),f.vertexLength+=4,f.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(n,Cu.members),this.maskedIndexBuffer=e.createIndexBuffer(i)}},Bu.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Bu.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Bu.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=function(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,n,i,r){var a=i||r;return e[n]=!a||a.toLowerCase(),""}),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var i=Date.now(),r=!1;if(this.expirationTime>i)r=!1;else if(e)if(this.expirationTime<e)r=!0;else{var a=this.expirationTime-e;a?this.expirationTime=i+Math.max(a,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Bu.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},Bu.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var n=this.latestFeatureIndex.loadVTLayers();for(var i in this.buckets){var r=this.buckets[i],a=r.layers[0].sourceLayer||"_geojsonTileLayer",o=n[a],s=t[a];o&&s&&0!==Object.keys(s).length&&(r.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{}),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(i).queryRadius(r))))}}},Bu.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},Bu.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<j.now()},Bu.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Bu.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=j.now()+t};var Ru=24,Fu={horizontal:1,vertical:2,horizontalOnly:3},Nu=function(){this.text="",this.sectionIndex=[],this.sections=[]};function Uu(t,e,n,i,r,a,o,s,u,l){var c,h=Nu.fromFeature(t,n);l===Fu.vertical&&h.verticalizePunctuation();var f=Li.processBidirectionalText,p=Li.processStyledBidirectionalText;if(f&&1===h.sections.length){c=[];for(var A=0,d=f(h.toString(),Zu(h,s,i,e));A<d.length;A+=1){var v=d[A],g=new Nu;g.text=v,g.sections=h.sections;for(var m=0;m<v.length;m++)g.sectionIndex.push(0);c.push(g)}}else if(p){c=[];for(var y=0,_=p(h.text,h.sectionIndex,Zu(h,s,i,e));y<_.length;y+=1){var b=_[y],x=new Nu;x.text=b[0],x.sectionIndex=b[1],x.sections=h.sections,c.push(x)}}else c=function(t,e){for(var n=[],i=t.text,r=0,a=0,o=e;a<o.length;a+=1){var s=o[a];n.push(t.substring(r,s)),r=s}return r<i.length&&n.push(t.substring(r,i.length)),n}(h,Zu(h,s,i,e));var w=[],S={positionedGlyphs:w,text:h.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:l,lineCount:c.length};return function(t,e,n,i,r,a,o,s){for(var u=0,l=-17,c=0,h=t.positionedGlyphs,f="right"===a?1:"left"===a?0:.5,p=0,A=n;p<A.length;p+=1){var d=A[p];d.trim();var v=d.getMaxScale();if(d.length()){for(var g=h.length,m=0;m<d.length();m++){var y=d.getSection(m),_=d.getCharCode(m),b=24*(v-y.scale),x=e[y.fontStack],w=x&&x[_];w&&(ki(_)&&o!==Fu.horizontal?(h.push({glyph:_,x:u,y:b,vertical:!0,scale:y.scale,fontStack:y.fontStack}),u+=Ru*y.scale+s):(h.push({glyph:_,x:u,y:l+b,vertical:!1,scale:y.scale,fontStack:y.fontStack}),u+=w.metrics.advance*y.scale+s))}if(h.length!==g){var S=u-s;c=Math.max(S,c),Qu(h,e,g,h.length-1,f)}u=0,l+=i*v}else l+=i}var k=Xu(r),O=k.horizontalAlign,P=k.verticalAlign;!function(t,e,n,i,r,a,o){for(var s=(e-n)*r,u=(-i*o+.5)*a,l=0;l<t.length;l++)t[l].x+=s,t[l].y+=u}(h,f,O,P,c,i,n.length);var E=l- -17;t.top+=-P*E,t.bottom=t.top+E,t.left+=-O*c,t.right=t.left+c}(S,e,c,r,a,o,l,s),!!w.length&&S}Nu.fromFeature=function(t,e){for(var n=new Nu,i=0;i<t.sections.length;i++){var r=t.sections[i];n.sections.push({scale:r.scale||1,fontStack:r.fontStack||e}),n.text+=r.text;for(var a=0;a<r.text.length;a++)n.sectionIndex.push(i)}return n},Nu.prototype.length=function(){return this.text.length},Nu.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Nu.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Nu.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",n=0;n<t.length;n++){var i=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;i&&Oi(i)&&!fs[t[n+1]]||r&&Oi(r)&&!fs[t[n-1]]||!fs[t[n]]?e+=t[n]:e+=fs[t[n]]}return e}(this.text)},Nu.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Vu[this.text.charCodeAt(e)];e++)t++;for(var n=this.text.length,i=this.text.length-1;i>=0&&i>=t&&Vu[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)},Nu.prototype.substring=function(t,e){var n=new Nu;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n},Nu.prototype.toString=function(){return this.text},Nu.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(e,n){return Math.max(e,t.sections[n].scale)},0)};var Vu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gu={};function Wu(t,e,n,i){var r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function Hu(t,e){var n=0;return 10===t&&(n-=1e4),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function qu(t,e,n,i,r,a){for(var o=null,s=Wu(e,n,r,a),u=0,l=i;u<l.length;u+=1){var c=l[u],h=Wu(e-c.x,n,r,a)+c.badness;h<=s&&(o=c,s=h)}return{index:t,x:e,priorBreak:o,badness:s}}function Zu(t,e,n,i){if(!n)return[];if(!t)return[];for(var r,a=[],o=function(t,e,n,i){for(var r=0,a=0;a<t.length();a++){var o=t.getSection(a),s=i[o.fontStack],u=s&&s[t.getCharCode(a)];u&&(r+=u.metrics.advance*o.scale+e)}return r/Math.max(1,Math.ceil(r/n))}(t,e,n,i),s=0,u=0;u<t.length();u++){var l=t.getSection(u),c=t.getCharCode(u),h=i[l.fontStack],f=h&&h[c];f&&!Vu[c]&&(s+=f.metrics.advance*l.scale+e),u<t.length()-1&&(Gu[c]||!((r=c)<11904)&&(bi["Bopomofo Extended"](r)||bi.Bopomofo(r)||bi["CJK Compatibility Forms"](r)||bi["CJK Compatibility Ideographs"](r)||bi["CJK Compatibility"](r)||bi["CJK Radicals Supplement"](r)||bi["CJK Strokes"](r)||bi["CJK Symbols and Punctuation"](r)||bi["CJK Unified Ideographs Extension A"](r)||bi["CJK Unified Ideographs"](r)||bi["Enclosed CJK Letters and Months"](r)||bi["Halfwidth and Fullwidth Forms"](r)||bi.Hiragana(r)||bi["Ideographic Description Characters"](r)||bi["Kangxi Radicals"](r)||bi["Katakana Phonetic Extensions"](r)||bi.Katakana(r)||bi["Vertical Forms"](r)||bi["Yi Radicals"](r)||bi["Yi Syllables"](r)))&&a.push(qu(u+1,s,o,a,Hu(c,t.getCharCode(u+1)),!1))}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(qu(t.length(),s,o,a,0,!0))}function Xu(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Qu(t,e,n,i,r){if(r){var a=t[i],o=e[a.fontStack],s=o&&o[a.glyph];if(s)for(var u=s.metrics.advance*a.scale,l=(t[i].x+u)*r,c=n;c<=i;c++)t[c].x-=l}}function Yu(t,e,n){var i=Xu(n),r=i.horizontalAlign,a=i.verticalAlign,o=e[0],s=e[1],u=o-t.displaySize[0]*r,l=u+t.displaySize[0],c=s-t.displaySize[1]*a;return{image:t,top:c,bottom:c+t.displaySize[1],left:u,right:l}}function Ku(t,e,n,i,r){if(void 0===e.segment)return!0;for(var a=e,o=e.segment+1,s=0;s>-n/2;){if(--o<0)return!1;s-=t[o].dist(a),a=t[o]}s+=t[o].dist(t[o+1]),o++;for(var u=[],l=0;s<n/2;){var c=t[o-1],h=t[o],f=t[o+1];if(!f)return!1;var p=c.angleTo(h)-h.angleTo(f);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:p}),l+=p;s-u[0].distance>i;)l-=u.shift().angleDelta;if(l>r)return!1;o++,s+=h.dist(f)}return!0}function Ju(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function $u(t,e,n){return t?.6*e*n:0}function tl(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function el(t,e,n,i,r,a){for(var o=$u(n,r,a),s=tl(n,i)*a,u=0,l=Ju(t)/2,c=0;c<t.length-1;c++){var h=t[c],f=t[c+1],p=h.dist(f);if(u+p>l){var A=(l-u)/p,d=me(h.x,f.x,A),v=me(h.y,f.y,A),g=new ps(d,v,f.angleTo(h),c);return g._round(),!o||Ku(t,g,s,o,e)?g:void 0}u+=p}}function nl(t,e,n,i,r,a,o,s,u){var l=$u(i,a,o),c=tl(i,r),h=c*o,f=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,n,i,r,a,o,s,u,l){for(var c=o/2,h=Ju(e),f=0,p=n-i,A=[],d=0;d<e.length-1;d++){for(var v=e[d],g=e[d+1],m=v.dist(g),y=g.angleTo(v);p+i<f+m;){var _=((p+=i)-f)/m,b=me(v.x,g.x,_),x=me(v.y,g.y,_);if(b>=0&&b<l&&x>=0&&x<l&&p-c>=0&&p+c<=h){var w=new ps(b,x,y,d);w._round(),r&&!Ku(e,w,o,r,a)||A.push(w)}}f+=m}return u||A.length||s||(A=t(e,f/2,i,r,a,o,s,!0,l)),A}(t,f?e/2*s%e:(c/2+2*a)*o*s%e,e,l,n,h,f,!1,u)}Gu[10]=!0,Gu[32]=!0,Gu[38]=!0,Gu[40]=!0,Gu[41]=!0,Gu[43]=!0,Gu[45]=!0,Gu[47]=!0,Gu[173]=!0,Gu[183]=!0,Gu[8203]=!0,Gu[8208]=!0,Gu[8211]=!0,Gu[8231]=!0;var il=function(t,e,n,i,a,o,s,u,l,c,h,f){var p=s.top*u-l,A=s.bottom*u+l,d=s.left*u-l,v=s.right*u+l;if(this.boxStartIndex=t.length,c){var g=A-p,m=v-d;g>0&&(g=Math.max(10*u,g),this._addLineCollisionCircles(t,e,n,n.segment,m,g,i,a,o,h))}else{if(f){var y=new r(d,p),_=new r(v,p),b=new r(d,A),x=new r(v,A),w=f*Math.PI/180;y._rotate(w),_._rotate(w),b._rotate(w),x._rotate(w),d=Math.min(y.x,_.x,b.x,x.x),v=Math.max(y.x,_.x,b.x,x.x),p=Math.min(y.y,_.y,b.y,x.y),A=Math.max(y.y,_.y,b.y,x.y)}t.emplaceBack(n.x,n.y,d,p,v,A,i,a,o,0,0)}this.boxEndIndex=t.length};il.prototype._addLineCollisionCircles=function(t,e,n,i,r,a,o,s,u,l){var c=a/2,h=Math.floor(r/c)||1,f=1+.4*Math.log(l)/Math.LN2,p=Math.floor(h*f/2),A=-a/2,d=n,v=i+1,g=A,m=-r/2,y=m-r/4;do{if(--v<0){if(g>m)return;v=0;break}g-=e[v].dist(d),d=e[v]}while(g>y);for(var _=e[v].dist(e[v+1]),b=-p;b<h+p;b++){var x=b*c,w=m+x;if(x<0&&(w+=x),x>r&&(w+=x-r),!(w<g)){for(;g+_<w;){if(g+=_,++v+1>=e.length)return;_=e[v].dist(e[v+1])}var S=w-g,k=e[v],O=e[v+1].sub(k)._unit()._mult(S)._add(k)._round(),P=Math.abs(w-A)<c?0:.8*(w-A);t.emplaceBack(O.x,O.y,-a/2,-a/2,a/2,a/2,o,s,u,a/2,P)}}};var rl=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=al),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function al(t,e){return t<e?-1:t>e?1:0}function ol(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var i=1/0,a=1/0,o=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<i)&&(i=c.x),(!l||c.y<a)&&(a=c.y),(!l||c.x>o)&&(o=c.x),(!l||c.y>s)&&(s=c.y)}var h=o-i,f=s-a,p=Math.min(h,f),A=p/2,d=new rl([],sl);if(0===p)return new r(i,a);for(var v=i;v<o;v+=p)for(var g=a;g<s;g+=p)d.push(new ul(v+A,g+A,A,t));for(var m=function(t){for(var e=0,n=0,i=0,r=t[0],a=0,o=r.length,s=o-1;a<o;s=a++){var u=r[a],l=r[s],c=u.x*l.y-l.x*u.y;n+=(u.x+l.x)*c,i+=(u.y+l.y)*c,e+=3*c}return new ul(n/e,i/e,0,t)}(t),y=d.length;d.length;){var _=d.pop();(_.d>m.d||!m.d)&&(m=_,n&&console.log("found best %d after %d probes",Math.round(1e4*_.d)/1e4,y)),_.max-m.d<=e||(A=_.h/2,d.push(new ul(_.p.x-A,_.p.y-A,A,t)),d.push(new ul(_.p.x+A,_.p.y-A,A,t)),d.push(new ul(_.p.x-A,_.p.y+A,A,t)),d.push(new ul(_.p.x+A,_.p.y+A,A,t)),y+=4)}return n&&(console.log("num probes: "+y),console.log("best distance: "+m.d)),m.p}function sl(t,e){return e.max-t.max}function ul(t,e,n,i){this.p=new r(t,e),this.h=n,this.d=function(t,e){for(var n=!1,i=1/0,r=0;r<e.length;r++)for(var a=e[r],o=0,s=a.length,u=s-1;o<s;u=o++){var l=a[o],c=a[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(n=!n),i=Math.min(i,va(t,l,c))}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}rl.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},rl.prototype.pop=function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},rl.prototype.peek=function(){return this.data[0]},rl.prototype._up=function(t){for(var e=this.data,n=this.compare,i=e[t];t>0;){var r=t-1>>1,a=e[r];if(n(i,a)>=0)break;e[t]=a,t=r}e[t]=i},rl.prototype._down=function(t){for(var e=this.data,n=this.compare,i=this.length>>1,r=e[t];t<i;){var a=1+(t<<1),o=e[a],s=a+1;if(s<this.length&&n(e[s],o)<0&&(a=s,o=e[s]),n(o,r)>=0)break;e[t]=o,t=a}e[t]=r};var ll=e(function(t){t.exports=function(t,e){var n,i,r,a,o,s,u,l;for(n=3&t.length,i=t.length-n,r=e,o=3432918353,s=461845907,l=0;l<i;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,r=27492+(65535&(a=5*(65535&(r=(r^=u=(65535&(u=(u=(65535&u)*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:r^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}}),cl=e(function(t){t.exports=function(t,e){for(var n,i=t.length,r=e^i,a=0;i>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++a;switch(i){case 3:r^=(255&t.charCodeAt(a+2))<<16;case 2:r^=(255&t.charCodeAt(a+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(a)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}}),hl=ll,fl=ll,pl=cl;hl.murmur3=fl,hl.murmur2=pl;var Al=7;function dl(t,e){var n=0,i=0,r=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":i=r-Al;break;case"bottom-right":case"bottom-left":i=-r+Al;break;case"bottom":i=-e+Al;break;case"top":i=e-Al}switch(t){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=e;break;case"right":n=-e}return[n,i]}function vl(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gl(t,e,n,i,a,o,s){var u=o.layoutTextSize.evaluate(e,{}),l=o.layoutIconSize.evaluate(e,{}),c=o.textMaxSize.evaluate(e,{});void 0===c&&(c=u);var h=t.layers[0].layout,f=h.get("icon-offset").evaluate(e,{}),p=_l(n.horizontal),A=u/24,d=t.tilePixelRatio*A,v=t.tilePixelRatio*c/24,g=t.tilePixelRatio*l,m=t.tilePixelRatio*h.get("symbol-spacing"),y=h.get("text-padding")*t.tilePixelRatio,_=h.get("icon-padding")*t.tilePixelRatio,b=h.get("text-max-angle")/180*Math.PI,w="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),S="map"===h.get("icon-rotation-alignment")&&"point"!==h.get("symbol-placement"),k=h.get("symbol-placement"),O=m/2,P=function(u,l){l.x<0||l.x>=ra||l.y<0||l.y>=ra||function(t,e,n,i,a,o,s,u,l,c,h,f,p,A,d,v,g,m,y,_,b){var w,S,k=t.addToLineVertexArray(e,n),O=0,P=0,E=0,C={},T=hl(""),M=(o.layout.get("text-radial-offset").evaluate(y,{})||0)*Ru;for(var j in i.horizontal){var L=i.horizontal[j];if(!w){T=hl(L.text);var I=o.layout.get("text-rotate").evaluate(y,{});w=new il(s,n,e,u,l,c,L,h,f,p,t.overscaling,I)}var z=1===L.lineCount;if(P+=yl(t,e,L,o,p,y,A,k,i.vertical?Fu.horizontal:Fu.horizontalOnly,z?Object.keys(i.horizontal):[j],C,_,b),z)break}i.vertical&&(E+=yl(t,e,i.vertical,o,p,y,A,k,Fu.vertical,["vertical"],C,_,b));var D=w?w.boxStartIndex:t.collisionBoxArray.length,B=w?w.boxEndIndex:t.collisionBoxArray.length;if(a){var R=function(t,e,n,i,a,o){var s,u,l,c,h=e.image,f=n.layout,p=e.top-1/h.pixelRatio,A=e.left-1/h.pixelRatio,d=e.bottom+1/h.pixelRatio,v=e.right+1/h.pixelRatio;if("none"!==f.get("icon-text-fit")&&a){var g=v-A,m=d-p,y=f.get("text-size").evaluate(o,{})/24,_=a.left*y,b=a.right*y,x=a.top*y,w=b-_,S=a.bottom*y-x,k=f.get("icon-text-fit-padding")[0],O=f.get("icon-text-fit-padding")[1],P=f.get("icon-text-fit-padding")[2],E=f.get("icon-text-fit-padding")[3],C="width"===f.get("icon-text-fit")?.5*(S-m):0,T="height"===f.get("icon-text-fit")?.5*(w-g):0,M="width"===f.get("icon-text-fit")||"both"===f.get("icon-text-fit")?w:g,j="height"===f.get("icon-text-fit")||"both"===f.get("icon-text-fit")?S:m;s=new r(_+T-E,x+C-k),u=new r(_+T+O+M,x+C-k),l=new r(_+T+O+M,x+C+P+j),c=new r(_+T-E,x+C+P+j)}else s=new r(A,p),u=new r(v,p),l=new r(v,d),c=new r(A,d);var L=n.layout.get("icon-rotate").evaluate(o,{})*Math.PI/180;if(L){var I=Math.sin(L),z=Math.cos(L),D=[z,-I,I,z];s._matMult(D),u._matMult(D),c._matMult(D),l._matMult(D)}return[{tl:s,tr:u,bl:c,br:l,tex:h.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,a,o,0,_l(i.horizontal),y),F=o.layout.get("icon-rotate").evaluate(y,{});S=new il(s,n,e,u,l,c,a,d,v,!1,t.overscaling,F),O=4*R.length;var N=t.iconSizeData,U=null;"source"===N.functionType?(U=[As*o.layout.get("icon-size").evaluate(y,{})])[0]>ml&&x(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'):"composite"===N.functionType&&((U=[As*b.compositeIconSizes[0].evaluate(y,{}),As*b.compositeIconSizes[1].evaluate(y,{})])[0]>ml||U[1]>ml)&&x(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'),t.addSymbols(t.icon,R,U,m,g,y,!1,e,k.lineStartIndex,k.lineLength)}var V=S?S.boxStartIndex:t.collisionBoxArray.length,G=S?S.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=ks.MAX_GLYPHS&&x("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),t.symbolInstances.emplaceBack(e.x,e.y,C.right>=0?C.right:-1,C.center>=0?C.center:-1,C.left>=0?C.left:-1,C.vertical||-1,T,D,B,V,G,u,P,E,O,0,h,M)}(t,l,u,n,i,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,d,y,w,s,g,_,S,f,e,a,o)};if("line"===k)for(var E=0,C=function(t,e,n,i,a){for(var o=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],f=u[c+1];h.x<0&&f.x<0||(h.x<0?h=new r(0,h.y+(f.y-h.y)*((0-h.x)/(f.x-h.x)))._round():f.x<0&&(f=new r(0,h.y+(f.y-h.y)*((0-h.x)/(f.x-h.x)))._round()),h.y<0&&f.y<0||(h.y<0?h=new r(h.x+(f.x-h.x)*((0-h.y)/(f.y-h.y)),0)._round():f.y<0&&(f=new r(h.x+(f.x-h.x)*((0-h.y)/(f.y-h.y)),0)._round()),h.x>=i&&f.x>=i||(h.x>=i?h=new r(i,h.y+(f.y-h.y)*((i-h.x)/(f.x-h.x)))._round():f.x>=i&&(f=new r(i,h.y+(f.y-h.y)*((i-h.x)/(f.x-h.x)))._round()),h.y>=a&&f.y>=a||(h.y>=a?h=new r(h.x+(f.x-h.x)*((a-h.y)/(f.y-h.y)),a)._round():f.y>=a&&(f=new r(h.x+(f.x-h.x)*((a-h.y)/(f.y-h.y)),a)._round()),l&&h.equals(l[l.length-1])||(l=[h],o.push(l)),l.push(f)))))}return o}(e.geometry,0,0,ra,ra);E<C.length;E+=1)for(var T=C[E],M=0,j=nl(T,m,b,n.vertical||p,i,24,v,t.overscaling,ra);M<j.length;M+=1){var L=j[M];p&&bl(t,p.text,O,L)||P(T,L)}else if("line-center"===k)for(var I=0,z=e.geometry;I<z.length;I+=1){var D=z[I];if(D.length>1){var B=el(D,b,n.vertical||p,i,24,v);B&&P(D,B)}}else if("Polygon"===e.type)for(var R=0,F=yo(e.geometry,0);R<F.length;R+=1){var N=F[R],U=ol(N,16);P(N[0],new ps(U.x,U.y,0))}else if("LineString"===e.type)for(var V=0,G=e.geometry;V<G.length;V+=1){var W=G[V];P(W,new ps(W[0].x,W[0].y,0))}else if("Point"===e.type)for(var H=0,q=e.geometry;H<q.length;H+=1)for(var Z=0,X=q[H];Z<X.length;Z+=1){var Q=X[Z];P([Q],new ps(Q.x,Q.y,0))}}var ml=65535;function yl(t,e,n,i,a,o,s,u,l,c,h,f,p){var A=function(t,e,n,i,a,o,s){for(var u=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,l=e.positionedGlyphs,c=[],h=0;h<l.length;h++){var f=l[h],p=s[f.fontStack],A=p&&p[f.glyph];if(A){var d=A.rect;if(d){var v=pu+1,g=A.metrics.advance*f.scale/2,m=a?[f.x+g,f.y]:[0,0],y=a?[0,0]:[f.x+g+n[0],f.y+n[1]],_=(A.metrics.left-v)*f.scale-g+y[0],b=(-A.metrics.top-v)*f.scale+y[1],x=_+d.w*f.scale,w=b+d.h*f.scale,S=new r(_,b),k=new r(x,b),O=new r(_,w),P=new r(x,w);if(a&&f.vertical){var E=new r(-g,g),C=-Math.PI/2,T=new r(5,0);S._rotateAround(C,E)._add(T),k._rotateAround(C,E)._add(T),O._rotateAround(C,E)._add(T),P._rotateAround(C,E)._add(T)}if(u){var M=Math.sin(u),j=Math.cos(u),L=[j,-M,M,j];S._matMult(L),k._matMult(L),O._matMult(L),P._matMult(L)}c.push({tl:S,tr:k,bl:O,br:P,tex:d,writingMode:e.writingMode,glyphOffset:m})}}}return c}(0,n,s,i,a,o,f),d=t.textSizeData,v=null;"source"===d.functionType?(v=[As*i.layout.get("text-size").evaluate(o,{})])[0]>ml&&x(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'):"composite"===d.functionType&&((v=[As*p.compositeTextSizes[0].evaluate(o,{}),As*p.compositeTextSizes[1].evaluate(o,{})])[0]>ml||v[1]>ml)&&x(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'),t.addSymbols(t.text,A,v,s,a,o,l,e,u.lineStartIndex,u.lineLength);for(var g=0,m=c;g<m.length;g+=1)h[m[g]]=t.text.placedSymbolArray.length-1;return 4*A.length}function _l(t){for(var e in t)return t[e];return null}function bl(t,e,n,i){var r=t.compareText;if(e in r){for(var a=r[e],o=a.length-1;o>=0;o--)if(i.dist(a[o])<n)return!0}else r[e]=[];return r[e].push(i),!1}t.Actor=Au,t.AlphaImage=Da,t.CanonicalTileID=Su,t.CollisionBoxArray=wr,t.Color=Zt,t.DEMData=Eu,t.DataConstantProperty=Gi,t.DictionaryCoder=Tu,t.EXTENT=ra,t.ErrorEvent=wt,t.EvaluationParameters=Ii,t.Event=xt,t.Evented=St,t.FeatureIndex=Iu,t.FillBucket=wo,t.FillExtrusionBucket=Fo,t.ImageAtlas=Rs,t.ImagePosition=Ds,t.LineBucket=$o,t.LngLat=gu,t.LngLatBounds=vu,t.MercatorCoordinate=wu,t.ONE_EM=Ru,t.OverscaledTileID=Ou,t.Point=r,t.Point$1=r,t.ProgramConfiguration=ta,t.Properties=Xi,t.Protobuf=qs,t.RGBAImage=Ba,t.RequestManager=F,t.ResourceType=ct,t.SegmentVector=zr,t.SourceFeatureState=Lu,t.StructArrayLayout1ui2=yr,t.StructArrayLayout2i4=er,t.StructArrayLayout2ui4=mr,t.StructArrayLayout3ui6=gr,t.StructArrayLayout4i8=nr,t.SymbolBucket=ks,t.Texture=Gs,t.Tile=Bu,t.Transitionable=Bi,t.Uniform1f=Ur,t.Uniform1i=Nr,t.Uniform2f=Vr,t.Uniform3f=Gr,t.Uniform4f=Wr,t.UniformColor=Hr,t.UniformMatrix4f=Zr,t.UnwrappedTileID=ku,t.ValidationError=Ot,t.WritingMode=Fu,t.ZoomHistory=_i,t.addDynamicAttributes=xs,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var i=t.length,r=new Array(t.length),a=null;t.forEach(function(t,o){e(t,function(t,e){t&&(a=t),r[o]=e,0==--i&&n(a,r)})})},t.bezier=s,t.bindAll=v,t.browser=j,t.clamp=l,t.clone=function(t){var e=new Sa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=_,t.config=L,t.create=function(){var t=new Sa(16);return Sa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=ka,t.create$2=function(){var t=new Sa(4);return Sa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=kn,t.createLayout=$i,t.createStyleLayer=function(t){return"custom"===t.type?new Ls(t):new Is[t.type](t)},t.deepEqual=o,t.ease=u,t.emitValidationErrors=ci,t.endsWith=g,t.evaluateRadialOffset=dl,t.evaluateSizeForFeature=vs,t.evaluateSizeForZoom=gs,t.evented=ji,t.extend=h,t.featureFilter=Fn,t.filterObject=y,t.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Xu,t.getAnchorJustification=vl,t.getArrayBuffer=gt,t.getImage=yt,t.getJSON=function(t,e){return vt(h(t,{type:"json"}),e)},t.getReferrer=dt,t.getVideo=function(t,e){var n,i,r=self.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(var a=0;a<t.length;a++){var o=self.document.createElement("source");n=t[a],i=void 0,(i=self.document.createElement("a")).href=n,(i.protocol!==self.document.location.protocol||i.host!==self.document.location.host)&&(r.crossOrigin="Anonymous"),o.src=t[a],r.appendChild(o)}return{cancel:function(){}}},t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.invert=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],A=e[12],d=e[13],v=e[14],g=e[15],m=n*s-i*o,y=n*u-r*o,_=n*l-a*o,b=i*u-r*s,x=i*l-a*s,w=r*l-a*u,S=c*d-h*A,k=c*v-f*A,O=c*g-p*A,P=h*v-f*d,E=h*g-p*d,C=f*g-p*v,T=m*C-y*E+_*P+b*O-x*k+w*S;return T?(T=1/T,t[0]=(s*C-u*E+l*P)*T,t[1]=(r*E-i*C-a*P)*T,t[2]=(d*w-v*x+g*b)*T,t[3]=(f*x-h*w-p*b)*T,t[4]=(u*O-o*C-l*k)*T,t[5]=(n*C-r*O+a*k)*T,t[6]=(v*_-A*w-g*y)*T,t[7]=(c*w-f*_+p*y)*T,t[8]=(o*E-s*O+l*S)*T,t[9]=(i*O-n*E-a*S)*T,t[10]=(A*x-d*_+g*m)*T,t[11]=(h*_-c*x-p*m)*T,t[12]=(s*k-o*P-u*S)*T,t[13]=(n*P-i*k+r*S)*T,t[14]=(d*y-A*b-v*m)*T,t[15]=(c*b-h*y+f*m)*T,t):null},t.isChar=bi,t.isMapboxURL=V,t.keysDifference=function(t,e){var n=[];for(var i in t)i in e||n.push(i);return n},t.makeRequest=vt,t.mapObject=m,t.mercatorXfromLng=yu,t.mercatorYfromLat=_u,t.mercatorZfromAltitude=bu,t.multiply=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],A=e[11],d=e[12],v=e[13],g=e[14],m=e[15],y=n[0],_=n[1],b=n[2],x=n[3];return t[0]=y*i+_*s+b*h+x*d,t[1]=y*r+_*u+b*f+x*v,t[2]=y*a+_*l+b*p+x*g,t[3]=y*o+_*c+b*A+x*m,y=n[4],_=n[5],b=n[6],x=n[7],t[4]=y*i+_*s+b*h+x*d,t[5]=y*r+_*u+b*f+x*v,t[6]=y*a+_*l+b*p+x*g,t[7]=y*o+_*c+b*A+x*m,y=n[8],_=n[9],b=n[10],x=n[11],t[8]=y*i+_*s+b*h+x*d,t[9]=y*r+_*u+b*f+x*v,t[10]=y*a+_*l+b*p+x*g,t[11]=y*o+_*c+b*A+x*m,y=n[12],_=n[13],b=n[14],x=n[15],t[12]=y*i+_*s+b*h+x*d,t[13]=y*r+_*u+b*f+x*v,t[14]=y*a+_*l+b*p+x*g,t[15]=y*o+_*c+b*A+x*m,t},t.mvt=zo,t.number=me,t.ortho=function(t,e,n,i,r,a,o){var s=1/(e-n),u=1/(i-r),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*u,t[14]=(o+a)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new qs(t).readFields(cu,[])},t.pbf=qs,t.performSymbolLayout=function(t,e,n,i,r,a){t.createArrays();var o=512*t.overscaling;t.tilePixelRatio=ra/o,t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.functionType){var c=t.textSizeData.zoomRange,h=c.min,f=c.max;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Ii(h)),u["text-size"].possiblyEvaluate(new Ii(f))]}if("composite"===t.iconSizeData.functionType){var p=t.iconSizeData.zoomRange,A=p.min,d=p.max;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Ii(A)),u["icon-size"].possiblyEvaluate(new Ii(d))]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new Ii(t.zoom+1)),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new Ii(t.zoom+1)),l.textMaxSize=u["text-size"].possiblyEvaluate(new Ii(18));for(var v=s.get("text-line-height")*Ru,g="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),m=s.get("text-keep-upright"),y=0,_=t.features;y<_.length;y+=1){var b=_[y],w=s.get("text-font").evaluate(b,{}).join(","),S=n,k={horizontal:{},vertical:void 0},O=b.text,P=[0,0];if(O){var E=O.toString(),C=s.get("text-letter-spacing").evaluate(b,{})*Ru,T=wi(E)?C:0,M=s.get("text-anchor").evaluate(b,{}),j=s.get("text-variable-anchor"),L=s.get("text-radial-offset").evaluate(b,{});j||(P=L?dl(M,L*Ru):s.get("text-offset").evaluate(b,{}).map(function(t){return t*Ru}));var I=g?"center":s.get("text-justify").evaluate(b,{}),z="point"===s.get("symbol-placement")?s.get("text-max-width").evaluate(b,{})*Ru:0;if(!g&&j)for(var D="auto"===I?j.map(function(t){return vl(t)}):[I],B=!1,R=0;R<D.length;R++){var F=D[R];if(!k.horizontal[F])if(B)k.horizontal[F]=k.horizontal[0];else{var N=Uu(O,e,w,z,v,"center",F,T,P,Fu.horizontal);N&&(k.horizontal[F]=N,B=1===N.lineCount)}}else{"auto"===I&&(I=vl(M));var U=Uu(O,e,w,z,v,M,I,T,P,Fu.horizontal);U&&(k.horizontal[I]=U),xi(E)&&g&&m&&(k.vertical=Uu(O,e,w,z,v,M,I,T,P,Fu.vertical))}}var V=void 0;if(b.icon){var G=i[b.icon];G&&(V=Yu(r[b.icon],s.get("icon-offset").evaluate(b,{}),s.get("icon-anchor").evaluate(b,{})),void 0===t.sdfIcons?t.sdfIcons=G.sdf:t.sdfIcons!==G.sdf&&x("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),G.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==s.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}(Object.keys(k.horizontal).length||V)&&gl(t,b,k,V,S,l,P)}a&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,i,r){var a,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(a=1/(i-r),t[10]=(r+i)*a,t[14]=2*r*i*a):(t[10]=-1,t[14]=-2*i),t},t.pick=function(t,e){for(var n={},i=0;i<e.length;i++){var r=e[i];r in t&&(n[r]=t[r])}return n},t.plugin=Li,t.polygonIntersectsPolygon=la,t.postMapLoadEvent=lt,t.postTurnstileEvent=st,t.potpack=zs,t.properties=Ps,t.rasterBoundsAttributes=Cu,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=vi,t.registerForPluginAvailability=function(t){return Ti?t({pluginURL:Ti,completionCallback:Ei}):ji.once("pluginAvailable",t),t},t.rotate=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=i*u+a*s,t[1]=r*u+o*s,t[2]=i*-s+a*u,t[3]=r*-s+o*u,t},t.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+l*i,t[5]=o*r+c*i,t[6]=s*r+h*i,t[7]=u*r+f*i,t[8]=l*r-a*i,t[9]=c*r-o*i,t[10]=h*r-s*i,t[11]=f*r-u*i,t},t.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+l*i,t[1]=o*r+c*i,t[2]=s*r+h*i,t[3]=u*r+f*i,t[4]=l*r-a*i,t[5]=c*r-o*i,t[6]=h*r-s*i,t[7]=f*r-u*i,t},t.scale=function(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.setRTLTextPlugin=function(t,e){if(Ci)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ci=!0,Ti=j.resolveURL(t),Ei=function(t){t?(Ci=!1,Ti=null,e&&e(t)):Mi=!0},ji.fire(new xt("pluginAvailable",{pluginURL:Ti,completionCallback:Ei}))},t.sphericalToCartesian=function(t){var e=t[0],n=t[1],i=t[2];return n+=90,n*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(i),y:e*Math.sin(n)*Math.sin(i),z:e*Math.cos(i)}},t.styleSpec=kt,t.symbolSize=ms,t.transformMat3=function(t,e,n){var i=e[0],r=e[1],a=e[2];return t[0]=i*n[0]+r*n[3]+a*n[6],t[1]=i*n[1]+r*n[4]+a*n[7],t[2]=i*n[2]+r*n[5]+a*n[8],t},t.transformMat4=Ea,t.translate=function(t,e,n){var i,r,a,o,s,u,l,c,h,f,p,A,d=n[0],v=n[1],g=n[2];return e===t?(t[12]=e[0]*d+e[4]*v+e[8]*g+e[12],t[13]=e[1]*d+e[5]*v+e[9]*g+e[13],t[14]=e[2]*d+e[6]*v+e[10]*g+e[14],t[15]=e[3]*d+e[7]*v+e[11]*g+e[15]):(i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],A=e[11],t[0]=i,t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=f,t[10]=p,t[11]=A,t[12]=i*d+s*v+h*g+e[12],t[13]=r*d+u*v+f*g+e[13],t[14]=a*d+l*v+p*g+e[14],t[15]=o*d+c*v+A*g+e[15]),t},t.uniqueId=p,t.validateCustomStyleLayer=function(t){var e=[],n=t.id;return void 0===n&&e.push({message:"layers."+n+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+n+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=si,t.validateStyle=oi,t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.vectorTile=zo,t.version="1.0.0",t.warnOnce=x,t.webpSupported=I,t.window=self,t.wrap=c}),i(0,function(t){function e(t){var n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var i="[",r=0,a=t;r<a.length;r+=1)i+=e(a[r])+",";return i+"]"}for(var o=Object.keys(t).sort(),s="{",u=0;u<o.length;u++)s+=JSON.stringify(o[u])+":"+e(t[o[u]])+",";return s+"}"}function n(n){for(var i="",r=0,a=t.refProperties;r<a.length;r+=1)i+="/"+e(n[a[r]]);return i}var i=function(t){t&&this.replace(t)};i.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},i.prototype.update=function(e,i){for(var r=this,a=0,o=e;a<o.length;a+=1){var s=o[a];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter)}for(var l=0,c=i;l<c.length;l+=1){var h=c[l];delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var f=0,p=function(t){for(var e={},i=0;i<t.length;i++){var r=n(t[i]),a=e[r];a||(a=e[r]=[]),a.push(t[i])}var o=[];for(var s in e)o.push(e[s]);return o}(t.values(this._layerConfigs));f<p.length;f+=1){var A=p[f].map(function(t){return r._layers[t.id]}),d=A[0];if("none"!==d.visibility){var v=d.source||"",g=this.familiesBySource[v];g||(g=this.familiesBySource[v]={});var m=d.sourceLayer||"_geojsonTileLayer",y=g[m];y||(y=g[m]=[]),y.push(A)}}};var r=function(e){var n={},i=[];for(var r in e){var a=e[r],o=n[r]={};for(var s in a){var u=a[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};i.push(l),o[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(i),h=c.w,f=c.h,p=new t.AlphaImage({width:h||1,height:f||1});for(var A in e){var d=e[A];for(var v in d){var g=d[+v];if(g&&0!==g.bitmap.width&&0!==g.bitmap.height){var m=n[A][v].rect;t.AlphaImage.copy(g.bitmap,p,{x:0,y:0},{x:m.x+1,y:m.y+1},g.bitmap)}}}this.image=p,this.positions=n};t.register("GlyphAtlas",r);var a=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies};function o(e,n){for(var i=new t.EvaluationParameters(n),r=0,a=e;r<a.length;r+=1)a[r].recalculate(i)}a.prototype.parse=function(e,n,i,a){var s=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var u=new t.DictionaryCoder(Object.keys(e.layers).sort()),l=new t.FeatureIndex(this.tileID);l.bucketLayerIDs=[];var c,h,f,p,A={},d={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{}},v=n.familiesBySource[this.source];for(var g in v){var m=e.layers[g];if(m){1===m.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+g+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var y=u.encode(g),_=[],b=0;b<m.length;b++){var x=m.feature(b);_.push({feature:x,index:b,sourceLayerIndex:y})}for(var w=0,S=v[g];w<S.length;w+=1){var k=S[w],O=k[0];O.minzoom&&this.zoom<Math.floor(O.minzoom)||O.maxzoom&&this.zoom>=O.maxzoom||"none"!==O.visibility&&(o(k,this.zoom),(A[O.id]=O.createBucket({index:l.bucketLayerIDs.length,layers:k,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:y,sourceID:this.source})).populate(_,d),l.bucketLayerIDs.push(k.map(function(t){return t.id})))}}}var P=t.mapObject(d.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(P).length?i.send("getGlyphs",{uid:this.uid,stacks:P},function(t,e){c||(c=t,h=e,T.call(s))}):h={};var E=Object.keys(d.iconDependencies);E.length?i.send("getImages",{icons:E},function(t,e){c||(c=t,f=e,T.call(s))}):f={};var C=Object.keys(d.patternDependencies);function T(){if(c)return a(c);if(h&&f&&p){var e=new r(h),n=new t.ImageAtlas(f,p);for(var i in A){var s=A[i];s instanceof t.SymbolBucket?(o(s.layers,this.zoom),t.performSymbolLayout(s,h,e.positions,f,n.iconPositions,this.showCollisionBoxes)):s.hasPattern&&(s instanceof t.LineBucket||s instanceof t.FillBucket||s instanceof t.FillExtrusionBucket)&&(o(s.layers,this.zoom),s.addFeatures(d,n.patternPositions))}this.status="done",a(null,{buckets:t.values(A).filter(function(t){return!t.isEmpty()}),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?h:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}C.length?i.send("getImages",{icons:C},function(t,e){c||(c=t,p=e,T.call(s))}):p={},T.call(this)};var s="undefined"!=typeof performance,u={getEntriesByName:function(t){return!!(s&&performance&&performance.getEntriesByName)&&performance.getEntriesByName(t)},mark:function(t){return!!(s&&performance&&performance.mark)&&performance.mark(t)},measure:function(t,e,n){return!!(s&&performance&&performance.measure)&&performance.measure(t,e,n)},clearMarks:function(t){return!!(s&&performance&&performance.clearMarks)&&performance.clearMarks(t)},clearMeasures:function(t){return!!(s&&performance&&performance.clearMeasures)&&performance.clearMeasures(t)}},l=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},u.mark(this._marks.start)};function c(e,n){var i=t.getArrayBuffer(e.request,function(e,i,r,a){e?n(e):i&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(i)),rawData:i,cacheControl:r,expires:a})});return function(){i.cancel(),n()}}l.prototype.finish=function(){u.mark(this._marks.end);var t=u.getEntriesByName(this._marks.measure);return 0===t.length&&(u.measure(this._marks.measure,this._marks.start,this._marks.end),t=u.getEntriesByName(this._marks.measure),u.clearMarks(this._marks.start),u.clearMarks(this._marks.end),u.clearMeasures(this._marks.measure)),t},u.Performance=l;var h=function(t,e,n){this.actor=t,this.layerIndex=e,this.loadVectorData=n||c,this.loading={},this.loaded={}};h.prototype.loadTile=function(e,n){var i=this,r=e.uid;this.loading||(this.loading={});var o=!!(e&&e.request&&e.request.collectResourceTiming)&&new u.Performance(e.request),s=this.loading[r]=new a(e);s.abort=this.loadVectorData(e,function(e,a){if(delete i.loading[r],e||!a)return s.status="done",i.loaded[r]=s,n(e);var u=a.rawData,l={};a.expires&&(l.expires=a.expires),a.cacheControl&&(l.cacheControl=a.cacheControl);var c={};if(o){var h=o.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,i.layerIndex,i.actor,function(e,i){if(e||!i)return n(e);n(null,t.extend({rawTileData:u.slice(0)},i,l,c))}),i.loaded=i.loaded||{},i.loaded[r]=s})},h.prototype.reloadTile=function(t,e){var n=this.loaded,i=t.uid,r=this;if(n&&n[i]){var a=n[i];a.showCollisionBoxes=t.showCollisionBoxes;var o=function(t,n){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,r.layerIndex,r.actor,i)),e(t,n)};"parsing"===a.status?a.reloadCallback=o:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.actor,o):o())}},h.prototype.abortTile=function(t,e){var n=this.loading,i=t.uid;n&&n[i]&&n[i].abort&&(n[i].abort(),delete n[i]),e()},h.prototype.removeTile=function(t,e){var n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()};var f=function(){this.loaded={}};f.prototype.loadTile=function(e,n){var i=e.uid,r=e.encoding,a=e.rawImageData,o=new t.DEMData(i,a,r);this.loaded=this.loaded||{},this.loaded[i]=o,n(null,o)},f.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var p={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function A(t){var e=0;if(t&&t.length>0){e+=Math.abs(d(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(d(t[n]))}return e}function d(t){var e,n,i,r,a,o,s=0,u=t.length;if(u>2){for(o=0;o<u;o++)o===u-2?(i=u-2,r=u-1,a=0):o===u-1?(i=u-1,r=0,a=1):(i=o,r=o+1,a=o+2),e=t[i],n=t[r],s+=(v(t[a][0])-v(e[0]))*Math.sin(v(n[1]));s=s*p.RADIUS*p.RADIUS/2}return s}function v(t){return t*Math.PI/180}var g={geometry:function t(e){var n,i=0;switch(e.type){case"Polygon":return A(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)i+=A(e.coordinates[n]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)i+=t(e.geometries[n]);return i}},ring:d};function m(t,e){return function(n){return t(n,e)}}function y(t,e){e=!!e,t[0]=_(t[0],e);for(var n=1;n<t.length;n++)t[n]=_(t[n],!e);return t}function _(t,e){return function(t){return g.ring(t)>=0}(t)===e?t:t.reverse()}var b=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,x=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};x.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],n=0,i=this._feature.geometry;n<i.length;n+=1){var r=i[n];e.push([new t.Point$1(r[0],r[1])])}return e}for(var a=[],o=0,s=this._feature.geometry;o<s.length;o+=1){for(var u=[],l=0,c=s[o];l<c.length;l+=1){var h=c[l];u.push(new t.Point$1(h[0],h[1]))}a.push(u)}return a},x.prototype.toGeoJSON=function(t,e,n){return b.call(this,t,e,n)};var w=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};w.prototype.feature=function(t){return new x(this._features[t])};var S=t.vectorTile.VectorTileFeature,k=O;function O(t,e){this.options=e||{},this.features=t,this.length=t.length}function P(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}O.prototype.feature=function(t){return new P(this.features[t],this.options.extent)},P.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var i=e[n],r=[],a=0;a<i.length;a++)r.push(new t.Point$1(i[a][0],i[a][1]));this.geometry.push(r)}return this.geometry},P.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,i=1/0,r=-1/0,a=0;a<t.length;a++)for(var o=t[a],s=0;s<o.length;s++){var u=o[s];e=Math.min(e,u.x),n=Math.max(n,u.x),i=Math.min(i,u.y),r=Math.max(r,u.y)}return[e,i,n,r]},P.prototype.toGeoJSON=S.prototype.toGeoJSON;var E=M,C=M,T=k;function M(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,j,t.layers[n])}(e,n),n.finish()}function j(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)i.feature=t.feature(n),e.writeMessage(2,L,i);var r=i.keys;for(n=0;n<r.length;n++)e.writeStringField(3,r[n]);var a=i.values;for(n=0;n<a.length;n++)e.writeMessage(4,R,a[n])}function L(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,I,t),e.writeVarintField(3,n.type),e.writeMessage(4,B,n)}function I(t,e){var n=t.feature,i=t.keys,r=t.values,a=t.keycache,o=t.valuecache;for(var s in n.properties){var u=a[s];void 0===u&&(i.push(s),u=i.length-1,a[s]=u),e.writeVarint(u);var l=n.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,f=o[h];void 0===f&&(r.push(l),f=r.length-1,o[h]=f),e.writeVarint(f)}}function z(t,e){return(e<<3)+(7&t)}function D(t){return t<<1^t>>31}function B(t,e){for(var n=t.loadGeometry(),i=t.type,r=0,a=0,o=n.length,s=0;s<o;s++){var u=n[s],l=1;1===i&&(l=u.length),e.writeVarint(z(1,l));for(var c=3===i?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==i&&e.writeVarint(z(2,c-1));var f=u[h].x-r,p=u[h].y-a;e.writeVarint(D(f)),e.writeVarint(D(p)),r+=f,a+=p}3===i&&e.writeVarint(z(7,1))}}function R(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function F(t,e,n,i){N(t,n,i),N(e,2*n,2*i),N(e,2*n+1,2*i+1)}function N(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function U(t,e,n,i){var r=t-n,a=e-i;return r*r+a*a}E.fromVectorTileJs=C,E.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var i in t)n[i]=new k(t[i].features,e),n[i].name=i,n[i].version=e.version,n[i].extent=e.extent;return M({layers:n})},E.GeoJSONWrapper=T;var V=function(t){return t[0]},G=function(t){return t[1]},W=function(t,e,n,i,r){void 0===e&&(e=V),void 0===n&&(n=G),void 0===i&&(i=64),void 0===r&&(r=Float64Array),this.nodeSize=i,this.points=t;for(var a=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(t.length),s=this.coords=new r(2*t.length),u=0;u<t.length;u++)o[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);!function t(e,n,i,r,a,o){if(!(a-r<=i)){var s=r+a>>1;!function t(e,n,i,r,a,o){for(;a>r;){if(a-r>600){var s=a-r+1,u=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,n,i,Math.max(r,Math.floor(i-u*c/s+h)),Math.min(a,Math.floor(i+(s-u)*c/s+h)),o)}var f=n[2*i+o],p=r,A=a;for(F(e,n,r,i),n[2*a+o]>f&&F(e,n,r,a);p<A;){for(F(e,n,p,A),p++,A--;n[2*p+o]<f;)p++;for(;n[2*A+o]>f;)A--}n[2*r+o]===f?F(e,n,r,A):F(e,n,++A,a),A<=i&&(r=A+1),i<=A&&(a=A-1)}}(e,n,s,r,a,o%2),t(e,n,i,r,s-1,o+1),t(e,n,i,s+1,a,o+1)}}(o,s,i,0,o.length-1,0)};W.prototype.range=function(t,e,n,i){return function(t,e,n,i,r,a,o){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),f=l.pop(),p=l.pop();if(f-p<=o)for(var A=p;A<=f;A++)s=e[2*A],u=e[2*A+1],s>=n&&s<=r&&u>=i&&u<=a&&c.push(t[A]);else{var d=Math.floor((p+f)/2);s=e[2*d],u=e[2*d+1],s>=n&&s<=r&&u>=i&&u<=a&&c.push(t[d]);var v=(h+1)%2;(0===h?n<=s:i<=u)&&(l.push(p),l.push(d-1),l.push(v)),(0===h?r>=s:a>=u)&&(l.push(d+1),l.push(f),l.push(v))}}return c}(this.ids,this.coords,t,e,n,i,this.nodeSize)},W.prototype.within=function(t,e,n){return function(t,e,n,i,r,a){for(var o=[0,t.length-1,0],s=[],u=r*r;o.length;){var l=o.pop(),c=o.pop(),h=o.pop();if(c-h<=a)for(var f=h;f<=c;f++)U(e[2*f],e[2*f+1],n,i)<=u&&s.push(t[f]);else{var p=Math.floor((h+c)/2),A=e[2*p],d=e[2*p+1];U(A,d,n,i)<=u&&s.push(t[p]);var v=(l+1)%2;(0===l?n-r<=A:i-r<=d)&&(o.push(h),o.push(p-1),o.push(v)),(0===l?n+r>=A:i+r>=d)&&(o.push(p+1),o.push(c),o.push(v))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var H={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:function(t){return t}},q=function(t){this.options=$(Object.create(H),t),this.trees=new Array(this.options.maxZoom+1)};function Z(t,e,n,i,r){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}function X(t,e){var n=t.geometry.coordinates,i=n[0],r=n[1];return{x:K(i),y:J(r),zoom:1/0,index:e,parentId:-1}}function Q(t){return{type:"Feature",id:t.id,properties:Y(t),geometry:{type:"Point",coordinates:[(i=t.x,360*(i-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,i}function Y(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return $($({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function K(t){return t/360+.5}function J(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function $(t,e){for(var n in e)t[n]=e[n];return t}function tt(t){return t.x}function et(t){return t.y}function nt(t,e,n,i,r,a){var o=r-n,s=a-i;if(0!==o||0!==s){var u=((t-n)*o+(e-i)*s)/(o*o+s*s);u>1?(n=r,i=a):u>0&&(n+=o*u,i+=s*u)}return(o=t-n)*o+(s=e-i)*s}function it(t,e,n,i){var r={id:void 0===t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)rt(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<e.length;i++)rt(t,e[i]);else if("MultiPolygon"===n)for(i=0;i<e.length;i++)for(var r=0;r<e[i].length;r++)rt(t,e[i][r])}(r),r}function rt(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function at(t,e,n,i){if(e.geometry){var r=e.geometry.coordinates,a=e.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=i||0),"Point"===a)ot(r,s);else if("MultiPoint"===a)for(var l=0;l<r.length;l++)ot(r[l],s);else if("LineString"===a)st(r,s,o,!1);else if("MultiLineString"===a){if(n.lineMetrics){for(l=0;l<r.length;l++)s=[],st(r[l],s,o,!1),t.push(it(u,"LineString",s,e.properties));return}ut(r,s,o,!1)}else if("Polygon"===a)ut(r,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(l=0;l<e.geometry.geometries.length;l++)at(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<r.length;l++){var c=[];ut(r[l],c,o,!0),s.push(c)}}t.push(it(u,a,s,e.properties))}}function ot(t,e){e.push(lt(t[0])),e.push(ct(t[1])),e.push(0)}function st(t,e,n,i){for(var r,a,o=0,s=0;s<t.length;s++){var u=lt(t[s][0]),l=ct(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(o+=i?(r*l-u*a)/2:Math.sqrt(Math.pow(u-r,2)+Math.pow(l-a,2))),r=u,a=l}var c=e.length-3;e[2]=1,function t(e,n,i,r){for(var a,o=r,s=i-n>>1,u=i-n,l=e[n],c=e[n+1],h=e[i],f=e[i+1],p=n+3;p<i;p+=3){var A=nt(e[p],e[p+1],l,c,h,f);if(A>o)a=p,o=A;else if(A===o){var d=Math.abs(p-s);d<u&&(a=p,u=d)}}o>r&&(a-n>3&&t(e,n,a,r),e[a+2]=o,i-a>3&&t(e,a,i,r))}(e,0,c,n),e[c+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function ut(t,e,n,i){for(var r=0;r<t.length;r++){var a=[];st(t[r],a,n,i),e.push(a)}}function lt(t){return t/360+.5}function ct(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function ht(t,e,n,i,r,a,o,s){if(i/=e,a>=(n/=e)&&o<i)return t;if(o<n||a>=i)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,f=c.type,p=0===r?c.minX:c.minY,A=0===r?c.maxX:c.maxY;if(p>=n&&A<i)u.push(c);else if(!(A<n||p>=i)){var d=[];if("Point"===f||"MultiPoint"===f)ft(h,d,n,i,r);else if("LineString"===f)pt(h,d,n,i,r,!1,s.lineMetrics);else if("MultiLineString"===f)dt(h,d,n,i,r,!1);else if("Polygon"===f)dt(h,d,n,i,r,!0);else if("MultiPolygon"===f)for(var v=0;v<h.length;v++){var g=[];dt(h[v],g,n,i,r,!0),g.length&&d.push(g)}if(d.length){if(s.lineMetrics&&"LineString"===f){for(v=0;v<d.length;v++)u.push(it(c.id,f,d[v],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===d.length?(f="LineString",d=d[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===d.length?"Point":"MultiPoint"),u.push(it(c.id,f,d,c.tags))}}}return u.length?u:null}function ft(t,e,n,i,r){for(var a=0;a<t.length;a+=3){var o=t[a+r];o>=n&&o<=i&&(e.push(t[a]),e.push(t[a+1]),e.push(t[a+2]))}}function pt(t,e,n,i,r,a,o){for(var s,u,l=At(t),c=0===r?gt:mt,h=t.start,f=0;f<t.length-3;f+=3){var p=t[f],A=t[f+1],d=t[f+2],v=t[f+3],g=t[f+4],m=0===r?p:A,y=0===r?v:g,_=!1;o&&(s=Math.sqrt(Math.pow(p-v,2)+Math.pow(A-g,2))),m<n?y>n&&(u=c(l,p,A,v,g,n),o&&(l.start=h+s*u)):m>i?y<i&&(u=c(l,p,A,v,g,i),o&&(l.start=h+s*u)):vt(l,p,A,d),y<n&&m>=n&&(u=c(l,p,A,v,g,n),_=!0),y>i&&m<=i&&(u=c(l,p,A,v,g,i),_=!0),!a&&_&&(o&&(l.end=h+s*u),e.push(l),l=At(t)),o&&(h+=s)}var b=t.length-3;p=t[b],A=t[b+1],d=t[b+2],(m=0===r?p:A)>=n&&m<=i&&vt(l,p,A,d),b=l.length-3,a&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&vt(l,l[0],l[1],l[2]),l.length&&e.push(l)}function At(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function dt(t,e,n,i,r,a){for(var o=0;o<t.length;o++)pt(t[o],e,n,i,r,a,!1)}function vt(t,e,n,i){t.push(e),t.push(n),t.push(i)}function gt(t,e,n,i,r,a){var o=(a-e)/(i-e);return t.push(a),t.push(n+(r-n)*o),t.push(1),o}function mt(t,e,n,i,r,a){var o=(a-n)/(r-n);return t.push(e+(i-e)*o),t.push(a),t.push(1),o}function yt(t,e){for(var n=[],i=0;i<t.length;i++){var r,a=t[i],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)r=_t(a.geometry,e);else if("MultiLineString"===o||"Polygon"===o){r=[];for(var s=0;s<a.geometry.length;s++)r.push(_t(a.geometry[s],e))}else if("MultiPolygon"===o)for(r=[],s=0;s<a.geometry.length;s++){for(var u=[],l=0;l<a.geometry[s].length;l++)u.push(_t(a.geometry[s][l],e));r.push(u)}n.push(it(a.id,o,r,a.tags))}return n}function _t(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var i=0;i<t.length;i+=3)n.push(t[i]+e,t[i+1],t[i+2]);return n}function bt(t,e){if(t.transformed)return t;var n,i,r,a=1<<t.z,o=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(i=0;i<l.length;i+=2)u.geometry.push(xt(l[i],l[i+1],e,a,o,s));else for(i=0;i<l.length;i++){var h=[];for(r=0;r<l[i].length;r+=2)h.push(xt(l[i][r],l[i][r+1],e,a,o,s));u.geometry.push(h)}}return t.transformed=!0,t}function xt(t,e,n,i,r,a){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-a))]}function wt(t,e,n,i,r){for(var a=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){o.numFeatures++,St(o,t[s],a,r);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<o.minX&&(o.minX=u),l<o.minY&&(o.minY=l),c>o.maxX&&(o.maxX=c),h>o.maxY&&(o.maxY=h)}return o}function St(t,e,n,i){var r=e.geometry,a=e.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<r.length;s+=3)o.push(r[s]),o.push(r[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===a)kt(o,r,t,n,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<r.length;s++)kt(o,r[s],t,n,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var u=0;u<r.length;u++){var l=r[u];for(s=0;s<l.length;s++)kt(o,l[s],t,n,!0,0===s)}if(o.length){var c=e.tags||null;if("LineString"===a&&i.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=r.start/r.size,c.mapbox_clip_end=r.end/r.size}var f={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:c};null!==e.id&&(f.id=e.id),t.features.push(f)}}function kt(t,e,n,i,r,a){var o=i*i;if(i>0&&e.size<(r?o:i))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===i||e[u+2]>o)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;r&&function(t,e){for(var n=0,i=0,r=t.length,a=r-2;i<r;a=i,i+=2)n+=(t[i]-t[a])*(t[i+1]+t[a+1]);if(n>0===e)for(i=0,r=t.length;i<r/2;i+=2){var o=t[i],s=t[i+1];t[i]=t[r-2-i],t[i+1]=t[r-1-i],t[r-2-i]=o,t[r-1-i]=s}}(s,a),t.push(s)}}function Ot(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)at(n,t.features[i],e,i);else"Feature"===t.type?at(n,t,e):at(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(t,e){var n=e.buffer/e.extent,i=t,r=ht(t,1,-1-n,n,0,-1,2,e),a=ht(t,1,1-n,2+n,0,-1,2,e);return(r||a)&&(i=ht(t,1,-n,1+n,0,-1,2,e)||[],r&&(i=yt(r,1).concat(i)),a&&(i=i.concat(yt(a,-1)))),i}(i,e)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pt(t,e,n){return 32*((1<<t)*n+e)+t}function Et(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return e(null,null);var r=new w(i.features),a=E(r);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),e(null,{vectorTile:r,rawData:a.buffer})}q.prototype.load=function(t){var e=this.options,n=e.log,i=e.minZoom,r=e.maxZoom,a=e.nodeSize;n&&console.time("total time");var o="prepare "+t.length+" points";n&&console.time(o),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(X(t[u],u));this.trees[r+1]=new W(s,tt,et,a,Float32Array),n&&console.timeEnd(o);for(var l=r;l>=i;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new W(s,tt,et,a,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return n&&console.timeEnd("total time"),this},q.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),r=180===t[2]?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){var o=this.getClusters([n,i,180,a],e),s=this.getClusters([-180,i,r,a],e);return o.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(K(n),J(a),K(r),J(i));c<h.length;c+=1){var f=h[c],p=u.points[f];l.push(p.numPoints?Q(p):this.points[p.index])}return l},q.prototype.getChildren=function(t){var e=t>>5,n=t%32,i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);var a=r.points[e];if(!a)throw new Error(i);for(var o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=r.within(a.x,a.y,o);u<l.length;u+=1){var c=l[u],h=r.points[c];h.parentId===t&&s.push(h.numPoints?Q(h):this.points[h.index])}if(0===s.length)throw new Error(i);return s},q.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var i=[];return this._appendLeaves(i,t,e,n,0),i},q.prototype.getTile=function(t,e,n){var i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),a=this.options,o=a.extent,s=a.radius/o,u=(n-s)/r,l=(n+1+s)/r,c={features:[]};return this._addTileFeatures(i.range((e-s)/r,u,(e+1+s)/r,l),i.points,e,n,r,c),0===e&&this._addTileFeatures(i.range(1-s/r,u,1,l),i.points,r,n,r,c),e===r-1&&this._addTileFeatures(i.range(0,u,s/r,l),i.points,-1,n,r,c),c.features.length?c:null},q.prototype.getClusterExpansionZoom=function(t){for(var e=t%32-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},q.prototype._appendLeaves=function(t,e,n,i,r){for(var a=0,o=this.getChildren(e);a<o.length;a+=1){var s=o[a],u=s.properties;if(u&&u.cluster?r+u.point_count<=i?r+=u.point_count:r=this._appendLeaves(t,u.cluster_id,n,i,r):r<i?r++:t.push(s),t.length===n)break}return r},q.prototype._addTileFeatures=function(t,e,n,i,r,a){for(var o=0,s=t;o<s.length;o+=1){var u=e[s[o]],l={type:1,geometry:[[Math.round(this.options.extent*(u.x*r-n)),Math.round(this.options.extent*(u.y*r-i))]],tags:u.numPoints?Y(u):this.points[u.index].properties},c=u.numPoints?u.id:this.points[u.index].id;void 0!==c&&(l.id=c),a.features.push(l)}},q.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},q.prototype._cluster=function(t,e){for(var n=[],i=this.options,r=i.radius,a=i.extent,o=i.reduce,s=r/(a*Math.pow(2,e)),u=0;u<t.length;u++){var l=t[u];if(!(l.zoom<=e)){l.zoom=e;for(var c=this.trees[e+1],h=c.within(l.x,l.y,s),f=l.numPoints||1,p=l.x*f,A=l.y*f,d=o?this._map(l,!0):null,v=(u<<5)+(e+1),g=0,m=h;g<m.length;g+=1){var y=m[g],_=c.points[y];if(!(_.zoom<=e)){_.zoom=e;var b=_.numPoints||1;p+=_.x*b,A+=_.y*b,f+=b,_.parentId=v,o&&o(d,this._map(_))}}1===f?n.push(l):(l.parentId=v,n.push(Z(p/f,A/f,v,f,d)))}}return n},q.prototype._map=function(t,e){if(t.numPoints)return e?$({},t.properties):t.properties;var n=this.points[t.index].properties,i=this.options.map(n);return e&&i===n?$({},i):i},Ot.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ot.prototype.splitTile=function(t,e,n,i,r,a,o){for(var s=[t,e,n,i],u=this.options,l=u.debug;s.length;){i=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=Pt(e,n,i),f=this.tiles[h];if(!f&&(l>1&&console.time("creation"),f=this.tiles[h]=wt(t,e,n,i,u),this.tileCoords.push({z:e,x:n,y:i}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=t,r){if(e===u.maxZoom||e===r)continue;var A=1<<r-e;if(n!==Math.floor(a/A)||i!==Math.floor(o/A))continue}else if(e===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==t.length){l>1&&console.time("clipping");var d,v,g,m,y,_,b=.5*u.buffer/u.extent,x=.5-b,w=.5+b,S=1+b;d=v=g=m=null,y=ht(t,c,n-b,n+w,0,f.minX,f.maxX,u),_=ht(t,c,n+x,n+S,0,f.minX,f.maxX,u),t=null,y&&(d=ht(y,c,i-b,i+w,1,f.minY,f.maxY,u),v=ht(y,c,i+x,i+S,1,f.minY,f.maxY,u),y=null),_&&(g=ht(_,c,i-b,i+w,1,f.minY,f.maxY,u),m=ht(_,c,i+x,i+S,1,f.minY,f.maxY,u),_=null),l>1&&console.timeEnd("clipping"),s.push(d||[],e+1,2*n,2*i),s.push(v||[],e+1,2*n,2*i+1),s.push(g||[],e+1,2*n+1,2*i),s.push(m||[],e+1,2*n+1,2*i+1)}}},Ot.prototype.getTile=function(t,e,n){var i=this.options,r=i.extent,a=i.debug;if(t<0||t>24)return null;var o=1<<t,s=Pt(t,e=(e%o+o)%o,n);if(this.tiles[s])return bt(this.tiles[s],r);a>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,l=t,c=e,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[Pt(l,c,h)];return u&&u.source?(a>1&&console.log("found parent tile z%d-%d-%d",l,c,h),a>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,n),a>1&&console.timeEnd("drilling down"),this.tiles[s]?bt(this.tiles[s],r):null):null};var Ct=function(e){function n(t,n,i){e.call(this,t,n,Et),i&&(this.loadGeoJSON=i)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var r=!!(i&&i.request&&i.request.collectResourceTiming)&&new u.Performance(i.request);this.loadGeoJSON(i,function(a,o){if(a||!o)return n(a);if("object"!=typeof o)return n(new Error("Input data is not a valid GeoJSON object."));!function t(e,n){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(m(t,n)),e;case"GeometryCollection":return e.geometries=e.geometries.map(m(t,n)),e;case"Feature":return e.geometry=t(e.geometry,n),e;case"Polygon":case"MultiPolygon":return function(t,e){return"Polygon"===t.type?t.coordinates=y(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(m(y,e))),t}(e,n);default:return e}}(o,!0);try{e._geoJSONIndex=i.cluster?new q(function(e){var n=e.superclusterOptions,i=e.clusterProperties;if(!i||!n)return n;for(var r={},a={},o={accumulated:null,zoom:0},s={properties:null},u=Object.keys(i),l=0,c=u;l<c.length;l+=1){var h=c[l],f=i[h],p=f[0],A=f[1],d=t.createExpression(A),v=t.createExpression("string"==typeof p?[p,["accumulated"],["get",h]]:p);r[h]=d.value,a[h]=v.value}return n.map=function(t){s.properties=t;for(var e={},n=0,i=u;n<i.length;n+=1){var a=i[n];e[a]=r[a].evaluate(o,s)}return e},n.reduce=function(t,e){s.properties=e;for(var n=0,i=u;n<i.length;n+=1){var r=i[n];o.accumulated=t[r],t[r]=a[r].evaluate(o,s)}},n}(i)).load(o.features):new Ot(o,i.geojsonVtOptions)}catch(a){return n(a)}e.loaded={};var s={};if(r){var u=r.finish();u&&(s.resourceTiming={},s.resourceTiming[i.source]=JSON.parse(JSON.stringify(u)))}n(null,s)})}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(t,n){var i=this.loaded,r=t.uid;return i&&i[r]?e.prototype.reloadTile.call(this,t,n):this.loadTile(t,n)},n.prototype.loadGeoJSON=function(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error("Input data is not a valid GeoJSON object."));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error("Input data is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},n.prototype.getClusterExpansionZoom=function(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))},n.prototype.getClusterChildren=function(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId))},n.prototype.getClusterLeaves=function(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))},n}(h),Tt=function(e){var n=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.workerSourceTypes={vector:h,geojson:Ct},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isLoaded())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return Tt.prototype.setReferrer=function(t,e){this.referrer=e},Tt.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},Tt.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},Tt.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},Tt.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},Tt.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},Tt.prototype.abortTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},Tt.prototype.removeTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},Tt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},Tt.prototype.removeSource=function(t,e,n){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,n):n()}},Tt.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}},Tt.prototype.loadRTLTextPlugin=function(e,n,i){try{t.plugin.isLoaded()||(this.self.importScripts(n),i(t.plugin.isLoaded()?null:new Error("RTL Text Plugin failed to import scripts from "+n)))}catch(t){i(t.toString())}},Tt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e},Tt.prototype.getWorkerSource=function(t,e,n){var i=this;if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][n]){var r={send:function(e,n,r){i.actor.send(e,n,r,t)}};this.workerSources[t][e][n]=new this.workerSourceTypes[e](r,this.getLayerIndex(t))}return this.workerSources[t][e][n]},Tt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new f),this.demWorkerSources[t][e]},"undefined"!=typeof WorkerGlobalScope&&void 0!==t.window&&t.window instanceof WorkerGlobalScope&&(t.window.worker=new Tt(t.window)),Tt}),i(0,function(t){var e=t.createCommonjsModule(function(t){function e(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{e=new Worker(i),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&function(t){return void 0===n[t]&&(n[t]=function(t){var n=document.createElement("canvas"),i=Object.create(e.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,n.probablySupportsContext?n.probablySupportsContext("webgl",i)||n.probablySupportsContext("experimental-webgl",i):n.supportsContext?n.supportsContext("webgl",i)||n.supportsContext("experimental-webgl",i):n.getContext("webgl",i)||n.getContext("experimental-webgl",i)}(t)),n[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e);var n={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),n={create:function(e,n,i){var r=t.window.document.createElement(e);return n&&(r.className=n),i&&i.appendChild(r),r},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},i=t.window.document?t.window.document.documentElement.style:null;function r(t){if(!i)return null;for(var e=0;e<t.length;e++)if(t[e]in i)return t[e];return t[0]}var a,o=r(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){i&&o&&(a=i[o],i[o]="none")},n.enableDrag=function(){i&&o&&(i[o]=a)};var s=r(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){u=!1}n.addEventListener=function(t,e,n,i){void 0===i&&(i={}),"passive"in i&&u?t.addEventListener(e,n,i):t.addEventListener(e,n,i.capture)},n.removeEventListener=function(t,e,n,i){void 0===i&&(i={}),"passive"in i&&u?t.removeEventListener(e,n,i):t.removeEventListener(e,n,i.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}n.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout(function(){t.window.removeEventListener("click",c,!0)},0)},n.mousePos=function(e,n){var i=e.getBoundingClientRect();return n=n.touches?n.touches[0]:n,new t.Point(n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop)},n.touchPos=function(e,n){for(var i=e.getBoundingClientRect(),r=[],a="touchend"===n.type?n.changedTouches:n.touches,o=0;o<a.length;o++)r.push(new t.Point(a[o].clientX-i.left-e.clientLeft,a[o].clientY-i.top-e.clientTop));return r},n.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var f=function(e){function n(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var i=n[e],r=i.ids,a=i.callback;this._notify(r,a)}this.requestors=[]}},n.prototype.getImage=function(t){return this.images[t]},n.prototype.addImage=function(t,e){this.images[t]=e},n.prototype.updateImage=function(t,e){var n=this.images[t];e.version=n.version+1,this.images[t]=e,this.updatedImages[t]=!0},n.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var i=0,r=t;i<r.length;i+=1){var a=r[i];this.images[a]||(n=!1)}this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},n.prototype._notify=function(e,n){for(var i={},r=0,a=e;r<a.length;r+=1){var o=a[r];this.images[o]||this.fire(new t.Event("styleimagemissing",{id:o}));var s=this.images[o];s?i[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+o+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,i)},n.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},n.prototype.getPattern=function(e){var n=this.patterns[e],i=this.getImage(e);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{var r={w:i.data.width+2,h:i.data.height+2,x:0,y:0},a=new t.ImagePosition(r,i);this.patterns[e]={bin:r,position:a}}return this._updatePatternAtlas(),this.patterns[e].position},n.prototype.bind=function(e){var n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var e=[];for(var n in this.patterns)e.push(this.patterns[n].bin);var i=t.potpack(e),r=i.w,a=i.h,o=this.atlasImage;for(var s in o.resize({width:r||1,height:a||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,f=h.width,p=h.height;t.RGBAImage.copy(h,o,{x:0,y:0},{x:l,y:c},{width:f,height:p}),t.RGBAImage.copy(h,o,{x:0,y:p-1},{x:l,y:c-1},{width:f,height:1}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:l,y:c+p},{width:f,height:1}),t.RGBAImage.copy(h,o,{x:f-1,y:0},{x:l-1,y:c},{width:1,height:p}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:l+f,y:c},{width:1,height:p})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(t){for(var e=0,n=t;e<n.length;e+=1){var i=n[e];if(!this.callbackDispatchedThisFrame[i]){this.callbackDispatchedThisFrame[i]=!0;var r=this.images[i];h(r)&&this.updateImage(i,r)}}},n}(t.Evented),p=d,A=1e20;function d(t,e,n,i,r,a){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=a||"normal",this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function v(t,e,n,i,r,a,o){for(var s=0;s<e;s++){for(var u=0;u<n;u++)i[u]=t[u*e+s];for(g(i,r,a,o,n),u=0;u<n;u++)t[u*e+s]=r[u]}for(u=0;u<n;u++){for(s=0;s<e;s++)i[s]=t[u*e+s];for(g(i,r,a,o,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(r[s])}}function g(t,e,n,i,r){n[0]=0,i[0]=-A,i[1]=+A;for(var a=1,o=0;a<r;a++){for(var s=(t[a]+a*a-(t[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);s<=i[o];)o--,s=(t[a]+a*a-(t[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);n[++o]=a,i[o]=s,i[o+1]=+A}for(a=0,o=0;a<r;a++){for(;i[o+1]<a;)o++;e[a]=(a-n[o])*(a-n[o])+t[n[o]]}}d.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),i=0;i<this.size*this.size;i++){var r=e.data[4*i+3]/255;this.gridOuter[i]=1===r?0:0===r?A:Math.pow(Math.max(0,.5-r),2),this.gridInner[i]=1===r?A:0===r?0:Math.pow(Math.max(0,r-.5),2)}for(v(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),v(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),i=0;i<this.size*this.size;i++){var a=this.gridOuter[i]-this.gridInner[i];n[i]=Math.max(0,Math.min(255,Math.round(255-255*(a/this.radius+this.cutoff))))}return n};var m=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};m.prototype.setURL=function(t){this.url=t},m.prototype.getGlyphs=function(e,n){var i=this,r=[];for(var a in e)for(var o=0,s=e[a];o<s.length;o+=1){var u=s[o];r.push({stack:a,id:u})}t.asyncAll(r,function(t,e){var n=t.stack,r=t.id,a=i.entries[n];a||(a=i.entries[n]={glyphs:{},requests:{}});var o=a.glyphs[r];if(void 0===o)if(o=i._tinySDF(a,n,r))e(null,{stack:n,id:r,glyph:o});else{var s=Math.floor(r/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var u=a.requests[s];u||(u=a.requests[s]=[],m.loadGlyphRange(n,s,i.url,i.requestManager,function(t,e){if(e)for(var n in e)a.glyphs[+n]=e[+n];for(var i=0,r=u;i<r.length;i+=1)(0,r[i])(t,e);delete a.requests[s]})),u.push(function(t,i){t?e(t):i&&e(null,{stack:n,id:r,glyph:i[r]||null})})}}else e(null,{stack:n,id:r,glyph:o})},function(t,e){if(t)n(t);else if(e){for(var i={},r=0,a=e;r<a.length;r+=1){var o=a[r],s=o.stack,u=o.id,l=o.glyph;(i[s]||(i[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}n(null,i)}})},m.prototype._tinySDF=function(e,n,i){var r=this.localIdeographFontFamily;if(r&&(t.isChar["CJK Unified Ideographs"](i)||t.isChar["Hangul Syllables"](i))){var a=e.tinySDF;if(!a){var o="400";/bold/i.test(n)?o="900":/medium/i.test(n)?o="500":/light/i.test(n)&&(o="200"),a=e.tinySDF=new m.TinySDF(24,3,8,.25,r,o)}return{id:i,bitmap:new t.AlphaImage({width:30,height:30},a.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},m.loadGlyphRange=function(e,n,i,r,a){var o=256*n,s=o+255,u=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",o+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,function(e,n){if(e)a(e);else if(n){for(var i={},r=0,o=t.parseGlyphPBF(n);r<o.length;r+=1){var s=o[r];i[s.id]=s}a(null,i)}})},m.TinySDF=p;var y=function(){this.specification=t.styleSpec.light.position};y.prototype.possiblyEvaluate=function(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))},y.prototype.interpolate=function(e,n,i){return{x:t.number(e.x,n.x,i),y:t.number(e.y,n.y,i),z:t.number(e.z,n.z,i)}};var _=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new y,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),b=function(e){function n(n){e.call(this),this._transitionable=new t.Transitionable(_),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(e,n){if(void 0===n&&(n={}),!this._validate(t.validateLight,e,n))for(var i in e){var r=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-"-transition".length),r):this._transitionable.setValue(i,r)}},n.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},n.prototype._validate=function(e,n,i){return(!i||!1!==i.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},n}(t.Evented),x=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};x.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.positions[n]||(this.positions[n]=this.addDash(t,e)),this.positions[n]},x.prototype.addDash=function(e,n){var i=n?7:0,r=2*i+1;if(this.nextRow+r>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var a=0,o=0;o<e.length;o++)a+=e[o];for(var s=this.width/a,u=s/2,l=e.length%2==1,c=-i;c<=i;c++)for(var h=this.nextRow+i+c,f=this.width*h,p=l?-e[e.length-1]:0,A=e[0],d=1,v=0;v<this.width;v++){for(;A<v/s;)p=A,A+=e[d],l&&d===e.length-1&&(A+=e[0]),d++;var g=Math.abs(v-p*s),m=Math.abs(v-A*s),y=Math.min(g,m),_=d%2==1,b=void 0;if(n){var x=i?c/i*(u+1):0;if(_){var w=u-Math.abs(x);b=Math.sqrt(y*y+w*w)}else b=u-Math.sqrt(y*y+x*x)}else b=(_?1:-1)*y;this.data[3+4*(f+v)]=Math.max(0,Math.min(255,b+128))}var S={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:a};return this.nextRow+=r,this.dirty=!0,S},x.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))};var w=function e(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var r=this.workerPool.acquire(this.id),a=0;a<r.length;a++){var o=r[a],s=new e.Actor(o,i,this.id);s.name="Worker "+a,this.actors.push(s)}};function S(e,n,i){var r=function(r,a){if(r)return i(r);if(a){var o=t.pick(a,["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds"]);a.vector_layers&&(o.vectorLayers=a.vector_layers,o.vectorLayerIds=o.vectorLayers.map(function(t){return t.id})),e.url&&(o.tiles=n.canonicalizeTileset(o,e.url)),i(null,o)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),r):t.browser.frame(function(){return r(null,e)})}w.prototype.broadcast=function(e,n,i){i=i||function(){},t.asyncAll(this.actors,function(t,i){t.send(e,n,i)},i)},w.prototype.send=function(t,e,n,i){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[i].send(t,e,n),i},w.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},w.Actor=t.Actor;var k=function(e,n,i){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=i||24};k.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},k.prototype.contains=function(e){var n=Math.pow(2,e.z),i=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),r=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),a=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),o=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=i&&e.x<a&&e.y>=r&&e.y<o};var O=function(e){function n(n,i,r,a){if(e.call(this),this.id=n,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,t.extend(this,t.pick(i,["url","scheme","tileSize"])),this._options=t.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=S(this._options,this.map._requestManager,function(n,i){e._tileJSONRequest=null,n?e.fire(new t.ErrorEvent(n)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new k(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.loadTile=function(e,n){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,null),r={request:this.map._requestManager.transformRequest(i,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function a(t,i){return e.aborted?n(null):t&&404!==t.status?n(t):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,void 0===e.workerID||"expired"===e.state?e.workerID=this.dispatcher.send("loadTile",r,a.bind(this)):"loading"===e.state?e.reloadCallback=n:this.dispatcher.send("reloadTile",r,a.bind(this),e.workerID)},n.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},n.prototype.hasTransition=function(){return!1},n}(t.Evented),P=function(e){function n(n,i,r,a){e.call(this),this.id=n,this.dispatcher=r,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({},i),t.extend(this,t.pick(i,["url","scheme","tileSize"]))}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=S(this._options,this.map._requestManager,function(n,i){e._tileJSONRequest=null,n?e.fire(new t.ErrorEvent(n)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new k(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.loadTile=function(e,n){var i=this,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),function(r,a){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(a){i.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=i.map.painter.context,s=o.gl;e.texture=i.map.painter.getTileTexture(a.width),e.texture?e.texture.update(a,{useMipmap:!0}):(e.texture=new t.Texture(o,a,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),e.state="loaded",n(null)}})},n.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},n.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},n.prototype.hasTransition=function(){return!1},n}(t.Evented),E=function(e){function n(n,i,r,a){e.call(this,n,i,r,a),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({},i),this.encoding=i.encoding||"mapbox"}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(e,n){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),function(i,r){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(r){this.map._refreshExpiredTiles&&e.setExpiryData(r),delete r.cacheControl,delete r.expires;var a=t.browser.getImageData(r),o={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.workerID&&"expired"!==e.state||(e.workerID=this.dispatcher.send("loadDEMTile",o,function(t,i){t&&(e.state="errored",n(t)),i&&(e.dem=i,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},n.prototype._getNeighboringTiles=function(e){var n=e.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,a=0===n.x?e.wrap-1:e.wrap,o=(n.x+1+i)%i,s=n.x+1===i?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,a,n.z,r,n.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,a,n.z,r,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<i&&(u[new t.OverscaledTileID(e.overscaledZ,a,n.z,r,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,o,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",this.dispatcher.send("removeDEMTile",{uid:t.uid,source:this.id},void 0,t.workerID)},n}(P),C=function(e){function n(n,i,r,a){e.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=r,this.setEventedParent(a),this._data=i.data,this._options=t.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution);var o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:t.EXTENT,radius:(i.clusterRadius||50)*o,log:!1},clusterProperties:i.clusterProperties},i.workerOptions)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(n){if(n)e.fire(new t.ErrorEvent(n));else{var i={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(i.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",i))}})},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setData=function(e){var n=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(e){if(e)n.fire(new t.ErrorEvent(e));else{var i={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(i.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new t.Event("data",i))}}),this},n.prototype.getClusterExpansionZoom=function(t,e){return this.dispatcher.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e,this.workerID),this},n.prototype.getClusterChildren=function(t,e){return this.dispatcher.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e,this.workerID),this},n.prototype.getClusterLeaves=function(t,e,n,i){return this.dispatcher.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},i,this.workerID),this},n.prototype._updateWorkerData=function(e){var n=this,i=t.extend({},this.workerOptions),r=this._data;"string"==typeof r?(i.request=this.map._requestManager.transformRequest(t.browser.resolveURL(r),t.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this.workerID=this.dispatcher.send(this.type+".loadData",i,function(t,r){n._removed||r&&r.abandoned||(n._loaded=!0,r&&r.resourceTiming&&r.resourceTiming[n.id]&&(n._resourceTiming=r.resourceTiming[n.id].slice(0)),n.dispatcher.send(n.type+".coalesce",{source:i.source},null,n.workerID),e(t))},this.workerID)},n.prototype.loadTile=function(e,n){var i=this,r=void 0===e.workerID?"loadTile":"reloadTile",a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};e.workerID=this.dispatcher.send(r,a,function(t,a){return e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(a,i.map.painter,"reloadTile"===r),n(null))},this.workerID)},n.prototype.abortTile=function(t){t.aborted=!0},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},n.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID)},n.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(t.Evented),T=function(e){function n(t,n,i,r){e.call(this),this.id=t,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(r),this.options=n}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(e,n){var i=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),function(r,a){r?i.fire(new t.ErrorEvent(r)):a&&(i.image=a,e&&(i.coordinates=e),n&&n(),i._finishLoading())})},n.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,function(){e.texture=null}),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setCoordinates=function(e){var n=this;this.coordinates=e;var i=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var n=1/0,i=1/0,r=-1/0,a=-1/0,o=0,s=e;o<s.length;o+=1){var u=s[o];n=Math.min(n,u.x),i=Math.min(i,u.y),r=Math.max(r,u.x),a=Math.max(a,u.y)}var l=r-n,c=a-i,h=Math.max(l,c),f=Math.max(0,Math.floor(-Math.log(h)/Math.LN2)),p=Math.pow(2,f);return new t.CanonicalTileID(f,Math.floor((n+r)/2*p),Math.floor((i+a)/2*p))}(i),this.minzoom=this.maxzoom=this.tileID.z;var r=i.map(function(t){return n.tileID.getTilePoint(t)._round()});return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(r[2].x,r[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,n=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[i];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},n.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(t.Evented),M=function(e){function n(t,n,i,r){e.call(this,t,n,i,r),this.roundZoom=!0,this.type="video",this.options=n}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this,n=this.options;this.urls=[];for(var i=0,r=n.urls;i<r.length;i+=1){var a=r[i];this.urls.push(this.map._requestManager.transformRequest(a,t.ResourceType.Source).url)}t.getVideo(this.urls,function(n,i){n?e.fire(new t.ErrorEvent(n)):i&&(e.video=i,e.video.loop=!0,e.video.addEventListener("playing",function(){e.map.triggerRepaint()}),e.map&&e.video.play(),e._finishLoading())})},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,n=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[i];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(T),j=function(e){function n(n,i,r,a){e.call(this,n,i,r,a),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(function(t){return!Array.isArray(t)||2!==t.length||t.some(function(t){return"number"!=typeof t})})||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,i=n.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,i.RGBA,{premultiply:!0}),this.tiles){var a=this.tiles[r];"loaded"!==a.state&&(a.state="loaded",a.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},n}(T),L={vector:O,raster:P,"raster-dem":E,geojson:C,video:M,image:T,canvas:j},I=function(e,n,i,r){var a=new L[n.type](e,n,i,r);if(a.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+a.id);return t.bindAll(["load","abort","unload","serialize","prepare"],a),a};function z(e,n){var i=t.identity([]);return t.translate(i,i,[1,1,0]),t.scale(i,i,[.5*e.width,.5*e.height,1]),t.multiply(i,i,e.calculatePosMatrix(n.toUnwrapped()))}function D(t,e,n,i,r){var a=function(t,e,n){if(t)for(var i=0,r=t;i<r.length;i+=1){var a=e[r[i]];if(a&&a.source===n&&"fill-extrusion"===a.type)return!0}else for(var o in e){var s=e[o];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),o=r.maxPitchScaleFactor(),s=t.tilesIn(n,o,a);s.sort(B);for(var u=[],l=0,c=s;l<c.length;l+=1){var h=c[l];u.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,t._state,h.queryGeometry,h.cameraQueryGeometry,h.scale,i,r,o,z(t.transform,h.tileID))})}var f=function(t){for(var e={},n={},i=0,r=t;i<r.length;i+=1){var a=r[i],o=a.queryResults,s=a.wrappedTileID,u=n[s]=n[s]||{};for(var l in o)for(var c=o[l],h=u[l]=u[l]||{},f=e[l]=e[l]||[],p=0,A=c;p<A.length;p+=1){var d=A[p];h[d.featureIndex]||(h[d.featureIndex]=!0,f.push(d))}}return e}(u);for(var p in f)f[p].forEach(function(e){var n=e.feature,i=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i});return f}function B(t,e){var n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}var R=function(t,e){this.max=t,this.onRemove=e,this.reset()};R.prototype.reset=function(){for(var t in this.data)for(var e=0,n=this.data[t];e<n.length;e+=1){var i=n[e];i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value)}return this.data={},this.order=[],this},R.prototype.add=function(t,e,n){var i=this,r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);var a={value:e,timeout:void 0};if(void 0!==n&&(a.timeout=setTimeout(function(){i.remove(t,a)},n)),this.data[r].push(a),this.order.push(r),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},R.prototype.has=function(t){return t.wrapped().key in this.data},R.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},R.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},R.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},R.prototype.remove=function(t,e){if(!this.has(t))return this;var n=t.wrapped().key,i=void 0===e?0:this.data[n].indexOf(e),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this},R.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this};var F=function(t,e,n){this.context=t;var i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};F.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},F.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},F.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var N={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},U=function(t,e,n,i){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;var r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};U.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},U.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},U.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var i=this.attributes[n],r=e.attributes[i.name];void 0!==r&&t.enableVertexAttribArray(r)}},U.prototype.setVertexAttribPointers=function(t,e,n){for(var i=0;i<this.attributes.length;i++){var r=this.attributes[i],a=e.attributes[r.name];void 0!==a&&t.vertexAttribPointer(a,r.components,t[N[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}},U.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var V=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};V.prototype.get=function(){return this.current},V.prototype.set=function(t){},V.prototype.getDefault=function(){return this.default},V.prototype.setDefault=function(){this.set(this.default)};var G=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(V),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(V),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(V),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(V),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(V),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(V),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(V),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(V),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(V),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(V),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(V),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),it=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(V),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(V),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(V),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(V),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(V),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(V),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(V),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(V),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(V),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(V),At=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(V),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(V),vt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(V),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(V),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),_t=function(t){function e(e,n){t.call(this,e),this.context=e,this.parent=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e}(V),bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(_t),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(_t),wt=function(t,e,n){this.context=t,this.width=e,this.height=n;var i=t.gl,r=this.framebuffer=i.createFramebuffer();this.colorAttachment=new bt(t,r),this.depthAttachment=new xt(t,r)};wt.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n),t.deleteFramebuffer(this.framebuffer)};var St=function(t,e,n){this.func=t,this.mask=e,this.range=n};St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);var kt=function(t,e,n,i,r,a){this.test=t,this.ref=e,this.mask=n,this.fail=i,this.depthFail=r,this.pass=a};kt.disabled=new kt({func:519,mask:0},0,0,7680,7680,7680);var Ot=function(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n};Ot.disabled=new Ot(Ot.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Ot.unblended=new Ot(Ot.Replace,t.Color.transparent,[!0,!0,!0,!0]),Ot.alphaBlended=new Ot([1,771],t.Color.transparent,[!0,!0,!0,!0]);var Pt=function(t,e,n){this.enable=t,this.mode=e,this.frontFace=n};Pt.disabled=new Pt(!1,1029,2305),Pt.backCCW=new Pt(!0,1029,2305);var Et=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G(this),this.clearDepth=new W(this),this.clearStencil=new H(this),this.colorMask=new q(this),this.depthMask=new Z(this),this.stencilMask=new X(this),this.stencilFunc=new Q(this),this.stencilOp=new Y(this),this.stencilTest=new K(this),this.depthRange=new J(this),this.depthTest=new $(this),this.depthFunc=new tt(this),this.blend=new et(this),this.blendFunc=new nt(this),this.blendColor=new it(this),this.blendEquation=new rt(this),this.cullFace=new at(this),this.cullFaceSide=new ot(this),this.frontFace=new st(this),this.program=new ut(this),this.activeTexture=new lt(this),this.viewport=new ct(this),this.bindFramebuffer=new ht(this),this.bindRenderbuffer=new ft(this),this.bindTexture=new pt(this),this.bindVertexBuffer=new At(this),this.bindElementBuffer=new dt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new vt(this),this.pixelStoreUnpack=new gt(this),this.pixelStoreUnpackPremultiplyAlpha=new mt(this),this.pixelStoreUnpackFlipY=new yt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear")};Et.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Et.prototype.createIndexBuffer=function(t,e){return new F(this,t,e)},Et.prototype.createVertexBuffer=function(t,e,n){return new U(this,t,e,n)},Et.prototype.createRenderbuffer=function(t,e,n){var i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),r},Et.prototype.createFramebuffer=function(t,e){return new wt(this,t,e)},Et.prototype.clear=function(t){var e=t.color,n=t.depth,i=this.gl,r=0;e&&(r|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(r|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),i.clear(r)},Et.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Et.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Et.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Et.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Ot.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Et.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ct=function(e){function n(n,i,r){var a=this;e.call(this),this.id=n,this.dispatcher=r,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(a._sourceLoaded=!0),a._sourceLoaded&&!a._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(a.reload(),a.transform&&a.update(a.transform))}),this.on("error",function(){a._sourceErrored=!0}),this._source=I(n,i,r,this),this._tiles={},this._cache=new R(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},n.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},n.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},n.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(Tt)},n.prototype.getRenderableIds=function(e){var n=this,i=[];for(var r in this._tiles)this._isIdRenderable(+r,e)&&i.push(+r);return e?i.sort(function(e,i){var r=n._tiles[e].tileID,a=n._tiles[i].tileID,o=new t.Point(r.canonical.x,r.canonical.y)._rotate(n.transform.angle),s=new t.Point(a.canonical.x,a.canonical.y)._rotate(n.transform.angle);return r.overscaledZ-a.overscaledZ||s.y-o.y||s.x-o.x}):i.sort(Tt)},n.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},n.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},n.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},n.prototype._tileLoaded=function(e,n,i,r){if(r)return e.state="errored",void(404!==r.status?this._source.fire(new t.ErrorEvent(r,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},n.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var i=e[n];if(t.neighboringTiles&&t.neighboringTiles[i]){var r=this.getTileByID(i);a(t,r),a(r,t)}}function a(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,i=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),a=e.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,i),t.neighboringTiles&&t.neighboringTiles[a]&&(t.neighboringTiles[a].backfilled=!0)))}},n.prototype.getTile=function(t){return this.getTileByID(t.key)},n.prototype.getTileByID=function(t){return this._tiles[t]},n.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},n.prototype._retainLoadedChildren=function(t,e,n,i){for(var r in this._tiles){var a=this._tiles[r];if(!(i[r]||!a.hasData()||a.tileID.overscaledZ<=e||a.tileID.overscaledZ>n)){for(var o=a.tileID;a&&a.tileID.overscaledZ>e+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var u=o;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){i[o.key]=o;break}}}},n.prototype.findLoadedParent=function(t,e){for(var n=t.overscaledZ-1;n>=e;n--){var i=t.scaledTo(n);if(!i)return;var r=String(i.key),a=this._tiles[r];if(a&&a.hasData())return a;if(this._cache.has(i))return this._cache.get(i)}},n.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),n=Math.floor(5*e),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(i)},n.prototype.handleWrapJump=function(t){var e=(t-(void 0===this._prevLng?t:this._prevLng))/360,n=Math.round(e);if(this._prevLng=t,n){var i={};for(var r in this._tiles){var a=this._tiles[r];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+n),i[a.tileID.key]=a}for(var o in this._tiles=i,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var s in this._tiles){var u=this._tiles[s];this._setTileReloadTimer(s,u)}}},n.prototype.update=function(e){var i=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var r;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)}):(r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(r=r.filter(function(t){return i._source.hasTile(t)}))):r=[];var a=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),o=Math.max(a-n.maxOverzooming,this._source.minzoom),s=Math.max(a+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(r,a);if(Mt(this._source.type)){for(var l={},c={},h=0,f=Object.keys(u);h<f.length;h+=1){var p=f[h],A=u[p],d=this._tiles[p];if(d&&!(d.fadeEndTime&&d.fadeEndTime<=t.browser.now())){var v=this.findLoadedParent(A,o);v&&(this._addTile(v.tileID),l[v.tileID.key]=v.tileID),c[p]=A}}for(var g in this._retainLoadedChildren(c,a,s,u),l)u[g]||(this._coveredTiles[g]=!0,u[g]=l[g])}for(var m in u)this._tiles[m].clearFadeHold();for(var y=0,_=t.keysDifference(this._tiles,u);y<_.length;y+=1){var b=_[y],x=this._tiles[b];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(b)}}},n.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},n.prototype._updateRetainedTiles=function(t,e){for(var i={},r={},a=Math.max(e-n.maxOverzooming,this._source.minzoom),o=Math.max(e+n.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],h=this._addTile(c);i[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,o,i);for(var f=0,p=t;f<p.length;f+=1){var A=p[f],d=this._tiles[A.key];if(!d.hasData()){if(e+1>this._source.maxzoom){var v=A.children(this._source.maxzoom)[0],g=this.getTile(v);if(g&&g.hasData()){i[v.key]=v;continue}}else{var m=A.children(this._source.maxzoom);if(i[m[0].key]&&i[m[1].key]&&i[m[2].key]&&i[m[3].key])continue}for(var y=d.wasRequested(),_=A.overscaledZ-1;_>=a;--_){var b=A.scaledTo(_);if(r[b.key])break;if(r[b.key]=!0,!(d=this.getTile(b))&&y&&(d=this._addTile(b)),d&&(i[b.key]=b,y=d.wasRequested(),d.hasData()))break}}}return i},n.prototype._addTile=function(e){var n=this._tiles[e.key];if(n)return n;(n=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));var i=Boolean(n);return i||(n=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,i||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout(function(){n._reloadTile(t,"expired"),delete n._timers[t]},i))},n.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},n.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},n.prototype.tilesIn=function(e,n,i){var r=this,a=[],o=this.transform;if(!o)return a;for(var s=i?o.getCameraQueryGeometry(e):e,u=e.map(function(t){return o.pointCoordinate(t)}),l=s.map(function(t){return o.pointCoordinate(t)}),c=this.getIds(),h=1/0,f=1/0,p=-1/0,A=-1/0,d=0,v=l;d<v.length;d+=1){var g=v[d];h=Math.min(h,g.x),f=Math.min(f,g.y),p=Math.max(p,g.x),A=Math.max(A,g.y)}for(var m=function(e){var i=r._tiles[c[e]];if(!i.holdingForFade()){var s=i.tileID,d=Math.pow(2,o.zoom-i.tileID.overscaledZ),v=n*i.queryPadding*t.EXTENT/i.tileSize/d,g=[s.getTilePoint(new t.MercatorCoordinate(h,f)),s.getTilePoint(new t.MercatorCoordinate(p,A))];if(g[0].x-v<t.EXTENT&&g[0].y-v<t.EXTENT&&g[1].x+v>=0&&g[1].y+v>=0){var m=u.map(function(t){return s.getTilePoint(t)}),y=l.map(function(t){return s.getTilePoint(t)});a.push({tile:i,tileID:s,queryGeometry:m,cameraQueryGeometry:y,scale:d})}}},y=0;y<c.length;y++)m(y);return a},n.prototype.getVisibleCoordinates=function(t){for(var e=this,n=this.getRenderableIds(t).map(function(t){return e._tiles[t].tileID}),i=0,r=n;i<r.length;i+=1){var a=r[i];a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Mt(this._source.type))for(var e in this._tiles){var n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.browser.now())return!0}return!1},n.prototype.setFeatureState=function(t,e,n){t=t||"_geojsonTileLayer",this._state.updateState(t,e,n)},n.prototype.removeFeatureState=function(t,e,n){t=t||"_geojsonTileLayer",this._state.removeFeatureState(t,e,n)},n.prototype.getFeatureState=function(t,e){return t=t||"_geojsonTileLayer",this._state.getState(t,e)},n}(t.Evented);function Tt(t,e){return t%32-e%32||e-t}function Mt(t){return"raster"===t||"image"===t||"video"===t}function jt(){return new t.window.Worker($i.workerUrl)}Ct.maxOverzooming=10,Ct.maxUnderzooming=3;var Lt=function(){this.active={}};Lt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Lt.workerCount;)this.workers.push(new jt);return this.active[t]=!0,this.workers.slice()},Lt.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)};var It,zt=Math.floor(t.browser.hardwareConcurrency/2);function Dt(e,n){var i={};for(var r in e)"ref"!==r&&(i[r]=e[r]);return t.refProperties.forEach(function(t){t in n&&(i[t]=n[t])}),i}function Bt(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Dt(t[i],e[t[i].ref]));return t}Lt.workerCount=Math.max(Math.min(zt,6),1);var Rt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ft(t,e,n){n.push({command:Rt.addSource,args:[t,e[t]]})}function Nt(t,e,n){e.push({command:Rt.removeSource,args:[t]}),n[t]=!0}function Ut(t,e,n,i){Nt(t,n,i),Ft(t,e,n)}function Vt(e,n,i){var r;for(r in e[i])if(e[i].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[i][r],n[i][r]))return!1;for(r in n[i])if(n[i].hasOwnProperty(r)&&"data"!==r&&!t.deepEqual(e[i][r],n[i][r]))return!1;return!0}function Gt(e,n,i,r,a,o){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||i.push({command:o,args:[r,s,n[s],a]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||i.push({command:o,args:[r,s,n[s],a]}))}function Wt(t){return t.id}function Ht(t,e){return t[e.id]=e,t}var qt=function(t,e,n){var i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};qt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},qt.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},qt.prototype.insertCircle=function(t,e,n,i){this._forEachCell(e-i,n-i,e+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(i)},qt.prototype._insertBoxCell=function(t,e,n,i,r,a){this.boxCells[r].push(a)},qt.prototype._insertCircleCell=function(t,e,n,i,r,a){this.circleCells[r].push(a)},qt.prototype._query=function(t,e,n,i,r,a){if(n<0||t>this.width||i<0||e>this.height)return!r&&[];var o=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];o.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return a?o.filter(a):o}var f={hitTest:r,seenUids:{box:{},circle:{}}};return this._forEachCell(t,e,n,i,this._queryCell,o,f,a),r?o.length>0:o},qt.prototype._queryCircle=function(t,e,n,i,r){var a=t-n,o=t+n,s=e-n,u=e+n;if(o<0||a>this.width||u<0||s>this.height)return!i&&[];var l=[],c={hitTest:i,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}};return this._forEachCell(a,s,o,u,this._queryCellCircle,l,c,r),i?l.length>0:l},qt.prototype.query=function(t,e,n,i,r){return this._query(t,e,n,i,!1,r)},qt.prototype.hitTest=function(t,e,n,i,r){return this._query(t,e,n,i,!0,r)},qt.prototype.hitTestCircle=function(t,e,n,i){return this._queryCircle(t,e,n,!0,i)},qt.prototype._queryCell=function(t,e,n,i,r,a,o,s){var u=o.seenUids,l=this.boxCells[r];if(null!==l)for(var c=this.bboxes,h=0,f=l;h<f.length;h+=1){var p=f[h];if(!u.box[p]){u.box[p]=!0;var A=4*p;if(t<=c[A+2]&&e<=c[A+3]&&n>=c[A+0]&&i>=c[A+1]&&(!s||s(this.boxKeys[p]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[p],x1:c[A],y1:c[A+1],x2:c[A+2],y2:c[A+3]})}}}var d=this.circleCells[r];if(null!==d)for(var v=this.circles,g=0,m=d;g<m.length;g+=1){var y=m[g];if(!u.circle[y]){u.circle[y]=!0;var _=3*y;if(this._circleAndRectCollide(v[_],v[_+1],v[_+2],t,e,n,i)&&(!s||s(this.circleKeys[y]))){if(o.hitTest)return a.push(!0),!0;var b=v[_],x=v[_+1],w=v[_+2];a.push({key:this.circleKeys[y],x1:b-w,y1:x-w,x2:b+w,y2:x+w})}}}},qt.prototype._queryCellCircle=function(t,e,n,i,r,a,o,s){var u=o.circle,l=o.seenUids,c=this.boxCells[r];if(null!==c)for(var h=this.bboxes,f=0,p=c;f<p.length;f+=1){var A=p[f];if(!l.box[A]){l.box[A]=!0;var d=4*A;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[d+0],h[d+1],h[d+2],h[d+3])&&(!s||s(this.boxKeys[A])))return a.push(!0),!0}}var v=this.circleCells[r];if(null!==v)for(var g=this.circles,m=0,y=v;m<y.length;m+=1){var _=y[m];if(!l.circle[_]){l.circle[_]=!0;var b=3*_;if(this._circlesCollide(g[b],g[b+1],g[b+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[_])))return a.push(!0),!0}}},qt.prototype._forEachCell=function(t,e,n,i,r,a,o,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i),f=u;f<=c;f++)for(var p=l;p<=h;p++){var A=this.xCellCount*p+f;if(r.call(this,t,e,n,i,A,a,o,s))return}},qt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},qt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},qt.prototype._circlesCollide=function(t,e,n,i,r,a){var o=i-t,s=r-e,u=n+a;return u*u>o*o+s*s},qt.prototype._circleAndRectCollide=function(t,e,n,i,r,a,o){var s=(a-i)/2,u=Math.abs(t-(i+s));if(u>s+n)return!1;var l=(o-r)/2,c=Math.abs(e-(r+l));if(c>l+n)return!1;if(u<=s||c<=l)return!0;var h=u-s,f=c-l;return h*h+f*f<=n*n};var Zt=t.properties.layout;function Xt(e,n,i,r,a){var o=t.create();return n?(t.scale(o,o,[1/a,1/a,1]),i||t.rotateZ(o,o,r.angle)):t.multiply(o,r.labelPlaneMatrix,e),o}function Qt(e,n,i,r,a){if(n){var o=t.clone(e);return t.scale(o,o,[a,a,1]),i||t.rotateZ(o,o,-r.angle),o}return r.glCoordMatrix}function Yt(e,n){var i=[e.x,e.y,0,1];oe(i,i,n);var r=i[3];return{point:new t.Point(i[0]/r,i[1]/r),signedDistanceFromCamera:r}}function Kt(t,e){var n=t[0]/t[3],i=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&i>=-e[1]&&i<=e[1]}function Jt(e,n,i,r,a,o,s,u){var l=r?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,i.transform.zoom,Zt.properties[r?"text-size":"icon-size"]),h=[256/i.width*2+1,256/i.height*2+1],f=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;f.clear();for(var p=e.lineVertexArray,A=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,d=i.transform.width/i.transform.height,v=!1,g=0;g<A.length;g++){var m=A.get(g);if(m.hidden||m.writingMode===t.WritingMode.vertical&&!v)ae(m.numGlyphs,f);else{v=!1;var y=[m.anchorX,m.anchorY,0,1];if(t.transformMat4(y,y,n),Kt(y,h)){var _=.5+y[3]/i.transform.cameraToCenterDistance*.5,b=t.evaluateSizeForFeature(l,c,m),x=s?b*_:b/_,w=new t.Point(m.anchorX,m.anchorY),S=Yt(w,a).point,k={},O=ee(m,x,!1,u,n,a,o,e.glyphOffsetArray,p,f,S,w,k,d);v=O.useVertical,(O.notEnoughRoom||v||O.needsFlipping&&ee(m,x,!0,u,n,a,o,e.glyphOffsetArray,p,f,S,w,k,d).notEnoughRoom)&&ae(m.numGlyphs,f)}else ae(m.numGlyphs,f)}}r?e.text.dynamicLayoutVertexBuffer.updateData(f):e.icon.dynamicLayoutVertexBuffer.updateData(f)}function $t(t,e,n,i,r,a,o,s,u,l,c,h){var f=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,A=s.lineStartIndex+s.lineLength,d=e.getoffsetX(s.glyphStartIndex),v=e.getoffsetX(f-1),g=ie(t*d,n,i,r,a,o,s.segment,p,A,u,l,c,h);if(!g)return null;var m=ie(t*v,n,i,r,a,o,s.segment,p,A,u,l,c,h);return m?{first:g,last:m}:null}function te(e,n,i,r){return e===t.WritingMode.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<i.y:n.x>i.x)?{needsFlipping:!0}:null}function ee(e,n,i,r,a,o,s,u,l,c,h,f,p,A){var d,v=n/24,g=e.lineOffsetX*v,m=e.lineOffsetY*v;if(e.numGlyphs>1){var y=e.glyphStartIndex+e.numGlyphs,_=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,x=$t(v,u,g,m,i,h,f,e,l,o,p,!1);if(!x)return{notEnoughRoom:!0};var w=Yt(x.first.point,s).point,S=Yt(x.last.point,s).point;if(r&&!i){var k=te(e.writingMode,w,S,A);if(k)return k}d=[x.first];for(var O=e.glyphStartIndex+1;O<y-1;O++)d.push(ie(v*u.getoffsetX(O),g,m,i,h,f,e.segment,_,b,l,o,p,!1));d.push(x.last)}else{if(r&&!i){var P=Yt(f,a).point,E=e.lineStartIndex+e.segment+1,C=new t.Point(l.getx(E),l.gety(E)),T=Yt(C,a),M=T.signedDistanceFromCamera>0?T.point:ne(f,C,P,1,a),j=te(e.writingMode,P,M,A);if(j)return j}var L=ie(v*u.getoffsetX(e.glyphStartIndex),g,m,i,h,f,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,o,p,!1);if(!L)return{notEnoughRoom:!0};d=[L]}for(var I=0,z=d;I<z.length;I+=1){var D=z[I];t.addDynamicAttributes(c,D.point,D.angle)}return{}}function ne(t,e,n,i,r){var a=Yt(t.add(t.sub(e)._unit()),r).point,o=n.sub(a);return n.add(o._mult(i/o.mag()))}function ie(e,n,i,r,a,o,s,u,l,c,h,f,p){var A=r?e-n:e+n,d=A>0?1:-1,v=0;r&&(d*=-1,v=Math.PI),d<0&&(v+=Math.PI);for(var g=d>0?u+s:u+s+1,m=g,y=a,_=a,b=0,x=0,w=Math.abs(A);b+x<=w;){if((g+=d)<u||g>=l)return null;if(_=y,void 0===(y=f[g])){var S=new t.Point(c.getx(g),c.gety(g)),k=Yt(S,h);if(k.signedDistanceFromCamera>0)y=f[g]=k.point;else{var O=g-d;y=ne(0===b?o:new t.Point(c.getx(O),c.gety(O)),S,_,w-b+1,h)}}b+=x,x=_.dist(y)}var P=(w-b)/x,E=y.sub(_),C=E.mult(P)._add(_);return C._add(E._unit()._perp()._mult(i*d)),{point:C,angle:v+Math.atan2(y.y-_.y,y.x-_.x),tileDistance:p?{prevTileDistance:g-d===m?0:c.gettileUnitDistanceFromAnchor(g-d),lastSegmentViewportDistance:w-b}:null}}var re=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ae(t,e){for(var n=0;n<t;n++){var i=e.length;e.resize(i+4),e.float32.set(re,3*i)}}function oe(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t[3]=n[3]*i+n[7]*r+n[15],t}var se=function(t,e,n){void 0===e&&(e=new qt(t.width+200,t.height+200,25)),void 0===n&&(n=new qt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function ue(t,e,n){t[e+4]=n?1:0}function le(e,n,i){return n*(t.EXTENT/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}se.prototype.placeCollisionBox=function(t,e,n,i,r){var a=this.projectAndGetPerspectiveRatio(i,t.anchorPointX,t.anchorPointY),o=n*a.perspectiveRatio,s=t.x1*o+a.point.x,u=t.y1*o+a.point.y,l=t.x2*o+a.point.x,c=t.y2*o+a.point.y;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,r)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},se.prototype.approximateTileDistance=function(t,e,n,i,r){var a=r?1:i/this.pitchfactor,o=t.lastSegmentViewportDistance*n;return t.prevTileDistance+o+(a-1)*o*Math.abs(Math.sin(e))},se.prototype.placeCollisionCircles=function(e,n,i,r,a,o,s,u,l,c,h,f,p){var A=[],d=this.projectAnchor(l,a.anchorX,a.anchorY),v=u/24,g=a.lineOffsetX*u,m=a.lineOffsetY*u,y=new t.Point(a.anchorX,a.anchorY),_=$t(v,s,g,m,!1,Yt(y,c).point,y,a,o,c,{},!0),b=!1,x=!1,w=!0,S=d.perspectiveRatio*r,k=1/(r*i),O=0,P=0;_&&(O=this.approximateTileDistance(_.first.tileDistance,_.first.angle,k,d.cameraDistance,f),P=this.approximateTileDistance(_.last.tileDistance,_.last.angle,k,d.cameraDistance,f));for(var E=0;E<e.length;E+=5){var C=e[E],T=e[E+1],M=e[E+2],j=e[E+3];if(!_||j<-O||j>P)ue(e,E,!1);else{var L=this.projectPoint(l,C,T),I=M*S;if(A.length>0){var z=L.x-A[A.length-4],D=L.y-A[A.length-3];if(I*I*2>z*z+D*D&&E+8<e.length){var B=e[E+8];if(B>-O&&B<P){ue(e,E,!1);continue}}}var R=E/5;A.push(L.x,L.y,I,R),ue(e,E,!0);var F=L.x-I,N=L.y-I,U=L.x+I,V=L.y+I;if(w=w&&this.isOffscreen(F,N,U,V),x=x||this.isInsideGrid(F,N,U,V),!n&&this.grid.hitTestCircle(L.x,L.y,I,p)){if(!h)return{circles:[],offscreen:!1};b=!0}}}return{circles:b||!x?[]:A,offscreen:w}},se.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],i=1/0,r=1/0,a=-1/0,o=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);i=Math.min(i,c.x),r=Math.min(r,c.y),a=Math.max(a,c.x),o=Math.max(o,c.y),n.push(c)}for(var h={},f={},p=0,A=this.grid.query(i,r,a,o).concat(this.ignoredGrid.query(i,r,a,o));p<A.length;p+=1){var d=A[p],v=d.key;if(void 0===h[v.bucketInstanceId]&&(h[v.bucketInstanceId]={}),!h[v.bucketInstanceId][v.featureIndex]){var g=[new t.Point(d.x1,d.y1),new t.Point(d.x2,d.y1),new t.Point(d.x2,d.y2),new t.Point(d.x1,d.y2)];t.polygonIntersectsPolygon(n,g)&&(h[v.bucketInstanceId][v.featureIndex]=!0,void 0===f[v.bucketInstanceId]&&(f[v.bucketInstanceId]=[]),f[v.bucketInstanceId].push(v.featureIndex))}}return f},se.prototype.insertCollisionBox=function(t,e,n,i,r){var a={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};(e?this.ignoredGrid:this.grid).insert(a,t[0],t[1],t[2],t[3])},se.prototype.insertCollisionCircles=function(t,e,n,i,r){for(var a=e?this.ignoredGrid:this.grid,o={bucketInstanceId:n,featureIndex:i,collisionGroupID:r},s=0;s<t.length;s+=4)a.insertCircle(o,t[s],t[s+1],t[s+2])},se.prototype.projectAnchor=function(t,e,n){var i=[e,n,0,1];return oe(i,i,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5,cameraDistance:i[3]}},se.prototype.projectPoint=function(e,n,i){var r=[n,i,0,1];return oe(r,r,e),new t.Point((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100)},se.prototype.projectAndGetPerspectiveRatio=function(e,n,i){var r=[n,i,0,1];return oe(r,r,e),{point:new t.Point((r[0]/r[3]+1)/2*this.transform.width+100,(-r[1]/r[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5}},se.prototype.isOffscreen=function(t,e,n,i){return n<100||t>=this.screenRightBoundary||i<100||e>this.screenBottomBoundary},se.prototype.isInsideGrid=function(t,e,n,i){return n>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary};var ce=function(t,e,n,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&n?1:0,this.placed=n};ce.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var he=function(t,e,n,i,r){this.text=new ce(t?t.text:null,e,n,r),this.icon=new ce(t?t.icon:null,e,i,r)};he.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var fe=function(t,e,n){this.text=t,this.icon=e,this.skipFade=n},pe=function(t,e,n,i,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r},Ae=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function de(e,n,i,r,a){var o=t.getAnchorAlignment(e),s=-(o.horizontalAlign-.5)*n,u=-(o.verticalAlign-.5)*i,l=t.evaluateRadialOffset(e,r);return new t.Point(s+l[0]*a,u+l[1]*a)}Ae.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var ve=function(t,e,n,i){this.transform=t.clone(),this.collisionIndex=new se(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new Ae(n),this.prevPlacement=i,i&&(i.prevPlacement=void 0)};function ge(t,e,n,i,r){t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0)}ve.prototype.placeLayerTile=function(e,n,i,r){var a=n.getBucket(e),o=n.latestFeatureIndex;if(a&&o&&e.id===a.layerIds[0]){var s=n.collisionBoxArray,u=a.layers[0].layout,l=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),c=n.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(n.tileID.toUnwrapped()),f=Xt(h,"map"===u.get("text-pitch-alignment"),"map"===u.get("text-rotation-alignment"),this.transform,le(n,1,this.transform.zoom)),p=Xt(h,"map"===u.get("icon-pitch-alignment"),"map"===u.get("icon-rotation-alignment"),this.transform,le(n,1,this.transform.zoom));this.retainedQueryData[a.bucketInstanceId]=new pe(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,n.tileID),this.placeLayerBucket(a,h,f,p,l,c,i,n.holdingForFade(),r,s)}},ve.prototype.attemptAnchorPlacement=function(e,n,i,r,a,o,s,u,l,c,h,f,p,A){var d,v=de(e,i,r,a,o),g=this.collisionIndex.placeCollisionBox(function(e,n,i,r,a,o){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,h=e.anchorPointX,f=e.anchorPointY,p=new t.Point(n,i);return r&&p._rotate(a?o:-o),{x1:s+p.x,y1:l+p.y,x2:u+p.x,y2:c+p.y,anchorPointX:h,anchorPointY:f}}(n,v.x,v.y,s,u,this.transform.angle),f,l,c,h.predicate);if(g.box.length>0)return this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(d=this.prevPlacement.variableOffsets[p.crossTileID].anchor),this.variableOffsets[p.crossTileID]={radialOffset:a,width:i,height:r,anchor:e,textBoxScale:o,prevAnchor:d},this.markUsedJustification(A,e,p),g},ve.prototype.placeLayerBucket=function(e,n,i,r,a,o,s,u,l,c){var h=e.layers[0].layout,f=t.evaluateSizeForZoom(e.textSizeData,this.transform.zoom,t.properties.layout.properties["text-size"]),p=h.get("text-optional"),A=h.get("icon-optional"),d=h.get("text-allow-overlap"),v=h.get("icon-allow-overlap"),g=d&&(v||!e.hasIconData()||A),m=v&&(d||!e.hasTextData()||p),y=this.collisionGroups.get(e.sourceID),_="map"===h.get("text-rotation-alignment"),b="map"===h.get("text-pitch-alignment");!e.collisionArrays&&c&&e.deserializeCollisionBoxes(c);for(var x=0;x<e.symbolInstances.length;x++){var w=e.symbolInstances.get(x);if(!l[w.crossTileID]){if(u){this.placements[w.crossTileID]=new fe(!1,!1,!1);continue}var S=!1,k=!1,O=!0,P=null,E=null,C=null,T=0,M=0,j=e.collisionArrays[x];j.textFeatureIndex&&(T=j.textFeatureIndex);var L=j.textBox;if(L)if(h.get("text-variable-anchor")){var I=L.x2-L.x1,z=L.y2-L.y1,D=w.textBoxScale,B=h.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[w.crossTileID]){var R=this.prevPlacement.variableOffsets[w.crossTileID];B[0]!==R.anchor&&(B=B.filter(function(t){return t!==R.anchor})).unshift(R.anchor)}for(var F=0,N=B;F<N.length;F+=1){var U=N[F];if(P=this.attemptAnchorPlacement(U,L,I,z,w.radialTextOffset,D,_,b,o,n,y,d,w,e)){S=!0;break}}if(!this.variableOffsets[w.crossTileID]&&this.prevPlacement){var V=this.prevPlacement.variableOffsets[w.crossTileID];V&&(this.variableOffsets[w.crossTileID]=V,this.markUsedJustification(e,V.anchor,w))}}else S=(P=this.collisionIndex.placeCollisionBox(L,h.get("text-allow-overlap"),o,n,y.predicate)).box.length>0;O=P&&P.offscreen;var G=j.textCircles;if(G){var W=e.text.placedSymbolArray.get(w.centerJustifiedTextSymbolIndex),H=t.evaluateSizeForFeature(e.textSizeData,f,W);E=this.collisionIndex.placeCollisionCircles(G,h.get("text-allow-overlap"),a,o,W,e.lineVertexArray,e.glyphOffsetArray,H,n,i,s,b,y.predicate),S=h.get("text-allow-overlap")||E.circles.length>0,O=O&&E.offscreen}j.iconFeatureIndex&&(M=j.iconFeatureIndex),j.iconBox&&(k=(C=this.collisionIndex.placeCollisionBox(j.iconBox,h.get("icon-allow-overlap"),o,n,y.predicate)).box.length>0,O=O&&C.offscreen);var q=p||0===w.numHorizontalGlyphVertices&&0===w.numVerticalGlyphVertices,Z=A||0===w.numIconVertices;q||Z?Z?q||(k=k&&S):S=k&&S:k=S=k&&S,S&&P&&this.collisionIndex.insertCollisionBox(P.box,h.get("text-ignore-placement"),e.bucketInstanceId,T,y.ID),k&&C&&this.collisionIndex.insertCollisionBox(C.box,h.get("icon-ignore-placement"),e.bucketInstanceId,M,y.ID),S&&E&&this.collisionIndex.insertCollisionCircles(E.circles,h.get("text-ignore-placement"),e.bucketInstanceId,T,y.ID),this.placements[w.crossTileID]=new fe(S||g,k||m,O||e.justReloaded),l[w.crossTileID]=!0}}e.justReloaded=!1},ve.prototype.markUsedJustification=function(e,n,i){var r={left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex},a=r[t.getAnchorJustification(n)];for(var o in r){var s=r[o];s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=a>=0&&s!==a?0:i.crossTileID)}},ve.prototype.commit=function(t){this.commitTime=t;var e=this.prevPlacement,n=!1,i=e&&0!==this.fadeDuration?(this.commitTime-e.commitTime)/this.fadeDuration:1,r=e?e.opacities:{},a=e?e.variableOffsets:{};for(var o in this.placements){var s=this.placements[o],u=r[o];u?(this.opacities[o]=new he(u,i,s.text,s.icon),n=n||s.text!==u.text.placed||s.icon!==u.icon.placed):(this.opacities[o]=new he(null,i,s.text,s.icon,s.skipFade),n=n||s.text||s.icon)}for(var l in r){var c=r[l];if(!this.opacities[l]){var h=new he(c,i,!1,!1);h.isHidden()||(this.opacities[l]=h,n=n||c.text.placed||c.icon.placed)}}for(var f in a)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=a[f]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},ve.prototype.updateLayerOpacities=function(t,e){for(var n={},i=0,r=e;i<r.length;i+=1){var a=r[i],o=a.getBucket(t);o&&a.latestFeatureIndex&&t.id===o.layerIds[0]&&this.updateBucketOpacities(o,n,a.collisionBoxArray)}},ve.prototype.updateBucketOpacities=function(e,n,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexArray.clear(),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexArray.clear();var r=e.layers[0].layout,a=new he(null,0,!1,!1,!0),o=r.get("text-allow-overlap"),s=r.get("icon-allow-overlap"),u=r.get("text-variable-anchor"),l="map"===r.get("text-rotation-alignment"),c="map"===r.get("text-pitch-alignment"),h=new he(null,0,o&&(s||!e.hasIconData()||r.get("icon-optional")),s&&(o||!e.hasTextData()||r.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasCollisionBoxData()||e.hasCollisionCircleData())&&e.deserializeCollisionBoxes(i);for(var f=0;f<e.symbolInstances.length;f++){var p=e.symbolInstances.get(f),A=p.numHorizontalGlyphVertices,d=p.numVerticalGlyphVertices,v=p.crossTileID,g=n[v],m=this.opacities[v];g?m=a:m||(m=h,this.opacities[v]=m),n[v]=!0;var y=A>0||d>0,_=p.numIconVertices>0;if(y){for(var b=ke(m.text),x=(A+d)/4,w=0;w<x;w++)e.text.opacityVertexArray.emplaceBack(b);var S=m.text.isHidden()?1:0;[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex].forEach(function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=S)});var k=this.variableOffsets[p.crossTileID];k&&this.markUsedJustification(e,k.anchor,p)}if(_){for(var O=ke(m.icon),P=0;P<p.numIconVertices/4;P++)e.icon.opacityVertexArray.emplaceBack(O);e.icon.placedSymbolArray.get(f).hidden=m.icon.isHidden()}if(e.hasCollisionBoxData()||e.hasCollisionCircleData()){var E=e.collisionArrays[f];if(E){if(E.textBox){var C=new t.Point(0,0),T=!0;if(u){var M=this.variableOffsets[v];M?(C=de(M.anchor,M.width,M.height,M.radialOffset,M.textBoxScale),l&&C._rotate(c?this.transform.angle:-this.transform.angle)):T=!1}ge(e.collisionBox.collisionVertexArray,m.text.placed,!T,C.x,C.y)}E.iconBox&&ge(e.collisionBox.collisionVertexArray,m.icon.placed,!1);var j=E.textCircles;if(j&&e.hasCollisionCircleData())for(var L=0;L<j.length;L+=5){var I=g||0===j[L+4];ge(e.collisionCircle.collisionVertexArray,m.text.placed,I)}}}}e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexBuffer&&e.collisionBox.collisionVertexBuffer.updateData(e.collisionBox.collisionVertexArray),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexBuffer&&e.collisionCircle.collisionVertexBuffer.updateData(e.collisionCircle.collisionVertexArray)},ve.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},ve.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},ve.prototype.stillRecent=function(t){return this.commitTime+this.fadeDuration>t},ve.prototype.setStale=function(){this.stale=!0};var me=Math.pow(2,25),ye=Math.pow(2,24),_e=Math.pow(2,17),be=Math.pow(2,16),xe=Math.pow(2,9),we=Math.pow(2,8),Se=Math.pow(2,1);function ke(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*me+e*ye+n*_e+e*be+n*xe+e*we+n*Se+e}var Oe=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};Oe.prototype.continuePlacement=function(t,e,n,i,r){for(;this._currentTileIndex<t.length;){var a=t[this._currentTileIndex];if(e.placeLayerTile(i,a,n,this._seenCrossTileIDs),this._currentTileIndex++,r())return!0}};var Pe=function(t,e,n,i,r,a,o){this.placement=new ve(t,r,a,o),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1};Pe.prototype.isDone=function(){return this._done},Pe.prototype.continuePlacement=function(e,n,i){for(var r=this,a=t.browser.now(),o=function(){var e=t.browser.now()-a;return!r._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=n[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Oe),this._inProgressLayer.continuePlacement(i[s.source],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Pe.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Ee=512/t.EXTENT/2,Ce=function(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var i=0;i<e.length;i++){var r=e.get(i),a=r.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,t)})}};Ce.prototype.getScaledCoordinates=function(e,n){var i=n.canonical.z-this.tileID.canonical.z,r=Ee/Math.pow(2,i);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*r),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*r)}},Ce.prototype.findMatches=function(t,e,n){for(var i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),r=0;r<t.length;r++){var a=t.get(r);if(!a.crossTileID){var o=this.indexedSymbolInstances[a.key];if(o)for(var s=this.getScaledCoordinates(a,e),u=0,l=o;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=i&&Math.abs(c.coord.y-s.y)<=i&&!n[c.crossTileID]){n[c.crossTileID]=!0,a.crossTileID=c.crossTileID;break}}}}};var Te=function(){this.maxCrossTileID=0};Te.prototype.generate=function(){return++this.maxCrossTileID};var Me=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Me.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var n in this.indexes){var i=this.indexes[n],r={};for(var a in i){var o=i[a];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+e),r[o.tileID.key]=o}this.indexes[n]=r}this.lng=t},Me.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var i=0;i<e.symbolInstances.length;i++)e.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var r=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var o=this.indexes[a];if(Number(a)>t.overscaledZ)for(var s in o){var u=o[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,r)}else{var l=o[t.scaledTo(Number(a)).key];l&&l.findMatches(e.symbolInstances,t,r)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=n.generate(),r[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ce(t,e.symbolInstances,e.bucketInstanceId),!0},Me.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var i=0,r=e.indexedSymbolInstances[n];i<r.length;i+=1){var a=r[i];delete this.usedCrossTileIDs[t][a.crossTileID]}},Me.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var i=this.indexes[n];for(var r in i)t[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],e=!0)}return e};var je=function(){this.layerIndexes={},this.crossTileIDs=new Te,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};je.prototype.addLayer=function(t,e,n){var i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new Me);var r=!1,a={};i.handleWrapJump(n);for(var o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(u.tileID,l,this.crossTileIDs)&&(r=!0),a[l.bucketInstanceId]=!0)}return i.removeStaleBuckets(a)&&(r=!0),r},je.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach(function(t){e[t]=!0}),this.layerIndexes)e[n]||delete this.layerIndexes[n]};var Le=function(e,n){return t.emitValidationErrors(e,n&&n.filter(function(t){return"source.canvas"!==t.identifier}))},Ie=t.pick(Rt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ze=t.pick(Rt,["setCenter","setZoom","setBearing","setPitch"]),De=function(e){function n(i,r){var a=this;void 0===r&&(r={}),e.call(this),this.map=i,this.dispatcher=new w((It||(It=new Lt),It),this),this.imageManager=new f,this.imageManager.setEventedParent(this),this.glyphManager=new m(i._requestManager,r.localIdeographFontFamily),this.lineAtlas=new x(256,512),this.crossTileSymbolIndex=new je,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var o=this;this._rtlTextPluginCallback=n.registerForPluginAvailability(function(t){for(var e in o.dispatcher.broadcast("loadRTLTextPlugin",t.pluginURL,t.completionCallback),o.sourceCaches)o.sourceCaches[e].reload()}),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=a.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var i in a._layers){var r=a._layers[i];r.source===n.id&&a._validateLayer(r)}}}})}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.loadURL=function(e,n){var i=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var r="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);var a=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(a,function(e,n){i._request=null,e?i.fire(new t.ErrorEvent(e)):n&&i._load(n,r)})},n.prototype.loadJSON=function(e,n){var i=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame(function(){i._request=null,i._load(e,!1!==n.validate)})},n.prototype._load=function(e,n){var i=this;if(!n||!Le(this,t.validateStyle(e))){for(var r in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(r,e.sources[r],{validate:!1});e.sprite?this._spriteRequest=function(e,n,i){var r,a,o,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),function(t,e){u=null,o||(o=t,r=e,c())}),l=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),function(t,e){l=null,o||(o=t,a=e,c())});function c(){if(o)i(o);else if(r&&a){var e=t.browser.getImageData(a),n={};for(var s in r){var u=r[s],l=u.width,c=u.height,h=u.x,f=u.y,p=u.sdf,A=u.pixelRatio,d=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,d,{x:h,y:f},{x:0,y:0},{width:l,height:c}),n[s]={data:d,pixelRatio:A,sdf:p}}i(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e.sprite,this.map._requestManager,function(e,n){if(i._spriteRequest=null,e)i.fire(new t.ErrorEvent(e));else if(n)for(var r in n)i.imageManager.addImage(r,n[r]);i.imageManager.setLoaded(!0),i.fire(new t.Event("data",{dataType:"style"}))}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var a=Bt(this.stylesheet.layers);this._order=a.map(function(t){return t.id}),this._layers={};for(var o=0,s=a;o<s.length;o+=1){var u=s[o];(u=t.createStyleLayer(u)).setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new b(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},n.prototype._validateLayer=function(e){var n=this.sourceCaches[e.source];if(n){var i=e.sourceLayer;if(i){var r=n.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+i+'" does not exist on source "'+r.id+'" as specified by style layer "'+e.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(t){for(var e=[],n=0,i=t;n<i.length;n+=1){var r=i[n],a=this._layers[r];"custom"!==a.type&&e.push(a.serialize())}return e},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(e){if(this._loaded){var n=this._changed;if(this._changed){var i=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);for(var a in(i.length||r.length)&&this._updateWorkerLayers(i,r),this._updatedSources){var o=this._updatedSources[a];"reload"===o?this._reloadSource(a):"clear"===o&&this._clearSource(a)}for(var s in this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}for(var u in this.sourceCaches)this.sourceCaches[u].used=!1;for(var l=0,c=this._order;l<c.length;l+=1){var h=c[l],f=this._layers[h];f.recalculate(e),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}},n.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},n.prototype.setState=function(e){var n=this;if(this._checkLoaded(),Le(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Bt(e.layers);var i=function(e,n){if(!e)return[{command:Rt.setStyle,args:[n]}];var i=[];try{if(!t.deepEqual(e.version,n.version))return[{command:Rt.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||i.push({command:Rt.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||i.push({command:Rt.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||i.push({command:Rt.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||i.push({command:Rt.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||i.push({command:Rt.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||i.push({command:Rt.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||i.push({command:Rt.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||i.push({command:Rt.setLight,args:[n.light]});var r={},a=[];!function(e,n,i,r){var a;for(a in n=n||{},e=e||{})e.hasOwnProperty(a)&&(n.hasOwnProperty(a)||Nt(a,i,r));for(a in n)n.hasOwnProperty(a)&&(e.hasOwnProperty(a)?t.deepEqual(e[a],n[a])||("geojson"===e[a].type&&"geojson"===n[a].type&&Vt(e,n,a)?i.push({command:Rt.setGeoJSONSourceData,args:[a,n[a].data]}):Ut(a,n,i,r)):Ft(a,n,i))}(e.sources,n.sources,a,r);var o=[];e.layers&&e.layers.forEach(function(t){r[t.source]?i.push({command:Rt.removeLayer,args:[t.id]}):o.push(t)}),i=i.concat(a),function(e,n,i){n=n||[];var r,a,o,s,u,l,c,h=(e=e||[]).map(Wt),f=n.map(Wt),p=e.reduce(Ht,{}),A=n.reduce(Ht,{}),d=h.slice(),v=Object.create(null);for(r=0,a=0;r<h.length;r++)o=h[r],A.hasOwnProperty(o)?a++:(i.push({command:Rt.removeLayer,args:[o]}),d.splice(d.indexOf(o,a),1));for(r=0,a=0;r<f.length;r++)o=f[f.length-1-r],d[d.length-1-r]!==o&&(p.hasOwnProperty(o)?(i.push({command:Rt.removeLayer,args:[o]}),d.splice(d.lastIndexOf(o,d.length-a),1)):a++,l=d[d.length-r],i.push({command:Rt.addLayer,args:[A[o],l]}),d.splice(d.length-r,0,o),v[o]=!0);for(r=0;r<f.length;r++)if(s=p[o=f[r]],u=A[o],!v[o]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in Gt(s.layout,u.layout,i,o,null,Rt.setLayoutProperty),Gt(s.paint,u.paint,i,o,null,Rt.setPaintProperty),t.deepEqual(s.filter,u.filter)||i.push({command:Rt.setFilter,args:[o,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||i.push({command:Rt.setLayerZoomRange,args:[o,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Gt(s[c],u[c],i,o,c.slice(6),Rt.setPaintProperty):t.deepEqual(s[c],u[c])||i.push({command:Rt.setLayerProperty,args:[o,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Gt(s[c],u[c],i,o,c.slice(6),Rt.setPaintProperty):t.deepEqual(s[c],u[c])||i.push({command:Rt.setLayerProperty,args:[o,c,u[c]]}))}else i.push({command:Rt.removeLayer,args:[o]}),l=d[d.lastIndexOf(o)+1],i.push({command:Rt.addLayer,args:[u,l]})}(o,n.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:Rt.setStyle,args:[n]}]}return i}(this.serialize(),e).filter(function(t){return!(t.command in ze)});if(0===i.length)return!1;var r=i.filter(function(t){return!(t.command in Ie)});if(r.length>0)throw new Error("Unimplemented: "+r.map(function(t){return t.command}).join(", ")+".");return i.forEach(function(t){"setTransition"!==t.command&&n[t.command].apply(n,t.args)}),this.stylesheet=e,!0},n.prototype.addImage=function(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},n.prototype.getImage=function(t){return this.imageManager.getImage(t)},n.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(e,n,i){var r=this;if(void 0===i&&(i={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,i))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var a=this.sourceCaches[e]=new Ct(e,n,this.dispatcher);a.style=this,a.setEventedParent(this,function(){return{isSourceLoaded:r.loaded(),source:a.serialize(),sourceId:e}}),a.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+n+'" is using it.')));var i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},n.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},n.prototype.addLayer=function(e,n,i){void 0===i&&(i={}),this._checkLoaded();var r=e.id;if(this.getLayer(r))this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" already exists on this map')));else{var a;if("custom"===e.type){if(Le(this,t.validateCustomStyleLayer(e)))return;a=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$1(e),e=t.extend(e,{source:r})),this._validate(t.validateStyle.layer,"layers."+r,e,{arrayIndex:-1},i))return;a=t.createStyleLayer(e),this._validateLayer(a),a.setEventedParent(this,{layer:{id:r}})}var o=n?this._order.indexOf(n):this._order.length;if(n&&-1===o)this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=a,this._removedLayers[r]&&a.source&&"custom"!==a.type){var s=this._removedLayers[r];delete this._removedLayers[r],s.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}},n.prototype.moveLayer=function(e,n){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==n){var i=this._order.indexOf(e);this._order.splice(i,1);var r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(r,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(e){this._checkLoaded();var n=this._layers[e];if(n){n.setEventedParent(null);var i=this._order.indexOf(e);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(t){return this._layers[t]},n.prototype.setLayerZoomRange=function(e,n,i){this._checkLoaded();var r=this.getLayer(e);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(e,n,i){void 0===i&&(i={}),this._checkLoaded();var r=this.getLayer(e);if(r){if(!t.deepEqual(r.filter,n))return null==n?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(t.validateStyle.filter,"layers."+r.id+".filter",n,null,i)||(r.filter=t.clone$1(n),this._updateLayer(r)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},n.prototype.setLayoutProperty=function(e,n,i,r){void 0===r&&(r={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getLayoutProperty(n),i)||(a.setLayoutProperty(n,i,r),this._updateLayer(a)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(e,n){var i=this.getLayer(e);if(i)return i.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(e,n,i,r){void 0===r&&(r={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getPaintProperty(n),i)||(a.setPaintProperty(n,i,r)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},n.prototype.setFeatureState=function(e,n){this._checkLoaded();var i=e.source,r=e.sourceLayer,a=this.sourceCaches[i],o=parseInt(e.id,10);if(void 0!==a){var s=a.getSource().type;"geojson"===s&&r?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||r?isNaN(o)||o<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative."))):a.setFeatureState(r,o,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(e,n){this._checkLoaded();var i=e.source,r=this.sourceCaches[i];if(void 0!==r){var a=r.getSource().type,o="vector"===a?e.sourceLayer:void 0,s=parseInt(e.id,10);"vector"!==a||o?void 0!==e.id&&isNaN(s)||s<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be non-negative."))):n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):r.removeFeatureState(o,s,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(e){this._checkLoaded();var n=e.source,i=e.sourceLayer,r=this.sourceCaches[n],a=parseInt(e.id,10);if(void 0!==r)if("vector"!==r.getSource().type||i){if(!(isNaN(a)||a<0))return r.getFeatureState(i,a);this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative.")))}else this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._serializeLayers(this._order)},function(t){return void 0!==t})},n.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,n=function(t){return"fill-extrusion"===e._layers[t].type},i={},r=[],a=this._order.length-1;a>=0;a--){var o=this._order[a];if(n(o)){i[o]=a;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][o];if(l)for(var c=0,h=l;c<h.length;c+=1){var f=h[c];r.push(f)}}}}r.sort(function(t,e){return e.intersectionZ-t.intersectionZ});for(var p=[],A=this._order.length-1;A>=0;A--){var d=this._order[A];if(n(d))for(var v=r.length-1;v>=0;v--){var g=r[v].feature;if(i[g.layer.id]<A)break;p.push(g),r.pop()}else for(var m=0,y=t;m<y.length;m+=1){var _=y[m][d];if(_)for(var b=0,x=_;b<x.length;b+=1){var w=x[b];p.push(w.feature)}}}return p},n.prototype.queryRenderedFeatures=function(e,n,i){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter);var r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var a=0,o=n.layers;a<o.length;a+=1){var s=o[a],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];r[u.source]=!0}}var l=[];for(var c in this.sourceCaches)n.layers&&!r[c]||l.push(D(this.sourceCaches[c],this._layers,e,n,i));return this.placement&&l.push(function(t,e,n,i,r,a){for(var o={},s=r.queryRenderedSymbols(n),u=[],l=0,c=Object.keys(s).map(Number);l<c.length;l+=1){var h=c[l];u.push(a[h])}u.sort(B);for(var f=function(){var e=A[p],n=e.featureIndex.lookupSymbolFeatures(s[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,i.filter,i.layers,t);for(var r in n){var a=o[r]=o[r]||[],u=n[r];u.sort(function(t,n){var i=e.featureSortOrder;if(i){var r=i.indexOf(t.featureIndex);return i.indexOf(n.featureIndex)-r}return n.featureIndex-t.featureIndex});for(var l=0,c=u;l<c.length;l+=1){var h=c[l];a.push(h)}}},p=0,A=u;p<A.length;p+=1)f();var d=function(n){o[n].forEach(function(i){var r=i.feature,a=t[n],o=e[a.source].getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o})};for(var v in o)d(v);return o}(this._layers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},n.prototype.querySourceFeatures=function(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter);var i=this.sourceCaches[e];return i?function(t,e){for(var n=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),i=[],r={},a=0;a<n.length;a++){var o=n[a],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(i,e))}return i}(i,n):[]},n.prototype.addSourceType=function(t,e,i){return n.getSourceType(t)?i(new Error('A source type called "'+t+'" already exists.')):(n.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(e,n){void 0===n&&(n={}),this._checkLoaded();var i=this.light.getLight(),r=!1;for(var a in e)if(!t.deepEqual(e[a],i[a])){r=!0;break}if(r){var o={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(o)}},n.prototype._validate=function(e,n,i,r,a){return void 0===a&&(a={}),(!a||!1!==a.validate)&&Le(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:i,styleSpec:t.styleSpec},r)))},n.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[e].clearTiles();this.dispatcher.remove()},n.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},n.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},n.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},n.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},n.prototype._updatePlacement=function(e,n,i,r){for(var a=!1,o=!1,s={},u=0,l=this._order;u<l.length;u+=1){var c=l[u],h=this._layers[c];if("symbol"===h.type){if(!s[h.source]){var f=this.sourceCaches[h.source];s[h.source]=f.getRenderableIds(!0).map(function(t){return f.getTileByID(t)}).sort(function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)})}var p=this.crossTileSymbolIndex.addLayer(h,s[h.source],e.center.lng);a=a||p}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var A=this._layerOrderChanged||0===i;if((A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now()))&&(this.pauseablePlacement=new Pe(e,this._order,A,n,i,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),o=!0),a&&this.pauseablePlacement.placement.setStale()),o||a)for(var d=0,v=this._order;d<v.length;d+=1){var g=v[d],m=this._layers[g];"symbol"===m.type&&this.placement.updateLayerOpacities(m,s[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},n.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n)},n.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},n.prototype.getResource=function(e,n,i){return t.makeRequest(n,i)},n}(t.Evented);De.getSourceType=function(t){return L[t]},De.setSourceType=function(t,e){L[t]=e},De.registerForPluginAvailability=t.registerForPluginAvailability;var Be=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),Re=cn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Fe=cn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ne=cn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ue=cn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvarying vec3 v_data;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvarying vec3 v_data;void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ve=cn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ge=cn("#pragma mapbox: define highp float weight\nuniform highp float u_intensity;varying vec2 v_extrude;\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;const highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),We=cn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),He=cn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),qe=cn("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {color=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}"),Ze=cn("uniform highp vec4 u_color;void main() {gl_FragColor=u_color;}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Xe=cn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),Qe=cn("#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_pos;void main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Ye=cn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Ke=cn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),Je=cn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),$e=cn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec4 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),tn=cn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;return (data.r+data.g*256.0+data.b*256.0*256.0)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),en=cn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),nn=cn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),rn=cn("#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nuniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;void main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define MAX_LINE_DISTANCE 32767.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),an=cn("uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec4 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x,1.0);float x_b=mod(v_linesofar/pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_a.y+2.0)/2.0)/pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_b.y+2.0)/2.0)/pattern_size_b.y);vec2 pos_a=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_gl_units_to_pixels;uniform mediump float u_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}"),on=cn("uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),sn=cn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),un=cn("uniform sampler2D u_texture;\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;void main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;\n#pragma mapbox: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;void main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),ln=cn("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;void main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;void main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}");function cn(t,e){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i={};return{fragmentSource:t=t.replace(n,function(t,e,n,r,a){return i[a]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+a+"\nvarying "+n+" "+r+" "+a+";\n#else\nuniform "+n+" "+r+" u_"+a+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+a+"\n    "+n+" "+r+" "+a+" = u_"+a+";\n#endif\n"}),vertexSource:e=e.replace(n,function(t,e,n,r,a){var o="float"===r?"vec2":"vec4",s=a.match(/color/)?"color":o;return i[a]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+a+"\nuniform lowp float a_"+a+"_t;\nattribute "+n+" "+o+" a_"+a+";\nvarying "+n+" "+r+" "+a+";\n#else\nuniform "+n+" "+r+" u_"+a+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+a+" = a_"+a+";\n#else\n    "+n+" "+r+" "+a+" = u_"+a+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+a+" = unpack_mix_"+s+"(a_"+a+", a_"+a+"_t);\n#else\n    "+n+" "+r+" "+a+" = u_"+a+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+a+"\nuniform lowp float a_"+a+"_t;\nattribute "+n+" "+o+" a_"+a+";\n#else\nuniform "+n+" "+r+" u_"+a+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+n+" "+r+" "+a+" = a_"+a+";\n#else\n    "+n+" "+r+" "+a+" = u_"+a+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+n+" "+r+" "+a+" = unpack_mix_"+s+"(a_"+a+", a_"+a+"_t);\n#else\n    "+n+" "+r+" "+a+" = u_"+a+";\n#endif\n"})}}var hn=Object.freeze({prelude:Re,background:Fe,backgroundPattern:Ne,circle:Ue,clippingMask:Ve,heatmap:Ge,heatmapTexture:We,collisionBox:He,collisionCircle:qe,debug:Ze,fill:Xe,fillOutline:Qe,fillOutlinePattern:Ye,fillPattern:Ke,fillExtrusion:Je,fillExtrusionPattern:$e,hillshadePrepare:tn,hillshade:en,line:nn,lineGradient:rn,linePattern:an,lineSDF:on,raster:sn,symbolIcon:un,symbolSDF:ln}),fn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};fn.prototype.bind=function(t,e,n,i,r,a,o,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==i.length,l=0;!u&&l<i.length;l++)this.boundPaintVertexBuffers[l]!==i[l]&&(u=!0);var c=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==n||u||this.boundIndexBuffer!==r||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==o||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||c?this.freshBind(e,n,i,r,a,o,s):(t.bindVertexArrayOES.set(this.vao),o&&o.bind(),r&&r.dynamicDraw&&r.bind(),s&&s.bind())},fn.prototype.freshBind=function(t,e,n,i,r,a,o){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var f=0,p=n;f<p.length;f+=1)p[f].enableAttributes(c,t);a&&a.enableAttributes(c,t),o&&o.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,r);for(var A=0,d=n;A<d.length;A+=1){var v=d[A];v.bind(),v.setVertexAttribPointers(c,t,r)}a&&(a.bind(),a.setVertexAttribPointers(c,t,r)),i&&i.bind(),o&&(o.bind(),o.setVertexAttribPointers(c,t,r)),l.currentNumAttributes=u},fn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var pn=function(e,n,i,r,a){var o=e.gl;this.program=o.createProgram();var s=i.defines().concat("#define DEVICE_PIXEL_RATIO "+t.browser.devicePixelRatio.toFixed(1));a&&s.push("#define OVERDRAW_INSPECTOR;");var u=s.concat(Re.fragmentSource,n.fragmentSource).join("\n"),l=s.concat(Re.vertexSource,n.vertexSource).join("\n"),c=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(c,u),o.compileShader(c),o.attachShader(this.program,c);var h=o.createShader(o.VERTEX_SHADER);o.shaderSource(h,l),o.compileShader(h),o.attachShader(this.program,h);for(var f=i.layoutAttributes||[],p=0;p<f.length;p++)o.bindAttribLocation(this.program,p,f[p].name);o.linkProgram(this.program),this.numAttributes=o.getProgramParameter(this.program,o.ACTIVE_ATTRIBUTES),this.attributes={};for(var A={},d=0;d<this.numAttributes;d++){var v=o.getActiveAttrib(this.program,d);v&&(this.attributes[v.name]=o.getAttribLocation(this.program,v.name))}for(var g=o.getProgramParameter(this.program,o.ACTIVE_UNIFORMS),m=0;m<g;m++){var y=o.getActiveUniform(this.program,m);y&&(A[y.name]=o.getUniformLocation(this.program,y.name))}this.fixedUniforms=r(e,A),this.binderUniforms=i.getUniforms(e,A)};function An(e,n,i){var r=1/le(i,1,n.transform.tileZoom),a=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,n.transform.tileZoom)/a,s=o*(i.tileID.canonical.x+i.tileID.wrap*a),u=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[t.browser.devicePixelRatio,r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,u>>16],u_pixel_coord_lower:[65535&s,65535&u]}}pn.prototype.draw=function(t,e,n,i,r,a,o,s,u,l,c,h,f,p,A,d){var v,g=t.gl;for(var m in t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(i),t.setColorMode(r),t.setCullFace(a),this.fixedUniforms)this.fixedUniforms[m].set(o[m]);p&&p.setUniforms(t,this.binderUniforms,h,{zoom:f});for(var y=(v={},v[g.LINES]=2,v[g.TRIANGLES]=3,v[g.LINE_STRIP]=1,v)[e],_=0,b=c.get();_<b.length;_+=1){var x=b[_],w=x.vaos||(x.vaos={});(w[s]||(w[s]=new fn)).bind(t,this,u,p?p.getPaintVertexBuffers():[],l,x.vertexOffset,A,d),g.drawElements(e,x.primitiveLength*y,g.UNSIGNED_SHORT,x.primitiveOffset*y*2)}};var dn=function(e,n,i,r){var a=n.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],u=t.create$1();"viewport"===a.properties.get("anchor")&&t.fromRotation(u,-n.transform.angle),t.transformMat3(s,s,u);var l=a.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+i,u_opacity:r}},vn=function(e,n,i,r,a,o,s){return t.extend(dn(e,n,i,r),An(o,n,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8})},gn=function(t){return{u_matrix:t}},mn=function(e,n,i,r){return t.extend(gn(e),An(i,n,r))},yn=function(t,e){return{u_matrix:t,u_world:e}},_n=function(e,n,i,r,a){return t.extend(mn(e,n,i,r),{u_world:a})},bn=function(t,e,n,i){var r,a,o=t.transform;if("map"===i.paint.get("circle-pitch-alignment")){var s=le(n,1,o.zoom);r=!0,a=[s,s]}else r=!1,a=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,n,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+r,u_extrude_scale:a}},xn=function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}},wn=function(t,e,n){var i=le(n,1,e.zoom),r=Math.pow(2,e.zoom-n.tileID.overscaledZ),a=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:i,u_extrude_scale:[e.pixelsToGLUnits[0]/(i*r),e.pixelsToGLUnits[1]/(i*r)],u_overscale_factor:a}},Sn=function(t,e){return{u_matrix:t,u_color:e}},kn=function(t){return{u_matrix:t}},On=function(t,e,n,i){return{u_matrix:t,u_extrude_scale:le(e,1,n),u_intensity:i}},Pn=function(t,e,n){var i=n.paint.get("hillshade-shadow-color"),r=n.paint.get("hillshade-highlight-color"),a=n.paint.get("hillshade-accent-color"),o=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(o-=t.transform.angle);var s=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),s),u_image:0,u_latrange:Cn(0,e.tileID),u_light:[n.paint.get("hillshade-exaggeration"),o],u_shadow:i,u_highlight:r,u_accent:a}},En=function(e,n){var i=e.dem.stride,r=t.create();return t.ortho(r,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(r,r,[0,-t.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:e.tileID.overscaledZ,u_maxzoom:n}};function Cn(e,n){var i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new t.MercatorCoordinate(0,r/i).toLngLat().lat,new t.MercatorCoordinate(0,(r+1)/i).toLngLat().lat]}var Tn=function(t,e,n){var i=t.transform;return{u_matrix:zn(t,e,n),u_ratio:1/le(e,1,i.zoom),u_gl_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Mn=function(e,n,i){return t.extend(Tn(e,n,i),{u_image:0})},jn=function(e,n,i,r){var a=e.transform,o=In(n,a);return{u_matrix:zn(e,n,i),u_texsize:n.imageAtlasTexture.size,u_ratio:1/le(n,1,a.zoom),u_image:0,u_scale:[t.browser.devicePixelRatio,o,r.fromScale,r.toScale],u_fade:r.t,u_gl_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Ln=function(e,n,i,r,a){var o=e.transform,s=e.lineAtlas,u=In(n,o),l="round"===i.layout.get("line-cap"),c=s.getDash(r.from,l),h=s.getDash(r.to,l),f=c.width*a.fromScale,p=h.width*a.toScale;return t.extend(Tn(e,n,i),{u_patternscale_a:[u/f,-c.height/2],u_patternscale_b:[u/p,-h.height/2],u_sdfgamma:s.width/(256*Math.min(f,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:h.y,u_mix:a.t})};function In(t,e){return 1/le(t,1,e.tileZoom)}function zn(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Dn=function(t,e,n,i,r){return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(o=r.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=r.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:Bn(r.paint.get("raster-hue-rotate"))};var a,o};function Bn(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}var Rn=function(t,e,n,i,r,a,o,s,u,l){var c=r.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:c.width/c.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_gl_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+i,u_texsize:l,u_texture:0}},Fn=function(e,n,i,r,a,o,s,u,l,c,h){var f=a.transform;return t.extend(Rn(e,n,i,r,a,o,s,u,l,c),{u_gamma_scale:r?Math.cos(f._pitch)*f.cameraToCenterDistance:1,u_is_halo:+h})},Nn=function(t,e,n){return{u_matrix:t,u_opacity:e,u_color:n}},Un=function(e,n,i,r,a,o){return t.extend(function(t,e,n,i){var r=n.imageManager.getPattern(t.from),a=n.imageManager.getPattern(t.to),o=n.imageManager.getPixelSize(),s=o.width,u=o.height,l=Math.pow(2,i.tileID.overscaledZ),c=i.tileSize*Math.pow(2,n.transform.tileZoom)/l,h=c*(i.tileID.canonical.x+i.tileID.wrap*l),f=c*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/le(i,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,f>>16],u_pixel_coord_lower:[65535&h,65535&f]}}(r,o,i,a),{u_matrix:e,u_opacity:n})},Vn={fillExtrusion:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fillExtrusionPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fill:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},fillPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},fillOutline:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}},fillOutlinePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},circle:function(e,n){return{u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},collisionBox:xn,collisionCircle:xn,debug:function(e,n){return{u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},clippingMask:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmap:function(e,n){return{u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmapTexture:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}},hillshade:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}},hillshadePrepare:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_maxzoom:new t.Uniform1f(e,n.u_maxzoom)}},line:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,n.u_gl_units_to_pixels)}},lineGradient:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,n.u_gl_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image)}},linePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_image:new t.Uniform1i(e,n.u_image),u_gl_units_to_pixels:new t.Uniform2f(e,n.u_gl_units_to_pixels),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},lineSDF:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,n.u_gl_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}},raster:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}},symbolIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_gl_coord_matrix:new t.UniformMatrix4f(e,n.u_gl_coord_matrix),u_is_text:new t.Uniform1f(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}},symbolSDF:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_gl_coord_matrix:new t.UniformMatrix4f(e,n.u_gl_coord_matrix),u_is_text:new t.Uniform1f(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_is_halo:new t.Uniform1f(e,n.u_is_halo)}},background:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}},backgroundPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}}};function Gn(e,n){for(var i=e.sort(function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0}),r=0;r<i.length;r++){var a={},o=i[r],s=i.slice(r+1);Wn(o.tileID.wrapped(),o.tileID,s,new t.OverscaledTileID(0,o.tileID.wrap+1,0,0,0),a),o.setMask(a,n)}}function Wn(e,n,i,r,a){for(var o=0;o<i.length;o++){var s=i[o];if(r.isLessThan(s.tileID))break;if(n.key===s.tileID.key)return;if(s.tileID.isChildOf(n)){for(var u=n.children(1/0),l=0;l<u.length;l++)Wn(e,u[l],i.slice(o),r,a);return}}var c=n.overscaledZ-e.overscaledZ,h=new t.CanonicalTileID(c,n.canonical.x-(e.canonical.x<<c),n.canonical.y-(e.canonical.y<<c));a[h.key]=a[h.key]||h}function Hn(t,e,n,i,r){for(var a=t.context,o=a.gl,s=r?t.useProgram("collisionCircle"):t.useProgram("collisionBox"),u=0;u<i.length;u++){var l=i[u],c=e.getTile(l),h=c.getBucket(n);if(h){var f=r?h.collisionCircle:h.collisionBox;f&&s.draw(a,r?o.TRIANGLES:o.LINES,St.disabled,kt.disabled,t.colorModeForRenderPass(),Pt.disabled,wn(l.posMatrix,t.transform,c),n.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,null,t.transform.zoom,null,null,f.collisionVertexBuffer)}}}var qn=t.identity(new Float32Array(16)),Zn=t.properties.layout;function Xn(e,n,i,r,a,o){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*n,l=-(s.verticalAlign-.5)*i,c=t.evaluateRadialOffset(e,r);return new t.Point((u/a+c[0])*o,(l/a+c[1])*o)}function Qn(e,n,i,r,a,o,s,u,l,c){var h=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray;f.clear();for(var p=0;p<h.length;p++){var A=h.get(p),d=!A.hidden&&A.crossTileID?r[A.crossTileID]:null;if(d){var v=new t.Point(A.anchorX,A.anchorY),g=Yt(v,i?u:s),m=.5+o.cameraToCenterDistance/g.signedDistanceFromCamera*.5,y=a.evaluateSizeForFeature(e.textSizeData,c,A)*m/t.ONE_EM;i&&(y*=e.tilePixelRatio/l);for(var _=d.width,b=d.height,x=d.radialOffset,w=d.textBoxScale,S=Xn(d.anchor,_,b,x,w,y),k=i?Yt(v.add(S),s).point:g.point.add(n?S.rotate(-o.angle):S),O=0;O<A.numGlyphs;O++)t.addDynamicAttributes(f,k,0)}else ae(A.numGlyphs,f)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function Yn(e,n,i,r,a,o,s,u,l,c,h,f,p){for(var A,d,v=e.context,g=v.gl,m=e.transform,y="map"===u,_="map"===l,b=y&&"point"!==i.layout.get("symbol-placement"),x=y&&!_&&!b,w=void 0!==i.layout.get("symbol-sort-key").constantOr(1),S=e.depthModeForSublayer(0,St.ReadOnly),k=i.layout.get("text-variable-anchor"),O=[],P=0,E=r;P<E.length;P+=1){var C=E[P],T=n.getTile(C),M=T.getBucket(i);if(M){var j=a?M.text:M.icon;if(j&&j.segments.get().length){var L=j.programConfigurations.get(i.id),I=a||M.sdfIcons,z=a?M.textSizeData:M.iconSizeData;A||(A=e.useProgram(I?"symbolSDF":"symbolIcon",L),d=t.evaluateSizeForZoom(z,m.zoom,Zn.properties[a?"text-size":"icon-size"])),v.activeTexture.set(g.TEXTURE0);var D=void 0,B=void 0,R=void 0;if(a)B=T.glyphAtlasTexture,R=g.LINEAR,D=T.glyphAtlasTexture.size;else{var F=1!==i.layout.get("icon-size").constantOr(0)||M.iconsNeedLinear,N=_||0!==m.pitch;B=T.imageAtlasTexture,R=I||e.options.rotating||e.options.zooming||F||N?g.LINEAR:g.NEAREST,D=T.imageAtlasTexture.size}var U=le(T,1,e.transform.zoom),V=Xt(C.posMatrix,_,y,e.transform,U),G=Qt(C.posMatrix,_,y,e.transform,U);if(b)Jt(M,C.posMatrix,e,a,V,G,_,c);else if(a&&d&&k){var W=Math.pow(2,m.zoom-T.tileID.overscaledZ);Qn(M,y,_,p,t.symbolSize,m,V,C.posMatrix,W,d)}var H=e.translatePosMatrix(C.posMatrix,T,o,s),q=b||a&&k?qn:V,Z=e.translatePosMatrix(G,T,o,s,!0),X=I&&0!==i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),Q={program:A,buffers:j,uniformValues:I?Fn(z.functionType,d,x,_,e,H,q,Z,a,D,!0):Rn(z.functionType,d,x,_,e,H,q,Z,a,D),atlasTexture:B,atlasInterpolation:R,isSDF:I,hasHalo:X};if(w)for(var Y=0,K=j.segments.get();Y<K.length;Y+=1){var J=K[Y];O.push({segments:new t.SegmentVector([J]),sortKey:J.sortKey,state:Q})}else O.push({segments:j.segments,sortKey:0,state:Q})}}}w&&O.sort(function(t,e){return t.sortKey-e.sortKey});for(var $=0,tt=O;$<tt.length;$+=1){var et=tt[$],nt=et.state;if(nt.atlasTexture.bind(nt.atlasInterpolation,g.CLAMP_TO_EDGE),nt.isSDF){var it=nt.uniformValues;nt.hasHalo&&(it.u_is_halo=1,Kn(nt.buffers,et.segments,i,e,nt.program,S,h,f,it)),it.u_is_halo=0}Kn(nt.buffers,et.segments,i,e,nt.program,S,h,f,nt.uniformValues)}}function Kn(t,e,n,i,r,a,o,s,u){var l=i.context,c=l.gl;r.draw(l,c.TRIANGLES,a,o,s,Pt.disabled,u,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Jn(t,e,n,i,r,a,o){var s,u,l,c,h,f=t.context.gl,p=n.paint.get("fill-pattern"),A=p&&p.constantOr(1),d=n.getCrossfadeParameters();o?(u=A&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=f.LINES):(u=A?"fillPattern":"fill",s=f.TRIANGLES);for(var v=0,g=i;v<g.length;v+=1){var m=g[v],y=e.getTile(m);if(!A||y.patternsLoaded()){var _=y.getBucket(n);if(_){var b=_.programConfigurations.get(n.id),x=t.useProgram(u,b);A&&(t.context.activeTexture.set(f.TEXTURE0),y.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),b.updatePatternPaintBuffers(d));var w=p.constantOr(null);if(w&&y.imageAtlas){var S=y.imageAtlas.patternPositions[w.to],k=y.imageAtlas.patternPositions[w.from];S&&k&&b.setConstantPatternPositions(S,k)}var O=t.translatePosMatrix(m.posMatrix,y,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(o){c=_.indexBuffer2,h=_.segments2;var P=[f.drawingBufferWidth,f.drawingBufferHeight];l="fillOutlinePattern"===u&&A?_n(O,t,d,y,P):yn(O,P)}else c=_.indexBuffer,h=_.segments,l=A?mn(O,t,d,y):gn(O);x.draw(t.context,s,r,t.stencilModeForClipping(m),a,Pt.disabled,l,n.id,_.layoutVertexBuffer,c,h,n.paint,t.transform.zoom,b)}}}}function $n(t,e,n,i,r,a,o){for(var s=t.context,u=s.gl,l=n.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=n.getCrossfadeParameters(),f=n.paint.get("fill-extrusion-opacity"),p=0,A=i;p<A.length;p+=1){var d=A[p],v=e.getTile(d),g=v.getBucket(n);if(g){var m=g.programConfigurations.get(n.id),y=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",m);c&&(t.context.activeTexture.set(u.TEXTURE0),v.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),m.updatePatternPaintBuffers(h));var _=l.constantOr(null);if(_&&v.imageAtlas){var b=v.imageAtlas.patternPositions[_.to],x=v.imageAtlas.patternPositions[_.from];b&&x&&m.setConstantPatternPositions(b,x)}var w=t.translatePosMatrix(d.posMatrix,v,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),S=n.paint.get("fill-extrusion-vertical-gradient"),k=c?vn(w,t,S,f,d,h,v):dn(w,t,S,f);y.draw(s,s.gl.TRIANGLES,r,a,o,Pt.backCCW,k,n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,t.transform.zoom,m)}}}function ti(t,e,n,i,r,a){var o=t.context,s=o.gl,u=e.fbo;if(u){var l=t.useProgram("hillshade");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get());var c=Pn(t,e,n);e.maskedBoundsBuffer&&e.maskedIndexBuffer&&e.segments?l.draw(o,s.TRIANGLES,i,r,a,Pt.disabled,c,n.id,e.maskedBoundsBuffer,e.maskedIndexBuffer,e.segments):l.draw(o,s.TRIANGLES,i,r,a,Pt.disabled,c,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function ei(e,n,i,r,a,o,s){var u=e.context,l=u.gl;if(n.dem&&n.dem.data){var c=n.dem.dim,h=n.dem.stride,f=n.dem.getPixels();if(u.activeTexture.set(l.TEXTURE1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(h),n.demTexture){var p=n.demTexture;p.update(f,{premultiply:!1}),p.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else n.demTexture=new t.Texture(u,f,l.RGBA,{premultiply:!1}),n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);u.activeTexture.set(l.TEXTURE0);var A=n.fbo;if(!A){var d=new t.Texture(u,{width:c,height:c,data:null},l.RGBA);d.bind(l.LINEAR,l.CLAMP_TO_EDGE),(A=n.fbo=u.createFramebuffer(c,c)).colorAttachment.set(d.texture)}u.bindFramebuffer.set(A.framebuffer),u.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(u,l.TRIANGLES,a,o,s,Pt.disabled,En(n,r),i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function ni(e,n,i,r,a){var o=r.paint.get("raster-fade-duration");if(o>0){var s=t.browser.now(),u=(s-e.timeAdded)/o,l=n?(s-n.timeAdded)/o:-1,c=i.getSource(),h=a.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),f=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),p=f&&e.refreshedUponExpiration?1:t.clamp(f?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}function ii(e,n,i){var r=e.context,a=r.gl,o=i.posMatrix,s=e.useProgram("debug"),u=St.disabled,l=kt.disabled,c=e.colorModeForRenderPass(),h="$debug";s.draw(r,a.LINE_STRIP,u,l,c,Pt.disabled,Sn(o,t.Color.red),h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);for(var f=n.getTileByID(i.key).latestRawTileData,p=f&&f.byteLength||0,A=Math.floor(p/1024),d=function(t,e,n,i){i=i||1;var r,a,o,s,u,l,c,h,f=[];for(r=0,a=t.length;r<a;r++)if(u=ri[t[r]]){for(h=null,o=0,s=u[1].length;o<s;o+=2)-1===u[1][o]&&-1===u[1][o+1]?h=null:(l=e+u[1][o]*i,c=200-u[1][o+1]*i,h&&f.push(h.x,h.y,l,c),h={x:l,y:c});e+=u[0]*i}return f}(i.toString()+" "+A+"kb",50,0,5),v=new t.StructArrayLayout2i4,g=new t.StructArrayLayout2ui4,m=0;m<d.length;m+=2)v.emplaceBack(d[m],d[m+1]),g.emplaceBack(m,m+1);for(var y=r.createVertexBuffer(v,Be.members),_=r.createIndexBuffer(g),b=t.SegmentVector.simpleSegment(0,0,v.length/2,v.length/2),x=n.getTile(i).tileSize,w=t.EXTENT/(Math.pow(2,e.transform.zoom-i.overscaledZ)*x),S=[[-1,-1],[-1,1],[1,-1],[1,1]],k=0;k<S.length;k++){var O=S[k];s.draw(r,a.LINES,u,l,c,Pt.disabled,Sn(t.translate([],o,[w*O[0],w*O[1],0]),t.Color.white),h,y,_,b)}s.draw(r,a.LINES,u,l,c,Pt.disabled,Sn(o,t.Color.black),h,y,_,b)}var ri={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]},ai={symbol:function(t,e,n,i,r){if("translucent"===t.renderPass){var a=kt.disabled,o=t.colorModeForRenderPass();0!==n.paint.get("icon-opacity").constantOr(1)&&Yn(t,e,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),a,o,r),0!==n.paint.get("text-opacity").constantOr(1)&&Yn(t,e,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),a,o,r),e.map.showCollisionBoxes&&function(t,e,n,i){Hn(t,e,n,i,!1),Hn(t,e,n,i,!0)}(t,e,n,i)}},circle:function(t,e,n,i){if("translucent"===t.renderPass){var r=n.paint.get("circle-opacity"),a=n.paint.get("circle-stroke-width"),o=n.paint.get("circle-stroke-opacity");if(0!==r.constantOr(1)||0!==a.constantOr(1)&&0!==o.constantOr(1))for(var s=t.context,u=s.gl,l=t.depthModeForSublayer(0,St.ReadOnly),c=kt.disabled,h=t.colorModeForRenderPass(),f=0;f<i.length;f++){var p=i[f],A=e.getTile(p),d=A.getBucket(n);if(d){var v=d.programConfigurations.get(n.id);t.useProgram("circle",v).draw(s,u.TRIANGLES,l,c,h,Pt.disabled,bn(t,p,A,n),n.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,n.paint,t.transform.zoom,v)}}}},heatmap:function(e,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var a=e.context,o=a.gl,s=e.depthModeForSublayer(0,St.ReadOnly),u=kt.disabled,l=new Ot([o.ONE,o.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){var i=t.gl;t.activeTexture.set(i.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var r=n.heatmapFbo;if(r)i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),t.bindFramebuffer.set(r.framebuffer);else{var a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),r=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,n,i,r){var a=e.gl;a.texImage2D(a.TEXTURE_2D,0,a.RGBA,n.width/4,n.height/4,0,a.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:a.UNSIGNED_BYTE,null),r.colorAttachment.set(i),e.extTextureHalfFloat&&a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,r.colorAttachment.setDirty(),t(e,n,i,r))}(t,e,a,r)}}(a,e,i),a.clear({color:t.Color.transparent});for(var c=0;c<r.length;c++){var h=r[c];if(!n.hasRenderableParent(h)){var f=n.getTile(h),p=f.getBucket(i);if(p){var A=p.programConfigurations.get(i.id),d=e.useProgram("heatmap",A),v=e.transform.zoom;d.draw(a,o.TRIANGLES,s,u,l,Pt.disabled,On(h.posMatrix,f,v,i.paint.get("heatmap-intensity")),i.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,i.paint,e.transform.zoom,A)}}}a.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){var i=e.context,r=i.gl,a=n.heatmapFbo;if(a){i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);var o=n.colorRampTexture;o||(o=n.colorRampTexture=new t.Texture(i,n.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(i,r.TRIANGLES,St.disabled,kt.disabled,e.colorModeForRenderPass(),Pt.disabled,function(e,n,i,r){var a=t.create();t.ortho(a,0,e.width,e.height,0,0,1);var o=e.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:i,u_color_ramp:r,u_opacity:n.paint.get("heatmap-opacity")}}(e,n,0,1),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}}(e,i))},line:function(e,n,i,r){if("translucent"===e.renderPass){var a=i.paint.get("line-opacity"),o=i.paint.get("line-width");if(0!==a.constantOr(1)&&0!==o.constantOr(1)){var s=e.depthModeForSublayer(0,St.ReadOnly),u=e.colorModeForRenderPass(),l=i.paint.get("line-dasharray"),c=i.paint.get("line-pattern"),h=c.constantOr(1),f=i.paint.get("line-gradient"),p=i.getCrossfadeParameters(),A=l?"lineSDF":h?"linePattern":f?"lineGradient":"line",d=e.context,v=d.gl,g=!0;if(f){d.activeTexture.set(v.TEXTURE0);var m=i.gradientTexture;if(!i.gradient)return;m||(m=i.gradientTexture=new t.Texture(d,i.gradient,v.RGBA)),m.bind(v.LINEAR,v.CLAMP_TO_EDGE)}for(var y=0,_=r;y<_.length;y+=1){var b=_[y],x=n.getTile(b);if(!h||x.patternsLoaded()){var w=x.getBucket(i);if(w){var S=w.programConfigurations.get(i.id),k=e.context.program.get(),O=e.useProgram(A,S),P=g||O.program!==k,E=c.constantOr(null);if(E&&x.imageAtlas){var C=x.imageAtlas.patternPositions[E.to],T=x.imageAtlas.patternPositions[E.from];C&&T&&S.setConstantPatternPositions(C,T)}var M=l?Ln(e,x,i,l,p):h?jn(e,x,i,p):f?Mn(e,x,i):Tn(e,x,i);l&&(P||e.lineAtlas.dirty)?(d.activeTexture.set(v.TEXTURE0),e.lineAtlas.bind(d)):h&&(d.activeTexture.set(v.TEXTURE0),x.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),S.updatePatternPaintBuffers(p)),O.draw(d,v.TRIANGLES,s,e.stencilModeForClipping(b),u,Pt.disabled,M,i.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,i.paint,e.transform.zoom,S),g=!1}}}}}},fill:function(e,n,i,r){var a=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0!==o.constantOr(1)){var s=e.colorModeForRenderPass(),u=i.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===a.constantOr(t.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?St.ReadWrite:St.ReadOnly);Jn(e,n,i,r,c,s,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){var h=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);Jn(e,n,i,r,h,s,!0)}}},"fill-extrusion":function(t,e,n,i){var r=n.paint.get("fill-extrusion-opacity");if(0!==r&&"translucent"===t.renderPass){var a=new St(t.context.gl.LEQUAL,St.ReadWrite,t.depthRangeFor3D);if(1!==r||n.paint.get("fill-extrusion-pattern").constantOr(1))$n(t,e,n,i,a,kt.disabled,Ot.disabled),$n(t,e,n,i,a,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var o=t.colorModeForRenderPass();$n(t,e,n,i,a,kt.disabled,o)}}},hillshade:function(t,e,n,i){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var r=t.context,a=e.getSource().maxzoom,o=t.depthModeForSublayer(0,St.ReadOnly),s=kt.disabled,u=t.colorModeForRenderPass(),l=0,c=i;l<c.length;l+=1){var h=c[l],f=e.getTile(h);f.needsHillshadePrepare&&"offscreen"===t.renderPass?ei(t,f,n,a,o,s,u):"translucent"===t.renderPass&&ti(t,f,n,o,s,u)}r.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,i){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity"))for(var r=t.context,a=r.gl,o=e.getSource(),s=t.useProgram("raster"),u=kt.disabled,l=t.colorModeForRenderPass(),c=i.length&&i[0].overscaledZ,h=!t.options.moving,f=0,p=i;f<p.length;f+=1){var A=p[f],d=t.depthModeForSublayer(A.overscaledZ-c,1===n.paint.get("raster-opacity")?St.ReadWrite:St.ReadOnly,a.LESS),v=e.getTile(A),g=t.transform.calculatePosMatrix(A.toUnwrapped(),h);v.registerFadeDuration(n.paint.get("raster-fade-duration"));var m=e.findLoadedParent(A,0),y=ni(v,m,e,n,t.transform),_=void 0,b=void 0,x="nearest"===n.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;r.activeTexture.set(a.TEXTURE0),v.texture.bind(x,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(a.TEXTURE1),m?(m.texture.bind(x,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),_=Math.pow(2,m.tileID.overscaledZ-v.tileID.overscaledZ),b=[v.tileID.canonical.x*_%1,v.tileID.canonical.y*_%1]):v.texture.bind(x,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);var w=Dn(g,b||[0,0],_||1,y,n);o instanceof T?s.draw(r,a.TRIANGLES,d,u,l,Pt.disabled,w,n.id,o.boundsBuffer,t.quadTriangleIndexBuffer,o.boundsSegments):v.maskedBoundsBuffer&&v.maskedIndexBuffer&&v.segments?s.draw(r,a.TRIANGLES,d,u,l,Pt.disabled,w,n.id,v.maskedBoundsBuffer,v.maskedIndexBuffer,v.segments,n.paint,t.transform.zoom):s.draw(r,a.TRIANGLES,d,u,l,Pt.disabled,w,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){var i=n.paint.get("background-color"),r=n.paint.get("background-opacity");if(0!==r){var a=t.context,o=a.gl,s=t.transform,u=s.tileSize,l=n.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=l||1!==i.a||1!==r?"translucent":"opaque";if(t.renderPass===c){var h=kt.disabled,f=t.depthModeForSublayer(0,"opaque"===c?St.ReadWrite:St.ReadOnly),p=t.colorModeForRenderPass(),A=t.useProgram(l?"backgroundPattern":"background"),d=s.coveringTiles({tileSize:u});l&&(a.activeTexture.set(o.TEXTURE0),t.imageManager.bind(t.context));for(var v=n.getCrossfadeParameters(),g=0,m=d;g<m.length;g+=1){var y=m[g],_=t.transform.calculatePosMatrix(y.toUnwrapped()),b=l?Un(_,r,t,l,{tileID:y,tileSize:u},v):Nn(_,r,i);A.draw(a,o.TRIANGLES,f,h,p,Pt.disabled,b,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,n){for(var i=0;i<n.length;i++)ii(t,e,n[i])},custom:function(t,e,n){var i=t.context,r=n.implementation;if("offscreen"===t.renderPass){var a=r.prerender;a&&(t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),a.call(r,i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),i.setStencilMode(kt.disabled);var o="3d"===r.renderingMode?new St(t.context.gl.LEQUAL,St.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,St.ReadOnly);i.setDepthMode(o),r.render(i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState(),i.bindFramebuffer.set(null)}}},oi=function(e,n){this.context=new Et(e),this.transform=n,this._tileTextures={},this.setup(),this.numSublayers=Ct.maxUnderzooming+Ct.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new t.ProgramConfiguration,this.crossTileSymbolIndex=new je};function si(t,e){if(t.y>e.y){var n=t;t=e,e=n}return{x0:t.x,y0:t.y,x1:e.x,y1:e.y,dx:e.x-t.x,dy:e.y-t.y}}function ui(t,e,n,i,r){var a=Math.max(n,Math.floor(e.y0)),o=Math.min(i,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var u=t.dx/t.dy,l=e.dx/e.dy,c=t.dx>0,h=e.dx<0,f=a;f<o;f++){var p=u*Math.max(0,Math.min(t.dy,f+c-t.y0))+t.x0,A=l*Math.max(0,Math.min(e.dy,f+h-e.y0))+e.x0;r(Math.floor(A),Math.ceil(p),f)}}function li(t,e,n,i,r,a){var o,s=si(t,e),u=si(e,n),l=si(n,t);s.dy>u.dy&&(o=s,s=u,u=o),s.dy>l.dy&&(o=s,s=l,l=o),u.dy>l.dy&&(o=u,u=l,l=o),s.dy&&ui(l,s,i,r,a),u.dy&&ui(l,u,i,r,a)}oi.prototype.resize=function(e,n){var i=this.context.gl;if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,a=this.style._order;r<a.length;r+=1){var o=a[r];this.style._layers[o].resize()}this.depthRbo&&(i.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},oi.prototype.setup=function(){var e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,Be.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(i,Be.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var r=new t.StructArrayLayout4i8;r.emplaceBack(0,0,0,0),r.emplaceBack(t.EXTENT,0,t.EXTENT,0),r.emplaceBack(0,t.EXTENT,0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(r,t.rasterBoundsAttributes.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(a,Be.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(o);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);var u=this.context.gl;this.stencilClearMode=new kt({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},oi.prototype.clearStencil=function(){var e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var i=t.create();t.ortho(i,0,this.width,this.height,0,0,1),t.scale(i,i,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,St.disabled,this.stencilClearMode,Ot.disabled,Pt.disabled,kn(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},oi.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var n=this.context,i=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(Ot.disabled),n.setDepthMode(St.disabled);var r=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var a=0,o=e;a<o.length;a+=1){var s=o[a],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;r.draw(n,i.TRIANGLES,St.disabled,new kt({func:i.ALWAYS,mask:0},u,255,i.KEEP,i.KEEP,i.REPLACE),Ot.disabled,Pt.disabled,kn(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},oi.prototype.stencilModeFor3D=function(){this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new kt({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},oi.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new kt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},oi.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Ot([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Ot.unblended:Ot.alphaBlended},oi.prototype.depthModeForSublayer=function(t,e,n){if(!this.opaquePassEnabledForLayer())return St.disabled;var i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new St(n||this.context.gl.LEQUAL,e,[i,i])},oi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},oi.prototype.render=function(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var i=this.style._order,r=this.style.sourceCaches;for(var a in r){var o=r[a];o.used&&o.prepare(this.context)}var s={},u={},l={};for(var c in r){var h=r[c];s[c]=h.getVisibleCoordinates(),u[c]=s[c].slice().reverse(),l[c]=h.getVisibleCoordinates(!0).reverse()}for(var f in r){var p=r[f],A=p.getSource();if("raster"===A.type||"raster-dem"===A.type){for(var d=[],v=0,g=s[f];v<g.length;v+=1){var m=g[v];d.push(p.getTile(m))}Gn(d,this.context)}}this.opaquePassCutoff=1/0;for(var y=0;y<i.length;y++){var _=i[y];if(this.style._layers[_].is3D()){this.opaquePassCutoff=y;break}}this.renderPass="offscreen",this.depthRboNeedsClear=!0;for(var b=0,x=i;b<x.length;b+=1){var w=x[b],S=this.style._layers[w];if(S.hasOffscreenPass()&&!S.isHidden(this.transform.zoom)){var k=u[S.source];("custom"===S.type||k.length)&&this.renderLayer(this,r[S.source],S,k)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var O=this.style._layers[i[this.currentLayer]],P=r[O.source],E=s[O.source];this._renderTileClippingMasks(O,E),this.renderLayer(this,P,O,E)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var C=this.style._layers[i[this.currentLayer]],T=r[C.source],M=("symbol"===C.type?l:u)[C.source];this._renderTileClippingMasks(C,s[C.source]),this.renderLayer(this,T,C,M)}if(this.options.showTileBoundaries)for(var j in r){ai.debug(this,r[j],s[j]);break}this.setCustomLayerDefaults()},oi.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},oi.prototype.renderLayer=function(t,e,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||i.length)&&(this.id=n.id,ai[n.type](t,e,n,i,this.style.placement.variableOffsets))},oi.prototype.translatePosMatrix=function(e,n,i,r,a){if(!i[0]&&!i[1])return e;var o=a?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){var s=Math.sin(o),u=Math.cos(o);i=[i[0]*u-i[1]*s,i[0]*s+i[1]*u]}var l=[a?i[0]:le(n,i[0],this.transform.zoom),a?i[1]:le(n,i[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},oi.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},oi.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},oi.prototype.isPatternMissing=function(t){if(!t)return!1;var e=this.imageManager.getPattern(t.from),n=this.imageManager.getPattern(t.to);return!e||!n},oi.prototype.useProgram=function(t,e){void 0===e&&(e=this.emptyProgramConfiguration),this.cache=this.cache||{};var n=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new pn(this.context,hn[t],e,Vn[t],this._showOverdrawInspector)),this.cache[n]},oi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},oi.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)};var ci=function(e,n,i){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===i||i,this._minZoom=e||0,this._maxZoom=n||22,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},hi={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ci.prototype.clone=function(){var t=new ci(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},hi.minZoom.get=function(){return this._minZoom},hi.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},hi.maxZoom.get=function(){return this._maxZoom},hi.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},hi.renderWorldCopies.get=function(){return this._renderWorldCopies},hi.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},hi.worldSize.get=function(){return this.tileSize*this.scale},hi.centerPoint.get=function(){return this.size._div(2)},hi.size.get=function(){return new t.Point(this.width,this.height)},hi.bearing.get=function(){return-this.angle/Math.PI*180},hi.bearing.set=function(e){var n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},hi.pitch.get=function(){return this._pitch/Math.PI*180},hi.pitch.set=function(e){var n=t.clamp(e,0,60)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},hi.fov.get=function(){return this._fov/Math.PI*180},hi.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},hi.zoom.get=function(){return this._zoom},hi.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},hi.center.get=function(){return this._center},hi.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},ci.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},ci.prototype.getVisibleUnwrappedCoordinates=function(e){var n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var i=this.pointCoordinate(new t.Point(0,0)),r=this.pointCoordinate(new t.Point(this.width,0)),a=this.pointCoordinate(new t.Point(this.width,this.height)),o=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(i.x,r.x,a.x,o.x)),u=Math.floor(Math.max(i.x,r.x,a.x,o.x)),l=s-1;l<=u+1;l++)0!==l&&n.push(new t.UnwrappedTileID(l,e));return n},ci.prototype.coveringTiles=function(e){var n=this.coveringZoomLevel(e),i=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);var r=t.MercatorCoordinate.fromLngLat(this.center),a=Math.pow(2,n),o=new t.Point(a*r.x-.5,a*r.y-.5);return function(e,n,i,r){void 0===r&&(r=!0);var a=1<<e,o={};function s(n,s,u){var l,c,h,f;if(u>=0&&u<=a)for(l=n;l<s;l++)c=Math.floor(l/a),h=(l%a+a)%a,0!==c&&!0!==r||(f=new t.OverscaledTileID(i,c,e,h,u),o[f.key]=f)}var u=n.map(function(e){return new t.Point(e.x,e.y)._mult(a)});return li(u[0],u[1],u[2],0,a,s),li(u[2],u[3],u[0],0,a,s),Object.keys(o).map(function(t){return o[t]})}(n,[this.pointCoordinate(new t.Point(0,0)),this.pointCoordinate(new t.Point(this.width,0)),this.pointCoordinate(new t.Point(this.width,this.height)),this.pointCoordinate(new t.Point(0,this.height))],e.reparseOverscaled?i:n,this._renderWorldCopies).sort(function(t,e){return o.dist(t.canonical)-o.dist(e.canonical)})},ci.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},hi.unmodified.get=function(){return this._unmodified},ci.prototype.zoomScale=function(t){return Math.pow(2,t)},ci.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},ci.prototype.project=function(e){var n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)},ci.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},hi.point.get=function(){return this.project(this.center)},ci.prototype.setLocationAtPoint=function(e,n){var i=this.pointCoordinate(n),r=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(e),o=new t.MercatorCoordinate(a.x-(i.x-r.x),a.y-(i.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())},ci.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},ci.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},ci.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},ci.prototype.coordinateLocation=function(t){return t.toLngLat()},ci.prototype.pointCoordinate=function(e){var n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(i,i,this.pixelMatrixInverse);var r=n[3],a=i[3],o=n[0]/r,s=i[0]/a,u=n[1]/r,l=i[1]/a,c=n[2]/r,h=i[2]/a,f=c===h?0:(0-c)/(h-c);return new t.MercatorCoordinate(t.number(o,s,f)/this.worldSize,t.number(u,l,f)/this.worldSize)},ci.prototype.coordinatePoint=function(e){var n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.Point(n[0]/n[3],n[1]/n[3])},ci.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},ci.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ci.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ci.prototype.calculatePosMatrix=function(e,n){void 0===n&&(n=!1);var i=e.key,r=n?this._alignedPosMatrixCache:this._posMatrixCache;if(r[i])return r[i];var a=e.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+Math.pow(2,a.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*o,a.y*o,0]),t.scale(u,u,[o/t.EXTENT,o/t.EXTENT,1]),t.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),r[i]=new Float32Array(u),r[i]},ci.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ci.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,n,i,r,a=-90,o=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;a=t.mercatorYfromLat(h[1])*this.worldSize,e=(o=t.mercatorYfromLat(h[0])*this.worldSize)-a<l.y?l.y/(o-a):0}if(this.lngRange){var f=this.lngRange;s=t.mercatorXfromLng(f[0])*this.worldSize,n=(u=t.mercatorXfromLng(f[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var p=this.point,A=Math.max(n||0,e||0);if(A)return this.center=this.unproject(new t.Point(n?(u+s)/2:p.x,e?(o+a)/2:p.y)),this.zoom+=this.scaleZoom(A),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var d=p.y,v=l.y/2;d-v<a&&(r=a+v),d+v>o&&(r=o-v)}if(this.lngRange){var g=p.x,m=l.x/2;g-m<s&&(i=s+m),g+m>u&&(i=u-m)}void 0===i&&void 0===r||(this.center=this.unproject(new t.Point(void 0!==i?i:p.x,void 0!==r?r:p.y))),this._unmodified=c,this._constraining=!1}},ci.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var e=this._fov/2,n=Math.PI/2+this._pitch,i=Math.sin(e)*this.cameraToCenterDistance/Math.sin(Math.PI-n-e),r=this.point,a=r.x,o=r.y,s=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),u=new Float64Array(16);t.perspective(u,this._fov,this.width/this.height,1,s),t.scale(u,u,[1,-1,1]),t.translate(u,u,[0,0,-this.cameraToCenterDistance]),t.rotateX(u,u,this._pitch),t.rotateZ(u,u,this.angle),t.translate(u,u,[-a,-o,0]),this.mercatorMatrix=t.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),t.scale(u,u,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=u;var l=this.width%2/2,c=this.height%2/2,h=Math.cos(this.angle),f=Math.sin(this.angle),p=a-Math.round(a)+h*l+f*c,A=o-Math.round(o)+h*c+f*l,d=new Float64Array(u);if(t.translate(d,d,[p>.5?p-1:p,A>.5?A-1:A,0]),this.alignedProjMatrix=d,u=t.create(),t.scale(u,u,[this.width/2,-this.height/2,1]),t.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.create(),t.scale(u,u,[1,-1,1]),t.translate(u,u,[-1,-1,0]),t.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(u=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ci.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},ci.prototype.getCameraPoint=function(){var e=this._pitch,n=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,n))},ci.prototype.getCameraQueryGeometry=function(e){var n=this.getCameraPoint();if(1===e.length)return[e[0],n];for(var i=n.x,r=n.y,a=n.x,o=n.y,s=0,u=e;s<u.length;s+=1){var l=u[s];i=Math.min(i,l.x),r=Math.min(r,l.y),a=Math.max(a,l.x),o=Math.max(o,l.y)}return[new t.Point(i,r),new t.Point(a,r),new t.Point(a,o),new t.Point(i,o),new t.Point(i,r)]},Object.defineProperties(ci.prototype,hi);var fi=function(){var e,n,i,r;t.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=(e=this._updateHashUnthrottled.bind(this),n=!1,i=0,r=function(){i=0,n&&(e(),i=setTimeout(r,300),n=!1)},function(){return n=!0,i||r(),i})};fi.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},fi.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},fi.prototype.getHashString=function(t){var e=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),a=Math.round(e.lng*r)/r,o=Math.round(e.lat*r)/r,s=this._map.getBearing(),u=this._map.getPitch(),l="";return l+=t?"#/"+a+"/"+o+"/"+n:"#"+n+"/"+o+"/"+a,(s||u)&&(l+="/"+Math.round(10*s)/10),u&&(l+="/"+Math.round(u)),l},fi.prototype._onHashChange=function(){var e=t.window.location.hash.replace("#","").split("/");return e.length>=3&&(this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:+(e[3]||0),pitch:+(e[4]||0)}),!0)},fi.prototype._updateHashUnthrottled=function(){var e=this.getHashString();try{t.window.history.replaceState(t.window.history.state,"",e)}catch(t){}};var pi=function(e){function i(i,r,a,o){void 0===o&&(o={});var s=n.mousePos(r.getCanvasContainer(),a),u=r.unproject(s);e.call(this,i,t.extend({point:s,lngLat:u,originalEvent:a},o)),this._defaultPrevented=!1,this.target=r}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var r={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,r),i}(t.Event),Ai=function(e){function i(i,r,a){var o=n.touchPos(r.getCanvasContainer(),a),s=o.map(function(t){return r.unproject(t)}),u=o.reduce(function(t,e,n,i){return t.add(e.div(i.length))},new t.Point(0,0)),l=r.unproject(u);e.call(this,i,{points:o,point:u,lngLats:s,lngLat:l,originalEvent:a}),this._defaultPrevented=!1}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var r={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,r),i}(t.Event),di=function(t){function e(e,n,i){t.call(this,e,{originalEvent:i}),this._defaultPrevented=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,n),e}(t.Event),vi=function(e){this._map=e,this._el=e.getCanvasContainer(),this._delta=0,t.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};vi.prototype.isEnabled=function(){return!!this._enabled},vi.prototype.isActive=function(){return!!this._active},vi.prototype.isZooming=function(){return!!this._zooming},vi.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},vi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},vi.prototype.onWheel=function(e){if(this.isEnabled()){var n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,i=t.browser.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this.isActive()||this._start(e)),e.preventDefault()}},vi.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},vi.prototype._start=function(e){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this._zooming=!0,this._map.fire(new t.Event("movestart",{originalEvent:e})),this._map.fire(new t.Event("zoomstart",{originalEvent:e})),this._finishTimeout&&clearTimeout(this._finishTimeout);var i=n.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(i)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},vi.prototype._onScrollFrame=function(){var e=this;if(this._frameId=null,this.isActive()){var n=this._map.transform;if(0!==this._delta){var i="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?1/450:.01,r=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==r&&(r=1/r);var a="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(a*r))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o="number"==typeof this._targetZoom?this._targetZoom:n.zoom,s=this._startZoom,u=this._easing,l=!1;if("wheel"===this._type&&s&&u){var c=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),h=u(c);n.zoom=t.number(s,o,h),c<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):l=!0}else n.zoom=o,l=!0;n.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new t.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new t.Event("zoom",{originalEvent:this._lastWheelEvent})),l&&(this._active=!1,this._finishTimeout=setTimeout(function(){e._zooming=!1,e._map.fire(new t.Event("zoomend",{originalEvent:e._lastWheelEvent})),e._map.fire(new t.Event("moveend",{originalEvent:e._lastWheelEvent})),delete e._targetZoom},200))}},vi.prototype._smoothOutEasing=function(e){var n=t.ease;if(this._prevEase){var i=this._prevEase,r=(t.browser.now()-i.start)/i.duration,a=i.easing(r+.01)-i.easing(r),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=t.bezier(o,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n};var gi=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1,t.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)};gi.prototype.isEnabled=function(){return!!this._enabled},gi.prototype.isActive=function(){return!!this._active},gi.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},gi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},gi.prototype.onMouseDown=function(e){this.isEnabled()&&e.shiftKey&&0===e.button&&(t.window.document.addEventListener("mousemove",this._onMouseMove,!1),t.window.document.addEventListener("keydown",this._onKeyDown,!1),t.window.document.addEventListener("mouseup",this._onMouseUp,!1),n.disableDrag(),this._startPos=this._lastPos=n.mousePos(this._el,e),this._active=!0)},gi.prototype._onMouseMove=function(t){var e=n.mousePos(this._el,t);if(!(this._lastPos.equals(e)||!this._box&&e.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=e,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var r=Math.min(i.x,e.x),a=Math.max(i.x,e.x),o=Math.min(i.y,e.y),s=Math.max(i.y,e.y);n.setTransform(this._box,"translate("+r+"px,"+o+"px)"),this._box.style.width=a-r+"px",this._box.style.height=s-o+"px"}},gi.prototype._onMouseUp=function(e){if(0===e.button){var i=this._startPos,r=n.mousePos(this._el,e);this._finish(),n.suppressClick(),i.x===r.x&&i.y===r.y?this._fireEvent("boxzoomcancel",e):this._map.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!0}).fire(new t.Event("boxzoomend",{originalEvent:e}))}},gi.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},gi.prototype._finish=function(){this._active=!1,t.window.document.removeEventListener("mousemove",this._onMouseMove,!1),t.window.document.removeEventListener("keydown",this._onKeyDown,!1),t.window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},gi.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))};var mi=t.bezier(0,0,.25,1),yi=function(e,n){this._map=e,this._el=n.element||e.getCanvasContainer(),this._state="disabled",this._button=n.button||"right",this._bearingSnap=n.bearingSnap||0,this._pitchWithRotate=!1!==n.pitchWithRotate,t.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)};yi.prototype.isEnabled=function(){return"disabled"!==this._state},yi.prototype.isActive=function(){return"active"===this._state},yi.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},yi.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},yi.prototype.onMouseDown=function(e){if("enabled"===this._state){if("right"===this._button){if(this._eventButton=n.mouseButton(e),this._eventButton!==(e.ctrlKey?0:2))return}else{if(e.ctrlKey||0!==n.mouseButton(e))return;this._eventButton=0}n.disableDrag(),t.window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("mouseup",this._onMouseUp),t.window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[t.browser.now(),this._map.getBearing()]],this._startPos=this._lastPos=n.mousePos(this._el,e),this._center=this._map.transform.centerPoint,e.preventDefault()}},yi.prototype._onMouseMove=function(t){var e=n.mousePos(this._el,t);this._lastPos.equals(e)||(this._lastMoveEvent=t,this._lastPos=e,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},yi.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var n=this._map.transform,i=this._startPos,r=this._lastPos,a=.8*(i.x-r.x),o=-.5*(i.y-r.y),s=n.bearing-a,u=n.pitch-o,l=this._inertia,c=l[l.length-1];this._drainInertiaBuffer(),l.push([t.browser.now(),this._map._normalizeBearing(s,c[1])]),n.bearing=s,this._pitchWithRotate&&(this._fireEvent("pitch",e),n.pitch=u),this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._startPos=this._lastPos}},yi.prototype._onMouseUp=function(t){if(n.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",n.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind()}},yi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},yi.prototype._unbind=function(){t.window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("mouseup",this._onMouseUp),t.window.removeEventListener("blur",this._onBlur),n.enableDrag()},yi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._lastPos},yi.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var n=this._map,i=n.getBearing(),r=this._inertia,a=function(){Math.abs(i)<e._bearingSnap?n.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(r.length<2)a();else{var o=r[0],s=r[r.length-1],u=r[r.length-2],l=n._normalizeBearing(i,u[1]),c=s[1]-o[1],h=c<0?-1:1,f=(s[0]-o[0])/1e3;if(0!==c&&0!==f){var p=Math.abs(c*(.25/f));p>180&&(p=180);var A=p/180;l+=h*p*(A/2),Math.abs(n._normalizeBearing(l,0))<this._bearingSnap&&(l=n._normalizeBearing(0,l)),n.rotateTo(l,{duration:1e3*A,easing:mi,noMoveStart:!0},{originalEvent:t})}else a()}},yi.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},yi.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,n=t.browser.now();e.length>0&&n-e[0][0]>160;)e.shift()};var _i=t.bezier(0,0,.3,1),bi=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",this._clickTolerance=n.clickTolerance||1,t.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)};bi.prototype.isEnabled=function(){return"disabled"!==this._state},bi.prototype.isActive=function(){return"active"===this._state},bi.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled")},bi.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},bi.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==n.mouseButton(e)||(n.addEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),n.addEventListener(t.window.document,"mouseup",this._onMouseUp),this._start(e)))},bi.prototype.onTouchStart=function(e){"enabled"===this._state&&(e.touches.length>1||(n.addEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),n.addEventListener(t.window.document,"touchend",this._onTouchEnd),this._start(e)))},bi.prototype._start=function(e){t.window.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._lastPos=n.mousePos(this._el,e),this._inertia=[[t.browser.now(),this._startPos]]},bi.prototype._onMove=function(e){e.preventDefault();var i=n.mousePos(this._el,e);this._lastPos.equals(i)||"pending"===this._state&&i.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=e,this._lastPos=i,this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._fireEvent("dragstart",e),this._fireEvent("movestart",e)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},bi.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._startPos),this._lastPos),this._fireEvent("drag",t),this._fireEvent("move",t),this._startPos=this._lastPos,delete this._lastMoveEvent}},bi.prototype._onMouseUp=function(t){if(0===n.mouseButton(t))switch(this._state){case"active":this._state="enabled",n.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},bi.prototype._onTouchEnd=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},bi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("dragend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},bi.prototype._unbind=function(){n.removeEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),n.removeEventListener(t.window.document,"touchend",this._onTouchEnd),n.removeEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),n.removeEventListener(t.window.document,"mouseup",this._onMouseUp),n.removeEventListener(t.window,"blur",this._onBlur)},bi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._mouseDownPos,delete this._lastPos},bi.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var n=e[e.length-1],i=e[0],r=n[1].sub(i[1]),a=(n[0]-i[0])/1e3;if(0===a||n[1].equals(i[1]))this._fireEvent("moveend",t);else{var o=r.mult(.3/a),s=o.mag();s>1400&&(s=1400,o._unit()._mult(s));var u=s/750,l=o.mult(-u/2);this._map.panBy(l,{duration:1e3*u,easing:_i,noMoveStart:!0},{originalEvent:t})}}},bi.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},bi.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,n=t.browser.now();e.length>0&&n-e[0][0]>160;)e.shift()};var xi=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onKeyDown"],this)};function wi(t){return t*(2-t)}xi.prototype.isEnabled=function(){return!!this._enabled},xi.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},xi.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},xi.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,n=0,i=0,r=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(a=1,t.preventDefault());break;default:return}var o=this._map,s=o.getZoom(),u={duration:300,delayEndEvents:500,easing:wi,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:o.getBearing()+15*n,pitch:o.getPitch()+10*i,offset:[100*-r,100*-a],center:o.getCenter()};o.easeTo(u,{originalEvent:t})}};var Si=function(e){this._map=e,t.bindAll(["_onDblClick","_onZoomEnd"],this)};Si.prototype.isEnabled=function(){return!!this._enabled},Si.prototype.isActive=function(){return!!this._active},Si.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Si.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Si.prototype.onTouchStart=function(t){var e=this;this.isEnabled()&&(t.points.length>1||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._zoom(t)):this._tapped=setTimeout(function(){e._tapped=null},300)))},Si.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t))},Si.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},Si.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};var ki=t.bezier(0,0,.15,1),Oi=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)};Oi.prototype.isEnabled=function(){return!!this._enabled},Oi.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},Oi.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1)},Oi.prototype.disableRotation=function(){this._rotationDisabled=!0},Oi.prototype.enableRotation=function(){this._rotationDisabled=!1},Oi.prototype.onStart=function(e){if(this.isEnabled()&&2===e.touches.length){var i=n.mousePos(this._el,e.touches[0]),r=n.mousePos(this._el,e.touches[1]),a=i.add(r).div(2);this._startVec=i.sub(r),this._startAround=this._map.transform.pointLocation(a),this._gestureIntent=void 0,this._inertia=[],n.addEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),n.addEventListener(t.window.document,"touchend",this._onEnd)}},Oi.prototype._getTouchEventData=function(t){var e=n.mousePos(this._el,t.touches[0]),i=n.mousePos(this._el,t.touches[1]),r=e.sub(i);return{vec:r,center:e.add(i).div(2),scale:r.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*r.angleWith(this._startVec)/Math.PI}},Oi.prototype._onMove=function(e){if(2===e.touches.length){var n=this._getTouchEventData(e),i=n.vec,r=n.scale,a=n.bearing;if(!this._gestureIntent){var o=this._rotationDisabled&&1!==r||Math.abs(1-r)>.15;Math.abs(a)>10?this._gestureIntent="rotate":o&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new t.Event(this._gestureIntent+"start",{originalEvent:e})),this._map.fire(new t.Event("movestart",{originalEvent:e})),this._startVec=i)}this._lastTouchEvent=e,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),e.preventDefault()}},Oi.prototype._onTouchFrame=function(){this._frameId=null;var e=this._gestureIntent;if(e){var n=this._map.transform;this._startScale||(this._startScale=n.scale,this._startBearing=n.bearing);var i=this._getTouchEventData(this._lastTouchEvent),r=i.center,a=i.bearing,o=i.scale,s=n.pointLocation(r),u=n.locationPoint(s);"rotate"===e&&(n.bearing=this._startBearing+a),n.zoom=n.scaleZoom(this._startScale*o),n.setLocationAtPoint(this._startAround,u),this._map.fire(new t.Event(e,{originalEvent:this._lastTouchEvent})),this._map.fire(new t.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),o,r])}},Oi.prototype._onEnd=function(e){n.removeEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),n.removeEventListener(t.window.document,"touchend",this._onEnd);var i=this._gestureIntent,r=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,i){this._map.fire(new t.Event(i+"end",{originalEvent:e})),this._drainInertiaBuffer();var a=this._inertia,o=this._map;if(a.length<2)o.snapToNorth({},{originalEvent:e});else{var s=a[a.length-1],u=a[0],l=o.transform.scaleZoom(r*s[1]),c=o.transform.scaleZoom(r*u[1]),h=l-c,f=(s[0]-u[0])/1e3,p=s[2];if(0!==f&&l!==c){var A=.15*h/f;Math.abs(A)>2.5&&(A=A>0?2.5:-2.5);var d=1e3*Math.abs(A/(12*.15)),v=l+A*d/2e3;v<0&&(v=0),o.easeTo({zoom:v,duration:d,easing:ki,around:this._aroundCenter?o.getCenter():o.unproject(p),noMoveStart:!0},{originalEvent:e})}else o.snapToNorth({},{originalEvent:e})}}},Oi.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,n=t.browser.now();e.length>2&&n-e[0][0]>160;)e.shift()};var Pi={scrollZoom:vi,boxZoom:gi,dragRotate:yi,dragPan:bi,keyboard:xi,doubleClickZoom:Si,touchZoomRotate:Oi},Ei=function(e){function n(n,i){e.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=i.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},n.prototype.panBy=function(e,n,i){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),i)},n.prototype.panTo=function(e,n,i){return this.easeTo(t.extend({center:e},n),i)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},n.prototype.zoomTo=function(e,n,i){return this.easeTo(t.extend({zoom:e},n),i)},n.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},n.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},n.prototype.rotateTo=function(e,n,i){return this.easeTo(t.extend({bearing:e},n),i)},n.prototype.resetNorth=function(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this},n.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},n.prototype.cameraForBounds=function(e,n){return e=t.LngLatBounds.convert(e),this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,n)},n.prototype._cameraForBoxAndBearing=function(e,n,i,r){if("number"==typeof(r=t.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var a=r.padding;r.padding={top:a,bottom:a,right:a,left:a}}if(t.deepEqual(Object.keys(r.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"])){var o=this.transform,s=o.project(t.LngLat.convert(e)),u=o.project(t.LngLat.convert(n)),l=s.rotate(-i*Math.PI/180),c=u.rotate(-i*Math.PI/180),h=new t.Point(Math.max(l.x,c.x),Math.max(l.y,c.y)),f=new t.Point(Math.min(l.x,c.x),Math.min(l.y,c.y)),p=h.sub(f),A=(o.width-r.padding.left-r.padding.right)/p.x,d=(o.height-r.padding.top-r.padding.bottom)/p.y;if(!(d<0||A<0)){var v=Math.min(o.scaleZoom(o.scale*Math.min(A,d)),r.maxZoom),g=t.Point.convert(r.offset),m=(r.padding.left-r.padding.right)/2,y=(r.padding.top-r.padding.bottom)/2,_=new t.Point(g.x+m,g.y+y).mult(o.scale/o.zoomScale(v));return{center:o.unproject(s.add(u).div(2).sub(_)),zoom:v,bearing:i}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}else t.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'")},n.prototype.fitBounds=function(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)},n.prototype.fitScreenCoordinates=function(e,n,i,r,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),i,r),r,a)},n.prototype._fitInternal=function(e,n,i){return e?(n=t.extend(e,n)).linear?this.easeTo(n,i):this.flyTo(n,i):this},n.prototype.jumpTo=function(e,n){this.stop();var i=this.transform,r=!1,a=!1,o=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(r=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=t.LngLat.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(a=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(o=!0,i.pitch=+e.pitch),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),r&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),a&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),o&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))},n.prototype.easeTo=function(e,n){var i=this;this.stop(),!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate&&(e.duration=0);var r=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),u="zoom"in e?+e.zoom:a,l="bearing"in e?this._normalizeBearing(e.bearing,o):o,c="pitch"in e?+e.pitch:s,h=r.centerPoint.add(t.Point.convert(e.offset)),f=r.pointLocation(h),p=t.LngLat.convert(e.center||f);this._normalizeCenter(p);var A,d,v=r.project(f),g=r.project(p).sub(v),m=r.zoomScale(u-a);return e.around&&(A=t.LngLat.convert(e.around),d=r.locationPoint(A)),this._zooming=u!==a,this._rotating=o!==l,this._pitching=c!==s,this._prepareEase(n,e.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(e){if(i._zooming&&(r.zoom=t.number(a,u,e)),i._rotating&&(r.bearing=t.number(o,l,e)),i._pitching&&(r.pitch=t.number(s,c,e)),A)r.setLocationAtPoint(A,d);else{var f=r.zoomScale(r.zoom-a),p=u>a?Math.min(2,m):Math.max(.5,m),y=Math.pow(p,1-e),_=r.unproject(v.add(g.mult(e*y)).mult(f));r.setLocationAtPoint(r.renderWorldCopies?_.wrap():_,h)}i._fireMoveEvents(n)},function(){e.delayEndEvents?i._easeEndTimeoutID=setTimeout(function(){return i._afterEase(n)},e.delayEndEvents):i._afterEase(n)},e),this},n.prototype._prepareEase=function(e,n){this._moving=!0,n||this.fire(new t.Event("movestart",e)),this._zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&this.fire(new t.Event("pitchstart",e))},n.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},n.prototype._afterEase=function(e){var n=this._zooming,i=this._rotating,r=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,n&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),r&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))},n.prototype.flyTo=function(e,n){var i=this;this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var r=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),u="zoom"in e?t.clamp(+e.zoom,r.minZoom,r.maxZoom):a,l="bearing"in e?this._normalizeBearing(e.bearing,o):o,c="pitch"in e?+e.pitch:s,h=r.zoomScale(u-a),f=r.centerPoint.add(t.Point.convert(e.offset)),p=r.pointLocation(f),A=t.LngLat.convert(e.center||p);this._normalizeCenter(A);var d=r.project(p),v=r.project(A).sub(d),g=e.curve,m=Math.max(r.width,r.height),y=m/h,_=v.mag();if("minZoom"in e){var b=t.clamp(Math.min(e.minZoom,a,u),r.minZoom,r.maxZoom),x=m/r.zoomScale(b-a);g=Math.sqrt(x/_*2)}var w=g*g;function S(t){var e=(y*y-m*m+(t?-1:1)*w*w*_*_)/(2*(t?y:m)*w*_);return Math.log(Math.sqrt(e*e+1)-e)}function k(t){return(Math.exp(t)-Math.exp(-t))/2}function O(t){return(Math.exp(t)+Math.exp(-t))/2}var P=S(0),E=function(t){return O(P)/O(P+g*t)},C=function(t){return m*((O(P)*(k(e=P+g*t)/O(e))-k(P))/w)/_;var e},T=(S(1)-P)/g;if(Math.abs(_)<1e-6||!isFinite(T)){if(Math.abs(m-y)<1e-6)return this.easeTo(e,n);var M=y<m?-1:1;T=Math.abs(Math.log(y/m))/g,C=function(){return 0},E=function(t){return Math.exp(M*g*t)}}if("duration"in e)e.duration=+e.duration;else{var j="screenSpeed"in e?+e.screenSpeed/g:+e.speed;e.duration=1e3*T/j}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=o!==l,this._pitching=c!==s,this._prepareEase(n,!1),this._ease(function(e){var h=e*T,p=1/E(h);r.zoom=1===e?u:a+r.scaleZoom(p),i._rotating&&(r.bearing=t.number(o,l,e)),i._pitching&&(r.pitch=t.number(s,c,e));var g=1===e?A:r.unproject(d.add(v.mult(C(h))).mult(p));r.setLocationAtPoint(r.renderWorldCopies?g.wrap():g,f),i._fireMoveEvents(n)},function(){return i._afterEase(n)},e),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},n.prototype._ease=function(e,n,i){!1===i.animate||0===i.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(e,n){e=t.wrap(e,-180,180);var i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e},n.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},n}(t.Evented),Ci=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};Ci.prototype.getDefaultPosition=function(){return"bottom-right"},Ci.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Ci.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},Ci.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:t.config.ACCESS_TOKEN}];if(e){var i=n.reduce(function(t,e,i){return e.value&&(t+=e.key+"="+e.value+(i<n.length-1?"&":"")),t},"?");e.href=t.config.FEEDBACK_URL+"/"+i+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener"}},Ci.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},Ci.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(function(t){return"string"!=typeof t?"":t})):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var n=this._map.style.sourceCaches;for(var i in n){var r=n[i];if(r.used){var a=r.getSource();a.attribution&&t.indexOf(a.attribution)<0&&t.push(a.attribution)}}t.sort(function(t,e){return t.length-e.length}),(t=t.filter(function(e,n){for(var i=n+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0})).length?(this._innerContainer.innerHTML=t.join(" | "),this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null}},Ci.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var Ti=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};Ti.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","mapboxgl-ctrl");var e=n.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),e.setAttribute("rel","noopener"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ti.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ti.prototype.getDefaultPosition=function(){return"bottom-left"},Ti.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Ti.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},Ti.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var Mi=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Mi.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},Mi.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,i=e?this._queue.concat(e):this._queue;n<i.length;n+=1){var r=i[n];if(r.id===t)return void(r.cancelled=!0)}},Mi.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,n=t;e<n.length;e+=1){var i=n[e];if(!i.cancelled&&(i.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Mi.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ji=t.window.HTMLImageElement,Li=t.window.HTMLElement,Ii={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},zi=function(i){function r(e){var r=this;if(null!=(e=t.extend({},Ii,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var a=new ci(e.minZoom,e.maxZoom,e.renderWorldCopies);if(i.call(this,a,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new Mi,this._controls=[],this._mapId=t.uniqueId(),this._requestManager=new t.RequestManager(e.transformRequest),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Li))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return r._update(!1)}),this.on("moveend",function(){return r._update(!1)}),this.on("zoom",function(){return r._update(!0)}),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1)),function(t,e){var i=t.getCanvasContainer(),r=null,a=!1,o=null;for(var s in Pi)t[s]=new Pi[s](t,e),e.interactive&&e[s]&&t[s].enable(e[s]);n.addEventListener(i,"mouseout",function(e){t.fire(new pi("mouseout",t,e))}),n.addEventListener(i,"mousedown",function(r){a=!0,o=n.mousePos(i,r);var s=new pi("mousedown",t,r);t.fire(s),s.defaultPrevented||(e.interactive&&!t.doubleClickZoom.isActive()&&t.stop(),t.boxZoom.onMouseDown(r),t.boxZoom.isActive()||t.dragPan.isActive()||t.dragRotate.onMouseDown(r),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onMouseDown(r))}),n.addEventListener(i,"mouseup",function(e){var n=t.dragRotate.isActive();r&&!n&&t.fire(new pi("contextmenu",t,r)),r=null,a=!1,t.fire(new pi("mouseup",t,e))}),n.addEventListener(i,"mousemove",function(e){if(!t.dragPan.isActive()&&!t.dragRotate.isActive()){for(var n=e.target;n&&n!==i;)n=n.parentNode;n===i&&t.fire(new pi("mousemove",t,e))}}),n.addEventListener(i,"mouseover",function(e){for(var n=e.target;n&&n!==i;)n=n.parentNode;n===i&&t.fire(new pi("mouseover",t,e))}),n.addEventListener(i,"touchstart",function(n){var i=new Ai("touchstart",t,n);t.fire(i),i.defaultPrevented||(e.interactive&&t.stop(),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onTouchStart(n),t.touchZoomRotate.onStart(n),t.doubleClickZoom.onTouchStart(i))},{passive:!1}),n.addEventListener(i,"touchmove",function(e){t.fire(new Ai("touchmove",t,e))},{passive:!1}),n.addEventListener(i,"touchend",function(e){t.fire(new Ai("touchend",t,e))}),n.addEventListener(i,"touchcancel",function(e){t.fire(new Ai("touchcancel",t,e))}),n.addEventListener(i,"click",function(r){var a=n.mousePos(i,r);(a.equals(o)||a.dist(o)<e.clickTolerance)&&t.fire(new pi("click",t,r))}),n.addEventListener(i,"dblclick",function(e){var n=new pi("dblclick",t,e);t.fire(n),n.defaultPrevented||t.doubleClickZoom.onDblClick(n)}),n.addEventListener(i,"contextmenu",function(e){var n=t.dragRotate.isActive();a||n?a&&(r=e):t.fire(new pi("contextmenu",t,e)),(t.dragRotate.isEnabled()||t.listens("contextmenu"))&&e.preventDefault()}),n.addEventListener(i,"wheel",function(n){e.interactive&&t.stop();var i=new di("wheel",t,n);t.fire(i),i.defaultPrevented||t.scrollZoom.onWheel(n)},{passive:!1})}(this,e),this._hash=e.hash&&(new fi).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Ci({customAttribution:e.customAttribution})),this.addControl(new Ti,e.logoPosition),this.on("style.load",function(){r.transform.unmodified&&r.jumpTo(r.style.stylesheet)}),this.on("data",function(e){r._update("style"===e.dataType),r.fire(new t.Event(e.dataType+"data",e))}),this.on("dataloading",function(e){r.fire(new t.Event(e.dataType+"dataloading",e))})}i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r;var a={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0}};return r.prototype._getMapId=function(){return this._mapId},r.prototype.addControl=function(e,n){if(void 0===n&&e.getDefaultPosition&&(n=e.getDefaultPosition()),void 0===n&&(n="top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var i=e.onAdd(this);this._controls.push(e);var r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this},r.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this},r.prototype.resize=function(e){var n=this._containerDimensions(),i=n[0],r=n[1];return this._resizeCanvas(i,r),this.transform.resize(i,r),this.painter.resize(i,r),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)).fire(new t.Event("resize",e)).fire(new t.Event("moveend",e)),this},r.prototype.getBounds=function(){return this.transform.getBounds()},r.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},r.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},r.prototype.setMinZoom=function(t){if((t=null==t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},r.prototype.getMinZoom=function(){return this.transform.minZoom},r.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},r.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},r.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},r.prototype.getMaxZoom=function(){return this.transform.maxZoom},r.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},r.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},r.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},r.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isZooming()},r.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},r.prototype.on=function(t,e,n){var r=this;if(void 0===n)return i.prototype.on.call(this,t,e);var a=function(){var i;if("mouseenter"===t||"mouseover"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(i){var o=r.getLayer(e)?r.queryRenderedFeatures(i.point,{layers:[e]}):[];o.length?a||(a=!0,n.call(r,new pi(t,r,i.originalEvent,{features:o}))):a=!1},mouseout:function(){a=!1}}}}if("mouseleave"===t||"mouseout"===t){var o=!1;return{layer:e,listener:n,delegates:{mousemove:function(i){(r.getLayer(e)?r.queryRenderedFeatures(i.point,{layers:[e]}):[]).length?o=!0:o&&(o=!1,n.call(r,new pi(t,r,i.originalEvent)))},mouseout:function(e){o&&(o=!1,n.call(r,new pi(t,r,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(i={},i[t]=function(t){var i=r.getLayer(e)?r.queryRenderedFeatures(t.point,{layers:[e]}):[];i.length&&(t.features=i,n.call(r,t),delete t.features)},i)}}();for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(a),a.delegates)this.on(o,a.delegates[o]);return this},r.prototype.off=function(t,e,n){if(void 0===n)return i.prototype.off.call(this,t,e);if(this._delegatedListeners&&this._delegatedListeners[t])for(var r=this._delegatedListeners[t],a=0;a<r.length;a++){var o=r[a];if(o.layer===e&&o.listener===n){for(var s in o.delegates)this.off(s,o.delegates[s]);return r.splice(a,1),this}}return this},r.prototype.queryRenderedFeatures=function(e,n){if(!this.style)return[];var i;if(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])i=[t.Point.convert(e)];else{var r=t.Point.convert(e[0]),a=t.Point.convert(e[1]);i=[r,new t.Point(a.x,r.y),a,new t.Point(r.x,a.y),r]}return this.style.queryRenderedFeatures(i,n,this.transform)},r.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},r.prototype.setStyle=function(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:Ii.localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))},r.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new De(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},r.prototype._diffStyle=function(e,n){var i=this;if("string"==typeof e){var r=this._requestManager.normalizeStyleURL(e),a=this._requestManager.transformRequest(r,t.ResourceType.Style);t.getJSON(a,function(e,r){e?i.fire(new t.ErrorEvent(e)):r&&i._updateDiff(r,n)})}else"object"==typeof e&&this._updateDiff(e,n)},r.prototype._updateDiff=function(e,n){try{this.style.setState(e)&&this._update(!0)}catch(i){t.warnOnce("Unable to perform style diff: "+(i.message||i.error||i)+".  Rebuilding the style from scratch."),this._updateStyle(e,n)}},r.prototype.getStyle=function(){if(this.style)return this.style.serialize()},r.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},r.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0)},r.prototype.isSourceLoaded=function(e){var n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},r.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var i in n){var r=n[i];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0},r.prototype.addSourceType=function(t,e,n){return this.style.addSourceType(t,e,n)},r.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},r.prototype.getSource=function(t){return this.style.getSource(t)},r.prototype.addImage=function(e,n,i){void 0===i&&(i={});var r=i.pixelRatio;void 0===r&&(r=1);var a=i.sdf;if(void 0===a&&(a=!1),n instanceof ji){var o=t.browser.getImageData(n),s=o.width,u=o.height,l=o.data;this.style.addImage(e,{data:new t.RGBAImage({width:s,height:u},l),pixelRatio:r,sdf:a,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=n.width,h=n.height,f=n.data,p=n;this.style.addImage(e,{data:new t.RGBAImage({width:c,height:h},new Uint8Array(f)),pixelRatio:r,sdf:a,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e)}},r.prototype.updateImage=function(e,n){var i=this.style.getImage(e);if(!i)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var r=n instanceof ji?t.browser.getImageData(n):n,a=r.width,o=r.height,s=r.data;if(void 0===a||void 0===o)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==i.data.width||o!==i.data.height)return this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));var u=!(n instanceof ji);i.data.replace(s,u),this.style.updateImage(e,i)},r.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},r.prototype.removeImage=function(t){this.style.removeImage(t)},r.prototype.loadImage=function(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)},r.prototype.listImages=function(){return this.style.listImages()},r.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0)},r.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},r.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},r.prototype.getLayer=function(t){return this.style.getLayer(t)},r.prototype.setFilter=function(t,e,n){return void 0===n&&(n={}),this.style.setFilter(t,e,n),this._update(!0)},r.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)},r.prototype.getFilter=function(t){return this.style.getFilter(t)},r.prototype.setPaintProperty=function(t,e,n,i){return void 0===i&&(i={}),this.style.setPaintProperty(t,e,n,i),this._update(!0)},r.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},r.prototype.setLayoutProperty=function(t,e,n,i){return void 0===i&&(i={}),this.style.setLayoutProperty(t,e,n,i),this._update(!0)},r.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},r.prototype.setLight=function(t,e){return void 0===e&&(e={}),this.style.setLight(t,e),this._update(!0)},r.prototype.getLight=function(){return this.style.getLight()},r.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},r.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},r.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},r.prototype.getContainer=function(){return this._container},r.prototype.getCanvasContainer=function(){return this._canvasContainer},r.prototype.getCanvas=function(){return this._canvas},r.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},r.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},r.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=n.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var r=this._controlContainer=n.create("div","mapboxgl-control-container",t),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){a[t]=n.create("div","mapboxgl-ctrl-"+t,r)})},r.prototype._resizeCanvas=function(e,n){var i=t.window.devicePixelRatio||1;this._canvas.width=i*e,this._canvas.height=i*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"},r.prototype._setupPainter=function(){var n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);i?(this.painter=new oi(i,this.transform),t.webpSupported.testSupport(i)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},r.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},r.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},r.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},r.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},r.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},r.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},r.prototype._render=function(){this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var e=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var n=this.transform.zoom,i=t.browser.now();this.style.zoomHistory.update(n,i);var r=new t.EvaluationParameters(n,{now:i,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=r.crossFadingFactor();1===a&&a===this._crossFadingFactor||(e=!0,this._crossFadingFactor=a),this.style.update(r)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||e)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),this},r.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,n=this._controls;e<n.length;e+=1)n[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),Di(this._canvasContainer),Di(this._controlContainer),Di(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this.fire(new t.Event("remove"))},r.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame(function(){e._frame=null,e._render()}))},r.prototype._onWindowOnline=function(){this._update()},r.prototype._onWindowResize=function(){this._trackResize&&this.resize()._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(t){this._vertices=t,this._update()},Object.defineProperties(r.prototype,a),r}(Ei);function Di(t){t.parentNode&&t.parentNode.removeChild(t)}var Bi={showCompass:!0,showZoom:!0},Ri=function(e){var i=this;this.options=t.extend({},Bi,e),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(t.bindAll(["_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in","Zoom in",function(){return i._map.zoomIn()}),this._zoomOutButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out","Zoom out",function(){return i._map.zoomOut()})),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-compass","Reset bearing to north",function(){return i._map.resetNorth()}),this._compassArrow=n.create("span","mapboxgl-ctrl-compass-arrow",this._compass))};function Fi(e,n,i){if(e=new t.LngLat(e.lng,e.lat),n){var r=new t.LngLat(e.lng-360,e.lat),a=new t.LngLat(e.lng+360,e.lat),o=i.locationPoint(e).distSqr(n);i.locationPoint(r).distSqr(n)<o?e=r:i.locationPoint(a).distSqr(n)<o&&(e=a)}for(;Math.abs(e.lng-i.center.lng)>180;){var s=i.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=i.width&&s.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}Ri.prototype._updateZoomButtons=function(){var t=this._map.getZoom();this._zoomInButton.classList.toggle("mapboxgl-ctrl-icon-disabled",t===this._map.getMaxZoom()),this._zoomOutButton.classList.toggle("mapboxgl-ctrl-icon-disabled",t===this._map.getMinZoom())},Ri.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},Ri.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yi(t,{button:"left",element:this._compass}),n.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.enable()),this._container},Ri.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),n.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.disable(),delete this._handler),delete this._map},Ri.prototype._createButton=function(t,e,i){var r=n.create("button",t,this._container);return r.type="button",r.title=e,r.setAttribute("aria-label",e),r.addEventListener("click",i),r};var Ni={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ui(t,e,n){var i=t.classList;for(var r in Ni)i.remove("mapboxgl-"+n+"-anchor-"+r);i.add("mapboxgl-"+n+"-anchor-"+e)}var Vi,Gi=function(e){function i(i,r){if(e.call(this),(i instanceof t.window.HTMLElement||r)&&(i=t.extend({element:i},r)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._draggable=i&&i.draggable||!1,this._state="inactive",i&&i.element)this._element=i.element,this._offset=t.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div");var a=n.createNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","41px"),a.setAttributeNS(null,"width","27px"),a.setAttributeNS(null,"viewBox","0 0 27 41");var o=n.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],f=n.createNS("http://www.w3.org/2000/svg","ellipse");f.setAttributeNS(null,"opacity","0.04"),f.setAttributeNS(null,"cx","10.5"),f.setAttributeNS(null,"cy","5.80029008"),f.setAttributeNS(null,"rx",h.rx),f.setAttributeNS(null,"ry",h.ry),u.appendChild(f)}var p=n.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"fill",this._color);var A=n.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),p.appendChild(A);var d=n.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");var v=n.createNS("http://www.w3.org/2000/svg","path");v.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(v);var g=n.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(6.0, 7.0)"),g.setAttributeNS(null,"fill","#FFFFFF");var m=n.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");var y=n.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#000000"),y.setAttributeNS(null,"opacity","0.25"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#FFFFFF"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962"),m.appendChild(y),m.appendChild(_),s.appendChild(u),s.appendChild(p),s.appendChild(d),s.appendChild(g),s.appendChild(m),a.appendChild(s),this._element.appendChild(a),this._offset=t.Point.convert(i&&i.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(t){t.preventDefault()}),Ui(this._element,this._anchor,"marker"),this._popup=null}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},i.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},i.prototype.getElement=function(){return this._element},i.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat)}return this},i.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},i.prototype.getPopup=function(){return this._popup},i.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},i.prototype._update=function(t){this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Fi(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset),t&&"moveend"!==t.type||(this._pos=this._pos.round()),n.setTransform(this._element,Ni[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px)"))},i.prototype.getOffset=function(){return this._offset},i.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},i.prototype._onMove=function(e){this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))},i.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},i.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},i.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},i.prototype.isDraggable=function(){return this._draggable},i}(t.Evented),Wi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},Hi=function(e){function i(n){e.call(this),this.options=t.extend({},Wi,n),t.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.onAdd=function(e){var i;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==Vi?i(Vi):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then(function(t){Vi="denied"!==t.state,i(Vi)}):(Vi=!!t.window.navigator.geolocation,i(Vi)),this._container},i.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),n.remove(this._container),this._map=void 0},i.prototype._onSuccess=function(e){if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()},i.prototype._updateCamera=function(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,r=this._map.getBearing(),a=t.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),a,{geolocateSource:!0})},i.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},i.prototype._onError=function(e){if(this.options.trackUserLocation)if(1===e.code)this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()},i.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},i.prototype._setupUI=function(e){var i=this;!1!==e?(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=n.create("button","mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Gi(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(e){e.geolocateSource||"ACTIVE_LOCK"!==i._watchState||(i._watchState="BACKGROUND",i._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),i._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),i.fire(new t.Event("trackuserlocationend")))})):t.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.")},i.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},i.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},i}(t.Evented),qi={maxWidth:100,unit:"metric"},Zi=function(e){this.options=t.extend({},qi,e),t.bindAll(["_onMove","setUnit"],this)};function Xi(t,e,n){var i,r,a,o,s,u,l=n&&n.maxWidth||100,c=t._container.clientHeight/2,h=(i=t.unproject([0,c]),r=t.unproject([l,c]),a=Math.PI/180,o=i.lat*a,s=r.lat*a,u=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos((r.lng-i.lng)*a),6371e3*Math.acos(Math.min(u,1)));if(n&&"imperial"===n.unit){var f=3.2808*h;f>5280?Qi(e,l,f/5280,"mi"):Qi(e,l,f,"ft")}else n&&"nautical"===n.unit?Qi(e,l,h/1852,"nm"):Qi(e,l,h,"m")}function Qi(t,e,n,i){var r,a,o,s=(r=n,(a=Math.pow(10,(""+Math.floor(r)).length-1))*(o=(o=r/a)>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(o))),u=s/n;"m"===i&&s>=1e3&&(s/=1e3,i="km"),t.style.width=e*u+"px",t.innerHTML=s+i}Zi.prototype.getDefaultPosition=function(){return"bottom-left"},Zi.prototype._onMove=function(){Xi(this._map,this._container,this.options)},Zi.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Zi.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Zi.prototype.setUnit=function(t){this.options.unit=t,Xi(this._map,this._container,this.options)};var Yi=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="mapboxgl-ctrl"};Yi.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div",this._className+" mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Yi.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Yi.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Yi.prototype._setupUI=function(){(this._fullscreenButton=n.create("button",this._className+"-icon "+this._className+"-fullscreen",this._controlContainer)).type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Yi.prototype._updateTitle=function(){var t=this._isFullscreen()?"Exit fullscreen":"Enter fullscreen";this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Yi.prototype._isFullscreen=function(){return this._fullscreen},Yi.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"),this._updateTitle())},Yi.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Ki={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},Ji=function(e){function i(n){e.call(this),this.options=t.extend(Object.create(Ki),n),t.bindAll(["_update","_onClickClose","remove"],this)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.addTo=function(e){return this._map=e,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._map.on("remove",this.remove),this._update(),this.fire(new t.Event("open")),this},i.prototype.isOpen=function(){return!!this._map},i.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),this._map.off("remove",this.remove),delete this._map),this.fire(new t.Event("close")),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._update(),this},i.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},i.prototype.setHTML=function(e){var n,i=t.window.document.createDocumentFragment(),r=t.window.document.createElement("body");for(r.innerHTML=e;n=r.firstChild;)i.appendChild(n);return this.setDOMContent(i)},i.prototype.getMaxWidth=function(){return this._container.style.maxWidth},i.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},i.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},i.prototype._createContent=function(){this._content&&n.remove(this._content),this._content=n.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},i.prototype._update=function(){var e=this;if(this._map&&this._lngLat&&this._content){this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(t){return e._container.classList.add(t)})),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&(this._lngLat=Fi(this._lngLat,this._pos,this._map.transform));var i=this._pos=this._map.project(this._lngLat),r=this.options.anchor,a=function e(n){if(n){if("number"==typeof n){var i=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(i,i),"top-right":new t.Point(-i,i),bottom:new t.Point(0,-n),"bottom-left":new t.Point(i,-i),"bottom-right":new t.Point(-i,-i),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){var r=t.Point.convert(n);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!r){var o,s=this._container.offsetWidth,u=this._container.offsetHeight;o=i.y+a.bottom.y<u?["top"]:i.y>this._map.transform.height-u?["bottom"]:[],i.x<s/2?o.push("left"):i.x>this._map.transform.width-s/2&&o.push("right"),r=0===o.length?"bottom":o.join("-")}var l=i.add(a[r]).round();n.setTransform(this._container,Ni[r]+" translate("+l.x+"px,"+l.y+"px)"),Ui(this._container,r,"popup")}},i.prototype._onClickClose=function(){this.remove()},i}(t.Evented),$i={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,Map:zi,NavigationControl:Ri,GeolocateControl:Hi,AttributionControl:Ci,ScaleControl:Zi,FullscreenControl:Yi,Popup:Ji,Marker:Gi,Style:De,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Lt.workerCount},set workerCount(t){Lt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},workerUrl:""};return $i}),n}()},"54ZI":function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}n.d(e,"a",function(){return i})},"5a1V":function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"loader assertion failed.")}n.d(e,"a",function(){return i})},"5ku3":function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return a});var i=n("U8pU"),r=n("I0ug");function a(){return!("object"===(void 0===t?"undefined":Object(i.a)(t))&&"[object process]"===String(t)&&!1)||Object(r.a)()}}).call(this,n("8oxB"))},"6pOq":function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return f});var i=n("1OyB"),r=n("vuIU"),a=n("rePB"),o=n("17x9"),s=n.n(o),u=n("2lZV");var l={container:s.a.object,gl:s.a.object,mapboxApiAccessToken:s.a.string,mapboxApiUrl:s.a.string,attributionControl:s.a.bool,preserveDrawingBuffer:s.a.bool,reuseMaps:s.a.bool,transformRequest:s.a.func,mapOptions:s.a.object,mapStyle:s.a.oneOfType([s.a.string,s.a.object]),visible:s.a.bool,asyncRender:s.a.bool,onLoad:s.a.func,onError:s.a.func,width:s.a.number,height:s.a.number,viewState:s.a.object,longitude:s.a.number,latitude:s.a.number,zoom:s.a.number,bearing:s.a.number,pitch:s.a.number,altitude:s.a.number},c={container:u.a.body,mapboxApiAccessToken:function(){var e=null;if("undefined"!=typeof window&&window.location){var n=window.location.search.match(/access_token=([^&\/]*)/);e=n&&n[1]}e||void 0===t||(e=e||t.env.MapboxAccessToken||t.env.REACT_APP_MAPBOX_ACCESS_TOKEN);return e||"no-token"}(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:function(){},onError:function(t){t&&console.error(t.error)},width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0};function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"component";t.debug&&s.a.checkPropTypes(l,t,"prop",e)}var f=function(){function t(e){var n=this;if(Object(i.a)(this,t),Object(a.a)(this,"mapboxgl",void 0),Object(a.a)(this,"props",c),Object(a.a)(this,"_map",null),Object(a.a)(this,"width",0),Object(a.a)(this,"height",0),Object(a.a)(this,"_fireLoadEvent",function(){n.props.onLoad({type:"load",target:n._map})}),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return Object(r.a)(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(e){this._map=t.savedMap;var n=this._map.getContainer(),i=e.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,t.savedMap=null,e.mapStyle&&this._map.setStyle(e.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(e){if(e.reuseMaps&&t.savedMap)this._reuse(e);else{if(e.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,e.gl}}var i={container:e.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:e.mapStyle,interactive:!1,trackResize:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(i.transformRequest=e.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,e.mapOptions)),this._map.once("load",e.onLoad),this._map.on("error",e.onError)}return this}},{key:"_destroy",value:function(){this._map&&(t.savedMap?this._map.remove():(t.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(t){var e=this;h(t=Object.assign({},c,t),"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||c.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var n=t.container;Object.defineProperty(n,"offsetWidth",{get:function(){return e.width}}),Object.defineProperty(n,"clientWidth",{get:function(){return e.width}}),Object.defineProperty(n,"offsetHeight",{get:function(){return e.height}}),Object.defineProperty(n,"clientHeight",{get:function(){return e.height}});var i=this._map.getCanvas();i&&(i.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,e){if(this._map){h(e=Object.assign({},this.props,e),"Mapbox");var n=this._updateMapViewport(t,e),i=this._updateMapSize(t,e);e.asyncRender||!n&&!i||this.redraw(),this.props=e}}},{key:"_updateMapSize",value:function(t,e){var n=t.width!==e.width||t.height!==e.height;return n&&(this.width=e.width,this.height=e.height,this.resize()),n}},{key:"_updateMapViewport",value:function(t,e){var n=this._getViewState(t),i=this._getViewState(e),r=i.latitude!==n.latitude||i.longitude!==n.longitude||i.zoom!==n.zoom||i.pitch!==n.pitch||i.bearing!==n.bearing||i.altitude!==n.altitude;return r&&(this._map.jumpTo(this._viewStateToMapboxProps(i)),i.altitude!==n.altitude&&(this._map.transform.altitude=i.altitude)),r}},{key:"_getViewState",value:function(t){var e=t.viewState||t,n=e.longitude,i=e.latitude,r=e.zoom,a=e.pitch,o=void 0===a?0:a,s=e.bearing,u=void 0===s?0:s,l=e.altitude;return{longitude:n,latitude:i,zoom:r,pitch:o,bearing:u,altitude:void 0===l?1.5:l}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0.47.0";if(void 0!==u.a)try{var e=u.a.createElement("div");if(e.className="mapboxgl-map",e.style.display="none",u.a.body.append(e),!("static"!==window.getComputedStyle(e).position)){var n=u.a.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),u.a.head.append(n)}}catch(i){}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),t}();Object(a.a)(f,"initialized",!1),Object(a.a)(f,"propTypes",l),Object(a.a)(f,"defaultProps",c),Object(a.a)(f,"savedMap",null)}).call(this,n("8oxB"))},"7+mA":function(t,e,n){"use strict";var i=n("rePB");e.a={enable:function(t,e){return t(Object(i.a)({},e,!0))},disable:function(t,e){return t(Object(i.a)({},e,!1))},pixelStorei:function(t,e,n){return t(Object(i.a)({},e,n))},hint:function(t,e,n){return t(Object(i.a)({},e,n))},bindFramebuffer:function(t,e,n){var r;switch(e){case 36160:return t((r={},Object(i.a)(r,36006,n),Object(i.a)(r,36010,n),r));case 36009:return t(Object(i.a)({},36006,n));case 36008:return t(Object(i.a)({},36010,n));default:return null}},blendColor:function(t,e,n,r,a){return t(Object(i.a)({},32773,new Float32Array([e,n,r,a])))},blendEquation:function(t,e){var n;return t((n={},Object(i.a)(n,32777,e),Object(i.a)(n,34877,e),n))},blendEquationSeparate:function(t,e,n){var r;return t((r={},Object(i.a)(r,32777,e),Object(i.a)(r,34877,n),r))},blendFunc:function(t,e,n){var r;return t((r={},Object(i.a)(r,32969,e),Object(i.a)(r,32968,n),Object(i.a)(r,32971,e),Object(i.a)(r,32970,n),r))},blendFuncSeparate:function(t,e,n,r,a){var o;return t((o={},Object(i.a)(o,32969,e),Object(i.a)(o,32968,n),Object(i.a)(o,32971,r),Object(i.a)(o,32970,a),o))},clearColor:function(t,e,n,r,a){return t(Object(i.a)({},3106,new Float32Array([e,n,r,a])))},clearDepth:function(t,e){return t(Object(i.a)({},2931,e))},clearStencil:function(t,e){return t(Object(i.a)({},2961,e))},colorMask:function(t,e,n,r,a){return t(Object(i.a)({},3107,[e,n,r,a]))},cullFace:function(t,e){return t(Object(i.a)({},2885,e))},depthFunc:function(t,e){return t(Object(i.a)({},2932,e))},depthRange:function(t,e,n){return t(Object(i.a)({},2928,new Float32Array([e,n])))},depthMask:function(t,e){return t(Object(i.a)({},2930,e))},frontFace:function(t,e){return t(Object(i.a)({},2886,e))},lineWidth:function(t,e){return t(Object(i.a)({},2849,e))},polygonOffset:function(t,e,n){var r;return t((r={},Object(i.a)(r,32824,e),Object(i.a)(r,10752,n),r))},sampleCoverage:function(t,e,n){var r;return t((r={},Object(i.a)(r,32938,e),Object(i.a)(r,32939,n),r))},scissor:function(t,e,n,r,a){return t(Object(i.a)({},3088,new Int32Array([e,n,r,a])))},stencilMask:function(t,e){var n;return t((n={},Object(i.a)(n,2968,e),Object(i.a)(n,36005,e),n))},stencilMaskSeparate:function(t,e,n){return t(Object(i.a)({},1028===e?2968:36005,n))},stencilFunc:function(t,e,n,r){var a;return t((a={},Object(i.a)(a,2962,e),Object(i.a)(a,2967,n),Object(i.a)(a,2963,r),Object(i.a)(a,34816,e),Object(i.a)(a,36003,n),Object(i.a)(a,36004,r),a))},stencilFuncSeparate:function(t,e,n,r,a){var o;return t((o={},Object(i.a)(o,1028===e?2962:34816,n),Object(i.a)(o,1028===e?2967:36003,r),Object(i.a)(o,1028===e?2963:36004,a),o))},stencilOp:function(t,e,n,r){var a;return t((a={},Object(i.a)(a,2964,e),Object(i.a)(a,2965,n),Object(i.a)(a,2966,r),Object(i.a)(a,34817,e),Object(i.a)(a,34818,n),Object(i.a)(a,34819,r),a))},stencilOpSeparate:function(t,e,n,r,a){var o;return t((o={},Object(i.a)(o,1028===e?2964:34817,n),Object(i.a)(o,1028===e?2965:34818,r),Object(i.a)(o,1028===e?2966:34819,a),o))},viewport:function(t,e,n,r,a){return t(Object(i.a)({},2978,new Int32Array([e,n,r,a])))}}},"7Kp1":function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}n("1eIE");function r(t){for(var e in t)return!1;return!0}function a(t){return Boolean(t&&2===t._version)}n.d(e,"a",function(){return i}),n.d(e,"c",function(){return a}),n.d(e,"b",function(){return r})},"8oxB":function(t,e){var n,i,r=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(t){n=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var u,l=[],c=!1,h=-1;function f(){c&&u&&(c=!1,u.length?l=u.concat(l):h=-1,l.length&&p())}function p(){if(!c){var t=s(f);c=!0;for(var e=l.length;e;){for(u=l,l=[];++h<e;)u&&u[h].run();h=-1,e=l.length}u=null,c=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function A(t,e){this.fun=t,this.array=e}function d(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new A(t,e)),1!==l.length||c||s(p)},A.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},"9Hqq":function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"webgl2-polyfill: assertion failed.")}n.d(e,"a",function(){return i})},B7nP:function(t,e,n){"use strict";n.d(e,"l",function(){return v}),n.d(e,"i",function(){return g}),n.d(e,"g",function(){return m}),n.d(e,"j",function(){return y}),n.d(e,"c",function(){return _}),n.d(e,"b",function(){return b}),n.d(e,"a",function(){return x}),n.d(e,"f",function(){return w}),n.d(e,"e",function(){return S}),n.d(e,"d",function(){return k}),n.d(e,"k",function(){return O}),n.d(e,"h",function(){return P});var i=n("ODXe"),r=n("VKpO"),a=n("ZaHm"),o=n("ZxFD"),s=n("n+fv"),u=n("54ZI"),l=Math.PI,c=l/4,h=l/180,f=180/l,p=512,A=4003e4,d=1.5;function v(t){return Math.pow(2,t)}function g(t){return Math.log2(t)}function m(t,e){var n=Object(i.a)(t,2),r=n[0],a=n[1];Object(u.a)(Number.isFinite(r)&&Number.isFinite(e)),Object(u.a)(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude");var o=a*h;return[(e*=p)*(r*h+l)/(2*l),e*(l-Math.log(Math.tan(c+.5*o)))/(2*l)]}function y(t,e){var n=Object(i.a)(t,2),r=n[0],a=n[1],o=r/(e*=p)*(2*l)-l,s=2*(Math.atan(Math.exp(l-a/e*(2*l)))-c);return[o*f,s*f]}function _(t){var e=t.latitude;Object(u.a)(Number.isFinite(e));var n=Math.cos(e*h);return g(A*n)-9}function b(t){var e=t.latitude,n=t.longitude,i=t.zoom,r=t.scale,a=t.highPrecision,o=void 0!==a&&a;r=void 0!==r?r:v(i),Object(u.a)(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(r));var s={},l=p*r,c=Math.cos(e*h),f=l/360,d=f/c,g=l/A/c;if(s.pixelsPerMeter=[g,-g,g],s.metersPerPixel=[1/g,-1/g,1/g],s.pixelsPerDegree=[f,-d,g],s.degreesPerPixel=[1/f,-1/d,1/g],o){var m=h*Math.tan(e*h)/c,y=f*m/2,_=l/A*m,b=_/d*g;s.pixelsPerDegree2=[0,-y,_],s.pixelsPerMeter2=[b,0,b]}return s}function x(t,e){var n=Object(i.a)(t,3),r=n[0],a=n[1],o=n[2],s=Object(i.a)(e,3),u=s[0],l=s[1],c=s[2],h=b({longitude:r,latitude:a,scale:1,highPrecision:!0}),f=h.pixelsPerMeter,p=h.pixelsPerMeter2,A=m(t,1);A[0]+=u*(f[0]+p[0]*l),A[1]+=l*(f[1]+p[1]*l);var d=y(A,1),v=(o||0)+(c||0);return Number.isFinite(o)||Number.isFinite(c)?[d[0],d[1],v]:d}function w(t){var e=t.height,n=t.pitch,i=t.bearing,o=t.altitude,u=t.center,l=void 0===u?null:u,c=t.flipY,f=void 0!==c&&c,p=Object(r.a)();return a.o(p,p,[0,0,-o]),a.n(p,p,[1,1,1/e]),a.k(p,p,-n*h),a.m(p,p,i*h),f&&a.n(p,p,[1,-1,1]),l&&a.o(p,p,s.d([],l)),p}function S(t){var e=t.width,n=t.height,i=t.altitude,r=void 0===i?d:i,a=t.pitch,o=void 0===a?0:a,s=t.nearZMultiplier,u=void 0===s?1:s,l=t.farZMultiplier,c=void 0===l?1:l,f=o*h,p=Math.atan(.5/r),A=Math.sin(p)*r/Math.sin(Math.PI/2-f-p),v=Math.cos(Math.PI/2-f)*A+r;return{fov:2*Math.atan(n/2/r),aspect:e/n,focalDistance:r,near:u,far:v*c}}function k(t){var e=t.width,n=t.height,i=t.pitch,r=S({width:e,height:n,altitude:t.altitude,pitch:i,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),o=r.fov,s=r.aspect,u=r.near,l=r.far;return a.i([],o,s,u,l)}function O(t,e){var n=Object(i.a)(t,3),a=n[0],o=n[1],s=n[2],l=void 0===s?0:s;return Object(u.a)(Number.isFinite(a)&&Number.isFinite(o)&&Number.isFinite(l)),Object(r.d)(e,[a,o,l,1])}function P(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Object(i.a)(t,3),s=a[0],l=a[1],c=a[2];if(Object(u.a)(Number.isFinite(s)&&Number.isFinite(l),"invalid pixel coordinate"),Number.isFinite(c))return Object(r.d)(e,[s,l,c,1]);var h=Object(r.d)(e,[s,l,0,1]),f=Object(r.d)(e,[s,l,1,1]),p=h[2],A=f[2],d=p===A?0:((n||0)-p)/(A-p);return o.d([],h,f,d)}},BaY6:function(t,e,n){"use strict";var i=n("5Uuq");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n("/MKj"),a=n("04ZO"),o=n("XiiD"),s=i(n("Uxdj")),u=(0,r.connect)(function(t){return{theme:o.appSelectors.getTheme(t),mapboxToken:o.appSelectors.getMapboxToken(t)}})((0,a.withStyles)(s.styles)(s.default));e.default=u},FWU8:function(t,e,n){"use strict";(function(t){n.d(e,"c",function(){return l}),n.d(e,"b",function(){return p}),n.d(e,"a",function(){return A});var i=n("1OyB"),r=n("iTDY"),a=n("IIwk"),o="luma.gl: loaded under Node.js without headless gl installed, meaning that WebGL contexts can not be created. This may not be an error. For example, this is a typical configuration for isorender applications running on the server.",s=t,u=null;function l(){var t=s.require("gl");if(!t)throw new Error(o);return t.apply(void 0,arguments)}if(!a.a)try{u=s.require("gl/wrap")}catch(d){}var c=function t(){Object(i.a)(this,t)},h=u||r.b,f=(h.WebGLRenderingContext,h.WebGLProgram,h.WebGLShader,h.WebGLBuffer),p=void 0===f?c:f;h.WebGLFramebuffer,h.WebGLRenderbuffer,h.WebGLTexture,h.WebGLUniformLocation,h.WebGLActiveInfo,h.WebGLShaderPrecisionFormat;var A=r.b.WebGL2RenderingContext||function t(){Object(i.a)(this,t)};r.b.Image}).call(this,n("BKcT")(t))},H7XF:function(t,e,n){"use strict";e.byteLength=function(t){var e=l(t),n=e[0],i=e[1];return 3*(n+i)/4-i},e.toByteArray=function(t){for(var e,n=l(t),i=n[0],o=n[1],s=new a(function(t,e,n){return 3*(e+n)/4-n}(0,i,o)),u=0,c=o>0?i-4:i,h=0;h<c;h+=4)e=r[t.charCodeAt(h)]<<18|r[t.charCodeAt(h+1)]<<12|r[t.charCodeAt(h+2)]<<6|r[t.charCodeAt(h+3)],s[u++]=e>>16&255,s[u++]=e>>8&255,s[u++]=255&e;2===o&&(e=r[t.charCodeAt(h)]<<2|r[t.charCodeAt(h+1)]>>4,s[u++]=255&e);1===o&&(e=r[t.charCodeAt(h)]<<10|r[t.charCodeAt(h+1)]<<4|r[t.charCodeAt(h+2)]>>2,s[u++]=e>>8&255,s[u++]=255&e);return s},e.fromByteArray=function(t){for(var e,n=t.length,r=n%3,a=[],o=0,s=n-r;o<s;o+=16383)a.push(c(t,o,o+16383>s?s:o+16383));1===r?(e=t[n-1],a.push(i[e>>2]+i[e<<4&63]+"==")):2===r&&(e=(t[n-2]<<8)+t[n-1],a.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+"="));return a.join("")};for(var i=[],r=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)i[s]=o[s],r[o.charCodeAt(s)]=s;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function c(t,e,n){for(var r,a,o=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),o.push(i[(a=r)>>18&63]+i[a>>12&63]+i[a>>6&63]+i[63&a]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},"HaE+":function(t,e,n){"use strict";function i(t,e,n,i,r,a,o){try{var s=t[a](o),u=s.value}catch(l){return void n(l)}s.done?e(u):Promise.resolve(u).then(i,r)}function r(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var o=t.apply(e,n);function s(t){i(o,r,a,s,u,"next",t)}function u(t){i(o,r,a,s,u,"throw",t)}s(void 0)})}}n.d(e,"a",function(){return r})},HrBr:function(t,e,n){"use strict";var i=n("U8pU"),r=n("ODXe"),a={boolean:{validate:function(t,e){return!0}},number:{validateType:function(t,e){return"value"in e&&(!("max"in e)||Number.isFinite(e.max))&&(!("min"in e)||Number.isFinite(e.min))},validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}}};function o(t,e){switch(s(e)){case"object":return function(t){var e=t.type;(a[e]||{}).typeValidator;return t}(e=function(t,e){if(!("type"in e))return"value"in e?Object.assign({name:t,type:s(e.value)},e):{name:t,type:"object",value:e};return Object.assign({name:t},e)}(t,e));case"array":return function(t,e){if(/color/i.test(t)&&(3===e.length||4===e.length))return{name:t,type:"color",value:e};return{name:t,type:"array",value:e}}(t,e);case"boolean":return{name:t,type:"boolean",value:e};case"number":return function(t,e){var n=/radius|scale|width|height|pixel|size|miter/i.test(t)&&/^((?!scale).)*$/.test(t)?100:1;return{name:t,type:"number",max:Math.max(e,n),min:Math.min(e,0),value:e}}(t,e);case"function":return{name:t,type:"function",value:e};default:return{name:t,type:"unknown",value:e}}}function s(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":null===t?"null":Object(i.a)(t)}function u(t){if(!t.normalized){if(t.normalized=!0,t.uniforms){var e=function(t){for(var e={},n={},i=0,a=Object.entries(t);i<a.length;i++){var s=Object(r.a)(a[i],2),u=s[0],l=o(u,s[1]);e[u]=l,n[u]=l.value}return{propTypes:e,defaultProps:n}}(t.uniforms).propTypes;t.uniforms=e}t.uniforms&&!t.getUniforms&&(t.getUniforms=function(t,e){var n={};if(void 0===e){for(var i in t.uniforms)n[i]=t.uniforms[i].value;return n}for(var r in e)n[r]=e[r];return n}.bind(null,t))}return t}n.d(e,"a",function(){return u})},I0ug:function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return r});var i=n("U8pU");function r(e){if("undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==t&&"object"===Object(i.a)(t.versions)&&Boolean(t.versions.electron))return!0;var n="object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,r=e||n;return!!(r&&r.indexOf("Electron")>=0)}}).call(this,n("8oxB"))},IIwk:function(t,e,n){"use strict";(function(t){var i=n("U8pU"),r=n("T8J6"),a=!("object"===(void 0===t?"undefined":Object(i.a)(t))&&"[object process]"===String(t)&&!1)||r.a;e.a=a}).call(this,n("8oxB"))},JOTL:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("egY1"),o=function(){function t(e){Object(i.a)(this,t),this.name=e,this.reset()}return Object(r.a)(t,[{key:"incrementCount",value:function(){this.addCount(1)}},{key:"decrementCount",value:function(){this.subtractCount(1)}},{key:"addCount",value:function(t){this.count+=t}},{key:"subtractCount",value:function(t){this.count-=t}},{key:"addTime",value:function(t){this.time+=t,this.lastTiming=t,this.count++}},{key:"timeStart",value:function(){this._startTime=Object(a.a)(),this._timerPending=!0}},{key:"timeEnd",value:function(){this._timerPending&&(this.addTime(Object(a.a)()-this._startTime),this._timerPending=!1)}},{key:"getAverageTime",value:function(){return this.count>0?this.time/this.count:0}},{key:"getHz",value:function(){return this.time>0?this.count/(this.time/1e3):0}},{key:"reset",value:function(){this.time=0,this.count=0,this.lastTiming=0,this._startTime=0,this._timerPending=!1}}]),t}();n.d(e,"a",function(){return s});var s=function(){function t(e){var n=e.id;Object(i.a)(this,t),this.id=n,this.stats={},Object.seal(this)}return Object(r.a)(t,[{key:"get",value:function(t){return this.stats[t]=this.stats[t]||new o(t),this.stats[t]}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach(function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}}]),t}()},Ji7U:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("s4An");function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Object(i.a)(t,e)}},K9nA:function(t,e,n){"use strict";(function(t,i){n.d(e,"b",function(){return o}),n.d(e,"a",function(){return s});var r=n("U8pU"),a={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document,process:"object"===(void 0===i?"undefined":Object(r.a)(i))&&i},o=a.window||a.self||a.global,s=a.process||{};console}).call(this,n("3r9c"),n("8oxB"))},LhmN:function(t,e,n){"use strict";n.d(e,"b",function(){return l}),n.d(e,"d",function(){return p}),n.d(e,"a",function(){return A}),n.d(e,"c",function(){return v});var i,r,a,o=n("KQm4"),s=n("rePB"),u=n("7Kp1"),l=(i={},Object(s.a)(i,3042,!1),Object(s.a)(i,32773,new Float32Array([0,0,0,0])),Object(s.a)(i,32777,32774),Object(s.a)(i,34877,32774),Object(s.a)(i,32969,1),Object(s.a)(i,32968,0),Object(s.a)(i,32971,1),Object(s.a)(i,32970,0),Object(s.a)(i,3106,new Float32Array([0,0,0,0])),Object(s.a)(i,3107,[!0,!0,!0,!0]),Object(s.a)(i,2884,!1),Object(s.a)(i,2885,1029),Object(s.a)(i,2929,!1),Object(s.a)(i,2931,1),Object(s.a)(i,2932,513),Object(s.a)(i,2928,new Float32Array([0,1])),Object(s.a)(i,2930,!0),Object(s.a)(i,3024,!0),Object(s.a)(i,36006,null),Object(s.a)(i,2886,2305),Object(s.a)(i,33170,4352),Object(s.a)(i,2849,1),Object(s.a)(i,32823,!1),Object(s.a)(i,32824,0),Object(s.a)(i,10752,0),Object(s.a)(i,32938,1),Object(s.a)(i,32939,!1),Object(s.a)(i,3089,!1),Object(s.a)(i,3088,new Int32Array([0,0,1024,1024])),Object(s.a)(i,2960,!1),Object(s.a)(i,2961,0),Object(s.a)(i,2968,4294967295),Object(s.a)(i,36005,4294967295),Object(s.a)(i,2962,519),Object(s.a)(i,2967,0),Object(s.a)(i,2963,4294967295),Object(s.a)(i,34816,519),Object(s.a)(i,36003,0),Object(s.a)(i,36004,4294967295),Object(s.a)(i,2964,7680),Object(s.a)(i,2965,7680),Object(s.a)(i,2966,7680),Object(s.a)(i,34817,7680),Object(s.a)(i,34818,7680),Object(s.a)(i,34819,7680),Object(s.a)(i,2978,new Int32Array([0,0,1024,1024])),Object(s.a)(i,3333,4),Object(s.a)(i,3317,4),Object(s.a)(i,37440,!1),Object(s.a)(i,37441,!1),Object(s.a)(i,37443,37444),Object(s.a)(i,35723,4352),Object(s.a)(i,36010,null),Object(s.a)(i,35977,!1),Object(s.a)(i,3330,0),Object(s.a)(i,3332,0),Object(s.a)(i,3331,0),Object(s.a)(i,3314,0),Object(s.a)(i,32878,0),Object(s.a)(i,3316,0),Object(s.a)(i,3315,0),Object(s.a)(i,32877,0),i),c=function(t,e,n){return e?t.enable(n):t.disable(n)},h=function(t,e,n){return t.hint(n,e)},f=function(t,e,n){return t.pixelStorei(n,e)},p=(r={},Object(s.a)(r,3042,c),Object(s.a)(r,32773,function(t,e){return t.blendColor.apply(t,Object(o.a)(e))}),Object(s.a)(r,32777,"blendEquation"),Object(s.a)(r,34877,"blendEquation"),Object(s.a)(r,32969,"blendFunc"),Object(s.a)(r,32968,"blendFunc"),Object(s.a)(r,32971,"blendFunc"),Object(s.a)(r,32970,"blendFunc"),Object(s.a)(r,3106,function(t,e){return t.clearColor.apply(t,Object(o.a)(e))}),Object(s.a)(r,3107,function(t,e){return t.colorMask.apply(t,Object(o.a)(e))}),Object(s.a)(r,2884,c),Object(s.a)(r,2885,function(t,e){return t.cullFace(e)}),Object(s.a)(r,2929,c),Object(s.a)(r,2931,function(t,e){return t.clearDepth(e)}),Object(s.a)(r,2932,function(t,e){return t.depthFunc(e)}),Object(s.a)(r,2928,function(t,e){return t.depthRange.apply(t,Object(o.a)(e))}),Object(s.a)(r,2930,function(t,e){return t.depthMask(e)}),Object(s.a)(r,3024,c),Object(s.a)(r,35723,h),Object(s.a)(r,36006,function(t,e){var n=Object(u.c)(t)?36009:36160;return t.bindFramebuffer(n,e)}),Object(s.a)(r,2886,function(t,e){return t.frontFace(e)}),Object(s.a)(r,33170,h),Object(s.a)(r,2849,function(t,e){return t.lineWidth(e)}),Object(s.a)(r,32823,c),Object(s.a)(r,32824,"polygonOffset"),Object(s.a)(r,10752,"polygonOffset"),Object(s.a)(r,35977,c),Object(s.a)(r,32938,"sampleCoverage"),Object(s.a)(r,32939,"sampleCoverage"),Object(s.a)(r,3089,c),Object(s.a)(r,3088,function(t,e){return t.scissor.apply(t,Object(o.a)(e))}),Object(s.a)(r,2960,c),Object(s.a)(r,2961,function(t,e){return t.clearStencil(e)}),Object(s.a)(r,2968,function(t,e){return t.stencilMaskSeparate(1028,e)}),Object(s.a)(r,36005,function(t,e){return t.stencilMaskSeparate(1029,e)}),Object(s.a)(r,2962,"stencilFuncFront"),Object(s.a)(r,2967,"stencilFuncFront"),Object(s.a)(r,2963,"stencilFuncFront"),Object(s.a)(r,34816,"stencilFuncBack"),Object(s.a)(r,36003,"stencilFuncBack"),Object(s.a)(r,36004,"stencilFuncBack"),Object(s.a)(r,2964,"stencilOpFront"),Object(s.a)(r,2965,"stencilOpFront"),Object(s.a)(r,2966,"stencilOpFront"),Object(s.a)(r,34817,"stencilOpBack"),Object(s.a)(r,34818,"stencilOpBack"),Object(s.a)(r,34819,"stencilOpBack"),Object(s.a)(r,2978,function(t,e){return t.viewport.apply(t,Object(o.a)(e))}),Object(s.a)(r,3333,f),Object(s.a)(r,3317,f),Object(s.a)(r,37440,f),Object(s.a)(r,37441,f),Object(s.a)(r,37443,f),Object(s.a)(r,3330,f),Object(s.a)(r,3332,f),Object(s.a)(r,3331,f),Object(s.a)(r,36010,function(t,e){return t.bindFramebuffer(36008,e)}),Object(s.a)(r,3314,f),Object(s.a)(r,32878,f),Object(s.a)(r,3316,f),Object(s.a)(r,3315,f),Object(s.a)(r,32877,f),r),A={blendEquation:function(t,e){return t.blendEquationSeparate(e[32777],e[34877])},blendFunc:function(t,e){return t.blendFuncSeparate(e[32969],e[32968],e[32971],e[32970])},polygonOffset:function(t,e){return t.polygonOffset(e[32824],e[10752])},sampleCoverage:function(t,e){return t.sampleCoverage(e[32938],e[32939])},stencilFuncFront:function(t,e){return t.stencilFuncSeparate(1028,e[2962],e[2967],e[2963])},stencilFuncBack:function(t,e){return t.stencilFuncSeparate(1029,e[34816],e[36003],e[36004])},stencilOpFront:function(t,e){return t.stencilOpSeparate(1028,e[2964],e[2965],e[2966])},stencilOpBack:function(t,e){return t.stencilOpSeparate(1029,e[34817],e[34818],e[34819])}},d=function(t,e){return t.isEnabled(e)},v=(a={},Object(s.a)(a,3042,d),Object(s.a)(a,2884,d),Object(s.a)(a,2929,d),Object(s.a)(a,3024,d),Object(s.a)(a,32823,d),Object(s.a)(a,32926,d),Object(s.a)(a,32928,d),Object(s.a)(a,3089,d),Object(s.a)(a,2960,d),Object(s.a)(a,35977,d),a)},O7G5:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var i=n("VKpO"),r=n("B7nP"),a=n("ZxFD"),o=.01,s=["longitude","latitude","zoom"];function u(t,e,n){var u={},l=t.zoom,c=[t.longitude,t.latitude],h=Object(r.l)(l),f=e.zoom,p=[e.longitude,e.latitude],A=Object(r.l)(f-l),d=Object(r.g)(c,h),v=Object(r.g)(p,h),g=a.g([],v,d),m=Math.max(t.width,t.height),y=m/A,_=a.c(g);if(Math.abs(_)<o){for(var b=0;b<s.length;b++){var x=s[b],w=t[x],S=e[x];u[x]=Object(i.b)(w,S,n)}return u}var k=1.414*1.414,O=(y*y-m*m+k*k*_*_)/(2*m*k*_),P=(y*y-m*m-k*k*_*_)/(2*y*k*_),E=Math.log(Math.sqrt(O*O+1)-O),C=n*((Math.log(Math.sqrt(P*P+1)-P)-E)/1.414),T=Math.cosh(E)/Math.cosh(E+1.414*C),M=m*((Math.cosh(E)*Math.tanh(E+1.414*C)-Math.sinh(E))/k)/_,j=1/T,L=l+Object(r.i)(j),I=a.f([],g,M);a.a(I,I,d),a.f(I,I,j);var z=Object(r.j)(I,Object(r.l)(L));return u.longitude=z[0],u.latitude=z[1],u.zoom=L,u}},ODXe:function(t,e,n){"use strict";function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(u){r=!0,a=u}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(e,"a",function(){return i})},P0Fk:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU");function a(t,e,n){switch(e){case 300:return n?function(t){return t.replace(/attribute\s+/g,"in ").replace(/varying\s+/g,"out ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(+/g,"texture(").replace(/texture2DLodEXT\(/g,"textureLod(").replace(/textureCubeLodEXT\(/g,"textureLod(")}(t):function(t){return t.replace(/varying\s+/g,"in ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(/g,"texture(").replace(/texture2DLodEXT\(/g,"textureLod(").replace(/textureCubeLodEXT\(/g,"textureLod(")}(t);case 100:return n?function(t){return t.replace(/^in\s+/gm,"attribute ").replace(/^out\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(t):function(t){return t.replace(/^in\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(t);default:throw new Error("unknown GLSL version ".concat(e))}}var o=n("uzDn"),s=function(){function t(e){var n=e.name,r=e.vs,a=e.fs,s=e.dependencies,u=void 0===s?[]:s,l=e.getUniforms,c=void 0===l?function(){return{}}:l,h=e.deprecations,f=void 0===h?[]:h,p=e.defines,A=void 0===p?{}:p,d=e.vertexShader,v=e.fragmentShader;Object(i.a)(this,t),Object(o.a)("string"==typeof n),this.name=n,this.vs=r||d,this.fs=a||v,this.getModuleUniforms=c,this.dependencies=u,this.deprecations=this._parseDeprecationDefinitions(f),this.defines=A}return Object(r.a)(t,[{key:"getModuleSource",value:function(t,e){var n;switch(t){case"vs":n=a(this.vs||"",e,!0);break;case"fs":n=a(this.fs||"",e,!1);break;default:Object(o.a)(!1)}return"string"!=typeof n?"":"#define MODULE_".concat(this.name.toUpperCase(),"\n").concat(n,"// END MODULE_").concat(this.name,"\n\n")}},{key:"getUniforms",value:function(t,e){return this.getModuleUniforms(t,e)}},{key:"getDefines",value:function(){return this.defines}},{key:"checkDeprecations",value:function(t,e){this.deprecations.forEach(function(n){n.regex.test(t)&&(n.deprecated&&e?e.deprecated(n.old,n.new)():e&&e.removed(n.old,n.new)())})}},{key:"_parseDeprecationDefinitions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.forEach(function(t){switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),t}}]),t}(),u=function(){function t(){Object(i.a)(this,t),this.shaderModules={},this.defaultShaderModules=[]}return Object(r.a)(t,[{key:"setDefaultShaderModules",value:function(t){this.defaultShaderModules=this.resolveModules(t)}},{key:"registerShaderModules",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreMultipleRegistrations,n=void 0!==e&&e,i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;this._registerShaderModule(u,n)}}catch(l){r=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}}},{key:"getShaderModule",value:function(t){if(t instanceof s)return t;if("string"!=typeof t)return this._registerShaderModule(t,!0);var e=this.shaderModules[t];return e||Object(o.a)(!1,"Unknown shader module ".concat(t)),e}},{key:"resolveModules",value:function(t){var e=this;return t.map(function(t){return e.getShaderModule(t)})}},{key:"_registerShaderModule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t instanceof s)return t;if(Object(o.a)(t.name,"shader module has no name"),this.shaderModules[t.name]&&!e)throw new Error("shader module ".concat(t.name," already registered"));return(t=new s(t)).dependencies=this.resolveModules(t.dependencies),this.shaderModules[t.name]=t,this.shaderModules[t.name]}}]),t}();n.d(e,"d",function(){return c}),n.d(e,"b",function(){return h}),n.d(e,"c",function(){return f}),n.d(e,"a",function(){return p});var l=new u;function c(t){l.setDefaultShaderModules(t)}function h(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreMultipleRegistrations,n=void 0!==e&&e;l.registerShaderModules(t,{ignoreMultipleRegistrations:n})}function f(t){return t=t.concat(l.defaultShaderModules),A(t=l.resolveModules(t))}function p(t){return l.getShaderModule(t)}function A(t){var e={},n={};return d({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort(function(t,e){return n[e]-n[t]}).map(function(t){return e[t]})}function d(t){var e=t.modules,n=t.level,i=t.moduleMap,r=t.moduleDepth;if(n>=5)throw new Error("Possible loop in shader dependency graph");var a=!0,o=!1,s=void 0;try{for(var u,l=e[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;i[c.name]=c,(void 0===r[c.name]||r[c.name]<n)&&(r[c.name]=n)}}catch(m){o=!0,s=m}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}var h=!0,f=!1,p=void 0;try{for(var A,v=e[Symbol.iterator]();!(h=(A=v.next()).done);h=!0){var g=A.value;g.dependencies&&d({modules:g.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}}catch(m){f=!0,p=m}finally{try{h||null==v.return||v.return()}finally{if(f)throw p}}}},RHh3:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("s4An");function r(t,e,n){return(r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&Object(i.a)(a,n.prototype),a}).apply(null,arguments)}},RcmO:function(t,e,n){"use strict";var i=n("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(n("q1tI")),a=(0,i(n("8/g6")).default)(r.default.createElement(r.default.Fragment,null,r.default.createElement("path",{d:"M12 7C6.48 7 2 9.24 2 12c0 2.24 2.94 4.13 7 4.77V20l4-4-4-4v2.73c-3.15-.56-5-1.9-5-2.73 0-1.06 3.04-3 8-3s8 1.94 8 3c0 .73-1.46 1.89-4 2.53v2.05c3.53-.77 6-2.53 6-4.58 0-2.76-4.48-5-10-5z"}),r.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"})),"ThreeSixty");e.default=a},ReuC:function(t,e,n){"use strict";var i=n("foSv");function r(t,e,n){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Object(i.a)(t)););return t}(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(n):a.value}})(t,e,n||t)}n.d(e,"a",function(){return r})},Rt0e:function(t,e,n){"use strict";var i=n("KI45");Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.query=void 0;var r=i(n("ln6h")),a=i(n("+oT+")),o=i(n("/HRN")),s=i(n("WaGi")),u=i(n("ZDA2")),l=i(n("/+P4")),c=i(n("N9n2")),h=i(n("q1tI")),f=(n("Ku+5"),n("5upH")),p=i(n("BaY6")),A=i(n("hl3i")),d=i(n("wkow")),v={},g=function(){return n("ZuRb")};e.query=g;var m=function(t){function e(){return(0,o.default)(this,e),(0,u.default)(this,(0,l.default)(e).apply(this,arguments))}return(0,c.default)(e,t),(0,s.default)(e,[{key:"render",value:function(){return h.default.createElement(f.QueryRenderer,{query:g,variables:v,render:function(t){var e=t.error,n=t.props;return h.default.createElement(A.default,{page:"/maps",viewer:n?n.viewer:null,error:e},!e&&!n&&h.default.createElement(d.default,null),!e&&n&&h.default.createElement(p.default,{viewer:n.viewer}))}})}}],[{key:"getInitialProps",value:function(){var t=(0,a.default)(r.default.mark(function t(e){var n;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.fetchQuery,t.next=3,n(g,v);case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}]),e}(h.default.Component);e.default=m},S4Ro:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("h6m0"),l=n("ZxFD"),c=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(i.a)(this,e),t=Object(a.a)(this,Object(o.a)(e).call(this,2)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,r),t}return Object(s.a)(e,t),Object(r.a)(e,[{key:"cross",value:function(t){return l.b(this,this,t),this.check()}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"operation",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return t.apply(void 0,[this,this].concat(n)),this.check()}},{key:"ELEMENTS",get:function(){return 2}}]),e}(u.a)},T8J6:function(t,e,n){"use strict";(function(t){var i=n("U8pU");e.a="undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type||!(void 0===t||"object"!==Object(i.a)(t.versions)||!Boolean(t.versions.electron))||"object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}).call(this,n("8oxB"))},TZTB:function(t,e,n){"use strict";(function(t,i){n.d(e,"a",function(){return a});var r=n("U8pU"),a=("object"!==(void 0===t?"undefined":Object(r.a)(t))||String(t),"undefined"!=typeof window&&window,void 0!==i?i:window);"undefined"!=typeof document&&document}).call(this,n("8oxB"),n("3r9c"))},"U//q":function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return p}),n.d(e,"c",function(){return A}),n.d(e,"b",function(){return d});var i=n("1OyB"),r=n("vuIU"),a=n("7+mA"),o=n("LhmN"),s=n("t+rZ"),u=n("7Kp1"),l=function(t,e){var n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return t===e};function c(t,e){var n=t[e].bind(t);t[e]=function(){var e=arguments.length<=0?void 0:arguments[0];return e in t.state.cache||(t.state.cache[e]=n.apply(void 0,arguments)),t.state.enable?t.state.cache[e]:n.apply(void 0,arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function h(t,e,n){var i=t[e].bind(t);t[e]=function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var s,u=n.apply(void 0,[t.state._updateCache].concat(a)),l=u.valueChanged,c=u.oldValue;l&&((s=t.state).log.apply(s,["gl.".concat(e)].concat(a)),i.apply(void 0,a));return c},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}var f=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.copyState,a=void 0!==r&&r,u=n.log,l=void 0===u?function(){}:u;Object(i.a)(this,t),this.gl=e,this.stateStack=[],this.enable=!0,this.cache=a?Object(s.c)(e):Object.assign({},o.b),this.log=l,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return Object(r.a)(t,[{key:"push",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.stateStack.push({})}},{key:"pop",value:function(){Object(u.a)(this.stateStack.length>0);var t=this.stateStack[this.stateStack.length-1];Object(s.f)(this.gl,t,this.cache),this.stateStack.pop()}},{key:"_updateCache",value:function(t){var e,n=!1,i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var r in t)Object(u.a)(void 0!==r),l(t[r],this.cache[r])||(n=!0,e=this.cache[r],!i||r in i||(i[r]=this.cache[r]),this.cache[r]=t[r]);return{valueChanged:n,oldValue:e}}}]),t}();function p(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.enable,r=void 0===i||i,o=n.copyState;if(Object(u.a)(void 0!==o),!e.state){var s=void 0!==t?t:window;for(var l in s.polyfillContext&&s.polyfillContext(e),e.state=new f(e,{copyState:o,enable:r}),a.a){h(e,l,a.a[l])}c(e,"getParameter"),c(e,"isEnabled")}return e.state.enable=r,e}function A(t){t.state||p(t,{copyState:!1}),t.state.push()}function d(t){Object(u.a)(t.state),t.state.pop()}}).call(this,n("3r9c"))},U8pU:function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return(r="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(t){return i(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)})(t)}n.d(e,"a",function(){return r})},UP1k:function(t,e,n){"use strict";n.r(e);var i=n("1OyB"),r=n("md7G"),a=n("foSv"),o=n("JX7q"),s=n("vuIU"),u=n("Ji7U"),l=n("rePB"),c=n("q1tI"),h=n("17x9"),f=n.n(h);function p(t){if(!t)return null;if("string"==typeof t)return t;t.toJS&&(t=t.toJS());var e=t.layers.reduce(function(t,e){return Object.assign(t,Object(l.a)({},e.id,e))},{});return t.layers=t.layers.map(function(t){delete(t=Object.assign({},t)).interactive;var n=e[t.ref];return n&&(delete t.ref,void 0!==n.type&&(t.type=n.type),void 0!==n.source&&(t.source=n.source),void 0!==n["source-layer"]&&(t["source-layer"]=n["source-layer"]),void 0!==n.minzoom&&(t.minzoom=n.minzoom),void 0!==n.maxzoom&&(t.maxzoom=n.maxzoom),void 0!==n.filter&&(t.filter=n.filter),void 0!==n.layout&&(t.layout=t.layout||{},t.layout=Object.assign({},t.layout,n.layout))),t}),t}var A=n("1A8y"),d=n("jYz7"),v=n("6pOq"),g=n("4ZJM"),m=n.n(g),y=n("ODXe"),_=n("xLQB"),b=1e-9;function x(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function w(t,e){if(t===e)return!0;if(x(t)&&x(e)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!w(t[n],e[n]))return!1;return!0}return Math.abs(t-e)<=b}function S(t,e,n){return Math.max(e,Math.min(n,t))}function k(t,e,n){return x(t)?t.map(function(t,i){return k(t,e[i],n)}):n*e+(1-n)*t}function O(t,e){if(!t)throw new Error(e||"react-map-gl: assertion failed.")}var P=function(){function t(){Object(i.a)(this,t),Object(l.a)(this,"propNames",[])}return Object(s.a)(t,[{key:"arePropsEqual",value:function(t,e){var n=!0,i=!1,r=void 0;try{for(var a,o=(this.propNames||[])[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(!w(t[s],e[s]))return!1}}catch(u){i=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return!0}},{key:"initializeProps",value:function(t,e){return{start:t,end:e}}},{key:"interpolateProps",value:function(t,e,n){O(!1,"interpolateProps is not implemented")}}]),t}(),E=n("O7G5"),C={longitude:1,bearing:1};function T(t){return Number.isFinite(t)||Array.isArray(t)}function M(t,e,n){return function(t){return t in C}(t)&&Math.abs(n-e)>180&&(n=n<0?n+360:n-360),n}var j=["longitude","latitude","zoom","bearing","pitch"],L=["latitude","longitude","zoom","width","height"],I=["bearing","pitch"],z=function(t){function e(){var t,n;Object(i.a)(this,e);for(var s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=Object(r.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(o.a)(n),"propNames",j),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"initializeProps",value:function(t,e){for(var n={},i={},r=0,a=L;r<a.length;r++){var o=a[r],s=t[o],u=e[o];O(T(s)&&T(u),"".concat(o," must be supplied for transition")),n[o]=s,i[o]=M(o,s,u)}for(var l=0,c=I;l<c.length;l++){var h=c[l],f=t[h]||0,p=e[h]||0;n[h]=f,i[h]=M(h,f,p)}return{start:n,end:i}}},{key:"interpolateProps",value:function(t,e,n){for(var i=Object(E.a)(t,e,n),r=0,a=I;r<a.length;r++){var o=a[r];i[o]=k(t[o],e[o],n)}return i}}]),e}(P),D=["longitude","latitude","zoom","bearing","pitch"],B=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.a)(this,e),t=Object(r.a)(this,Object(a.a)(e).call(this)),Object(l.a)(Object(o.a)(t),"around",void 0),Array.isArray(n)&&(n={transitionProps:n}),t.propNames=n.transitionProps||D,n.around&&(t.around=n.around),t}return Object(u.a)(e,t),Object(s.a)(e,[{key:"initializeProps",value:function(t,e){var n={},i={};if(this.around){n.around=this.around;var r=new A.a(t).unproject(this.around);Object.assign(i,e,{around:new A.a(e).project(r),aroundLngLat:r})}var a=!0,o=!1,s=void 0;try{for(var u,l=this.propNames[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value,h=t[c],f=e[c];O(T(h)&&T(f),"".concat(c," must be supplied for transition")),n[c]=h,i[c]=M(c,h,f)}}catch(p){o=!0,s=p}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return{start:n,end:i}}},{key:"interpolateProps",value:function(t,e,n){var i={},r=!0,a=!1,o=void 0;try{for(var s,u=this.propNames[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value;i[l]=k(t[l],e[l],n)}}catch(d){a=!0,o=d}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}if(e.around){var c=new A.a(Object.assign({},e,i)).getMapCenterByLngLatPosition({lngLat:e.aroundLngLat,pos:k(t.around,e.around,n)}),h=Object(y.a)(c,2),f=h[0],p=h[1];i.longitude=f,i.latitude=p}return i}}]),e}(P),R={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},F={pitch:0,bearing:0,altitude:1.5},N=function(){function t(e){var n=e.width,r=e.height,a=e.latitude,o=e.longitude,s=e.zoom,u=e.bearing,c=void 0===u?F.bearing:u,h=e.pitch,f=void 0===h?F.pitch:h,p=e.altitude,A=void 0===p?F.altitude:p,d=e.maxZoom,v=void 0===d?R.maxZoom:d,g=e.minZoom,m=void 0===g?R.minZoom:g,y=e.maxPitch,_=void 0===y?R.maxPitch:y,b=e.minPitch,x=void 0===b?R.minPitch:b,w=e.transitionDuration,S=e.transitionEasing,k=e.transitionInterpolator,P=e.transitionInterruption,E=e.startPanLngLat,C=e.startZoomLngLat,T=e.startBearing,M=e.startPitch,j=e.startZoom;Object(i.a)(this,t),Object(l.a)(this,"_viewportProps",void 0),Object(l.a)(this,"_interactiveState",void 0),O(Number.isFinite(n),"`width` must be supplied"),O(Number.isFinite(r),"`height` must be supplied"),O(Number.isFinite(o),"`longitude` must be supplied"),O(Number.isFinite(a),"`latitude` must be supplied"),O(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:n,height:r,latitude:a,longitude:o,zoom:s,bearing:c,pitch:f,altitude:A,maxZoom:v,minZoom:m,maxPitch:_,minPitch:x,transitionDuration:w,transitionEasing:S,transitionInterpolator:k,transitionInterruption:P}),this._interactiveState={startPanLngLat:E,startZoomLngLat:C,startBearing:T,startPitch:M,startZoom:j}}return Object(s.a)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,i=this._interactiveState.startPanLngLat||this._unproject(n);if(!i)return this;var r=this._calculateNewLngLat({startPanLngLat:i,pos:e}),a=Object(y.a)(r,2),o=a[0],s=a[1];return this._getUpdatedMapState({longitude:o,latitude:s})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedMapState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=void 0===e?0:e,i=t.deltaScaleY,r=void 0===i?0:i,a=this._interactiveState,o=a.startBearing,s=a.startPitch;if(!Number.isFinite(o)||!Number.isFinite(s))return this;var u=this._calculateNewPitchAndBearing({deltaScaleX:n,deltaScaleY:r,startBearing:o||0,startPitch:s||0}),l=u.pitch,c=u.bearing;return this._getUpdatedMapState({bearing:c,pitch:l})}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,i=t.scale;O(i>0,"`scale` must be a positive number");var r=this._interactiveState,a=r.startZoom,o=r.startZoomLngLat;Number.isFinite(a)||(a=this._viewportProps.zoom,o=this._unproject(n)||this._unproject(e)),O(o,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var s=this._calculateNewZoom({scale:i,startZoom:a||0}),u=new A.a(Object.assign({},this._viewportProps,{zoom:s})).getMapCenterByLngLatPosition({lngLat:o,pos:e}),l=Object(y.a)(u,2),c=l[0],h=l[1];return this._getUpdatedMapState({zoom:s,longitude:c,latitude:h})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(e){return new t(Object.assign({},this._viewportProps,this._interactiveState,e))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,i=t.zoom;t.zoom=S(i,n,e);var r=t.maxPitch,a=t.minPitch,o=t.pitch;return t.pitch=S(o,a,r),Object.assign(t,Object(_.a)(t)),t}},{key:"_unproject",value:function(t){var e=new A.a(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,n=t.pos;return new A.a(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,n=t.startZoom,i=this._viewportProps,r=i.maxZoom,a=i.minZoom;return S(n+Math.log2(e),a,r)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY,i=t.startBearing,r=t.startPitch;n=S(n,-1,1);var a=this._viewportProps,o=a.minPitch,s=a.maxPitch,u=r;return n>0?u=r+n*(s-r):n<0&&(u=r-n*(o-r)),{pitch:u,bearing:i+180*e}}}]),t}();var U=Object(c.createContext)({viewport:null,map:null,mapContainer:null,onViewportChange:null,onViewStateChange:null,eventManager:null,isDragging:!1}),V="A valid API access token is required to use Mapbox data";var G=401,W={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},H=Object.assign({},v.a.propTypes,{width:f.a.oneOfType([f.a.number,f.a.string]),height:f.a.oneOfType([f.a.number,f.a.string]),onResize:f.a.func,preventStyleDiffing:f.a.bool,disableTokenWarning:f.a.bool,visible:f.a.bool,className:f.a.string,style:f.a.object,visibilityConstraints:f.a.object}),q=Object.assign({},v.a.defaultProps,{preventStyleDiffing:!1,disableTokenWarning:!1,visible:!0,onResize:function(){},className:"",style:null,visibilityConstraints:R}),Z=function(t){function e(){var t,n;Object(i.a)(this,e);for(var s=arguments.length,u=new Array(s),h=0;h<s;h++)u[h]=arguments[h];return n=Object(r.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(o.a)(n),"state",{accessTokenInvalid:!1}),Object(l.a)(Object(o.a)(n),"_mapbox",null),Object(l.a)(Object(o.a)(n),"_map",null),Object(l.a)(Object(o.a)(n),"_mapboxMapRef",Object(c.createRef)()),Object(l.a)(Object(o.a)(n),"_mapContainerRef",Object(c.createRef)()),Object(l.a)(Object(o.a)(n),"_queryParams",{}),Object(l.a)(Object(o.a)(n),"_width",0),Object(l.a)(Object(o.a)(n),"_height",0),Object(l.a)(Object(o.a)(n),"getMap",function(){return n._map}),Object(l.a)(Object(o.a)(n),"queryRenderedFeatures",function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n._map.queryRenderedFeatures(t,e)}),Object(l.a)(Object(o.a)(n),"_mapboxMapError",function(t){(t.error&&t.error.status||t.status)!==G||n.state.accessTokenInvalid||(console.error(V),n.setState({accessTokenInvalid:!0})),n.props.onError(t)}),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){if(e.supported()){var t=this.props.mapStyle;this._mapbox=new v.a(Object.assign({},this.props,{mapboxgl:m.a,width:this._width,height:this._height,container:this._mapboxMapRef.current,onError:this._mapboxMapError,mapStyle:p(t)})),this._map=this._mapbox.getMap()}}},{key:"componentDidUpdate",value:function(t){this._mapbox&&(this._updateMapStyle(t,this.props),this._updateMapProps(this.props))}},{key:"componentWillUnmount",value:function(){this._mapbox&&(this._mapbox.finalize(),this._mapbox=null,this._map=null)}},{key:"_updateMapSize",value:function(t,e){this._width===t&&this._height===e||(this._width=t,this._height=e,this._updateMapProps(this.props))}},{key:"_updateMapStyle",value:function(t,e){var n=e.mapStyle;n!==t.mapStyle&&this._map.setStyle(p(n),{diff:!this.props.preventStyleDiffing})}},{key:"_updateMapProps",value:function(t){this._mapbox&&this._mapbox.setProps(Object.assign({},t,{width:this._width,height:this._height}))}},{key:"_renderNoTokenWarning",value:function(){if(this.state.accessTokenInvalid&&!this.props.disableTokenWarning){return Object(c.createElement)("div",{key:"warning",id:"no-token-warning",style:{position:"absolute",left:0,top:0}},[Object(c.createElement)("h3",{key:"header"},V),Object(c.createElement)("div",{key:"text"},"For information on setting up your basemap, read"),Object(c.createElement)("a",{key:"link",href:"https://uber.github.io/react-map-gl/#/Documentation/getting-started/about-mapbox-tokens"},"Note on Map Tokens")])}return null}},{key:"_renderOverlays",value:function(t){var e=this,n=t.width,i=void 0===n?Number(this.props.width):n,r=t.height,a=void 0===r?Number(this.props.height):r;return this._updateMapSize(i,a),Object(c.createElement)(U.Consumer,null,function(t){var n=Object.assign({},t,{viewport:new A.a(Object.assign({},e.props,e.props.viewState,{width:i,height:a})),map:e._map,mapContainer:t.mapContainer||e._mapContainerRef.current});return Object(c.createElement)(U.Provider,{value:n},Object(c.createElement)("div",{key:"map-overlays",className:"overlays",style:W,children:e.props.children}))})}},{key:"render",value:function(){var t=this.props,e=t.className,n=t.width,i=t.height,r=t.style,a=t.visibilityConstraints,o=Object.assign({position:"relative"},r,{width:n,height:i}),s=this.props.visible&&function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R;for(var i in n){var r=i.slice(0,3),a=(e=i.slice(3))[0].toLowerCase()+e.slice(1);if("min"===r&&t[a]<n[i])return!1;if("max"===r&&t[a]>n[i])return!1}return!0}(this.props.viewState||this.props,a),u=Object.assign({},W,{visibility:s?"inherit":"hidden"});return Object(c.createElement)("div",{key:"map-container",style:o,ref:this._mapContainerRef,children:[Object(c.createElement)("div",{key:"map-mapbox",ref:this._mapboxMapRef,style:u,className:e}),Object(c.createElement)(d.a,{key:"autosizer",disableWidth:Number.isFinite(n),disableHeight:Number.isFinite(i),onResize:this.props.onResize},this._renderOverlays.bind(this)),this._renderNoTokenWarning()]})}}],[{key:"supported",value:function(){return m.a&&m.a.supported()}}]),e}(c.PureComponent);Object(l.a)(Z,"propTypes",H),Object(l.a)(Z,"defaultProps",q);var X=function(){};var Q={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},Y={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new B,transitionInterruption:Q.BREAK,onTransitionStart:X,onTransitionInterrupt:X,onTransitionEnd:X,onViewportChange:X,onStateChange:X},K=function(){function t(e,n){var r=this;Object(i.a)(this,t),Object(l.a)(this,"props",void 0),Object(l.a)(this,"state",void 0),Object(l.a)(this,"time",void 0),Object(l.a)(this,"_animationFrame",null),Object(l.a)(this,"_onTransitionFrame",function(){r._animationFrame=requestAnimationFrame(r._onTransitionFrame),r._updateViewport()}),e&&(this.props=e),this.time=n||Date.now}return Object(s.a)(t,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(t){var e=this.props;if(this.props=t,this._shouldIgnoreViewportChange(e,t))return!1;if(this._isTransitionEnabled(t)){var n=Object.assign({},e),i=Object.assign({},t);if(this._isTransitionInProgress()&&(e.onTransitionInterrupt(),this.state.interruption===Q.SNAP_TO_END?Object.assign(n,this.state.endProps):Object.assign(n,this.state.propsInTransition),this.state.interruption===Q.UPDATE)){var r=this.time(),a=(r-this.state.startTime)/this.state.duration;i.transitionDuration=this.state.duration-(r-this.state.startTime),i.transitionEasing=function(t,e){var n=t(e);return function(i){return 1/(1-n)*(t(i*(1-e)+e)-n)}}(this.state.easing,a),i.transitionInterpolator=n.transitionInterpolator}return i.onTransitionStart(),this._triggerTransition(n,i),!0}return this._isTransitionInProgress()&&(e.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return Boolean(this._animationFrame)}},{key:"_isTransitionEnabled",value:function(t){return t.transitionDuration>0&&Boolean(t.transitionInterpolator)}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.state.propsInTransition&&this.state.interpolator.arePropsEqual(t,this.state.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return!t||(this._isTransitionInProgress()?this.state.interruption===Q.IGNORE||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e))}},{key:"_triggerTransition",value:function(t,e){O(this._isTransitionEnabled(e),"Transition is not enabled"),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var n=e.transitionInterpolator.initializeProps(t,e),i={inTransition:!0,isZooming:t.zoom!==e.zoom,isPanning:t.longitude!==e.longitude||t.latitude!==e.latitude,isRotating:t.bearing!==e.bearing||t.pitch!==e.pitch};this.state={duration:e.transitionDuration,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startTime:this.time(),startProps:n.start,endProps:n.end,animation:null,propsInTransition:{},interactionState:i},this._onTransitionFrame(),this.props.onStateChange(i)}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.props.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var t=this.time(),e=this.state,n=e.startTime,i=e.duration,r=e.easing,a=e.interpolator,o=e.startProps,s=e.endProps,u=!1,l=(t-n)/i;l>=1&&(l=1,u=!0),l=r(l);var c=a.interpolateProps(o,s,l),h=new N(Object.assign({},this.props,c));this.state.propsInTransition=h.getViewportProps(),this.props.onViewportChange(this.state.propsInTransition,this.state.interactionState,this.props),u&&(this._endTransition(),this.props.onTransitionEnd())}}]),t}();Object(l.a)(K,"defaultProps",Y);var J=n("ei+1"),$={transitionDuration:0},tt={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new B,transitionInterruption:Q.BREAK},et=["wheel"],nt=["panstart","panmove","panend"],it=["pinchstart","pinchmove","pinchend"],rt=["doubletap"],at=["keydown"],ot=function(){function t(){var e=this;Object(i.a)(this,t),Object(l.a)(this,"events",[]),Object(l.a)(this,"mapState",void 0),Object(l.a)(this,"onViewportChange",void 0),Object(l.a)(this,"onStateChange",void 0),Object(l.a)(this,"mapStateProps",void 0),Object(l.a)(this,"eventManager",void 0),Object(l.a)(this,"scrollZoom",!0),Object(l.a)(this,"dragPan",!0),Object(l.a)(this,"dragRotate",!0),Object(l.a)(this,"doubleClickZoom",!0),Object(l.a)(this,"touchZoom",!0),Object(l.a)(this,"touchRotate",!1),Object(l.a)(this,"keyboard",!0),Object(l.a)(this,"_state",{isDragging:!1}),Object(l.a)(this,"_events",{}),Object(l.a)(this,"_transitionManager",new K),Object(l.a)(this,"setState",function(t){Object.assign(e._state,t),e.onStateChange&&e.onStateChange(e._state)}),this.handleEvent=this.handleEvent.bind(this)}return Object(s.a)(t,[{key:"handleEvent",value:function(t){switch(this.mapState=this.getMapState(),t.type){case"panstart":return this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=t.offsetCenter;return[e.x,e.y]}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.mapState?this.mapState.getViewportProps():{},r=Object.assign({},t.getViewportProps(),e);Object.keys(r).some(function(t){return i[t]!==r[t]})&&this.onViewportChange(r,n,i),this.setState(Object.assign({},t.getInteractiveState(),n))}},{key:"getMapState",value:function(t){return new N(Object.assign({},this.mapStateProps,this._state,t))}},{key:"setOptions",value:function(t){var e=t.onViewportChange,n=t.onStateChange,i=t.eventManager,r=void 0===i?this.eventManager:i,a=t.isInteractive,o=void 0===a||a,s=t.scrollZoom,u=void 0===s?this.scrollZoom:s,l=t.dragPan,c=void 0===l?this.dragPan:l,h=t.dragRotate,f=void 0===h?this.dragRotate:h,p=t.doubleClickZoom,A=void 0===p?this.doubleClickZoom:p,d=t.touchZoom,v=void 0===d?this.touchZoom:d,g=t.touchRotate,m=void 0===g?this.touchRotate:g,y=t.keyboard,_=void 0===y?this.keyboard:y;this.onViewportChange=e,this.onStateChange=n,this.mapStateProps&&this.mapStateProps.height===t.height||this.updateViewport(new N(t)),this.mapStateProps=t,this._transitionManager.processViewportChange(Object.assign({},t,{onStateChange:this.setState})),this.eventManager!==r&&(this.eventManager=r,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(et,o&&u),this.toggleEvents(nt,o&&(c||f)),this.toggleEvents(it,o&&(v||m)),this.toggleEvents(rt,o&&A),this.toggleEvents(at,o&&_),this.scrollZoom=u,this.dragPan=c,this.dragRotate=f,this.doubleClickZoom=A,this.touchZoom=v,this.touchRotate=m,this.keyboard=_}},{key:"toggleEvents",value:function(t,e){var n=this;this.eventManager&&t.forEach(function(t){n._events[t]!==e&&(n._events[t]=e,e?n.eventManager.on(t,n.handleEvent):n.eventManager.off(t,n.handleEvent))})}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t),n=this.mapState.panStart({pos:e}).rotateStart({pos:e});return this.updateViewport(n,$,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return this.isFunctionKeyPressed(t)||t.rightButton?this._onPanRotate(t):this._onPanMove(t)}},{key:"_onPanEnd",value:function(t){var e=this.mapState.panEnd().rotateEnd();return this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isRotating:!1}),!0}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t),n=this.mapState.pan({pos:e});return this.updateViewport(n,$,{isPanning:!0}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,n=t.deltaY,i=this.getCenter(t),r=Object(y.a)(i,2)[1],a=r-n,o=this.mapState.getViewportProps(),s=o.width,u=o.height,l=e/s,c=0;n>0?Math.abs(u-a)>5&&(c=n/(a-u)*1.2):n<0&&a>5&&(c=1-r/a),c=Math.min(1,Math.max(-1,c));var h=this.mapState.rotate({deltaScaleX:l,deltaScaleY:c});return this.updateViewport(h,$,{isRotating:!0}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;t.preventDefault();var e=this.getCenter(t),n=t.delta,i=2/(1+Math.exp(-Math.abs(.01*n)));n<0&&0!==i&&(i=1/i);var r=this.mapState.zoom({pos:e,scale:i});return this.updateViewport(r,$,{isZooming:!0}),this.setState({isZooming:!1}),!0}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t),n=this.mapState.zoomStart({pos:e}).rotateStart({pos:e});return this._state.startPinchRotation=t.rotation,this.updateViewport(n,$,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;var e=this.mapState;if(this.touchZoom){var n=t.scale,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){var r=t.rotation,a=this._state.startPinchRotation;e=e.rotate({deltaScaleX:-(r-a)/180})}return this.updateViewport(e,$,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),!0}},{key:"_onPinchEnd",value:function(t){var e=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t),n=this.isFunctionKeyPressed(t),i=this.mapState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,Object.assign({},tt,{transitionInterpolator:new B({around:e})})),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,n=this.isFunctionKeyPressed(t),i=this.mapStateProps;switch(t.srcEvent.keyCode){case 189:e=n?this.getMapState({zoom:i.zoom-2}):this.getMapState({zoom:i.zoom-1});break;case 187:e=n?this.getMapState({zoom:i.zoom+2}):this.getMapState({zoom:i.zoom+1});break;case 37:e=n?this.getMapState({bearing:i.bearing-15}):this.mapState.pan({pos:[100,0],startPos:[0,0]});break;case 39:e=n?this.getMapState({bearing:i.bearing+15}):this.mapState.pan({pos:[-100,0],startPos:[0,0]});break;case 38:e=n?this.getMapState({pitch:i.pitch+10}):this.mapState.pan({pos:[0,100],startPos:[0,0]});break;case 40:e=n?this.getMapState({pitch:i.pitch-10}):this.mapState.pan({pos:[0,-100],startPos:[0,0]});break;default:return!1}return this.updateViewport(e,tt)}}]),t}(),st=[{old:"onChangeViewport",new:"onViewportChange"},{old:"perspectiveEnabled",new:"dragRotate"},{old:"onHoverFeatures",new:"onHover"},{old:"onClickFeatures",new:"onClick"},{old:"touchZoomRotate",new:"touchZoom, touchRotate"},{old:"mapControls",new:"controller"}];function ut(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};st.forEach(function(e){if(t.hasOwnProperty(e.old)){var n=(i=e.old,"react-map-gl: `".concat(i,"` is removed."));e.new&&(n="".concat(n," ").concat(function(t){return"Use `".concat(t,"` instead.")}(e.new))),console.warn(n)}var i})}var lt=Object.assign({},Z.propTypes,{maxZoom:f.a.number,minZoom:f.a.number,maxPitch:f.a.number,minPitch:f.a.number,onViewStateChange:f.a.func,onViewportChange:f.a.func,onInteractionStateChange:f.a.func,transitionDuration:f.a.number,transitionInterpolator:f.a.object,transitionInterruption:f.a.number,transitionEasing:f.a.func,onTransitionStart:f.a.func,onTransitionInterrupt:f.a.func,onTransitionEnd:f.a.func,scrollZoom:f.a.bool,dragPan:f.a.bool,dragRotate:f.a.bool,doubleClickZoom:f.a.bool,touchZoom:f.a.bool,touchRotate:f.a.bool,keyboard:f.a.bool,onHover:f.a.func,onClick:f.a.func,onDblClick:f.a.func,onContextMenu:f.a.func,onMouseDown:f.a.func,onMouseMove:f.a.func,onMouseUp:f.a.func,onTouchStart:f.a.func,onTouchMove:f.a.func,onTouchEnd:f.a.func,onMouseEnter:f.a.func,onMouseLeave:f.a.func,onMouseOut:f.a.func,onWheel:f.a.func,touchAction:f.a.string,clickRadius:f.a.number,interactiveLayerIds:f.a.array,getCursor:f.a.func,controller:f.a.instanceOf(ot)}),ct=Object.assign({},Z.defaultProps,R,K.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(t){return t.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",clickRadius:0,getCursor:function(t){var e=t.isDragging,n=t.isHovering;return e?"grabbing":n?"pointer":"grab"}}),ht=function(t){function e(t){var n;return Object(i.a)(this,e),n=Object(r.a)(this,Object(a.a)(e).call(this,t)),Object(l.a)(Object(o.a)(n),"state",{isLoaded:!1,isDragging:!1,isHovering:!1}),Object(l.a)(Object(o.a)(n),"_controller",void 0),Object(l.a)(Object(o.a)(n),"_eventManager",void 0),Object(l.a)(Object(o.a)(n),"_interactiveContext",void 0),Object(l.a)(Object(o.a)(n),"_width",0),Object(l.a)(Object(o.a)(n),"_height",0),Object(l.a)(Object(o.a)(n),"_eventCanvasRef",Object(c.createRef)()),Object(l.a)(Object(o.a)(n),"_staticMapRef",Object(c.createRef)()),Object(l.a)(Object(o.a)(n),"getMap",function(){return n._staticMapRef.current?n._staticMapRef.current.getMap():null}),Object(l.a)(Object(o.a)(n),"queryRenderedFeatures",function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.getMap();return i&&i.queryRenderedFeatures(t,e)}),Object(l.a)(Object(o.a)(n),"_onInteractionStateChange",function(t){var e=t.isDragging,i=void 0!==e&&e;i!==n.state.isDragging&&n.setState({isDragging:i});var r=n.props.onInteractionStateChange;r&&r(t)}),Object(l.a)(Object(o.a)(n),"_onResize",function(t){var e=t.width,i=t.height;n._width=e,n._height=i,n._setControllerProps(n.props),n.props.onResize({width:e,height:i})}),Object(l.a)(Object(o.a)(n),"_onViewportChange",function(t,e,i){var r=n.props,a=r.onViewStateChange,o=r.onViewportChange;a&&a({viewState:t,interactionState:e,oldViewState:i}),o&&o(t,e,i)}),Object(l.a)(Object(o.a)(n),"_onLoad",function(t){n.setState({isLoaded:!0}),n.props.onLoad(t)}),Object(l.a)(Object(o.a)(n),"_onEvent",function(t,e){var i=n.props[t];i&&i(n._normalizeEvent(e))}),Object(l.a)(Object(o.a)(n),"_onPointerDown",function(t){switch(t.pointerType){case"touch":n._onEvent("onTouchStart",t);break;default:n._onEvent("onMouseDown",t)}}),Object(l.a)(Object(o.a)(n),"_onPointerUp",function(t){switch(t.pointerType){case"touch":n._onEvent("onTouchEnd",t);break;default:n._onEvent("onMouseUp",t)}}),Object(l.a)(Object(o.a)(n),"_onPointerMove",function(t){switch(t.pointerType){case"touch":n._onEvent("onTouchMove",t);break;default:n._onEvent("onMouseMove",t)}if(!n.state.isDragging){var e,i=n.props,r=i.onHover,a=i.interactiveLayerIds;t=n._normalizeEvent(t),n.state.isLoaded&&(a||r)&&(e=n._getFeatures({pos:t.point,radius:n.props.clickRadius})),r&&(t.features=e,r(t));var o=Boolean(a&&e&&e.length>0),s=o&&!n.state.isHovering,u=!o&&n.state.isHovering;s&&n._onEvent("onMouseEnter",t),u&&n._onEvent("onMouseLeave",t),(s||u)&&n.setState({isHovering:o})}}),Object(l.a)(Object(o.a)(n),"_onClick",function(t){var e=n.props,i=e.onClick,r=e.onNativeClick,a=e.onDblClick,o=e.doubleClickZoom,s=[],u=a||o;switch(t.type){case"anyclick":s.push(r),u||s.push(i);break;case"click":u&&s.push(i)}(s=s.filter(Boolean)).length&&((t=n._normalizeEvent(t)).features=n._getFeatures({pos:t.point,radius:n.props.clickRadius}),s.forEach(function(e){return e(t)}))}),ut(t),n._controller=t.controller||new ot,n._eventManager=new J.a(null,{touchAction:t.touchAction}),n._updateInteractiveContext({isDragging:!1,eventManager:n._eventManager}),n}return Object(u.a)(e,t),Object(s.a)(e,null,[{key:"supported",value:function(){return Z.supported()}}]),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this._eventManager,e=this._eventCanvasRef.current;t.setElement(e),t.on({pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerup:this._onPointerUp,pointerleave:this._onEvent.bind(this,"onMouseOut"),click:this._onClick,anyclick:this._onClick,dblclick:this._onEvent.bind(this,"onDblClick"),wheel:this._onEvent.bind(this,"onWheel"),contextmenu:this._onEvent.bind(this,"onContextMenu")}),this._setControllerProps(this.props),this._updateInteractiveContext({mapContainer:e})}},{key:"componentWillUpdate",value:function(t,e){this._setControllerProps(t),e.isDragging!==this.state.isDragging&&this._updateInteractiveContext({isDragging:e.isDragging})}},{key:"_setControllerProps",value:function(t){t=Object.assign({},t,t.viewState,{isInteractive:Boolean(t.onViewStateChange||t.onViewportChange),onViewportChange:this._onViewportChange,onStateChange:this._onInteractionStateChange,eventManager:this._eventManager,width:this._width,height:this._height}),this._controller.setOptions(t),this._updateInteractiveContext({onViewStateChange:t.onViewStateChange,onViewportChange:t.onViewportChange})}},{key:"_getFeatures",value:function(t){var e,n=t.pos,i=t.radius,r={},a=this.getMap();if(this.props.interactiveLayerIds&&(r.layers=this.props.interactiveLayerIds),i){var o=i,s=[[n[0]-o,n[1]+o],[n[0]+o,n[1]-o]];e=a&&a.queryRenderedFeatures(s,r)}else e=a&&a.queryRenderedFeatures(n,r);return e}},{key:"_updateInteractiveContext",value:function(t){this._interactiveContext=Object.assign({},this._interactiveContext,t)}},{key:"_normalizeEvent",value:function(t){if(t.lngLat)return t;var e=t.offsetCenter,n=[e.x,e.y],i=new A.a(Object.assign({},this.props,{width:this._width,height:this._height}));return t.point=n,t.lngLat=i.unproject(n),t}},{key:"render",value:function(){var t=this.props,e=t.width,n=t.height,i=t.style,r=t.getCursor,a=Object.assign({position:"relative"},i,{width:e,height:n,cursor:r(this.state)});return Object(c.createElement)(U.Provider,{value:this._interactiveContext},Object(c.createElement)("div",{key:"event-canvas",ref:this._eventCanvasRef,style:a},Object(c.createElement)(Z,Object.assign({},this.props,{width:"100%",height:"100%",style:null,onResize:this._onResize,onLoad:this._onLoad,ref:this._staticMapRef,children:this.props.children}))))}}]),e}(c.PureComponent);Object(l.a)(ht,"propTypes",lt),Object(l.a)(ht,"defaultProps",ct);var ft={captureScroll:f.a.bool,captureDrag:f.a.bool,captureClick:f.a.bool,captureDoubleClick:f.a.bool},pt=function(t){function e(){var t,n;Object(i.a)(this,e);for(var s=arguments.length,u=new Array(s),h=0;h<s;h++)u[h]=arguments[h];return n=Object(r.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(o.a)(n),"_context",{}),Object(l.a)(Object(o.a)(n),"_events",null),Object(l.a)(Object(o.a)(n),"_containerRef",Object(c.createRef)()),Object(l.a)(Object(o.a)(n),"_onScroll",function(t){n.props.captureScroll&&t.stopPropagation()}),Object(l.a)(Object(o.a)(n),"_onDragStart",function(t){n.props.captureDrag&&t.stopPropagation()}),Object(l.a)(Object(o.a)(n),"_onDblClick",function(t){n.props.captureDoubleClick&&t.stopPropagation()}),Object(l.a)(Object(o.a)(n),"_onClick",function(t){n.props.captureClick&&t.stopPropagation()}),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this._containerRef.current;if(t){var e=this._context.eventManager;e&&(this._events={wheel:this._onScroll,panstart:this._onDragStart,anyclick:this._onClick,click:this._onClick,dblclick:this._onDblClick},e.on(this._events,t))}}},{key:"componentWillUnmount",value:function(){var t=this._context.eventManager;t&&this._events&&t.off(this._events)}},{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){var t=this;return Object(c.createElement)(U.Consumer,null,function(e){return t._context=e,t._render()})}}]),e}(c.PureComponent);Object(l.a)(pt,"propTypes",ft),Object(l.a)(pt,"defaultProps",{captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0});var At=n("ReuC"),dt=Object.assign({},pt.propTypes,{draggable:f.a.bool,onDrag:f.a.func,onDragEnd:f.a.func,onDragStart:f.a.func,offsetLeft:f.a.number,offsetTop:f.a.number}),vt=Object.assign({},pt.defaultProps,{draggable:!1,offsetLeft:0,offsetTop:0}),gt=function(t){function e(){var t,n;Object(i.a)(this,e);for(var s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=Object(r.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(o.a)(n),"state",{dragPos:null,dragOffset:null}),Object(l.a)(Object(o.a)(n),"_dragEvents",null),Object(l.a)(Object(o.a)(n),"_onDragStart",function(t){var e=n.props,i=e.draggable,r=e.captureDrag;if((i||r)&&t.stopPropagation(),i){var a=n._getDragEventPosition(t),o=n._getDragEventOffset(t);n.setState({dragPos:a,dragOffset:o}),n._setupDragEvents();var s=n.props.onDragStart;if(s&&o){var u=Object.assign({},t);u.lngLat=n._getDragLngLat(a,o),s(u)}}}),Object(l.a)(Object(o.a)(n),"_onDrag",function(t){t.stopPropagation();var e=n._getDragEventPosition(t);n.setState({dragPos:e});var i=n.props.onDrag,r=n.state.dragOffset;if(i&&r){var a=Object.assign({},t);a.lngLat=n._getDragLngLat(e,r),i(a)}}),Object(l.a)(Object(o.a)(n),"_onDragEnd",function(t){var e=n.state,i=e.dragPos,r=e.dragOffset;t.stopPropagation(),n.setState({dragPos:null,dragOffset:null}),n._removeDragEvents();var a=n.props.onDragEnd;if(a&&i&&r){var o=Object.assign({},t);o.lngLat=n._getDragLngLat(i,r),a(o)}}),Object(l.a)(Object(o.a)(n),"_onDragCancel",function(t){t.stopPropagation(),n.setState({dragPos:null,dragOffset:null}),n._removeDragEvents()}),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentWillUnmount",value:function(){Object(At.a)(Object(a.a)(e.prototype),"componentWillUnmount",this).call(this),this._removeDragEvents()}},{key:"_setupDragEvents",value:function(){var t=this._context.eventManager;t&&(this._dragEvents={panmove:this._onDrag,panend:this._onDragEnd,pancancel:this._onDragCancel},t.on(this._dragEvents))}},{key:"_removeDragEvents",value:function(){var t=this._context.eventManager;t&&this._dragEvents&&(t.off(this._dragEvents),this._dragEvents=null)}},{key:"_getDragEventPosition",value:function(t){var e=t.offsetCenter;return[e.x,e.y]}},{key:"_getDragEventOffset",value:function(t){var e=t.center,n=e.x,i=e.y,r=this._containerRef.current;if(r){var a=r.getBoundingClientRect();return[a.left-n,a.top-i]}return null}},{key:"_getDraggedPosition",value:function(t,e){return[t[0]+e[0],t[1]+e[1]]}},{key:"_getDragLngLat",value:function(t,e){var n=this.props,i=n.offsetLeft,r=n.offsetTop,a=this._getDraggedPosition(t,e),o=Object(y.a)(a,2),s=o[0],u=o[1];return this._context.viewport.unproject([s-i,u-r])}}]),e}(pt);Object(l.a)(gt,"propTypes",dt),Object(l.a)(gt,"defaultProps",vt);var mt=Object.assign({},gt.propTypes,{className:f.a.string,longitude:f.a.number.isRequired,latitude:f.a.number.isRequired}),yt=Object.assign({},gt.defaultProps,{className:""}),_t=function(t){function e(){return Object(i.a)(this,e),Object(r.a)(this,Object(a.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(s.a)(e,[{key:"_getPosition",value:function(){var t=this.props,e=t.longitude,n=t.latitude,i=t.offsetLeft,r=t.offsetTop,a=this.state,o=a.dragPos,s=a.dragOffset;if(o&&s)return this._getDraggedPosition(o,s);var u=this._context.viewport.project([e,n]),l=Object(y.a)(u,2),c=l[0],h=l[1];return[c+=i,h+=r]}},{key:"_render",value:function(){var t=this.props,e=t.className,n=t.draggable,i=this.state.dragPos,r=this._getPosition(),a=Object(y.a)(r,2),o={position:"absolute",left:a[0],top:a[1],cursor:n?i?"grabbing":"grab":"auto"};return Object(c.createElement)("div",{className:"mapboxgl-marker ".concat(e),ref:this._containerRef,style:o,children:this.props.children})}}]),e}(gt);Object(l.a)(_t,"propTypes",mt),Object(l.a)(_t,"defaultProps",yt);var bt={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},xt=Object.keys(bt);var wt=Object.assign({},pt.propTypes,{className:f.a.string,longitude:f.a.number.isRequired,latitude:f.a.number.isRequired,altitude:f.a.number,offsetLeft:f.a.number,offsetTop:f.a.number,tipSize:f.a.number,closeButton:f.a.bool,closeOnClick:f.a.bool,anchor:f.a.oneOf(Object.keys(bt)),dynamicPosition:f.a.bool,sortByDepth:f.a.bool,onClose:f.a.func}),St=Object.assign({},pt.defaultProps,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}}),kt=function(t){function e(){var t,n;Object(i.a)(this,e);for(var s=arguments.length,u=new Array(s),h=0;h<s;h++)u[h]=arguments[h];return n=Object(r.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(o.a)(n),"_closeOnClick",!1),Object(l.a)(Object(o.a)(n),"_contentRef",Object(c.createRef)()),Object(l.a)(Object(o.a)(n),"_onClick",function(t){n.props.captureClick&&t.stopPropagation(),"click"!==t.type||!n.props.closeOnClick&&"mapboxgl-popup-close-button"!==t.target.className||n.props.onClose()}),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){Object(At.a)(Object(a.a)(e.prototype),"componentDidMount",this).call(this),this.forceUpdate()}},{key:"_getPosition",value:function(t,e){var n=this._context.viewport,i=this.props,r=i.anchor,a=i.dynamicPosition,o=i.tipSize,s=this._contentRef.current;return s&&a?function(t){var e=t.x,n=t.y,i=t.width,r=t.height,a=t.selfWidth,o=t.selfHeight,s=t.anchor,u=t.padding,l=void 0===u?0:u,c=bt[s],h=c.x,f=c.y,p=n-f*o,A=p+o;if(p<l)for(;p<l&&f>=.5;)f-=.5,p+=.5*o;else if(A>r-l)for(;A>r-l&&f<=.5;)f+=.5,A-=.5*o;var d=e-h*a,v=d+a,g=.5;if(.5===f&&(h=Math.floor(h),g=1),d<l)for(;d<l&&h>=g;)h-=g,d+=g*a;else if(v>i-l)for(;v>i-l&&h<=1-g;)h+=g,v-=g*a;return xt.find(function(t){var e=bt[t];return e.x===h&&e.y===f})||s}({x:t,y:e,anchor:r,padding:o,width:n.width,height:n.height,selfWidth:s.clientWidth,selfHeight:s.clientHeight}):r}},{key:"_getContainerStyle",value:function(t,e,n,i){var r=this._context.viewport,a=this.props,o=a.offsetLeft,s=a.offsetTop,u=a.sortByDepth,l=bt[i],c={position:"absolute",left:t+o,top:e+s,transform:"translate(".concat(100*-l.x,"%, ").concat(100*-l.y,"%)"),display:void 0,zIndex:void 0};return u?(n>1||n<-1||t<0||t>r.width||e<0||e>r.height?c.display="none":c.zIndex=Math.floor((1-n)/2*1e5),c):c}},{key:"_renderTip",value:function(t){var e=this.props.tipSize;return Object(c.createElement)("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:e}})}},{key:"_renderContent",value:function(){var t=this.props,e=t.closeButton,n=t.children,i=this._context.eventManager?null:this._onClick;return Object(c.createElement)("div",{key:"content",ref:this._contentRef,className:"mapboxgl-popup-content",onClick:i},[e&&Object(c.createElement)("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button"},""),n])}},{key:"_render",value:function(){var t=this.props,e=t.className,n=t.longitude,i=t.latitude,r=t.altitude,a=this._context.viewport.project([n,i,r]),o=Object(y.a)(a,3),s=o[0],u=o[1],l=o[2],h=this._getPosition(s,u),f=this._getContainerStyle(s,u,l,h);return Object(c.createElement)("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(h," ").concat(e),style:f,ref:this._containerRef},[this._renderTip(h),this._renderContent()])}}]),e}(pt);Object(l.a)(kt,"propTypes",wt),Object(l.a)(kt,"defaultProps",St);var Ot,Pt=n("2lZV"),Et=Object.assign({},pt.propTypes,{className:f.a.string,container:f.a.object}),Ct=Object.assign({},pt.defaultProps,{className:"",container:null}),Tt=function(t){function e(){var t,n;Object(i.a)(this,e);for(var s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=Object(r.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(o.a)(n),"state",{isFullscreen:!1,showButton:!1}),Object(l.a)(Object(o.a)(n),"_mapboxFullscreenControl",null),Object(l.a)(Object(o.a)(n),"_onFullscreenChange",function(){var t=!n._mapboxFullscreenControl._fullscreen;n._mapboxFullscreenControl._fullscreen=t,n.setState({isFullscreen:t})}),Object(l.a)(Object(o.a)(n),"_onClickFullscreen",function(){n._mapboxFullscreenControl._onClickFullscreen()}),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this.props.container||this._context.mapContainer;this._mapboxFullscreenControl=new m.a.FullscreenControl({container:t}),this.setState({showButton:this._mapboxFullscreenControl._checkFullscreenSupport()}),Pt.a.addEventListener(this._mapboxFullscreenControl._fullscreenchange,this._onFullscreenChange)}},{key:"componentWillUnmount",value:function(){Pt.a.removeEventListener(this._mapboxFullscreenControl._fullscreenchange,this._onFullscreenChange)}},{key:"_renderButton",value:function(t,e,n){return Object(c.createElement)("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),type:"button",title:e,onClick:n})}},{key:"_render",value:function(){if(!this.state.showButton)return null;var t=this.props.className,e=this.state.isFullscreen?"shrink":"fullscreen";return Object(c.createElement)("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(t),ref:this._containerRef},[this._renderButton(e,"Toggle fullscreen",this._onClickFullscreen)])}}]),e}(pt);Object(l.a)(Tt,"propTypes",Et),Object(l.a)(Tt,"defaultProps",Ct);var Mt=Object.assign({},K.defaultProps,{transitionDuration:500}),jt=function(){},Lt=Object.assign({},pt.propTypes,{className:f.a.string,style:f.a.object,positionOptions:f.a.object,fitBoundsOptions:f.a.object,trackUserLocation:f.a.bool,showUserLocation:f.a.bool,onViewStateChange:f.a.func,onViewportChange:f.a.func}),It=Object.assign({},pt.defaultProps,{className:"",style:{},positionOptions:null,fitBoundsOptions:null,trackUserLocation:!1,showUserLocation:!0}),zt=function(t){function e(){var t,n;Object(i.a)(this,e);for(var s=arguments.length,u=new Array(s),h=0;h<s;h++)u[h]=arguments[h];return n=Object(r.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(o.a)(n),"state",{supportsGeolocation:!1,markerPosition:null}),Object(l.a)(Object(o.a)(n),"_mapboxGeolocateControl",null),Object(l.a)(Object(o.a)(n),"_geolocateButtonRef",Object(c.createRef)()),Object(l.a)(Object(o.a)(n),"_markerRef",Object(c.createRef)()),Object(l.a)(Object(o.a)(n),"_setupMapboxGeolocateControl",function(t){if(t){var e={};["positionOptions","fitBoundsOptions","trackUserLocation","showUserLocation"].forEach(function(t){t in n.props&&null!==n.props[t]&&(e[t]=n.props[t])}),n._mapboxGeolocateControl=new m.a.GeolocateControl(e),n._mapboxGeolocateControl._watchState="OFF",n._mapboxGeolocateControl._geolocateButton=n._geolocateButtonRef.current,n._mapboxGeolocateControl._updateMarker=n._updateMarker,n._mapboxGeolocateControl._updateCamera=n._updateCamera,n._mapboxGeolocateControl._setup=!0}else console.warn("Geolocation support is not available, the GeolocateControl will not be visible.")}),Object(l.a)(Object(o.a)(n),"_onClickGeolocate",function(){return n._mapboxGeolocateControl.trigger()}),Object(l.a)(Object(o.a)(n),"_updateMarker",function(t){t&&n.setState({markerPosition:t.coords})}),Object(l.a)(Object(o.a)(n),"_getBounds",function(t){var e=new m.a.LngLat(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,i=e.toBounds(n);return[[i._ne.lng,i._ne.lat],[i._sw.lng,i._sw.lat]]}),Object(l.a)(Object(o.a)(n),"_updateCamera",function(t){var e=n._context.viewport,i=n._getBounds(t),r=new A.a(e).fitBounds(i),a=r.longitude,o=r.latitude,s=r.zoom,u=Object.assign({},e,{longitude:a,latitude:o,zoom:s}),l=new N(u),c=Object.assign({},l.getViewportProps(),Mt),h=n.props.onViewportChange||n._context.onViewportChange||jt;(n.props.onViewStateChange||n._context.onViewStateChange||jt)({viewState:c}),h(c)}),Object(l.a)(Object(o.a)(n),"_renderButton",function(t,e,i){return Object(c.createElement)("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),ref:n._geolocateButtonRef,type:"button",title:e,onClick:i})}),Object(l.a)(Object(o.a)(n),"_renderMarker",function(){var t=n.props.showUserLocation,e=n.state.markerPosition;return t&&e?Object(c.createElement)(_t,{key:"location-maker",ref:n._markerRef,className:"mapboxgl-user-location-dot",longitude:e.longitude,latitude:e.latitude,onContextMenu:function(t){return t.preventDefault()},captureDrag:!1,captureDoubleClick:!1}):null}),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this;(void 0!==Ot?Promise.resolve(Ot):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(function(t){return Ot="denied"!==t.state}):(Ot=Boolean(window.navigator.geolocation),Promise.resolve(Ot))).then(function(e){t.setState({supportsGeolocation:e}),t._setupMapboxGeolocateControl(e)})}},{key:"componentDidUpdate",value:function(){var t=this._markerRef.current;this._mapboxGeolocateControl&&t&&(this._mapboxGeolocateControl._dotElement=t._containerRef.current)}},{key:"componentWillUnmount",value:function(){var t=this._mapboxGeolocateControl._geolocationWatchID;void 0!==t&&(window.navigator.geolocation.clearWatch(t),this._mapboxGeolocateControl._geolocationWatchID=void 0)}},{key:"_render",value:function(){if(!this.state.supportsGeolocation)return null;var t=this.props,e=t.className,n=t.style;return Object(c.createElement)("div",null,[this._renderMarker(),Object(c.createElement)("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(e),ref:this._containerRef,style:n,onContextMenu:function(t){return t.preventDefault()}},this._renderButton("geolocate","Geolocate",this._onClickGeolocate))])}}]),e}(pt);Object(l.a)(zt,"propTypes",Lt),Object(l.a)(zt,"defaultProps",It);var Dt=function(){},Bt=Object.assign({},pt.propTypes,{className:f.a.string,onViewStateChange:f.a.func,onViewportChange:f.a.func,showCompass:f.a.bool,showZoom:f.a.bool}),Rt=Object.assign({},pt.defaultProps,{className:"",showCompass:!0,showZoom:!0}),Ft=function(t){function e(t){var n;return Object(i.a)(this,e),n=Object(r.a)(this,Object(a.a)(e).call(this,t)),Object(l.a)(Object(o.a)(n),"_onZoomIn",function(){n._updateViewport({zoom:n._context.viewport.zoom+1})}),Object(l.a)(Object(o.a)(n),"_onZoomOut",function(){n._updateViewport({zoom:n._context.viewport.zoom-1})}),Object(l.a)(Object(o.a)(n),"_onResetNorth",function(){n._updateViewport({bearing:0,pitch:0})}),ut(t),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"_updateViewport",value:function(t){var e=this._context.viewport,n=new N(Object.assign({},e,t)),i=Object.assign({},n.getViewportProps(),tt),r=this.props.onViewportChange||this._context.onViewportChange||Dt;(this.props.onViewStateChange||this._context.onViewStateChange||Dt)({viewState:i}),r(i)}},{key:"_renderCompass",value:function(){var t=this._context.viewport.bearing;return Object(c.createElement)("span",{className:"mapboxgl-ctrl-compass-arrow",style:{transform:"rotate(".concat(-t,"deg)")}})}},{key:"_renderButton",value:function(t,e,n,i){return Object(c.createElement)("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),type:"button",title:e,onClick:n,children:i})}},{key:"_render",value:function(){var t=this.props,e=t.className,n=t.showCompass,i=t.showZoom;return Object(c.createElement)("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(e),ref:this._containerRef},[i&&this._renderButton("zoom-in","Zoom In",this._onZoomIn),i&&this._renderButton("zoom-out","Zoom Out",this._onZoomOut),n&&this._renderButton("compass","Reset North",this._onResetNorth,this._renderCompass())])}}]),e}(pt);Object(l.a)(Ft,"propTypes",Bt),Object(l.a)(Ft,"defaultProps",Rt);var Nt=Object.assign({},pt.propTypes,{redraw:f.a.func.isRequired}),Ut=function(t){function e(){var t,n;Object(i.a)(this,e);for(var s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=Object(r.a)(this,(t=Object(a.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(o.a)(n),"_canvas",void 0),Object(l.a)(Object(o.a)(n),"_ctx",void 0),Object(l.a)(Object(o.a)(n),"_redraw",function(){var t=n._ctx;if(t){var e=Pt.b.devicePixelRatio||1;t.save(),t.scale(e,e);var i=n._context,r=i.viewport,a=i.isDragging;n.props.redraw({width:r.width,height:r.height,ctx:t,isDragging:a,project:r.project.bind(r),unproject:r.unproject.bind(r)}),t.restore()}}),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this._containerRef.current;t&&(this._canvas=t,this._ctx=t.getContext("2d")),this._redraw()}},{key:"_render",value:function(){var t=Pt.b.devicePixelRatio||1,e=this._context.viewport,n=e.width,i=e.height;return this._redraw(),Object(c.createElement)("canvas",{ref:this._containerRef,width:n*t,height:i*t,style:{width:"".concat(n,"px"),height:"".concat(i,"px"),position:"absolute",left:0,top:0}})}}]),e}(pt);Object(l.a)(Ut,"propTypes",Nt),Object(l.a)(Ut,"defaultProps",{captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1});var Vt=Object.assign({},pt.propTypes,{redraw:f.a.func.isRequired,style:f.a.object}),Gt=function(t){function e(){return Object(i.a)(this,e),Object(r.a)(this,Object(a.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(s.a)(e,[{key:"_render",value:function(){var t=this._context,e=t.viewport,n=t.isDragging,i=Object.assign({position:"absolute",left:0,top:0,width:e.width,height:e.height},this.props.style);return Object(c.createElement)("div",{ref:this._containerRef,style:i},this.props.redraw({width:e.width,height:e.height,isDragging:n,project:e.project.bind(e),unproject:e.unproject.bind(e)}))}}]),e}(pt);Object(l.a)(Gt,"propTypes",Vt),Object(l.a)(Gt,"defaultProps",{captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1});var Wt=Object.assign({},pt.propTypes,{redraw:f.a.func.isRequired,style:f.a.object}),Ht=function(t){function e(){return Object(i.a)(this,e),Object(r.a)(this,Object(a.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(s.a)(e,[{key:"_render",value:function(){var t=this._context,e=t.viewport,n=t.isDragging,i=Object.assign({position:"absolute",left:0,top:0},this.props.style);return Object(c.createElement)("svg",{width:e.width,height:e.height,ref:this._containerRef,style:i},this.props.redraw({width:e.width,height:e.height,isDragging:n,project:e.project.bind(e),unproject:e.unproject.bind(e)}))}}]),e}(pt);Object(l.a)(Ht,"propTypes",Wt),Object(l.a)(Ht,"defaultProps",{captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1}),n.d(e,"default",function(){return ht}),n.d(e,"InteractiveMap",function(){return ht}),n.d(e,"StaticMap",function(){return Z}),n.d(e,"BaseControl",function(){return pt}),n.d(e,"Marker",function(){return _t}),n.d(e,"Popup",function(){return kt}),n.d(e,"FullscreenControl",function(){return Tt}),n.d(e,"GeolocateControl",function(){return zt}),n.d(e,"NavigationControl",function(){return Ft}),n.d(e,"CanvasOverlay",function(){return Ut}),n.d(e,"HTMLOverlay",function(){return Gt}),n.d(e,"SVGOverlay",function(){return Ht}),n.d(e,"TRANSITION_EVENTS",function(){return Q}),n.d(e,"TransitionInterpolator",function(){return P}),n.d(e,"LinearInterpolator",function(){return B}),n.d(e,"FlyToInterpolator",function(){return z}),n.d(e,"MapController",function(){return ot}),n.d(e,"_MapContext",function(){return U})},Uxdj:function(t,e,n){"use strict";var i=n("5Uuq"),r=n("KI45");Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.styles=void 0;var a=r(n("ln6h")),o=r(n("eVuF")),s=r(n("+oT+")),u=r(n("Avpf")),l=r(n("/HRN")),c=r(n("WaGi")),h=r(n("ZDA2")),f=r(n("/+P4")),p=r(n("K47E")),A=r(n("N9n2")),d=r(n("xHqa")),v=r(n("q1tI")),g=i(n("UP1k")),m=r(n("elnw")),y=r(n("vm6e")),_=r(n("RcmO")),b=r(n("/uLY")),x=r(n("qBB9")),w=r(n("xPWL")),S=r(n("laYx"));e.styles=function(t){var e;return{layout:(e={width:"100%",flex:1,marginTop:"-2rem"},(0,d.default)(e,t.breakpoints.down("xs"),{marginTop:0}),(0,d.default)(e,"& canvas",{top:0,left:0}),e),controls:{position:"absolute",zIndex:100,top:"10px",right:"10px"},controlsSpacer:{height:"10px"},controlsSelected:{background:["rgba(0, 0, 255, 0.1)","!important"]}}};var k=function(t){function e(t){var n;return(0,l.default)(this,e),(n=(0,h.default)(this,(0,f.default)(e).call(this,t))).state={mode:"contour",viewState:{latitude:53.35014,longitude:-6.266155,zoom:13,bearing:0,pitch:0}},n.updateViewState=n.updateViewState.bind((0,p.default)(n)),n.updateViewportNoPitch=n.updateViewportNoPitch.bind((0,p.default)(n)),n.updateMapMode=n.updateMapMode.bind((0,p.default)(n)),n.updateViewMode=n.updateViewMode.bind((0,p.default)(n)),n}return(0,A.default)(e,t),(0,c.default)(e,[{key:"updateViewState",value:function(t){var e=t.viewState;e=(0,u.default)({},this.state.viewState,e),this.setState({viewState:e},this.renderLayers)}},{key:"updateViewportNoPitch",value:function(t){t.pitch=this.state.viewState.pitch,this.updateViewState({viewState:t})}},{key:"updateMapMode",value:function(t){switch(t){case"flat":this.updateViewState({viewState:{pitch:0,transitionDuration:2e3,transitionInterpolator:new g.FlyToInterpolator}});break;case"perspective":this.updateViewState({viewState:{pitch:60,transitionDuration:2e3,transitionInterpolator:new g.FlyToInterpolator}})}}},{key:"updateViewMode",value:function(t){this.setState({mode:t})}},{key:"locateUser",value:function(){var t=(0,s.default)(a.default.mark(function t(){var e,n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new o.default(function(t){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){return t({latitude:e.coords.latitude,longitude:e.coords.longitude})},function(e){console.error(e),t(null)},{timeout:5e3,enableHighAccuracy:!0}):(console.error("Geolocation IS NOT available"),t(null))});case 2:if(e=t.sent){t.next=5;break}return t.abrupt("return");case 5:n={viewState:(0,u.default)({},this.state.viewState,e,{transitionDuration:2e3,transitionInterpolator:new g.FlyToInterpolator})},this.setState(n);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t,e=this,n=this.props,i=n.mapboxToken,r=n.theme,a=this.state,o=a.viewState.pitch,s=a.mode;switch(s){case"contour":t="mapbox://styles/mapbox/"+r+"-v9";break;case"streets":t="mapbox://styles/mapbox/streets-v10";break;case"satellite":t="mapbox://styles/mapbox/satellite-v9"}return v.default.createElement("div",{className:this.props.classes.layout},v.default.createElement(m.default,{controller:!0,width:"100%",height:"100%",viewState:this.state.viewState,getCursor:function(){return"crosshair"},onViewStateChange:this.updateViewState},v.default.createElement(g.default,{reuseMaps:!0,preventStyleDiffing:!0,mapboxApiAccessToken:i,mapStyle:t},v.default.createElement("div",{className:this.props.classes.controls},v.default.createElement(g.NavigationControl,{onViewportChange:this.updateViewportNoPitch}),v.default.createElement("div",{className:this.props.classes.controlsSpacer}),v.default.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group "},v.default.createElement("button",{title:"My Location",className:"mapboxgl-ctrl-icon ",onClick:this.locateUser},v.default.createElement(b.default,null))),v.default.createElement("div",{className:this.props.classes.controlsSpacer}),v.default.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group "},v.default.createElement("button",{title:"Flat Mode",className:"mapboxgl-ctrl-icon "+(o?"":this.props.classes.controlsSelected),onClick:function(){return e.updateMapMode("flat")}},v.default.createElement(y.default,null)),v.default.createElement("button",{title:"3D Mode",className:"mapboxgl-ctrl-icon "+(o?this.props.classes.controlsSelected:""),onClick:function(){return e.updateMapMode("perspective")}},v.default.createElement(_.default,null))),v.default.createElement("div",{className:this.props.classes.controlsSpacer}),v.default.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group "},v.default.createElement("button",{title:"Contour View",className:"mapboxgl-ctrl-icon "+("contour"===s?this.props.classes.controlsSelected:""),onClick:function(){return e.updateViewMode("contour")}},v.default.createElement(x.default,null)),v.default.createElement("button",{title:"Streets View",className:"mapboxgl-ctrl-icon "+("streets"===s?this.props.classes.controlsSelected:""),onClick:function(){return e.updateViewMode("streets")}},v.default.createElement(w.default,null)),v.default.createElement("button",{title:"Satellite View",className:"mapboxgl-ctrl-icon "+("satellite"===s?this.props.classes.controlsSelected:""),onClick:function(){return e.updateViewMode("satellite")}},v.default.createElement(S.default,null)))))))}}]),e}(v.default.Component);e.default=k},VKpO:function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"d",function(){return a}),n.d(e,"c",function(){return o}),n.d(e,"b",function(){return s});var i=n("bl9R");function r(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(t,e){var n=i.c([],e,t);return i.b(n,n,1/n[3]),n}function o(t,e){var n=t%e;return n<0?e+n:n}function s(t,e,n){return n*e+(1-n)*t}},Vame:function(t,e,n){"use strict";(function(t){n.d(e,"b",function(){return i}),n.d(e,"c",function(){return r}),n.d(e,"a",function(){return a});var i="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",r="undefined"!=typeof window?window:t,a=(void 0!==t||window,"undefined"!=typeof document&&document,!1);try{var o={get passive(){a=!0}};r.addEventListener("test",o,o),r.removeEventListener("test",o,o)}catch(s){}}).call(this,n("3r9c"))},VmRL:function(t,e,n){"use strict";function i(t,e,n){n=n||2;var i,s,u,l,c,p,d,v=e&&e.length,g=v?e[0]*n:t.length,m=r(t,0,g,n,!0),y=[];if(!m||m.next===m.prev)return y;if(v&&(m=function(t,e,n,i){var o,s,u,l,c,p=[];for(o=0,s=e.length;o<s;o++)u=e[o]*i,l=o<s-1?e[o+1]*i:t.length,(c=r(t,u,l,i,!1))===c.next&&(c.steiner=!0),p.push(A(c));for(p.sort(h),o=0;o<p.length;o++)f(p[o],n),n=a(n,n.next);return n}(t,e,m,n)),t.length>80*n){i=u=t[0],s=l=t[1];for(var _=n;_<g;_+=n)(c=t[_])<i&&(i=c),(p=t[_+1])<s&&(s=p),c>u&&(u=c),p>l&&(l=p);d=0!==(d=Math.max(u-i,l-s))?1/d:0}return o(m,y,n,i,s,d),y}function r(t,e,n,i,r){var a,o;if(r===k(t,e,n,i)>0)for(a=e;a<n;a+=i)o=x(a,t[a],t[a+1],o);else for(a=n-i;a>=e;a-=i)o=x(a,t[a],t[a+1],o);return o&&m(o,o.next)&&(w(o),o=o.next),o}function a(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!m(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(w(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function o(t,e,n,i,r,h,f){if(t){!f&&h&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=p(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,a,o,s,u,l=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,i=n,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(t,i,r,h);for(var A,d,v=t;t.prev!==t.next;)if(A=t.prev,d=t.next,h?u(t,i,r,h):s(t))e.push(A.i/n),e.push(t.i/n),e.push(d.i/n),w(t),t=d.next,v=d.next;else if((t=d)===v){f?1===f?o(t=l(t,e,n),e,n,i,r,h,2):2===f&&c(t,e,n,i,r,h):o(a(t),e,n,i,r,h,1);break}}}function s(t){var e=t.prev,n=t,i=t.next;if(g(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(d(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&g(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function u(t,e,n,i){var r=t.prev,a=t,o=t.next;if(g(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,u=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,c=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=p(s,u,e,n,i),f=p(l,c,e,n,i),A=t.prevZ,v=t.nextZ;A&&A.z>=h&&v&&v.z<=f;){if(A!==t.prev&&A!==t.next&&d(r.x,r.y,a.x,a.y,o.x,o.y,A.x,A.y)&&g(A.prev,A,A.next)>=0)return!1;if(A=A.prevZ,v!==t.prev&&v!==t.next&&d(r.x,r.y,a.x,a.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;A&&A.z>=h;){if(A!==t.prev&&A!==t.next&&d(r.x,r.y,a.x,a.y,o.x,o.y,A.x,A.y)&&g(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;v&&v.z<=f;){if(v!==t.prev&&v!==t.next&&d(r.x,r.y,a.x,a.y,o.x,o.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function l(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!m(r,a)&&y(r,i,i.next,a)&&_(r,a)&&_(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),w(i),w(i.next),i=t=a),i=i.next}while(i!==t);return i}function c(t,e,n,i,r,s){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&v(u,l)){var c=b(u,l);return u=a(u,u.next),c=a(c,c.next),o(u,e,n,i,r,s),void o(c,e,n,i,r,s)}l=l.next}u=u.next}while(u!==t)}function h(t,e){return t.x-e.x}function f(t,e){if(e=function(t,e){var n,i=e,r=t.x,a=t.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===o)return n.prev;var u,l=n,c=n.x,h=n.y,f=1/0;i=n.next;for(;i!==l;)r>=i.x&&i.x>=c&&r!==i.x&&d(a<h?r:o,a,c,h,a<h?o:r,a,i.x,i.y)&&((u=Math.abs(a-i.y)/(r-i.x))<f||u===f&&i.x>n.x)&&_(i,t)&&(n=i,f=u),i=i.next;return n}(t,e)){var n=b(e,t);a(n,n.next)}}function p(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function A(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function d(t,e,n,i,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&y(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&_(t,e)&&_(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function m(t,e){return t.x===e.x&&t.y===e.y}function y(t,e,n,i){return!!(m(t,e)&&m(n,i)||m(t,i)&&m(n,e))||g(t,e,n)>0!=g(t,e,i)>0&&g(n,i,t)>0!=g(n,i,e)>0}function _(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function b(t,e){var n=new S(t.i,t.x,t.y),i=new S(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function x(t,e,n,i){var r=new S(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function k(t,e,n,i){for(var r=0,a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}t.exports=i,t.exports.default=i,i.deviation=function(t,e,n,i){var r=e&&e.length,a=r?e[0]*n:t.length,o=Math.abs(k(t,0,a,n));if(r)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;o-=Math.abs(k(t,l,c,n))}var h=0;for(s=0;s<i.length;s+=3){var f=i[s]*n,p=i[s+1]*n,A=i[s+2]*n;h+=Math.abs((t[f]-t[A])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[A+1]-t[f+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},i.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var a=0;a<t[r].length;a++)for(var o=0;o<e;o++)n.vertices.push(t[r][a][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n}},W1BH:function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"b",function(){return a});var i=n("5ku3"),r="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",a=Object(i.a)()},Wb0s:function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return o});var i=n("5a1V"),r=function(t){return t&&t instanceof ArrayBuffer},a=function(e){return e&&e instanceof t};function o(t){if(r(t))return t;if(a(t))return new Uint8Array(t).buffer;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){var e=t;return(new TextEncoder).encode(e).buffer}return Object(i.a)(!1)}}).call(this,n("tjlA").Buffer)},YzvJ:function(t,e,n){"use strict";e.a={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null}},ZaHm:function(t,e,n){"use strict";n.d(e,"p",function(){return r}),n.d(e,"e",function(){return a}),n.d(e,"a",function(){return o}),n.d(e,"g",function(){return s}),n.d(e,"o",function(){return u}),n.d(e,"n",function(){return l}),n.d(e,"j",function(){return c}),n.d(e,"k",function(){return h}),n.d(e,"l",function(){return f}),n.d(e,"m",function(){return p}),n.d(e,"c",function(){return A}),n.d(e,"d",function(){return d}),n.d(e,"i",function(){return v}),n.d(e,"h",function(){return g}),n.d(e,"f",function(){return m}),n.d(e,"b",function(){return y});var i=n("yU0y");function r(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=r,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function a(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],A=e[12],d=e[13],v=e[14],g=e[15],m=n*s-i*o,y=n*u-r*o,_=n*l-a*o,b=i*u-r*s,x=i*l-a*s,w=r*l-a*u,S=c*d-h*A,k=c*v-f*A,O=c*g-p*A,P=h*v-f*d,E=h*g-p*d,C=f*g-p*v,T=m*C-y*E+_*P+b*O-x*k+w*S;return T?(T=1/T,t[0]=(s*C-u*E+l*P)*T,t[1]=(r*E-i*C-a*P)*T,t[2]=(d*w-v*x+g*b)*T,t[3]=(f*x-h*w-p*b)*T,t[4]=(u*O-o*C-l*k)*T,t[5]=(n*C-r*O+a*k)*T,t[6]=(v*_-A*w-g*y)*T,t[7]=(c*w-f*_+p*y)*T,t[8]=(o*E-s*O+l*S)*T,t[9]=(i*O-n*E-a*S)*T,t[10]=(A*x-d*_+g*m)*T,t[11]=(h*_-c*x-p*m)*T,t[12]=(s*k-o*P-u*S)*T,t[13]=(n*P-i*k+r*S)*T,t[14]=(d*y-A*b-v*m)*T,t[15]=(c*b-h*y+f*m)*T,t):null}function o(t){var e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11],p=t[12],A=t[13],d=t[14],v=t[15];return(e*o-n*a)*(h*v-f*d)-(e*s-i*a)*(c*v-f*A)+(e*u-r*a)*(c*d-h*A)+(n*s-i*o)*(l*v-f*p)-(n*u-r*o)*(l*d-h*p)+(i*u-r*s)*(l*A-c*p)}function s(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],A=e[11],d=e[12],v=e[13],g=e[14],m=e[15],y=n[0],_=n[1],b=n[2],x=n[3];return t[0]=y*i+_*s+b*h+x*d,t[1]=y*r+_*u+b*f+x*v,t[2]=y*a+_*l+b*p+x*g,t[3]=y*o+_*c+b*A+x*m,y=n[4],_=n[5],b=n[6],x=n[7],t[4]=y*i+_*s+b*h+x*d,t[5]=y*r+_*u+b*f+x*v,t[6]=y*a+_*l+b*p+x*g,t[7]=y*o+_*c+b*A+x*m,y=n[8],_=n[9],b=n[10],x=n[11],t[8]=y*i+_*s+b*h+x*d,t[9]=y*r+_*u+b*f+x*v,t[10]=y*a+_*l+b*p+x*g,t[11]=y*o+_*c+b*A+x*m,y=n[12],_=n[13],b=n[14],x=n[15],t[12]=y*i+_*s+b*h+x*d,t[13]=y*r+_*u+b*f+x*v,t[14]=y*a+_*l+b*p+x*g,t[15]=y*o+_*c+b*A+x*m,t}function u(t,e,n){var i,r,a,o,s,u,l,c,h,f,p,A,d=n[0],v=n[1],g=n[2];return e===t?(t[12]=e[0]*d+e[4]*v+e[8]*g+e[12],t[13]=e[1]*d+e[5]*v+e[9]*g+e[13],t[14]=e[2]*d+e[6]*v+e[10]*g+e[14],t[15]=e[3]*d+e[7]*v+e[11]*g+e[15]):(i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],p=e[10],A=e[11],t[0]=i,t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=f,t[10]=p,t[11]=A,t[12]=i*d+s*v+h*g+e[12],t[13]=r*d+u*v+f*g+e[13],t[14]=a*d+l*v+p*g+e[14],t[15]=o*d+c*v+A*g+e[15]),t}function l(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c(t,e,n,r){var a,o,s,u,l,c,h,f,p,A,d,v,g,m,y,_,b,x,w,S,k,O,P,E,C=r[0],T=r[1],M=r[2],j=Math.sqrt(C*C+T*T+M*M);return j<i.b?null:(C*=j=1/j,T*=j,M*=j,a=Math.sin(n),s=1-(o=Math.cos(n)),u=e[0],l=e[1],c=e[2],h=e[3],f=e[4],p=e[5],A=e[6],d=e[7],v=e[8],g=e[9],m=e[10],y=e[11],_=C*C*s+o,b=T*C*s+M*a,x=M*C*s-T*a,w=C*T*s-M*a,S=T*T*s+o,k=M*T*s+C*a,O=C*M*s+T*a,P=T*M*s-C*a,E=M*M*s+o,t[0]=u*_+f*b+v*x,t[1]=l*_+p*b+g*x,t[2]=c*_+A*b+m*x,t[3]=h*_+d*b+y*x,t[4]=u*w+f*S+v*k,t[5]=l*w+p*S+g*k,t[6]=c*w+A*S+m*k,t[7]=h*w+d*S+y*k,t[8]=u*O+f*P+v*E,t[9]=l*O+p*P+g*E,t[10]=c*O+A*P+m*E,t[11]=h*O+d*P+y*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function h(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+l*i,t[5]=o*r+c*i,t[6]=s*r+h*i,t[7]=u*r+f*i,t[8]=l*r-a*i,t[9]=c*r-o*i,t[10]=h*r-s*i,t[11]=f*r-u*i,t}function f(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-l*i,t[1]=o*r-c*i,t[2]=s*r-h*i,t[3]=u*r-f*i,t[8]=a*i+l*r,t[9]=o*i+c*r,t[10]=s*i+h*r,t[11]=u*i+f*r,t}function p(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+l*i,t[1]=o*r+c*i,t[2]=s*r+h*i,t[3]=u*r+f*i,t[4]=l*r-a*i,t[5]=c*r-o*i,t[6]=h*r-s*i,t[7]=f*r-u*i,t}function A(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=n+n,s=i+i,u=r+r,l=n*o,c=i*o,h=i*s,f=r*o,p=r*s,A=r*u,d=a*o,v=a*s,g=a*u;return t[0]=1-h-A,t[1]=c+g,t[2]=f-v,t[3]=0,t[4]=c-g,t[5]=1-l-A,t[6]=p+d,t[7]=0,t[8]=f+v,t[9]=p-d,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function d(t,e,n,i,r,a,o){var s=1/(n-e),u=1/(r-i),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(r+i)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function v(t,e,n,i,r){var a,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(a=1/(i-r),t[10]=(r+i)*a,t[14]=2*r*i*a):(t[10]=-1,t[14]=-2*i),t}function g(t,e,n,i,r,a,o){var s=1/(e-n),u=1/(i-r),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*u,t[14]=(o+a)*l,t[15]=1,t}function m(t,e,n,r){var a,o,s,u,l,c,h,f,p,A,d=e[0],v=e[1],g=e[2],m=r[0],y=r[1],_=r[2],b=n[0],x=n[1],w=n[2];return Math.abs(d-b)<i.b&&Math.abs(v-x)<i.b&&Math.abs(g-w)<i.b?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=d-b,f=v-x,p=g-w,a=y*(p*=A=1/Math.sqrt(h*h+f*f+p*p))-_*(f*=A),o=_*(h*=A)-m*p,s=m*f-y*h,(A=Math.sqrt(a*a+o*o+s*s))?(a*=A=1/A,o*=A,s*=A):(a=0,o=0,s=0),u=f*s-p*o,l=p*a-h*s,c=h*o-f*a,(A=Math.sqrt(u*u+l*l+c*c))?(u*=A=1/A,l*=A,c*=A):(u=0,l=0,c=0),t[0]=a,t[1]=u,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=s,t[9]=c,t[10]=p,t[11]=0,t[12]=-(a*d+o*v+s*g),t[13]=-(u*d+l*v+c*g),t[14]=-(h*d+f*v+p*g),t[15]=1,t)}function y(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],A=t[11],d=t[12],v=t[13],g=t[14],m=t[15],y=e[0],_=e[1],b=e[2],x=e[3],w=e[4],S=e[5],k=e[6],O=e[7],P=e[8],E=e[9],C=e[10],T=e[11],M=e[12],j=e[13],L=e[14],I=e[15];return Math.abs(n-y)<=i.b*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=i.b*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(a-b)<=i.b*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(o-x)<=i.b*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-w)<=i.b*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-S)<=i.b*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-k)<=i.b*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(c-O)<=i.b*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(h-P)<=i.b*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(f-E)<=i.b*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(p-C)<=i.b*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(A-T)<=i.b*Math.max(1,Math.abs(A),Math.abs(T))&&Math.abs(d-M)<=i.b*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(v-j)<=i.b*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(g-L)<=i.b*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(m-I)<=i.b*Math.max(1,Math.abs(m),Math.abs(I))}},ZuRb:function(t,e,n){"use strict";var i,r={kind:"Request",fragment:{kind:"Fragment",name:"MapsPageQuery",type:"Query",metadata:null,argumentDefinitions:[],selections:[{kind:"LinkedField",alias:null,name:"viewer",storageKey:null,args:null,concreteType:"Viewer",plural:!1,selections:[{kind:"FragmentSpread",name:"LayoutContainer_viewer",args:null}]}]},operation:{kind:"Operation",name:"MapsPageQuery",argumentDefinitions:[],selections:[{kind:"LinkedField",alias:null,name:"viewer",storageKey:null,args:null,concreteType:"Viewer",plural:!1,selections:[{kind:"LinkedField",alias:null,name:"me",storageKey:null,args:null,concreteType:"Status",plural:!1,selections:[{kind:"ScalarField",alias:null,name:"isAuthenticated",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"userId",args:null,storageKey:null},i={kind:"ScalarField",alias:null,name:"name",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"email",args:null,storageKey:null},{kind:"ScalarField",alias:null,name:"roles",args:null,storageKey:null},{kind:"LinkedField",alias:null,name:"providers",storageKey:null,args:null,concreteType:"ProviderStatus",plural:!0,selections:[i]}]}]}]},params:{operationKind:"query",name:"MapsPageQuery",id:null,text:"query MapsPageQuery {\n  viewer {\n    ...LayoutContainer_viewer\n  }\n}\n\nfragment LayoutContainer_viewer on Viewer {\n  me {\n    isAuthenticated\n    userId\n    name\n    email\n    roles\n    providers {\n      name\n    }\n  }\n}\n",metadata:{}}};r.hash="581e71fb6db09ace5cad8fa88ca4f3f2",t.exports=r},ZxFD:function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"f",function(){return a}),n.d(e,"c",function(){return o}),n.d(e,"e",function(){return s}),n.d(e,"b",function(){return u}),n.d(e,"d",function(){return l}),n.d(e,"h",function(){return c}),n.d(e,"g",function(){return p});var i=n("yU0y");function r(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function a(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function o(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function s(t,e){return t[0]=-e[0],t[1]=-e[1],t}function u(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t}function l(t,e,n,i){var r=e[0],a=e[1];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t}function c(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}var h,f,p=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t};h=new i.a(2),i.a!=Float32Array&&(h[0]=0,h[1]=0),f=h},bl9R:function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"b",function(){return a}),n.d(e,"c",function(){return o});var i=n("yU0y");function r(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function a(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function o(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,t}var s,u;s=new i.a(4),i.a!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0),u=s},d3wX:function(t,e,n){"use strict";var i=n("U8pU"),r=n("KQm4"),a=n("rePB"),o=n("1OyB"),s=n("vuIU"),u=n("W1BH");var l=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Object(o.a)(this,t),this.storage=function(t){try{var e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(i){return null}}(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}return Object(s.a)(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(t){return this.config={},this.updateConfiguration(t)}},{key:"updateConfiguration",value:function(t){if(Object.assign(this.config,t),this.storage){var e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}},{key:"_loadConfiguration",value:function(){var t={};if(this.storage){var e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}]),t}();function c(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));var a=t.width*n,o=t.height*n,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}var h={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function f(t){return"string"==typeof t?h[t.toUpperCase()]||h.WHITE:t}function p(t,e){if(!t)throw new Error(e||"Assertion failed")}var A=n("egY1");n.d(e,"a",function(){return y});var d={debug:u.b&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},v={enabled:!1,priority:0};function g(){}var m={};var y=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;Object(o.a)(this,t),this.id=e,this.VERSION=u.a,this._startTs=Object(A.a)(),this._deltaTs=Object(A.a)(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new l("__probe-".concat(this.id,"__"),v),this.userData={},this.timeStamp("".concat(this.id," started")),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=!0,a=!1,o=void 0;try{for(var s,u=function(){var n=s.value;"function"==typeof t[n]&&(e.find(function(t){return n===t})||(t[n]=t[n].bind(t)))},l=i[Symbol.iterator]();!(r=(s=l.next()).done);r=!0)u()}catch(c){a=!0,o=c}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}}(this),Object.seal(this)}return Object(s.a)(t,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getPriority",value:function(){return this._storage.config.priority}},{key:"getLevel",value:function(){return this._storage.config.priority}},{key:"getTotal",value:function(){return Number((Object(A.a)()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((Object(A.a)()-this._deltaTs).toPrecision(10))}},{key:"enable",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}},{key:"setLevel",value:function(t){return this._storage.updateConfiguration({priority:t}),this}},{key:"assert",value:function(t,e){p(t,e)}},{key:"warn",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this._getLogFunction({message:t,args:n,method:d.warn,once:!0})}},{key:"error",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this._getLogFunction({message:t,args:n,method:d.error})}},{key:"deprecated",value:function(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}},{key:"removed",value:function(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}},{key:"probe",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:t,message:e,args:i,method:d.log,time:!0,once:!0})}},{key:"log",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:t,message:e,args:i,method:d.debug})}},{key:"info",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:t,message:e,args:i,method:console.info})}},{key:"once",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._getLogFunction({priority:t,message:e,args:i,method:d.debug||d.info,once:!0})}},{key:"table",value:function(t,e,n){if(e){var i=function(t){for(var e in t)for(var n in t[e])return n||"untitled";return"empty"}(e);return this._getLogFunction({priority:t,message:e,args:n&&[n],tag:i,method:console.table||g})}return g}},{key:"image",value:function(t){var e=t.priority,n=t.image,i=t.message,r=void 0===i?"":i,a=t.scale,o=void 0===a?1:a;return e>this.getPriority()?g:u.b?this._logImageInBrowser({image:n,message:r,scale:o}):this._logImageInNode({image:n,message:r,scale:o})}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(t){return this._storage.config[t]}},{key:"set",value:function(t,e){this._storage.updateConfiguration(Object(a.a)({},t,e))}},{key:"_logImageInNode",value:function(t){var e=t.image,i=(t.message,t.scale),r=void 0===i?1:i,a=null;try{a=n(0)}catch(o){}return a?function(){return a(e,{fit:"box",width:"".concat(Math.round(80*r),"%")}).then(function(t){return console.log(t)})}:g}},{key:"_logImageInBrowser",value:function(t){var e=t.image,n=t.message,i=void 0===n?"":n,a=t.scale,o=void 0===a?1:a;if("string"==typeof e){var s=new Image;return s.onload=function(){var t,e=c(s,i,o);(t=console).log.apply(t,Object(r.a)(e))},s.src=e,g}var u,l=e.nodeName||"";if("img"===l.toLowerCase())return(u=console).log.apply(u,Object(r.a)(c(e,i,o))),g;if("canvas"===l.toLowerCase()){var h=new Image;return h.onload=function(){var t;return(t=console).log.apply(t,Object(r.a)(c(h,i,o)))},h.src=e.toDataURL(),g}return g}},{key:"time",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.time?console.time:console.info})}},{key:"timeEnd",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeEnd?console.timeEnd:console.info})}},{key:"timeStamp",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeStamp||g})}},{key:"group",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},i=(n=this._normalizeArguments({priority:t,message:e,opts:n})).collapsed;return this._getLogFunction({priority:t,message:e,opts:n,method:(i?console.groupCollapsed:console.group)||console.info})}},{key:"groupCollapsed",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}},{key:"groupEnd",value:function(t){return this._getLogFunction({priority:t,message:"",method:console.groupEnd||g})}},{key:"withGroup",value:function(t,e,n){var i=this._normalizeArguments({priority:t,message:e});this.group(i);try{n()}finally{this.groupEnd(i.message)}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(t){return 0===(t=this._normalizePriority(t))||this.isEnabled()&&this.getPriority()>=t}},{key:"_getElapsedTime",value:function(){var t=this.getTotal(),e=this.getDelta();return this._deltaTs=Object(A.a)(),{total:t,delta:e}}},{key:"_getLogFunction",value:function(t){if(this._shouldLog(t.priority)){var e=t.method;t=this._parseArguments(t),p(e);var n=t.message,i=t.tag||t.message;if(t.once){if(m[i])return g;m[i]=Object(A.a)()}return n=this._decorateMessage(n,t),e.bind.apply(e,[console,n].concat(Object(r.a)(t.args)))}return g}},{key:"_parseArguments",value:function(t){var e=this._normalizeArguments(t),n=this._getElapsedTime(),i=n.delta,r=n.total;return Object.assign(t,e,{delta:i,total:r})}},{key:"_normalizePriority",value:function(t){var e;switch(Object(i.a)(t)){case"number":e=t;break;case"object":e=t.priority||0;break;default:e=0}return p(Number.isFinite(e)&&e>=0),e}},{key:"_normalizeArguments",value:function(t){var e=t.priority,n=t.message,r=t.args,a=void 0===r?[]:r,o=t.opts,s={priority:this._normalizePriority(e),message:n,args:a};switch(Object(i.a)(e)){case"string":case"function":void 0!==n&&a.unshift(n),Object.assign(s,{message:e});break;case"object":Object.assign(s,e)}return"function"==typeof s.message&&(s.message=this._shouldLog(s.priority)?s.message():""),p("string"==typeof s.message||"object"===Object(i.a)(s.message)),Object.assign(s,o)}},{key:"_decorateMessage",value:function(t,e){if("string"==typeof t){var n="";if(e.time){var i=this._getElapsedTime().total;n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}((s=i)<10?"".concat(s.toFixed(2),"ms"):s<100?"".concat(s.toFixed(1),"ms"):s<1e3?"".concat(s.toFixed(0),"ms"):"".concat((s/1e3).toFixed(2),"s"))}t=e.time?"".concat(this.id,": ").concat(n,"  ").concat(t):"".concat(this.id,": ").concat(t),r=t,a=e.color,o=e.background,u.b||"string"!=typeof r||(a&&(a=f(a),r="[".concat(a,"m").concat(r,"[39m")),o&&(a=f(o),r="[".concat(o+10,"m").concat(r,"[49m"))),t=r}var r,a,o,s;return t}},{key:"priority",set:function(t){return this._storage.updateConfiguration({priority:t}),this},get:function(){return this._storage.config.priority}}]),t}();y.VERSION=u.a},dByZ:function(t,e,n){"use strict";n.d(e,"a",function(){return f});var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("h6m0"),l=n("qjXE"),c=n("n+fv"),h=[0,0,0],f=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(i.a)(this,e),t=Object(a.a)(this,Object(o.a)(e).call(this,3)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,r,s),t}return Object(s.a)(e,t),Object(r.a)(e,[{key:"angle",value:function(t){return c.a(this,t)}},{key:"cross",value:function(t){return c.b(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,n=t.origin,i=void 0===n?h:n;return c.e(this,this,i,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,n=t.origin,i=void 0===n?h:n;return c.f(this,this,i,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,n=t.origin,i=void 0===n?h:n;return c.g(this,this,i,e),this.check()}},{key:"operation",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return t.apply(void 0,[this,this].concat(n)),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Object(l.a)(t)}}]),e}(u.a)},dCZK:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/maps",function(){var t=n("i/Ws");return{page:t.default||t}}])},eUbh:function(t,e,n){"use strict";(function(t){var e=n("9Hqq"),i=n("gVfD");function r(t,n){var r=n.extension,a=n.target,o=n.target2,s=i.b[r];Object(e.a)(s);for(var u=s.meta,l=(void 0===u?{}:u).suffix,c=void 0===l?"":l,h=t.getExtension(r),f=function(){var e=A[p],n="".concat(e).concat(c),i=null;"meta"===e||"function"==typeof t[e]||(h&&"function"==typeof h[n]?i=function(){return h[n].apply(h,arguments)}:"function"==typeof s[e]&&(i=s[e].bind(a))),i&&(a[e]=i,o[e]=i)},p=0,A=Object.keys(s);p<A.length;p++)f()}(void 0!==t?t:window).polyfillContext=function(t){return t.luma=t.luma||{},function(t){t.luma.extensions={};var e=t.getSupportedExtensions()||[],n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;t.luma[s]=t.getExtension(s)}}catch(u){i=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}(t),t.luma.polyfilled||(function(t,e){var n=!0,i=!1,a=void 0;try{for(var o,s=Object.getOwnPropertyNames(e)[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;"overrides"!==u&&r(t,{extension:u,target:t.luma,target2:t})}}catch(l){i=!0,a=l}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}(t,i.b),function(t,e){var n=e.target,r=e.target2;Object.keys(i.a).forEach(function(e){if("function"==typeof i.a[e]){var a=t[e]?t[e].bind(t):function(){},o=i.a[e].bind(null,t,a);n[e]=o,r[e]=o}})}(t,{target:t.luma,target2:t}),t.luma.polyfilled=!0),t}}).call(this,n("3r9c"))},egY1:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var i=n("W1BH"),r=n("K9nA");function a(){var t;if(i.b&&r.b.performance)t=r.b.performance.now();else if(r.a.hrtime){var e=r.a.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}},"ei+1":function(t,e,n){"use strict";var i=n("ODXe"),r=n("1OyB"),a=n("vuIU"),o=1,s=2,u=4,l={mousedown:o,mousemove:s,mouseup:u};var c,h,f=null;"undefined"!=typeof document&&(f=n("yLV6"),c=f.PointerEventInput,h=c.prototype.handler,c.prototype.handler=function(t){var e=this.store;t.button>0&&(function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(e,function(e){return e.pointerId===t.pointerId})||e.push(t)),h.call(this,t)},f.MouseInput.prototype.handler=function(t){var e=l[t.type];e&o&&t.button>=0&&(this.pressed=!0),e&s&&0===t.which&&(e=u),this.pressed&&(e&u&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))});var p=f;var A=p?[[p.Rotate,{enable:!1}],[p.Pinch,{enable:!1}],[p.Swipe,{enable:!1}],[p.Pan,{threshold:0,enable:!1}],[p.Press,{enable:!1}],[p.Tap,{event:"doubletap",taps:2,enable:!1}],[p.Tap,{event:"anytap",enable:!1}],[p.Tap,{enable:!1}]]:null,d={rotate:["pinch"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},v={doubletap:["tap"]},g={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},m=["keydown","keyup"],y=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],_=["wheel","mousewheel","DOMMouseScroll"],b={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},x={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},w=n("Vame"),S=-1!==w.b.indexOf("firefox"),k=_,O=function(){function t(e,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},a),this.events=k.concat(a.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(t){return e.addEventListener(t,i.handleEvent,!!w.a&&{passive:!1})})}return Object(a.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"wheel"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){if(this.options.enable){var e=t.deltaY;w.c.WheelEvent&&(S&&t.deltaMode===w.c.WheelEvent.DOM_DELTA_PIXEL&&(e/=w.c.devicePixelRatio),t.deltaMode===w.c.WheelEvent.DOM_DELTA_LINE&&(e*=40));var n={x:t.clientX,y:t.clientY};0!==e&&e%4.000244140625==0&&(e=Math.floor(e/4.000244140625)),t.shiftKey&&e&&(e*=.25),this._onWheel(t,-e,n)}}},{key:"_onWheel",value:function(t,e,n){this.callback({type:"wheel",center:n,delta:e,srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),P=y,E=function(){function t(e,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},a),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=P.concat(a.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(t){return e.addEventListener(t,i.handleEvent)})}return Object(a.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"pointermove"===t&&(this.enableMoveEvent=e),"pointerover"===t&&(this.enableOverEvent=e),"pointerout"===t&&(this.enableOutEvent=e),"pointerleave"===t&&(this.enableLeaveEvent=e)}},{key:"handleEvent",value:function(t){this.handleOverEvent(t),this.handleOutEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)}},{key:"handleOverEvent",value:function(t){this.enableOverEvent&&"mouseover"===t.type&&this.callback({type:"pointerover",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleOutEvent",value:function(t){this.enableOutEvent&&"mouseout"===t.type&&this.callback({type:"pointerout",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleLeaveEvent",value:function(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this.callback({type:"pointerleave",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleMoveEvent",value:function(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:t,pointerType:"mouse",target:t.target});break;case"mouseup":this.pressed=!1}}}]),t}(),C=m,T=function(){function t(e,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},a),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=C.concat(a.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=1,e.style.outline="none",this.events.forEach(function(t){return e.addEventListener(t,i.handleEvent)})}return Object(a.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"keydown"===t&&(this.enableDownEvent=e),"keyup"===t&&(this.enableUpEvent=e)}},{key:"handleEvent",value:function(t){var e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:"keydown",srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:"keyup",srcEvent:t,key:t.key,target:t.target}))}}]),t}(),M=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(r.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Object(a.a)(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(t,e){"contextmenu"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){this.options.enable&&this.callback({type:"contextmenu",center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),j=1,L=2,I=4,z={pointerdown:j,pointermove:L,pointerup:I,mousedown:j,mousemove:L,mouseup:I},D=1,B=2,R=3,F=0,N=1,U=2,V=1,G=2,W=4;var H=function(){function t(e){Object(r.a)(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this)}return Object(a.a)(t,[{key:"isEmpty",value:function(){return 0===this.handlers.length}},{key:"add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"root",i=this.handlers,r=this.handlersByElement;r.has(n)||r.set(n,[]);var a={type:t,handler:e,srcElement:n};i.push(a),r.get(n).push(a)}},{key:"remove",value:function(t,e){for(var n=this.handlers,i=this.handlersByElement,r=n.length-1;r>=0;r--){var a=n[r];if(a.type===t&&a.handler===e){n.splice(r,1);var o=i.get(a.srcElement);o.splice(o.indexOf(a),1),0===o.length&&i.delete(a.srcElement)}}}},{key:"handleEvent",value:function(t){if(!this.isEmpty()){for(var e=this._normalizeEvent(t),n=t.srcEvent.target;n&&n!==e.rootElement;){if(this._emit(e,n),e.handled)return;n=n.parentNode}this._emit(e,"root")}}},{key:"_emit",value:function(t,e){var n=this.handlersByElement.get(e);if(n)for(var i=!1,r=function(){t.handled=!0},a=function(){t.handled=!0,i=!0},o=0;o<n.length;o++){var s=n[o],u=s.type;if((0,s.handler)(Object.assign({},t,{type:u,stopPropagation:r,stopImmediatePropagation:a})),i)break}}},{key:"_normalizeEvent",value:function(t){var e=this.eventManager.element;return Object.assign({},t,function(t){var e=z[t.srcEvent.type];if(!e)return null;var n=t.srcEvent,i=n.buttons,r=n.button,a=n.which,o=!1,s=!1,u=!1;return e===I||e===L&&!Number.isFinite(i)?(o=a===D,s=a===B,u=a===R):e===L?(o=Boolean(i&V),s=Boolean(i&W),u=Boolean(i&G)):e===j&&(o=r===F,s=r===N,u=r===U),{leftButton:o,middleButton:s,rightButton:u}}(t),function(t,e){var n=t.srcEvent;if(!t.center&&!Number.isFinite(n.clientX))return null;var i=t.center||{x:n.clientX,y:n.clientY},r=e.getBoundingClientRect(),a=r.width/e.offsetWidth,o=r.height/e.offsetHeight;return{center:i,offsetCenter:{x:(i.x-r.left-e.clientLeft)/a,y:(i.y-r.top-e.clientTop)/o}}}(t,e),{handled:!1,rootElement:e})}}]),t}(),q={events:null,recognizers:null,recognizerOptions:{},Manager:p?p.Manager:function(t){var e={},n=function(){return e};return e.get=function(){return null},e.set=n,e.on=n,e.off=n,e.destroy=n,e.emit=n,e},touchAction:"none"},Z=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(r.a)(this,t),this.options=Object.assign({},q,n),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var i=n.events;i&&this.on(i)}return Object(a.a)(t,[{key:"setElement",value:function(t){var e=this;if(this.element&&this.destroy(),this.element=t,t){var n=this.options,r=n.Manager;for(var a in this.manager=new r(t,{touchAction:n.touchAction,recognizers:n.recognizers||A}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(d).forEach(function(t){var n=e.manager.get(t);n&&d[t].forEach(function(t){n.recognizeWith(t)})}),n.recognizerOptions){var o=this.manager.get(a);if(o){var s=n.recognizerOptions[a];delete s.enable,o.set(s)}}this.wheelInput=new O(t,this._onOtherEvent,{enable:!1}),this.moveInput=new E(t,this._onOtherEvent,{enable:!1}),this.keyInput=new T(t,this._onOtherEvent,{enable:!1}),this.contextmenuInput=new M(t,this._onOtherEvent,{enable:!1});var u=!0,l=!1,c=void 0;try{for(var h,f=this.events[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=Object(i.a)(h.value,2),v=p[0],g=p[1];g.isEmpty()||(this._toggleRecognizer(g.recognizerName,!0),this.manager.on(v,g.handleEvent))}}catch(m){l=!0,c=m}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(t,e,n){if("string"==typeof t)this._addEventHandler(t,e,n);else for(var i in n=e,t)this._addEventHandler(i,t[i],n)}},{key:"off",value:function(t,e){if("string"==typeof t)this._removeEventHandler(t,e);else for(var n in t)this._removeEventHandler(n,t[n])}},{key:"_toggleRecognizer",value:function(t,e){var n=this.manager;if(n){var i=n.get(t);if(i&&i.options.enable!==e){i.set({enable:e});var r=v[t];r&&!this.options.recognizers&&r.forEach(function(r){var a=n.get(r);e?(a.requireFailure(t),i.dropRequireFailure(r)):a.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}}},{key:"_addEventHandler",value:function(t,e,n){var i=this.manager,r=this.events,a=x[t]||t,o=r.get(a);o||(o=new H(this),r.set(a,o),o.recognizerName=b[a]||a,i&&i.on(a,o.handleEvent)),this._toggleRecognizer(o.recognizerName,!0),o.add(t,e,n)}},{key:"_removeEventHandler",value:function(t,e){var n=this.events,i=x[t]||t,r=n.get(i);if(r&&(r.remove(t,e),r.isEmpty())){var a=r.recognizerName,o=!1,s=!0,u=!1,l=void 0;try{for(var c,h=n.values()[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var f=c.value;if(f.recognizerName===a&&!f.isEmpty()){o=!0;break}}}catch(p){u=!0,l=p}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}o||this._toggleRecognizer(a,!1)}}},{key:"_onBasicInput",value:function(t){var e=t.srcEvent,n=g[e.type];n&&this.manager.emit(n,t)}},{key:"_onOtherEvent",value:function(t){this.manager.emit(t.type,t)}}]),t}();n.d(e,"a",function(){return Z})},elnw:function(t,e,n){"use strict";n.r(e);var i=n("TZTB"),r=new(n("d3wX").a)({id:"deck"}).enable(),a=n("uTBh"),o={LNG_LAT:1,LNGLAT_AUTO_OFFSET:4,METER_OFFSETS:2,LNGLAT_OFFSETS:3,IDENTITY:0},s=Object.keys(o).map(function(t){return"const float COORDINATE_SYSTEM_".concat(t," = ").concat(o[t],".;")}).join(""),u="".concat(s,"\n\nuniform float project_uCoordinateSystem;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform float project_uAntimeridian;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    dy = clamp(dy, -1., 1.);\n  }\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x - project_uAntimeridian, 360.0) + project_uAntimeridian;\n  }\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\nvec4 project_position(vec4 position, vec2 position64xyLow) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT) {\n    return project_uModelMatrix * vec4(\n      project_mercator_(position.xy) * WORLD_SCALE * project_uScale,\n      project_size(position.z),\n      position.w\n    );\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    float X = position.x - project_uCoordinateOrigin.x;\n    float Y = position.y - project_uCoordinateOrigin.y;\n    return project_offset_(vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w));\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return project_offset_(position);\n  }\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_IDENTITY) {\n    position_world.xyz -= project_uCoordinateOrigin;\n    position_world += project_uModelMatrix * vec4(position64xyLow, 0.0, 0.0);\n  }\n\n  return project_offset_(position_world);\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_XY_LOW);\n}\n\nvec3 project_position(vec3 position, vec2 position64xyLow) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64xyLow);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_METER_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    position.w *= project_uCommonUnitsPerMeter.z;\n  }\n  return project_uViewProjectionMatrix * position + project_uCenter;\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters);\n}\nfloat project_pixel_size(float pixels) {\n  return pixels;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels;\n}\nfloat project_scale(float meters) {\n  return project_size(meters);\n}\nvec2 project_scale(vec2 meters) {\n  return project_size(meters);\n}\nvec3 project_scale(vec3 meters) {\n  return project_size(meters);\n}\nvec4 project_scale(vec4 meters) {\n  return project_size(meters);\n}\nvec4 project_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position);\n}\nvec4 project_pixel_to_clipspace(vec2 pixels) {\n  return vec4(project_pixel_size_to_clipspace(pixels), 0.0, 0.0);\n}\n"),l=n("ZaHm"),c=n("bl9R"),h={LNGLAT:1,LNGLAT_DEPRECATED:5,METER_OFFSETS:2,METERS:2,LNGLAT_OFFSETS:3,IDENTITY:0},f={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};function p(t,e){if(t===e)return!0;if(Array.isArray(t)){var n=t.length;if(!e||e.length!==n)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function A(t){var e,n={};return function(i){for(var r in i)if(!p(i[r],n[r])){e=t(i),n=i;break}return e}}function d(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}var v=[0,0,0,0],g=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y=[0,0,0],_=[0,0,0],b=12,x=A(function(t){var e=t.viewport,n=t.devicePixelRatio,i=t.coordinateSystem,r=t.coordinateOrigin,a=t.wrapLongitude,s=e.zoom,u=function(t){var e,n=t.viewport,i=t.coordinateSystem,r=t.coordinateOrigin,a=t.coordinateZoom,s=n.viewMatrixUncentered,u=n.viewMatrix,f=n.projectionMatrix,p=n.viewProjectionMatrix,A=n.cameraPosition,d=function(t){switch(t){case h.LNGLAT:case h.LNGLAT_EXPERIMENTAL:default:return o.LNGLAT_AUTO_OFFSET;case h.LNGLAT_DEPRECATED:return o.LNG_LAT;case h.METER_OFFSETS:case h.METERS:return o.METER_OFFSETS;case h.LNGLAT_OFFSETS:return o.LNGLAT_OFFSETS;case h.IDENTITY:return o.IDENTITY}}(i),m=r;if(d===o.LNGLAT_AUTO_OFFSET)if(a<b)d=o.LNG_LAT;else{var y=Math.fround(n.longitude),_=Math.fround(n.latitude);m=[y,_]}d===o.IDENTITY&&(m=[Math.fround(n.position[0]),Math.fround(n.position[1])]);switch(m[2]=m[2]||0,d){case o.LNG_LAT:e=v;break;case o.LNGLAT_OFFSETS:case o.METER_OFFSETS:case o.LNGLAT_AUTO_OFFSET:case o.IDENTITY:var x=n.projectPosition(m,Math.pow(2,a));A=[A[0]-x[0],A[1]-x[1],A[2]-x[2]],x[3]=1,e=c.c([],x,p),u=s||u,p=l.g([],f,u),p=l.g([],p,g);break;default:throw new Error("Unknown projection mode")}return{viewMatrix:u,viewProjectionMatrix:p,projectionCenter:e,cameraPosCommon:A,shaderCoordinateSystem:d,shaderCoordinateOrigin:m}}({coordinateSystem:i,coordinateOrigin:r,coordinateZoom:s,viewport:e}),f=u.projectionCenter,p=u.viewProjectionMatrix,A=u.cameraPosCommon,m=u.shaderCoordinateSystem,_=u.shaderCoordinateOrigin;d(p,"Viewport missing modelViewProjectionMatrix");var x=e.getDistanceScales(),w=[e.width*n,e.height*n],S={project_uCoordinateSystem:m,project_uCenter:f,project_uWrapLongitude:a,project_uAntimeridian:(e.longitude||0)-180,project_uViewportSize:w,project_uDevicePixelRatio:n,project_uFocalDistance:e.focalDistance||1,project_uCommonUnitsPerMeter:x.pixelsPerMeter,project_uCommonUnitsPerWorldUnit:x.pixelsPerMeter,project_uCommonUnitsPerWorldUnit2:y,project_uScale:e.scale,project_uViewProjectionMatrix:p,project_uCameraPosition:A},k=e.getDistanceScales(_);switch(m){case o.METER_OFFSETS:S.project_uCommonUnitsPerWorldUnit=k.pixelsPerMeter,S.project_uCommonUnitsPerWorldUnit2=k.pixelsPerMeter2;break;case o.LNGLAT_AUTO_OFFSET:S.project_uCoordinateOrigin=_;case o.LNG_LAT:case o.LNGLAT_OFFSETS:S.project_uCommonUnitsPerWorldUnit=k.pixelsPerDegree,S.project_uCommonUnitsPerWorldUnit2=k.pixelsPerDegree2;break;case o.IDENTITY:S.project_uCoordinateOrigin=_}return S});var w={};var S={name:"project",dependencies:[a.fp32],vs:u,getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w;return t.viewport?function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.viewport,n=t.devicePixelRatio,i=void 0===n?1:n,r=t.modelMatrix,a=void 0===r?null:r,o=t.coordinateSystem,s=void 0===o?h.LNGLAT:o,u=t.coordinateOrigin,l=void 0===u?_:u,c=t.wrapLongitude,f=void 0!==c&&c;return t.projectionMode,t.positionOrigin,d(e),Object.assign({project_uModelMatrix:a||m},x({viewport:e,devicePixelRatio:i,coordinateSystem:s,coordinateOrigin:l,wrapLongitude:f}))}(t):{}},deprecations:[{type:"function",old:"project_scale",new:"project_size"},{type:"function",old:"project_to_clipspace",new:"project_common_position_to_clipspace"},{type:"function",old:"project_pixel_to_clipspace",new:"project_pixel_size_to_clipspace"}]},k={name:"project32",dependencies:[S],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64xyLow);\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64xyLow, offset, commonPosition);\n}\n"},O=a.fp64.fp64ify,P=a.fp64.fp64ifyMatrix4,E={name:"project64",dependencies:[S,a.fp64],vs:"\nconst vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\n\nuniform vec2 project64_uScale;\nuniform vec2 project_uViewProjectionMatrixFP64[16];\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {\n\n#if defined(NVIDIA_FP64_WORKAROUND)\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);\n#else\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n#endif\n  out_val[1] = sub_fp64(PI_FP64,\n    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\n  return;\n}\n\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\n  vec2 pos_fp64[2];\n  mercatorProject_fp64(position_fp64, pos_fp64);\n  vec2 x_fp64 = mul_fp64(pos_fp64[0], project64_uScale);\n  vec2 y_fp64 = mul_fp64(pos_fp64[1], project64_uScale);\n  out_val[0] = mul_fp64(x_fp64, WORLD_SCALE_FP64);\n  out_val[1] = mul_fp64(y_fp64, WORLD_SCALE_FP64);\n\n  return;\n}\n\nvoid project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {\n  vec4 position64xy = vec4(\n    position.x, position64xyLow.x,\n    position.y, position64xyLow.y);\n\n  project_position_fp64(position64xy, out_val);\n}\n\nvec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  vec2 vertex_pos_clipspace[4];\n  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,\n    vertex_pos_clipspace);\n  return vec4(\n    vertex_pos_clipspace[0].x,\n    vertex_pos_clipspace[1].x,\n    vertex_pos_clipspace[2].x,\n    vertex_pos_clipspace[3].x\n    );\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec2 offset64[4];\n  vec4_fp64(vec4(offset, 0.0), offset64);\n\n  float z = project_size(position.z);\n  vec2 projectedPosition64xy[2];\n  project_position_fp64(position.xy, position64xyLow, projectedPosition64xy);\n\n  vec2 commonPosition64[4];\n  commonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);\n  commonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);\n  commonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));\n  commonPosition64[3] = vec2(1.0, 0.0);\n\n  commonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);\n\n  return project_common_position_to_clipspace_fp64(commonPosition64);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(\n    position, position64xyLow, offset, commonPosition\n  );\n}\nvec4 project_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  return project_common_position_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",getUniforms:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=t.project_uViewProjectionMatrix,n=t.project_uScale;if(e&&n)return C({project_uViewProjectionMatrix:e,project_uScale:n});return{}},deprecations:[{type:"function",old:"project_to_clipspace_fp64",new:"project_common_position_to_clipspace_fp64"}]},C=A(function(t){var e=t.project_uViewProjectionMatrix,n=t.project_uScale,i=P(e),r=O(n);return{project_uViewProjectionMatrixFP64:i,project64_uViewProjectionMatrix:i,project64_uScale:r}});if(i.a.deck&&"7.1.2"!==i.a.deck.VERSION)throw new Error("deck.gl - multiple versions detected: ".concat(i.a.deck.VERSION," vs ").concat("7.1.2"));i.a.deck||(r.log(0,"deck.gl ".concat("7.1.2"," - ").concat("set deck.log.priority=1 (or higher) to trace attribute updates"))(),i.a.deck=i.a.deck||{VERSION:"7.1.2",version:"7.1.2",log:r},Object(a.registerShaderModules)([a.fp32,a.fp64,S,k,E,a.gouraudlighting,a.phonglighting,a.picking]),Object(a.setDefaultShaderModules)([S]));var T=n("1OyB"),M=n("vuIU"),j=n("md7G"),L=n("foSv"),I=n("Ji7U"),z=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getProjectedLight",value:function(){return this}}]),e}(a.DirectionalLight),D=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(T.a)(this,t);var n=e.id,i=void 0===n?"effect":n;this.id=i,this.props={},Object.assign(this.props,e)}return Object(M.a)(t,[{key:"prepare",value:function(){}},{key:"getParameters",value:function(){}},{key:"cleanup",value:function(){}}]),t}(),B={color:[255,255,255],intensity:1},R=[{color:[255,255,255],intensity:1,direction:[-1,-3,-1]},{color:[255,255,255],intensity:.9,direction:[1,8,-2.5]}],F=function(t){function e(t){var n;for(var i in Object(T.a)(this,e),(n=Object(j.a)(this,Object(L.a)(e).call(this,t))).ambientLight=null,n.directionalLights=[],n.pointLights=[],t){var r=t[i];switch(r.type){case"ambient":n.ambientLight=r;break;case"directional":n.directionalLights.push(r);break;case"point":n.pointLights.push(r)}}return n.applyDefaultLights(),n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getParameters",value:function(t){var e=this.ambientLight,n=this.getProjectedPointLights(t);return{lightSources:{ambientLight:e,directionalLights:this.getProjectedDirectionalLights(t),pointLights:n}}}},{key:"applyDefaultLights",value:function(){var t=this.ambientLight,e=this.pointLights,n=this.directionalLights;t||0!==e.length||0!==n.length||(this.ambientLight=new a.AmbientLight(B),this.directionalLights.push(new z(R[0])),this.directionalLights.push(new z(R[1])))}},{key:"getProjectedPointLights",value:function(t){for(var e=[],n=0;n<this.pointLights.length;n++){var i=this.pointLights[n];e.push(i.getProjectedLight({layer:t}))}return e}},{key:"getProjectedDirectionalLights",value:function(t){for(var e=[],n=0;n<this.directionalLights.length;n++){var i=this.directionalLights[n];e.push(i.getProjectedLight({layer:t}))}return e}}]),e}(D),N=n("ODXe"),U=n("n+fv"),V=n("B7nP");function G(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Object(N.a)(t,3),r=i[0],a=i[1],o=i[2],s=void 0===o?0:o,u=e.projectFlat(t),l=Object(N.a)(u,2);return[l[0],l[1],s*(n?Object(V.b)({longitude:r,latitude:a,scale:e.scale}):e.getDistanceScales()).pixelsPerMeter[2]]}function W(t,e){var n=e.viewport,i=e.modelMatrix,r=e.coordinateSystem,a=e.coordinateOrigin,o=e.offsetMode,s=Object(N.a)(t,3),u=s[0],l=s[1],f=s[2];if(i){var p=c.c([],[u,l,f,1],i),A=Object(N.a)(p,3);u=A[0],l=A[1],f=A[2]}switch(r){case h.LNGLAT:case h.LNGLAT_DEPRECATED:return G([u,l,f],n,o);case h.LNGLAT_OFFSETS:return G([u+a[0],l+a[1],f+(a[2]||0)],n,o);case h.METER_OFFSETS:return G(Object(V.a)(a,[u,l,f]),n,o);case h.IDENTITY:default:return n.projectPosition([u,l,f])}}function H(t,e){var n=function(t){var e=Object.assign({},t),n=t.viewport,i=t.coordinateSystem,r=t.coordinateOrigin,a=t.fromCoordinateSystem,o=t.fromCoordinateOrigin;return void 0===a&&(e.fromCoordinateSystem=i),void 0===o&&(e.fromCoordinateOrigin=r),i===h.LNGLAT&&n.zoom>=b&&(e.coordinateSystem=h.LNGLAT_OFFSETS,e.coordinateOrigin=[Math.fround(n.longitude),Math.fround(n.latitude)]),e}(e),i=n.viewport,r=n.coordinateSystem,a=n.coordinateOrigin,o=n.modelMatrix,s=n.fromCoordinateSystem,u=n.fromCoordinateOrigin;switch(r){case h.LNGLAT_OFFSETS:case h.METER_OFFSETS:var l=W(t,{viewport:i,modelMatrix:o,coordinateSystem:s,coordinateOrigin:u,offsetMode:!0}),c=G(a,i,!0);return U.h(l,l,c),l;case h.LNGLAT:case h.LNGLAT_DEPRECATED:case h.IDENTITY:default:return W(t,{viewport:i,modelMatrix:o,coordinateSystem:s,coordinateOrigin:u,offsetMode:!1})}}var q=function(t){function e(t){var n;return Object(T.a)(this,e),(n=Object(j.a)(this,Object(L.a)(e).call(this,t))).projectedLight=new a.PointLight(t),n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer,n=e.context.viewport,i=e.props,r=i.coordinateSystem,a=i.coordinateOrigin,o=H(this.position,{viewport:n,coordinateSystem:r,coordinateOrigin:a,fromCoordinateSystem:n.isGeospatial?h.LNGLAT:h.IDENTITY,fromCoordinateOrigin:[0,0,0]});return this.projectedLight.color=this.color,this.projectedLight.intensity=this.intensity,this.projectedLight.position=o,this.projectedLight}}]),e}(a.PointLight),Z=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(T.a)(this,t);var i=n.id,r=void 0===i?"pass":i;this.id=r,this.gl=e,this.props={},Object.assign(this.props,n)}return Object(M.a)(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"render",value:function(){}},{key:"cleanup",value:function(){}}]),t}(),X=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(T.a)(this,e),n=Object(j.a)(this,Object(L.a)(e).call(this,t,i));var r=i.module,a=i.fs,o=i.id,s=i.moduleProps;return n.model=n._getModel(t,r,a,o,s),n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"render",value:function(t){var e=this,n=this.gl;Object(a.withParameters)(n,{framebuffer:t.outputBuffer,clearColor:[0,0,0,0]},function(){return e._renderPass(n,t)})}},{key:"delete",value:function(){this.model.delete(),this.model=null}},{key:"_getModel",value:function(t,e,n,i,r){var o=new a.ClipSpace(t,{id:i,fs:n,modules:[e]}),s=Object.assign(e.getUniforms(),e.getUniforms(r));return o.setUniforms(s),o}},{key:"_renderPass",value:function(t,e){var n=e.inputBuffer;e.outputBuffer;Object(a.clear)(t,{color:!0}),this.model.draw({uniforms:{texture:n,texSize:[n.width,n.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(Z),Q=n("HrBr"),Y=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(T.a)(this,e),(n=Object(j.a)(this,Object(L.a)(e).call(this,i))).id="".concat(t.name,"-pass"),Object(Q.a)(t),n.module=t,n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"prepare",value:function(t){this.passes||(this.passes=function(t,e,n,i){if(e.filter||e.sampler){var r=$(e),a=new X(t,{id:n,module:e,fs:r,moduleProps:i});return[a]}return(e.passes||[]).map(function(r,a){var o=$(e,r),s="".concat(n,"-").concat(a);return new X(t,{id:s,module:e,fs:o,moduleProps:i})})}(t,this.module,this.id,this.props))}},{key:"render",value:function(t){for(var e=t.target,n=void 0===e?null:e,i=!1,r=0;r<this.passes.length;r++){var a=i?t.outputBuffer:t.inputBuffer,o=i?t.inputBuffer:t.outputBuffer;n&&r===this.passes.length-1&&(o=n),this.passes[r].render({inputBuffer:a,outputBuffer:o}),i=!i}return{inputBuffer:i?t.outputBuffer:t.inputBuffer,outputBuffer:i?t.inputBuffer:t.outputBuffer}}},{key:"cleanup",value:function(){if(this.passes){var t=!0,e=!1,n=void 0;try{for(var i,r=this.passes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.delete()}}catch(a){e=!0,n=a}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}this.passes=null}}}]),e}(D);var K=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ".concat(t,"(gl_FragColor, texSize, texCoord);\n}\n")},J=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ".concat(t,"(texture, texSize, texCoord);\n}\n")};function $(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;if(e.filter){var n="string"==typeof e.filter?e.filter:"".concat(t.name,"_filterColor");return K(n)}if(e.sampler){var i="string"==typeof e.sampler?e.sampler:"".concat(t.name,"_sampleColor");return J(i)}return null}var tt=n("KQm4"),et=n("kLp3"),nt=n.n(et),it=n("ReuC"),rt=[],at=[];function ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,i=rt,r={index:-1,data:t,target:[]};return t?"function"==typeof t[Symbol.iterator]?i=t:t.length>0&&(at.length=t.length,i=at):i=rt,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function st(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.filter,i=void 0===n?function(){return!0}:n,r=e.map,a=void 0===r?function(t){return t}:r,o=e.result,s=void 0===o?[]:o;return Array.isArray(t)?function t(e,n,i,r){var a=-1;for(;++a<e.length;){var o=e[a];Array.isArray(o)?t(o,n,i,r):n(o)&&r.push(i(o))}return r}(t,i,a,s):i(t)?[a(t)]:[]}function ut(t){for(var e=t.target,n=t.source,i=t.start,r=void 0===i?0:i,a=t.count,o=void 0===a?1:a,s=n.length,u=o*s,l=0,c=r;l<s;l++)e[c++]=n[l];for(;l<u;)l<u-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+u-l),l=u);return e}var lt=[],ct=[[0,1/0]];var ht=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(T.a)(this,t);var i=n.id,r=void 0===i?Object(a.uid)("attribute"):i,o=n.type,s=n.isIndexed,u=void 0!==s&&s;this.gl=e,this.id=r,this.isIndexed=u,this.target=u?34963:34962,this.type=o,u&&!o&&(this.type=e&&Object(a.hasFeature)(e,a.FEATURES.ELEMENT_INDEX_UINT32)?5125:5123),this.value=null,this.externalBuffer=null,this.buffer=null,this.userData={},this.update(n),this._validateAttributeDefinition()}return Object(M.a)(t,[{key:"delete",value:function(){this.buffer&&(this.buffer.delete(),this.buffer=null)}},{key:"update",value:function(t){var e=t.value,n=t.buffer,i=t.constant,r=void 0===i?this.constant||!1:i;if(this.constant=r,n)this.externalBuffer=n,this.constant=!1,this.type=t.type||n.accessor.type,void 0!==n.accessor.divisor&&(this.divisor=n.accessor.divisor),void 0!==t.divisor&&(this.divisor=t.divisor);else if(e){this.externalBuffer=null;var a=this.size||t.size||0;if(r&&e.length!==a){this.value=new Float32Array(a);for(var o=this.offset/4,s=0;s<this.size;++s)this.value[s]=e[o+s]}else this.value=e;!r&&this.gl&&(this.buffer=this.buffer||this._createBuffer(t),this.buffer.setData({data:e}),this.type=this.buffer.accessor.type)}this._setAccessor(t)}},{key:"getBuffer",value:function(){return this.constant?null:this.externalBuffer||this.buffer}},{key:"getValue",value:function(){if(this.constant)return this.value;var t=this.externalBuffer||this.buffer;return t?[t,this]:null}},{key:"_createBuffer",value:function(t){var e=Object.assign({},t,{id:this.id,target:this.target,accessor:{type:this.type}});return Number.isFinite(e.divisor)&&(e.accessor.divisor=e.divisor),delete e.divisor,Number.isFinite(e.size)&&(e.accessor.size=e.size),delete e.size,new a.Buffer(this.gl,e)}},{key:"_setAccessor",value:function(t){var e=t.size,n=void 0===e?this.size:e,i=t.offset,r=void 0===i?this.offset||0:i,o=t.stride,s=void 0===o?this.stride||0:o,u=t.normalized,l=void 0===u?this.normalized||!1:u,c=t.integer,h=void 0===c?this.integer||!1:c,f=t.divisor,p=void 0===f?this.divisor||0:f,A=t.instanced,d=t.isInstanced;this.size=n,this.offset=r,this.stride=s,this.normalized=l,this.integer=h,this.divisor=p,void 0!==d&&(a.log.deprecated("Attribute.isInstanced")(),this.divisor=d?1:0),void 0!==A&&(a.log.deprecated("Attribute.instanced")(),this.divisor=A?1:0)}},{key:"_validateAttributeDefinition",value:function(){}}]),t}(),ft={isExternalBuffer:!1,needsUpdate:!0,needsRedraw:!1,updateRanges:ct,allocedInstances:-1},pt=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(T.a)(this,e),n=Object(j.a)(this,Object(L.a)(e).call(this,t,i));var r=i.transition,a=void 0!==r&&r,o=i.noAlloc,s=void 0!==o&&o,u=i.update,l=void 0===u?null:u,c=i.accessor,h=void 0===c?null:c,f=i.bufferLayout,p=void 0===f?null:f,A=i.defaultValue,d=void 0===A?[0,0,0,0]:A;if(d=Array.isArray(d)?d:[d],n.shaderAttributes={},n.hasShaderAttributes=!1,i.shaderAttributes){var v=i.shaderAttributes;for(var g in v){var m=v[g];n.shaderAttributes[g]=new e(n.gl,Object.assign({},m,{id:g,constant:m.constant||!1,isIndexed:m.isIndexed||m.elements,size:(m.elements?1:m.size)||n.size,value:m.value||null,divisor:m.instanced||m.divisor||n.divisor,buffer:n.getBuffer(),noAlloc:!0})),n.hasShaderAttributes=!0}}return Object.assign(n.userData,ft,i,{transition:a,noAlloc:s,update:l||h&&n._standardAccessor,accessor:h,defaultValue:d,bufferLayout:p}),Object.seal(n.userData),n._validateAttributeUpdaters(),n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"needsUpdate",value:function(){return this.userData.needsUpdate}},{key:"needsRedraw",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).clearChangedFlags,e=void 0!==t&&t,n=this.userData.needsRedraw;return this.userData.needsRedraw=this.userData.needsRedraw&&!e,n}},{key:"getInstanceCount",value:function(){return null!==this.value?this.value.length/this.size:0}},{key:"getUpdateTriggers",value:function(){var t=this.userData.accessor;return[this.id].concat("function"!=typeof t&&t||[])}},{key:"getAccessor",value:function(){return this.userData.accessor}},{key:"getShaderAttributes",value:function(){var t={};return this.hasShaderAttributes?Object.assign(t,this.shaderAttributes):t[this.id]=this,t}},{key:"supportsTransition",value:function(){return this.userData.transition}},{key:"getTransitionSetting",value:function(t){var e=this.userData,n=e.transition,i=e.accessor;if(!n)return null;var r=Array.isArray(i)?t[i.find(function(e){return t[e]})]:t[i];return Number.isFinite(r)&&(r={duration:r}),r&&r.duration>0?Object.assign({},n,r):null}},{key:"setNeedsUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.userData.needsUpdate=this.userData.needsUpdate||t,e){var n=e.startRow,i=void 0===n?0:n,r=e.endRow,a=void 0===r?1/0:r;this.userData.updateRanges=function(t,e){if(t===ct)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;for(var n=[],i=t.length,r=0,a=0;a<i;a++){var o=t[a];o[1]<e[0]?(n.push(o),r=a+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}(this.userData.updateRanges,[i,a])}else this.userData.updateRanges=ct}},{key:"clearNeedsUpdate",value:function(){this.userData.needsUpdate=!1,this.userData.updateRanges=lt}},{key:"setNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.userData.needsRedraw=this.userData.needsRedraw||t}},{key:"allocate",value:function(t){var e=this.userData;if(e.isExternalBuffer||e.noAlloc)return!1;var n=this.getInstanceCount();if((0===n||n<t)&&(e.update||e.accessor)){d(Number.isFinite(t));var i=Math.max(t,1),r=At(this.type||5126),a=this.value;return this.constant=!1,this.value=new r(this.size*i),this.buffer&&this.buffer.byteLength<this.value.byteLength&&this.buffer.reallocate(this.value.byteLength),e.updateRanges!==ct&&(this.value.set(a),this.buffer.subData(a)),this.setNeedsUpdate(!0,{startRow:n}),e.allocedInstances=i,!0}return!1}},{key:"updateBuffer",value:function(t){var e=t.numInstances,n=t.bufferLayout,i=t.data,r=t.props,a=t.context;if(!this.needsUpdate())return!1;var o=this.userData,s=o.update,u=o.updateRanges,l=o.noAlloc,c=!0;if(s){var h=!0,f=!1,p=void 0;try{for(var A,d=u[Symbol.iterator]();!(h=(A=d.next()).done);h=!0){var v=Object(N.a)(A.value,2),g=v[0],m=v[1];s.call(a,this,{data:i,startRow:g,endRow:m,props:r,numInstances:e,bufferLayout:n})}}catch(P){f=!0,p=P}finally{try{h||null==d.return||d.return()}finally{if(f)throw p}}if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength)this.update({value:this.value,constant:this.constant});else{var y=!0,_=!1,b=void 0;try{for(var x,w=u[Symbol.iterator]();!(y=(x=w.next()).done);y=!0){var S=Object(N.a)(x.value,2),k=(g=S[0],m=S[1],Number.isFinite(g)?this._getVertexOffset(g,this.bufferLayout):0),O=Number.isFinite(m)?this._getVertexOffset(m,this.bufferLayout):l||!Number.isFinite(e)?this.value.length:e*this.size;this.buffer.subData({data:this.value.subarray(k,O),offset:k*this.value.BYTES_PER_ELEMENT})}}catch(P){_=!0,b=P}finally{try{y||null==w.return||w.return()}finally{if(_)throw b}}}this._checkAttributeArray()}else c=!1;return this._updateShaderAttributes(),this.clearNeedsUpdate(),o.needsRedraw=!0,c}},{key:"update",value:function(t){Object(it.a)(Object(L.a)(e.prototype),"update",this).call(this,t),this._updateShaderAttributes()}},{key:"setGenericValue",value:function(t){var e=this.userData;if(void 0===t||"function"==typeof t)return e.isExternalBuffer=!1,!1;t=this._normalizeValue(t);var n=!this.constant||!this._areValuesEqual(t,this.value);return n&&this.update({constant:!0,value:t}),e.needsRedraw=e.needsUpdate||n,this.clearNeedsUpdate(),e.isExternalBuffer=!0,this._updateShaderAttributes(),!0}},{key:"setExternalBuffer",value:function(t,e){var n=this.userData;if(t){if(n.isExternalBuffer=!0,this.clearNeedsUpdate(),t instanceof a.Buffer)this.externalBuffer!==t&&(this.update({constant:!1,buffer:t}),n.needsRedraw=!0);else if(this.value!==t){if(!ArrayBuffer.isView(t))throw new Error("Attribute prop must be typed array");if(n.auto&&t.length<=e*this.size)throw new Error("Attribute prop array must match length and size");var i=At(this.type||5126);t instanceof i?this.update({constant:!1,value:t}):(r.warn("Attribute prop ".concat(this.id," is casted to ").concat(i.name))(),this.update({constant:!1,value:new i(t)})),this.value=t,n.needsRedraw=!0}return this._updateShaderAttributes(),!0}return n.isExternalBuffer=!1,!1}},{key:"_getVertexOffset",value:function(t,e){if(e){var n=0,i=0,r=!0,a=!1,o=void 0;try{for(var s,u=e[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value;if(i>=t)break;n+=l*this.size,i++}}catch(c){a=!0,o=c}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return n}return t*this.size}},{key:"_normalizeValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.userData.defaultValue;if(!Array.isArray(t)&&!ArrayBuffer.isView(t))return e[n]=Number.isFinite(t)?t:i[0],e;switch(this.size){case 4:e[n+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[n+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[n+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[n+0]=Number.isFinite(t[0])?t[0]:i[0]}return e}},{key:"_areValuesEqual",value:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.size,i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}},{key:"_standardAccessor",value:function(t,e){var n=e.data,i=e.startRow,r=e.endRow,a=e.props,o=(e.numInstances,e.bufferLayout),s=t.userData.accessor,u=t.value,l=t.size,c="function"==typeof s?s:a[s];d("function"==typeof c,'accessor "'.concat(s,'" is not a function'));var h=t._getVertexOffset(i,o),f=ot(n,i,r),p=f.iterable,A=f.objectInfo,v=!0,g=!1,m=void 0;try{for(var y,_=p[Symbol.iterator]();!(v=(y=_.next()).done);v=!0){var b=y.value;A.index++;var x=c(b,A);if(o){t._normalizeValue(x,A.target);var w=o[A.index];ut({target:t.value,source:A.target,start:h,count:w}),h+=w*l}else t._normalizeValue(x,u,h),h+=l}}catch(S){g=!0,m=S}finally{try{v||null==_.return||_.return()}finally{if(g)throw m}}t.constant=!1,t.bufferLayout=o}},{key:"_validateAttributeUpdaters",value:function(){var t=this.userData;if(!(t.noAlloc||"function"==typeof t.update||"string"==typeof t.accessor))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var t=this.value;if(t&&t.length>=4&&!(Number.isFinite(t[0])&&Number.isFinite(t[1])&&Number.isFinite(t[2])&&Number.isFinite(t[3])))throw new Error("Illegal attribute generated for ".concat(this.id))}},{key:"_updateShaderAttributes",value:function(){var t=this.shaderAttributes;for(var e in t){t[e].update({buffer:this.getBuffer(),value:this.value,constant:this.constant})}}},{key:"bufferLayout",get:function(){return this.userData.bufferLayout},set:function(t){this.userData.bufferLayout=t}}]),e}(ht);function At(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,n=void 0===e||e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce type from array")}}function dt(t){var e=t.source,n=t.target,i=t.start,r=void 0===i?0:i,a=t.end,o=t.getData;a=a||n.length;var s=e.length,u=a-r;if(s>u)n.set(e.subarray(0,u),r);else if(n.set(e,r),o)for(var l=s;l<u;)for(var c=o(l,e),h=0;h<c.length;h++)n[r+l]=c[h],l++}var vt={1:"float",2:"vec2",3:"vec3",4:"vec4"};function gt(t){var e={},n={};for(var i in t){var r=t[i],o=r.fromState,s=r.toState,u=r.buffer;e["".concat(i,"From")]=o instanceof a.Buffer?[o,{divisor:0}]:o,e["".concat(i,"To")]=s,n["".concat(i)]=u}return{sourceBuffers:e,feedbackBuffers:n}}function mt(t){var e=t.fromState,n=t.toState,i=t.fromLength,r=t.toLength,o=t.fromBufferLayout,s=t.toBufferLayout,u=t.getData,l=void 0===u?function(t){return t}:u;if((o&&s||!(i>=r))&&e instanceof a.Buffer){var c=new Float32Array(r),h=e.getData({}),f=n.size,p=n.constant,A=p?n.getValue():n.getBuffer().getData({}),d=p?function(t,e){return l(A,e)}:function(t,e){return l(A.subarray(t,t+f),e)};!function(t){var e=t.source,n=t.target,i=t.size,r=t.getData,a=t.sourceLayout,o=t.targetLayout;if(!Array.isArray(o))return dt({source:e,target:n,getData:r}),n;for(var s=0,u=0,l=r&&function(t,e){return r(t+u,e)},c=Math.min(a.length,o.length),h=0;h<c;h++){var f=a[h]*i,p=o[h]*i;dt({source:e.subarray(s,s+f),target:n,start:u,end:u+p,getData:l}),s+=f,u+=p}u<n.length&&dt({source:[],target:n,start:u,getData:l})}({source:h,target:c,sourceLayout:o,targetLayout:s,size:n.size,getData:d}),e.setData({data:c})}}var yt={NONE:"none",PENDING:"pending",IN_PROGRESS:"in_progress",ENDED:"ended"};function _t(){}var bt=function(){function t(e){Object(T.a)(this,t),this._startTime=null,this._state=yt.NONE,this.duration=1,this.easing=function(t){return t},this.onStart=_t,this.onUpdate=_t,this.onInterrupt=_t,this.onEnd=_t,Object.assign(this,e)}return Object(M.a)(t,[{key:"start",value:function(t){this.inProgress&&this.onInterrupt(this),Object.assign(this,t),this._setState(yt.PENDING)}},{key:"cancel",value:function(){this.inProgress&&(this.onInterrupt(this),this._setState(yt.NONE))}},{key:"update",value:function(t){if(this.state===yt.PENDING&&(this._startTime=t,this._setState(yt.IN_PROGRESS)),this.state===yt.IN_PROGRESS){var e=!1,n=(t-this._startTime)/this.duration;return n>=1&&(n=1,e=!0),this.time=this.easing(n),this.onUpdate(this),e&&this._setState(yt.ENDED),!0}return!1}},{key:"_setState",value:function(t){if(this._state!==t)switch(this._state=t,t){case yt.PENDING:this.onStart(this);break;case yt.ENDED:this.onEnd(this)}}},{key:"state",get:function(){return this._state}},{key:"inProgress",get:function(){return this._state===yt.PENDING||this._state===yt.IN_PROGRESS}}]),t}(),xt=function(){},wt={duration:0,easing:function(t){return t},onStart:xt,onEnd:xt,onInterrupt:xt},St=function(){function t(e,n){var i=n.id;Object(T.a)(this,t),this.id=i,this.gl=e,this.attributeTransitions={},this.needsRedraw=!1,this.transform=null,this.numInstances=0,a.Transform.isSupported(e)?this.isSupported=!0:e&&r.warn("WebGL2 not supported by this browser. Transition animation is disabled.")()}return Object(M.a)(t,[{key:"finalize",value:function(){for(var t in this.transform&&this.transform.delete(),this.attributeTransitions)this._removeTransition(t)}},{key:"update",value:function(t){var e=t.attributes,n=t.transitions,i=void 0===n?{}:n,r=t.numInstances;if(this.opts=i,this.numInstances=r||1,this.isSupported){var a=this.attributeTransitions,o={};for(var s in e){this._updateAttribute(s,e[s])&&(o[s]=a[s])}for(var u in a){var l=e[u];l&&l.supportsTransition()||this._removeTransition(u)}if(this.transform){if(this.transform){var c=gt(o),h=c.sourceBuffers,f=c.feedbackBuffers;this.transform.update({elementCount:this.numInstances,sourceBuffers:h,feedbackBuffers:f})}}else this._createModel()}}},{key:"hasAttribute",value:function(t){return t in this.attributeTransitions}},{key:"getAttributes",value:function(){var t={};for(var e in this.attributeTransitions){var n=this.attributeTransitions[e];n.buffer&&(t[e]=n.attributeInTransition)}return t}},{key:"setCurrentTime",value:function(t){if(!this.transform||0===this.numInstances)return!1;var e={},n=this.needsRedraw;for(var i in this.needsRedraw=!1,this.attributeTransitions){var r=this.attributeTransitions[i];r.update(t)&&(e["".concat(i,"Time")]=r.time,n=!0)}return n&&this.transform.run({uniforms:e}),n}},{key:"_createTransition",value:function(t,e){var n=this.attributeTransitions[t];return n?null:(n=new bt({name:t,attribute:e,attributeInTransition:new pt(this.gl,e),bufferLayout:e.bufferLayout}),this.attributeTransitions[t]=n,this._invalidateModel(),n)}},{key:"_removeTransition",value:function(t){var e=this.attributeTransitions[t];e&&(e.buffer&&e.buffer.delete(),e._swapBuffer&&e._swapBuffer.delete(),delete this.attributeTransitions[t],this._invalidateModel())}},{key:"_updateAttribute",value:function(t,e){var n=e.getTransitionSetting(this.opts);if(n){var i,r=this.attributeTransitions[t];if(r?i=e.needsRedraw():(r=this._createTransition(t,e),i=!0),i)return this._triggerTransition(r,n),!0}return!1}},{key:"_invalidateModel",value:function(){this.transform&&(this.transform.delete(),this.transform=null)}},{key:"_createModel",value:function(){0!==Object.keys(this.attributeTransitions).length&&(this.transform=new a.Transform(this.gl,Object.assign({elementCount:this.numInstances},gt(this.attributeTransitions),function(t){var e=[],n=[],i=[],r=[],a=[];for(var o in t){var s=t[o],u=vt[s.attribute.size];u&&(s.bufferIndex=e.length,e.push(o),n.push("attribute ".concat(u," ").concat(o,"From;")),n.push("attribute ".concat(u," ").concat(o,"To;")),i.push("uniform float ".concat(o,"Time;")),r.push("varying ".concat(u," ").concat(o,";")),a.push("".concat(o," = mix(").concat(o,"From, ").concat(o,"To,\n        ").concat(o,"Time);")))}return{vs:"\n#define SHADER_NAME feedback-vertex-shader\n".concat(n.join("\n"),"\n").concat(i.join("\n"),"\n").concat(r.join("\n"),"\n\nvoid main(void) {\n  ").concat(a.join("\n"),"\n  gl_Position = vec4(0.0);\n}\n"),fs:"#define SHADER_NAME feedback-fragment-shader\n\nprecision highp float;\n\n".concat(r.join("\n"),"\n\nvoid main(void) {\n  gl_FragColor = vec4(0.0);\n}\n"),varyings:e}}(this.attributeTransitions))))}},{key:"_getNextTransitionStates",value:function(t,e){var n,i=t.attribute,r=i.size;n=i.constant?new ht(this.gl,{constant:!0,value:i.value,size:r}):new ht(this.gl,{constant:!1,buffer:i.getBuffer(),divisor:0,size:r,value:i.externalBuffer?null:i.value});var o=t.buffer||n,s=this.numInstances*r,u=o instanceof a.Buffer&&o.getElementCount()||s,l=t._swapBuffer;return t._swapBuffer=t.buffer,l?l.getElementCount()<s&&l.setData({data:new Float32Array(s)}):l=new a.Buffer(this.gl,{data:new Float32Array(s),usage:35050}),t.attributeInTransition.update({buffer:l}),mt({fromState:o,toState:n,fromLength:u,toLength:s,fromBufferLayout:t.bufferLayout,toBufferLayout:i.bufferLayout,getData:e.enter}),t.bufferLayout=i.bufferLayout,{fromState:o,toState:n,buffer:l}}},{key:"_triggerTransition",value:function(t,e){d(e&&e.duration>0),this.needsRedraw=!0;var n=Object.assign({},wt,e);t.start(Object.assign({},this._getNextTransitionStates(t,e),n))}}]),t}();function kt(){}var Ot={savedMessages:null,timeStart:null,onLog:function(t){var e=t.level,n=t.message;r.log(e,n)()},onUpdateStart:function(t){t.level,t.numInstances;Ot.savedMessages=[],Ot.timeStart=new Date},onUpdate:function(t){t.level;var e=t.message;Ot.savedMessages&&Ot.savedMessages.push(e)},onUpdateEnd:function(t){var e=t.level,n=t.id,i=t.numInstances,a=Math.round(new Date-Ot.timeStart),o="".concat(a,"ms");r.group(e,"Updated attributes for ".concat(i," instances in ").concat(n," in ").concat(o),{collapsed:!0})();var s=!0,u=!1,l=void 0;try{for(var c,h=Ot.savedMessages[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var f=c.value;r.log(e,f)()}}catch(p){u=!0,l=p}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}r.groupEnd(e,"Updated attributes for ".concat(i," instances in ").concat(n," in ").concat(o))(),Ot.savedMessages=null}},Pt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.id,r=void 0===i?"attribute-manager":i,a=n.stats;Object(T.a)(this,t),this.id=r,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new St(e,{id:"".concat(r,"-transitions")}),Object.seal(this)}return Object(M.a)(t,null,[{key:"setDefaultLogFunctions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.onLog,n=t.onUpdateStart,i=t.onUpdate,r=t.onUpdateEnd;void 0!==e&&(Ot.onLog=e||kt),void 0!==n&&(Ot.onUpdateStart=n||kt),void 0!==i&&(Ot.onUpdate=i||kt),void 0!==r&&(Ot.onUpdateEnd=r||kt)}}]),Object(M.a)(t,[{key:"finalize",value:function(){for(var t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}},{key:"setNeedsRedraw",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.needsRedraw=!0,this}},{key:"add",value:function(t,e){this._add(t,e)}},{key:"addInstanced",value:function(t,e){this._add(t,e,{instanced:1})}},{key:"remove",value:function(t){for(var e=0;e<t.length;e++){var n=t[e];void 0!==this.attributes[n]&&(this.attributes[n].delete(),delete this.attributes[n])}}},{key:"invalidate",value:function(t,e){var n=this._invalidateTrigger(t,e);Ot.onLog({level:3,message:"invalidated attributes ".concat(n," (").concat(t,") for ").concat(this.id)})}},{key:"invalidateAll",value:function(t){for(var e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);Ot.onLog({level:3,message:"invalidated all attributes for ".concat(this.id)})}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.numInstances,i=t.bufferLayout,r=t.transitions,a=t.props,o=void 0===a?{}:a,s=t.buffers,u=void 0===s?{}:s,l=t.context,c=void 0===l?{}:l,h=!1;for(var f in Ot.onUpdateStart({level:2,id:this.id,numInstances:n}),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){var p=this.attributes[f];p.setExternalBuffer(u[f],this.numInstances)||p.setGenericValue(o[p.getAccessor()])||p.needsUpdate()&&(h=!0,this._updateAttribute({attribute:p,numInstances:n,bufferLayout:i,data:e,props:o,context:c})),this.needsRedraw|=p.needsRedraw()}h&&Ot.onUpdateEnd({level:2,id:this.id,numInstances:n}),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}},{key:"updateTransition",value:function(t){var e=this.attributeTransitionManager.setCurrentTime(t);return this.needsRedraw=this.needsRedraw||e,e}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getChangedAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1},e=this.attributes,n=this.attributeTransitionManager,i=Object.assign({},n.getAttributes());for(var r in e){var a=e[r];a.needsRedraw(t)&&!n.hasAttribute(r)&&(i[r]=a)}return i}},{key:"getAccessors",value:function(){return this.updateTriggers}},{key:"_add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e&&r.warn("AttributeManager.add({updaters}) - updater map no longer supported")();var i={};for(var a in t){var o=t[a],s=this._createAttribute(a,o,n);i[a]=s}Object.assign(this.attributes,i),this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(t,e,n){var i={id:t,constant:e.constant||!1,isIndexed:e.isIndexed||e.elements,size:e.elements?1:e.size,value:e.value||null,divisor:e.instanced||n.instanced?1:e.divisor};return new pt(this.gl,Object.assign({},e,i))}},{key:"_mapUpdateTriggersToAttributes",value:function(){var t=this,e={},n=function(n){t.attributes[n].getUpdateTriggers().forEach(function(t){e[t]||(e[t]=[]),e[t].push(n)})};for(var i in this.attributes)n(i);this.updateTriggers=e}},{key:"_invalidateTrigger",value:function(t,e){var n=this.attributes,i=this.updateTriggers[t];if(i)i.forEach(function(t){var i=n[t];i&&i.setNeedsUpdate(i.id,e)});else{var a="invalidating non-existent trigger ".concat(t," for ").concat(this.id,"\n");a+="Valid triggers: ".concat(Object.keys(n).join(", ")),r.warn(a,i)()}return i}},{key:"_updateAttribute",value:function(t){var e=t.attribute,n=t.numInstances;e.allocate(n)&&Ot.onUpdate({level:3,message:"".concat(e.id," allocated ").concat(n),id:this.id});var i=Date.now();if(e.updateBuffer(t)){this.needsRedraw=!0;var r=Math.round(Date.now()-i);Ot.onUpdate({level:3,message:"".concat(e.id," updated ").concat(n," in ").concat(r,"ms")})}}}]),t}(),Et=new Map,Ct=function(t){if(nt.a.isReady()&&t.id){var e=Et.get(t.id);e&&e.forEach(function(e,n){!function t(e,n,i){e&&(n.length>1?t(e[n[0]],n.slice(1),i):e[n[0]]=i)}(t,n,e),"data"===n[0]&&(t.data=Object(tt.a)(t.data))})}},Tt=function(t){nt.a.isReady()&&nt.a.listenFor("deck.gl",t)},Mt=function(t){nt.a.isReady()&&nt.a.listenFor("init",t)},jt=function(t){if(nt.a.isReady()&&t){var e=[t.constructor.layerName];nt.a.listItem("deck.gl",t.id,{badges:e,links:t.state&&t.state.model?["luma.gl:".concat(t.state.model.id)]:void 0,parent:t.parent?t.parent.id:void 0})}},Lt=function(t){if(nt.a.isReady()&&!nt.a.throttle("deck.gl:".concat(t.id),1e3)){var e=function(t){var e=[{path:"objects.props",data:t.props}],n=[t.constructor.layerName];if(t.state){if(t.getAttributeManager()){var i=t.getAttributeManager().getAttributes();e.push({path:"objects.attributes",data:i})}if(t.state.model){t.state.model.setProps({timerQueryEnabled:!0});var r=t.state.model.stats.lastFrameTime;r&&n.push("".concat((1e3*r).toFixed(0),"s"))}}return e.push({path:"badges",data:n}),e}(t);nt.a.multiUpdate("deck.gl",t.id,e)}};var It=n("U8pU");function zt(t,e){var n=Dt({newProps:t,oldProps:e,propTypes:Rt(t),ignoreProps:{data:null,updateTriggers:null}}),i=function(t,e){if(null===e)return"oldProps is null, initial diff";var n=t.dataComparator;if(n){if(!n(t.data,e.data))return"Data comparator detected a change"}else if(t.data!==e.data)return"A new data container was supplied";return null}(t,e),r=!1;return i||(r=function(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers){var n=Bt(t,e,"all");if(n)return{all:!0}}var i={},r=!1;for(var a in t.updateTriggers)if("all"!==a){var o=Bt(t,e,a);o&&(i[a]=!0,r=i)}return r}(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r}}function Dt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.newProps,n=t.oldProps,i=t.ignoreProps,r=void 0===i?{}:i,a=t.propTypes,o=void 0===a?{}:a,s=t.triggerName,u=void 0===s?"props":s;if(d(void 0!==n&&void 0!==e,"compareProps args"),n===e)return null;if("object"!==Object(It.a)(e)||null===e)return"".concat(u," changed shallowly");if("object"!==Object(It.a)(n)||null===n)return"".concat(u," changed shallowly");for(var l in n)if(!(l in r)){if(!(l in e))return"".concat(u,".").concat(l," dropped");var c=e[l],h=n[l],f=o[l],p=f&&f.equal;if(p&&!p(c,h,f))return"".concat(u,".").concat(l," changed deeply");if(!p&&(p=c&&h&&c.equals)&&!p.call(c,h))return"".concat(u,".").concat(l," changed deeply");if(!p&&h!==c)return"".concat(u,".").concat(l," changed shallowly")}for(var A in e)if(!(A in r||A in n))return"".concat(u,".").concat(A," added: undefined -> ").concat(e[A]);return null}function Bt(t,e,n){var i=t.updateTriggers[n];i=null==i?{}:i;var r=e.updateTriggers[n];return Dt({oldProps:r=null==r?{}:r,newProps:i,triggerName:n})}function Rt(t){var e=t._component,n=e&&e.constructor;return n?n._propTypes:{}}var Ft="count(): argument not an object",Nt="count(): argument not a container";function Ut(t){if(null===(e=t)||"object"!==Object(It.a)(e))throw new Error(Ft);var e;if("function"==typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===Object(It.a)(t)&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error(Nt)}var Vt={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Gt={boolean:{validate:function(t,e){return!0},equal:function(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate:function(t,e){return Zt(t)&&(3===t.length||4===t.length)},equal:function(t,e,n){return Wt(t,e)}},accessor:{validate:function(t,e){var n=Xt(t);return"function"===n||n===Xt(e.value)},equal:function(t,e,n){return"function"==typeof e||Wt(t,e)}},array:{validate:function(t,e){return e.optional&&!t||Zt(t)},equal:function(t,e,n){return n.compare?Wt(t,e):t===e}},function:{validate:function(t,e){return e.optional&&!t||"function"==typeof t},equal:function(t,e,n){return!n.compare||t===e}}};function Wt(t,e){if(t===e)return!0;if(!Zt(t)||!Zt(e))return!1;var n=t.length;if(n!==e.length)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Ht(t,e){switch(Xt(e)){case"object":return qt(t,e);case"array":return qt(t,{type:"array",value:e,compare:!1});case"boolean":return qt(t,{type:"boolean",value:e});case"number":return qt(t,{type:"number",value:e});case"function":return qt(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function qt(t,e){return"type"in e?Object.assign({name:t},Gt[e.type],e):"value"in e?Object.assign({name:t,type:Xt(e.value)},e):{name:t,type:"object",value:e}}function Zt(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Xt(t){return Zt(t)?"array":null===t?"null":Object(It.a)(t)}function Qt(t,e,n){if(e)for(var i in n)if(Jt(e,i)){var a="".concat(t||"Layer",": ").concat(i),o=!0,s=!1,u=void 0;try{for(var l,c=n[i][Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;Jt(e,h)||(e[h]=e[i])}}catch(f){s=!0,u=f}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}r.deprecated(a,n[i].join("/"))()}}function Yt(t){var e=$t(t,"_mergedDefaultProps");return e?{defaultProps:e,propTypes:$t(t,"_propTypes"),deprecatedProps:$t(t,"_deprecatedProps")}:function(t){var e=t.prototype;if(!e)return{defaultProps:{}};var n=Object.getPrototypeOf(t),i=e&&Yt(n)||null,a=function(t){for(var e={},n={},i={},r=Object.entries(t),a=0;a<r.length;a++){var o=Object(N.a)(r[a],2),s=o[0],u=o[1];if(u&&u.deprecatedFor)i[s]=Array.isArray(u.deprecatedFor)?u.deprecatedFor:[u.deprecatedFor];else{var l=Ht(s,u);e[s]=l,n[s]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}($t(t,"defaultProps")||{}),o=Object.assign({},i&&i.propTypes,a.propTypes),s=function(t,e,n,i){var a=Object.create(null);Object.assign(a,e,t);var o=function(t){var e=$t(t,"layerName")||$t(t,"componentName");e||r.once(0,"".concat(t.name,".componentName not specified"))();return e||t.name}(i);return delete t.id,Object.defineProperties(a,{id:{configurable:!1,writable:!0,value:o}}),function(t,e){var n={},i={_asyncPropDefaultValues:{enumerable:!1,value:n},_asyncPropOriginalValues:{enumerable:!1,value:{}}};for(var r in e){var a=e[r],o=a.name,s=a.value;a.async&&(n[o]=s,i[o]=Kt(o))}Object.defineProperties(t,i)}(a,n),a}(a.defaultProps,i&&i.defaultProps,o,t),u=Object.assign({},i&&i.deprecatedProps,a.deprecatedProps);return t._mergedDefaultProps=s,t._propTypes=o,t._deprecatedProps=u,{propTypes:o,defaultProps:s,deprecatedProps:u}}(t)}function Kt(t){return{configurable:!1,enumerable:!0,set:function(e){"string"==typeof e||e instanceof Promise?this._asyncPropOriginalValues[t]=e:this._asyncPropResolvedValues[t]=e},get:function(){if(this._asyncPropResolvedValues){if(t in this._asyncPropResolvedValues){var e=this._asyncPropResolvedValues[t];return"data"===t?e||this._asyncPropDefaultValues[t]:e}if(t in this._asyncPropOriginalValues){var n=this._component&&this._component.internalState;if(n&&n.hasAsyncProp(t))return n.getAsyncProp(t)}}return this._asyncPropDefaultValues[t]}}}function Jt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function $t(t,e){return Jt(t,e)&&t[e]}var te=Object.freeze({}),ee=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(T.a)(this,t),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=te,this.oldAsyncProps=null}return Object(M.a)(t,[{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component.props}},{key:"freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps)for(var t in this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps={},this.oldProps)this.oldAsyncProps[t]=this.oldProps[t]}},{key:"hasAsyncProp",value:function(t){return t in this.asyncProps}},{key:"getAsyncProp",value:function(t){var e=this.asyncProps[t];return e&&e.resolvedValue}},{key:"isAsyncPropLoading",value:function(t){var e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}},{key:"setAsyncProps",value:function(t){var e=t._asyncPropResolvedValues||{},n=t._asyncPropOriginalValues||t,i=t._asyncPropDefaultValues||{};for(var r in e){var a=e[r];this._createAsyncPropData(r,a,i[r]),this._updateAsyncProp(r,a)}for(var o in n){var s=n[o];this._createAsyncPropData(o,s,i[o]),this._updateAsyncProp(o,s)}}},{key:"_updateAsyncProp",value:function(t,e){if(this._didAsyncInputValueChange(t,e)){if("string"==typeof e)e=(0,this.layer.props.fetch)(e,{propName:t,layer:this.layer});e instanceof Promise?this._watchPromise(t,e):this._setPropValue(t,e)}}},{key:"_didAsyncInputValueChange",value:function(t,e){var n=this.asyncProps[t];return e!==n.lastValue&&(n.lastValue=e,!0)}},{key:"_setPropValue",value:function(t,e){var n=this.asyncProps[t];n.value=e,n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount}},{key:"_setAsyncPropValue",value:function(t,e,n){var i=this.asyncProps[t];i&&n>=i.resolvedLoadCount&&(d(void 0!==e),this.freezeAsyncOldProps(),e=this._postProcessValue(t,e),i.resolvedValue=e,i.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}},{key:"_watchPromise",value:function(t,e){var n=this,i=this.asyncProps[t];i.pendingLoadCount++;var a=i.pendingLoadCount;e.then(function(e){return n._setAsyncPropValue(t,e,a)}).catch(function(t){return r.error(t)()})}},{key:"_postProcessValue",value:function(t,e){var n=(this.component?this.component.props:{}).dataTransform;return"data"===t&&n&&(e=n(e)),e}},{key:"_createAsyncPropData",value:function(t,e,n){this.asyncProps[t]||(this.asyncProps[t]={lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0})}}]),t}(),ne=0,ie=function(){function t(){Object(T.a)(this,t),this.props=function(){for(var t=Yt(this.constructor),e=t.defaultProps,n=Object.create(e,{_component:{enumerable:!1,value:this},_asyncPropOriginalValues:{enumerable:!1,value:{}},_asyncPropResolvedValues:{enumerable:!1,value:{}}}),i=0;i<arguments.length;++i)Object.assign(n,arguments[i]);var r=this.constructor.layerName,a=t.deprecatedProps;return Qt(r,n,a),Qt(r,n.updateTriggers,a),Qt(r,n.transitions,a),Ct(n),Object.freeze(n),n}.apply(this,arguments),this.id=this.props.id,this.count=ne++,this.lifecycle=Vt.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}return Object(M.a)(t,[{key:"clone",value:function(t){var e=this.props,n={};for(var i in e._asyncPropDefaultValues)i in e._asyncPropResolvedValues?n[i]=e._asyncPropResolvedValues[i]:i in e._asyncPropOriginalValues&&(n[i]=e._asyncPropOriginalValues[i]);return new this.constructor(Object.assign({},e,n,t))}},{key:"_initState",value:function(){this.internalState=new ee({})}},{key:"stats",get:function(){return this.internalState.stats}}]),t}();ie.componentName="Component",ie.defaultProps={};var re=function(t){function e(t){var n,i=t.attributeManager,r=t.layer;return Object(T.a)(this,e),(n=Object(j.a)(this,Object(L.a)(e).call(this,r))).attributeManager=i,n.model=null,n.needsRedraw=!0,n.subLayers=null,n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"layer",get:function(){return this.component},set:function(t){this.component=t}}]),e}(ee),ae=Object.freeze([]),oe=new Uint8ClampedArray(0),se={data:{type:"data",value:ae,async:!0},dataComparator:null,dataTransform:{type:"function",value:function(t){return t},compare:!1},fetch:{type:"function",value:function(t){return fetch(t).then(function(t){return t.json()})},compare:!1},updateTriggers:{},numInstances:void 0,visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:.8},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:h.LNGLAT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,parameters:{},uniforms:{},framebuffer:null,animation:null,getPolygonOffset:{type:"function",value:function(t){return[0,100*-t.layerIndex]},compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"color",value:[0,0,128,128]}},ue=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"toString",value:function(){var t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}},{key:"setState",value:function(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.internalState&&(this.internalState.needsRedraw=t)}},{key:"setLayerNeedsUpdate",value:function(){this.context.layerManager.setNeedsUpdate(String(this))}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this.shouldUpdateState(this._getUpdateParams())}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}},{key:"getSingleModel",value:function(){return this.state&&this.state.model}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getFirstObject",value:function(){var t=this.props.data,e=!0,n=!1,i=void 0;try{for(var r,a=t[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){return r.value}}catch(o){n=!0,i=o}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}return null}},{key:"project",value:function(t){var e=this.context.viewport,n=W(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),i=Object(V.k)(n,e.pixelProjectionMatrix),r=Object(N.a)(i,3),a=r[0],o=r[1],s=r[2];return 2===t.length?[a,o]:[a,o,s]}},{key:"unproject",value:function(t){var e=this.context.viewport;return d(Array.isArray(t)),e.unproject(t)}},{key:"projectPosition",value:function(t){return d(Array.isArray(t)),H(t,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}},{key:"projectFlat",value:function(t){r.deprecated("layer.projectFlat","layer.projectPosition")();var e=this.context.viewport;return d(Array.isArray(t)),e.projectFlat(t)}},{key:"unprojectFlat",value:function(t){r.deprecated("layer.unprojectFlat")();var e=this.context.viewport;return d(Array.isArray(t)),e.unprojectFlat(t)}},{key:"use64bitProjection",value:function(){if(this.props.fp64){if(this.props.coordinateSystem===h.LNGLAT_DEPRECATED)return!0;r.once(0,"Legacy 64-bit mode only works with coordinateSystem set to\n        COORDINATE_SYSTEM.LNGLAT_DEPRECATED. Rendering in 32-bit mode instead")()}return!1}},{key:"use64bitPositions",value:function(){return this.props.fp64||this.props.coordinateSystem===h.LNGLAT||this.props.coordinateSystem===h.IDENTITY}},{key:"screenToDevicePixels",value:function(t){return r.deprecated("screenToDevicePixels","DeckGL prop useDevicePixels for conversion")(),t*("undefined"!=typeof window?window.devicePixelRatio:1)}},{key:"onHover",value:function(t,e){return!!this.props.onHover&&this.props.onHover(t,e)}},{key:"onClick",value:function(t,e){return!!this.props.onClick&&this.props.onClick(t,e)}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return d(t<16777215,"index out of picking color range"),e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}},{key:"decodePickingColor",value:function(t){d(t instanceof Uint8Array);var e=Object(N.a)(t,3);return e[0]+256*e[1]+65536*e[2]-1}},{key:"initializeState",value:function(){throw new Error("Layer ".concat(this," has not defined initializeState"))}},{key:"shouldUpdateState",value:function(t){t.oldProps,t.props,t.context;return t.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(t){t.oldProps,t.props,t.context;var e=t.changeFlags,n=this.getAttributeManager();e.dataChanged&&n&&n.invalidateAll()}},{key:"finalizeState",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.getModels()[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.delete()}}catch(o){e=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}var a=this.getAttributeManager();a&&a.finalize()}},{key:"draw",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.draw(t)}}catch(o){n=!0,i=o}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"getPickingInfo",value:function(t){var e=t.info,n=(t.mode,e.index);return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}},{key:"invalidateAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.getAttributeManager();n&&("all"===t?(r.log(1,"updateTriggers invalidating all attributes: ".concat(e))(),n.invalidateAll()):(r.log(1,"updateTriggers invalidating attribute ".concat(t,": ").concat(e))(),n.invalidate(t)))}},{key:"updateAttributes",value:function(t){var e=this.getAttributeManager();if(e){var n=this.getNumInstances(t),i=this.getBufferLayout(t);e.update({data:t.data,numInstances:n,bufferLayout:i,props:t,transitions:t.transitions,buffers:t,context:this,ignoreUnknownAttributes:!0});var r=this.getModels();if(r.length>0)for(var a=e.getChangedAttributes({clearChangedFlags:!0}),o=0,s=r.length;o<s;++o)this._setModelAttributes(r[o],a)}}},{key:"updateTransition",value:function(){var t=this.getAttributeManager();t&&t.updateTransition(this.context.time)}},{key:"calculateInstancePickingColors",value:function(t,e){var n=e.numInstances,i=t.value,r=t.size;if(1!==i[0]){var a=oe.length/r;if(a<n){var o=new Uint8ClampedArray(n*r);o.set(oe);for(var s=[],u=a;u<n;u++)this.encodePickingColor(u,s),o[u*r+0]=s[0],o[u*r+1]=s[1],o[u*r+2]=s[2];oe=o}i.set(n<a?oe.subarray(0,n*r):oe)}}},{key:"_setModelAttributes",value:function(t,e){var n={},i=t.userData.excludeAttributes||{};for(var r in e)i[r]||Object.assign(n,e[r].getShaderAttributes());t.setAttributes(n)}},{key:"_clearInstancePickingColor",value:function(t){var e=this.getAttributeManager().attributes.instancePickingColors,n=e.value,i=e.size,r=this.decodePickingColor(t);n[r*i+0]=0,n[r*i+1]=0,n[r*i+2]=0,e.update({value:n})}},{key:"_clearPickingColor",value:function(t){for(var e=this.getAttributeManager().attributes.pickingColors,n=e.value,i=0;i<n.length;i+=3)n[i+0]===t[0]&&n[i+1]===t[1]&&n[i+2]===t[2]&&(n[i+0]=0,n[i+1]=0,n[i+2]=0);e.update({value:n})}},{key:"clearPickingColor",value:function(t){this.getAttributeManager().attributes.pickingColors?this._clearPickingColor(t):this._clearInstancePickingColor(t)}},{key:"copyPickingColors",value:function(){var t=this.getAttributeManager().attributes,e=t.pickingColors,n=t.instancePickingColors;return new Uint8ClampedArray((e||n).value)}},{key:"restorePickingColors",value:function(t){var e=this.getAttributeManager().attributes,n=e.pickingColors,i=e.instancePickingColors;(n||i).update({value:t})}},{key:"getNumInstances",value:function(t){return void 0!==(t=t||this.props).numInstances?t.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:Ut(this.props.data)}},{key:"getBufferLayout",value:function(t){return void 0!==(t=t||this.props).bufferLayout?t.bufferLayout:this.state&&void 0!==this.state.bufferLayout?this.state.bufferLayout:null}},{key:"_initialize",value:function(){this._initState(),this.initializeState(this.context),this.state.attributeManager=this.getAttributeManager(),this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0}),this._updateState();var t=this.getSingleModel();t&&(t.id=this.props.id,t.program.id="".concat(this.props.id,"-program"))}},{key:"_update",value:function(){this.needsUpdate()&&this._updateState()}},{key:"_updateState",value:function(){var t=this._getUpdateParams();if(this.context.gl)this.updateState(t);else try{this.updateState(t)}catch(e){}this.isComposite?this._renderLayers(t):(this.setNeedsRedraw(),this.updateAttributes(this.props),this._updateBaseUniforms(),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances())),this.clearChangeFlags(),this.internalState.resetOldProps()}},{key:"_finalize",value:function(){var t;d(this.internalState&&this.state),this.finalizeState(this.context),t=this.id,nt.a.isReady()&&t&&nt.a.deleteItem("deck.gl",t)}},{key:"drawLayer",value:function(t){var e=this,n=t.moduleParameters,i=void 0===n?null:n,r=t.uniforms,o=void 0===r?{}:r,s=t.parameters,u=void 0===s?{}:s;o.picking_uActive||this.updateTransition(),i&&this.setModuleParameters(i);var l=this.context.animationProps;if(l){var c=!0,h=!1,f=void 0;try{for(var p,A=this.getModels()[Symbol.iterator]();!(c=(p=A.next()).done);c=!0){p.value._setAnimationProps(l)}}catch(g){h=!0,f=g}finally{try{c||null==A.return||A.return()}finally{if(h)throw f}}}var d=this.props.getPolygonOffset,v=d&&d(o)||[0,0];u.polygonOffset=v,Object(a.withParameters)(this.context.gl,u,function(){e.draw({moduleParameters:i,uniforms:o,parameters:u,context:e.context})})}},{key:"pickLayer",value:function(t){return this.getPickingInfo(t)}},{key:"getChangeFlags",value:function(){return this.internalState.changeFlags}},{key:"setChangeFlags",value:function(t){var e=this;this.internalState.changeFlags=this.internalState.changeFlags||{};var n=this.internalState.changeFlags;t.dataChanged&&!n.dataChanged&&(n.dataChanged=t.dataChanged,r.log(2,function(){return"dataChanged: ".concat(t.dataChanged," in ").concat(e.id)})()),t.updateTriggersChanged&&!n.updateTriggersChanged&&(n.updateTriggersChanged=n.updateTriggersChanged&&t.updateTriggersChanged?Object.assign({},t.updateTriggersChanged,n.updateTriggersChanged):t.updateTriggersChanged||n.updateTriggersChanged,r.log(2,function(){return"updateTriggersChanged: "+"".concat(Object.keys(t.updateTriggersChanged).join(", ")," in ").concat(e.id)})()),t.propsChanged&&!n.propsChanged&&(n.propsChanged=t.propsChanged,r.log(2,function(){return"propsChanged: ".concat(t.propsChanged," in ").concat(e.id)})()),t.viewportChanged&&!n.viewportChanged&&(n.viewportChanged=t.viewportChanged,r.log(3,function(){return"viewportChanged: ".concat(t.viewportChanged," in ").concat(e.id)})()),t.stateChanged&&!n.stateChanged&&(n.stateChanged=t.stateChanged,r.log(2,function(){return"stateChanged: ".concat(t.stateChanged," in ").concat(e.id)})());var i=t.dataChanged||t.updateTriggersChanged||t.propsChanged;n.propsOrDataChanged=n.propsOrDataChanged||i,n.somethingChanged=n.somethingChanged||i||t.viewportChanged||t.stateChanged}},{key:"clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"printChangeFlags",value:function(){var t=this.internalState.changeFlags;return"".concat(t.dataChanged?"data ":"").concat(t.propsChanged?"props ":"").concat(t.updateTriggersChanged?"triggers ":"").concat(t.viewportChanged?"viewport":"")}},{key:"diffProps",value:function(t,e){var n=zt(t,e);if(n.updateTriggersChanged)for(var i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this._activeUpdateTrigger(i);return this.setChangeFlags(n)}},{key:"validateProps",value:function(){!function(t){var e=Rt(t);for(var n in e){var i=e[n],r=i.validate;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}(this.props)}},{key:"setModuleParameters",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.updateModuleSettings(t)}}catch(o){n=!0,i=o}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(t){if(!this.internalState)return!1;var e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;var n=this.getAttributeManager(),i=n&&n.getNeedsRedraw(t);return e=e||i}},{key:"_getAttributeManager",value:function(){return new Pt(this.context.gl,{id:this.props.id,stats:this.context.stats})}},{key:"_initState",value:function(){d(!this.internalState&&!this.state);var t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,update:this.calculateInstancePickingColors}}),this.internalState=new re({attributeManager:t,layer:this}),this.state={},this.state.attributeManager=t,this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}},{key:"_transferState",value:function(t){var e=t.state,n=t.internalState;if(d(e&&n),this!==t){this.internalState=n,this.internalState.component=this,this.state=e,e.layer=this,this.internalState.setAsyncProps(this.props);var i=!0,r=!1,a=void 0;try{for(var o,s=this.getModels()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.userData.layer=this}}catch(u){r=!0,a=u}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}this.diffProps(this.props,this.internalState.getOldProps())}}},{key:"_onAsyncPropUpdated",value:function(){this.diffProps(this.props,this.internalState.getOldProps()),this.setLayerNeedsUpdate()}},{key:"_activeUpdateTrigger",value:function(t){this.invalidateAttribute(t)}},{key:"_updateBaseUniforms",value:function(){var t=this,e={opacity:"function"==typeof this.props.opacity?function(e){return Math.pow(t.props.opacity(e),1/2.2)}:Math.pow(this.props.opacity,1/2.2)},n=!0,i=!1,r=void 0;try{for(var a,o=this.getModels()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){a.value.setUniforms(e)}}catch(s){i=!0,r=s}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}},{key:"setUniforms",value:function(t){var e=!0,n=!1,i=void 0;try{for(var a,o=this.getModels()[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.setUniforms(t)}}catch(s){n=!0,i=s}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}this.setNeedsRedraw(),r.deprecated("layer.setUniforms","model.setUniforms")()}},{key:"is64bitEnabled",value:function(){return r.deprecated("is64bitEnabled","use64bitProjection")(),this.use64bitProjection()}}]),e}(ie);ue.layerName="Layer",ue.defaultProps=se;var le=n("JOTL");var ce=n("qjXE"),he=n("zGma"),fe=n("dByZ"),pe=Math.PI/180,Ae=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],de=[0,0,0],ve=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(T.a)(this,t);var n=e.id,i=void 0===n?null:n,r=e.x,a=void 0===r?0:r,o=e.y,s=void 0===o?0:o,u=e.width,l=void 0===u?1:u,c=e.height,h=void 0===c?1:c;this.id=i||this.constructor.displayName||"viewport",this.x=a,this.y=s,this.width=l||1,this.height=h||1,this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this),this.getMatrices=this.getMatrices.bind(this)}return Object(M.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Object(ce.e)(e.projectionMatrix,this.projectionMatrix)&&Object(ce.e)(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,n=void 0===e||e,i=this.projectPosition(t),r=Object(V.k)(i,this.pixelProjectionMatrix),a=Object(N.a)(r,2),o=a[0],s=a[1],u=n?s:this.height-s;return 2===t.length?[o,u]:[o,u,r[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,i=void 0===n||n,r=e.targetZ,a=Object(N.a)(t,3),o=a[0],s=a[1],u=a[2],l=i?s:this.height-s,c=r&&r*this.distanceScales.pixelsPerMeter[2],h=Object(V.h)([o,l,u],this.pixelUnprojectionMatrix,c),f=this.unprojectPosition(h),p=Object(N.a)(f,3),A=p[0],d=p[1],v=p[2];return Number.isFinite(u)?[A,d,v]:Number.isFinite(r)?[A,d,r]:[A,d]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=Object(N.a)(e,2);return[n[0],n[1],(t[2]||0)*this.distanceScales.pixelsPerMeter[2]]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=Object(N.a)(e,2);return[n[0],n[1],(t[2]||0)*this.distanceScales.metersPerPixel[2]]}},{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return Object(V.g)(t,e);var n=this.distanceScales.pixelsPerMeter;return[t[0]*n[0],t[1]*n[1]]}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return Object(V.j)(t,e);var n=this.distanceScales.metersPerPixel;return[t[0]*n[0],t[1]*n[1]]}},{key:"getDistanceScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?Object(V.b)({longitude:t[0],latitude:t[1],scale:this.scale,highPrecision:!0}):this.distanceScales}},{key:"getMatrices",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).modelMatrix,e=void 0===t?null:t,n=this.viewProjectionMatrix,i=this.pixelProjectionMatrix,r=this.pixelUnprojectionMatrix;return e&&(n=l.g([],this.viewProjectionMatrix,e),i=l.g([],this.pixelProjectionMatrix,e),r=l.e([],i)),Object.assign({modelViewProjectionMatrix:n,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix,pixelProjectionMatrix:i,pixelUnprojectionMatrix:r,width:this.width,height:this.height,scale:this.scale})}},{key:"containsPixel",value:function(t){var e=t.x,n=t.y,i=t.width,r=void 0===i?1:i,a=t.height,o=void 0===a?1:a;return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+o}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"getCameraDirection",value:function(){return this.cameraDirection}},{key:"getCameraUp",value:function(){return this.cameraUp}},{key:"_addMetersToLngLat",value:function(t,e){var n=Object(N.a)(t,3),i=n[0],r=n[1],a=n[2],o=void 0===a?0:a,s=this._metersToLngLatDelta(e),u=Object(N.a)(s,3),l=u[0],c=u[1],h=u[2],f=void 0===h?0:h;return 2===t.length?[i+l,r+c]:[i+l,r+c,o+f]}},{key:"_metersToLngLatDelta",value:function(t){var e=Object(N.a)(t,3),n=e[0],i=e[1],r=e[2],a=void 0===r?0:r;d(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a),"Illegal argument to Viewport");var o=this.distanceScales,s=o.pixelsPerMeter,u=o.degreesPerPixel,l=n*s[0]*u[0],c=i*s[1]*u[1];return 2===t.length?[l,c]:[l,c,a]}},{key:"_createProjectionMatrix",value:function(t){var e=t.orthographic,n=t.fovyRadians,i=t.aspect,r=t.focalDistance,a=t.near,o=t.far;return d(Number.isFinite(n)),e?(new he.a).orthographic({fovy:n,aspect:i,focalDistance:r,near:a,far:o}):(new he.a).perspective({fovy:n,aspect:i,near:a,far:o})}},{key:"_initViewMatrix",value:function(t){var e=t.viewMatrix,n=void 0===e?Ae:e,i=t.longitude,r=void 0===i?null:i,a=t.latitude,o=void 0===a?null:a,s=t.zoom,u=void 0===s?null:s,c=t.position,h=void 0===c?null:c,f=t.modelMatrix,p=void 0===f?null:f,A=t.focalDistance,d=void 0===A?1:A,v=t.distanceScales,g=void 0===v?null:v;this.isGeospatial=Number.isFinite(o)&&Number.isFinite(r),this.zoom=u,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?Object(V.c)({latitude:o})+Math.log2(d):0);var m=Math.pow(2,this.zoom);this.scale=m,this.distanceScales=this.isGeospatial?Object(V.b)({latitude:o,longitude:r,scale:this.scale}):g||{pixelsPerMeter:[m,m,m],metersPerPixel:[1/m,1/m,1/m]},this.focalDistance=d,this.distanceScales.metersPerPixel=new fe.a(this.distanceScales.metersPerPixel),this.distanceScales.pixelsPerMeter=new fe.a(this.distanceScales.pixelsPerMeter),this.position=de,this.meterOffset=de,h&&(this.position=h,this.modelMatrix=p,this.meterOffset=p?p.transformVector(h):h),this.isGeospatial?(this.longitude=r,this.latitude=o,this.center=this._getCenterInWorld({longitude:r,latitude:o}),this.viewMatrixUncentered=l.n([],n,[1,-1,1])):(this.center=h?this.projectPosition(h):[0,0,0],this.viewMatrixUncentered=n),this.viewMatrix=(new he.a).multiplyRight(this.viewMatrixUncentered).translate(new fe.a(this.center||de).negate())}},{key:"_getCenterInWorld",value:function(t){var e=t.longitude,n=t.latitude,i=this.meterOffset,r=this.scale,a=this.distanceScales,o=this.projectFlat([e,n],r),s=new fe.a(o[0],o[1],0);if(i){var u=new fe.a(i).scale(a.pixelsPerMeter);s.add(u)}return s}},{key:"_initProjectionMatrix",value:function(t){var e=t.projectionMatrix,n=void 0===e?null:e,i=t.orthographic,r=void 0!==i&&i,a=t.fovyRadians,o=t.fovyDegrees,s=t.fovy,u=t.near,l=void 0===u?.1:u,c=t.far,h=void 0===c?1e3:c,f=t.focalDistance,p=void 0===f?1:f,A=t.orthographicFocalDistance,d=a||(o||s||75)*pe;this.projectionMatrix=n||this._createProjectionMatrix({orthographic:r,fovyRadians:d,aspect:this.width/this.height,focalDistance:A||p,near:l,far:h})}},{key:"_initPixelMatrices",value:function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];l.g(t,t,this.projectionMatrix),l.g(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=l.e([],this.viewMatrix)||this.viewMatrix;var e,n,i,a=(e={viewMatrix:this.viewMatrix,viewMatrixInverse:this.viewMatrixInverse},n=e.viewMatrix,{eye:[(i=e.viewMatrixInverse)[12],i[13],i[14]],direction:[n[2],n[6],n[10]],up:[n[1],n[5],n[9]]}),o=a.eye,s=a.direction,u=a.up;this.cameraPosition=o,this.cameraDirection=s,this.cameraUp=u;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];l.n(c,c,[this.width/2,-this.height/2,1]),l.o(c,c,[1,-1,0]),l.g(h,c,this.viewProjectionMatrix),this.pixelProjectionMatrix=h,this.viewportMatrix=c,this.pixelUnprojectionMatrix=l.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||r.warn("Pixel project matrix not invertible")()}}]),t}();ve.displayName="Viewport";var ge=Object.seal({layerManager:null,deck:null,gl:null,time:-1,useDevicePixels:!0,stats:null,shaderCache:null,pickingFBO:null,animationProps:null,userData:{}}),me=function(t){return t instanceof ue?"".concat(t):t?"invalid":"null"},ye=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.deck,r=n.stats,o=n.viewport,s=void 0===o?null:o;Object(T.a)(this,t),this.lastRenderedLayers=[],this.layers=[],this.context=Object.assign({},ge,{layerManager:this,deck:i,gl:e,shaderCache:e&&new a._ShaderCache({gl:e,_cachePrograms:!0}),stats:r||new le.a({id:"deck.gl"}),viewport:s||new ve({id:"DEFAULT-INITIAL-VIEWPORT"})}),this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),this._initSeer=this._initSeer.bind(this),this._editSeer=this._editSeer.bind(this),Object.seal(this),Mt(this._initSeer),Tt(this._editSeer)}return Object(M.a)(t,[{key:"finalize",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.layers[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=i.value;this._finalizeLayer(a)}}catch(o){e=!0,n=o}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}nt.a.removeListener(this._initSeer),nt.a.removeListener(this._editSeer)}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._checkIfNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this._needsUpdate}},{key:"setNeedsRedraw",value:function(t){this._needsRedraw=this._needsRedraw||t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t}},{key:"getLayers",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layerIds,e=void 0===t?null:t;return e?this.layers.filter(function(t){return e.find(function(e){return 0===t.id.indexOf(e)})}):this.layers}},{key:"setProps",value:function(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"useDevicePixels"in t&&(this.context.useDevicePixels=t.useDevicePixels),"layers"in t&&this.setLayers(t.layers)}},{key:"setLayers",value:function(t){if(t===this.lastRenderedLayers)return r.log(3,"Ignoring layer update due to layer array not changed")(),this;this.lastRenderedLayers=t,t=st(t,{filter:Boolean});var e=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.context=this.context}}catch(c){n=!0,i=c}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}var s=this._updateLayers({oldLayers:this.layers,newLayers:t}),u=s.error,l=s.generatedLayers;if(this.layers=l,u)throw u;return this}},{key:"updateLayers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"time"in t&&(this.context.time=t.time);var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(Object(tt.a)(this.lastRenderedLayers)))}},{key:"_checkIfNeedsRedraw",value:function(t){var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var n=!0,i=!1,r=void 0;try{for(var a,o=this.layers[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value.getNeedsRedraw(t);e=e||s}}catch(u){i=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return e}},{key:"activateViewport",value:function(t){var e=this.context.viewport;if(!e||!t.equals(e)){r.log(4,"Viewport changed",t)(),this.context.viewport=t;var n=!0,i=!1,a=void 0;try{for(var o,s=this.layers[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;u.setChangeFlags({viewportChanged:"Viewport changed"}),this._updateLayer(u)}}catch(l){i=!0,a=l}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}return d(this.context.viewport,"LayerManager: viewport not set"),this}},{key:"_updateLayers",value:function(t){var e=t.oldLayers,n=t.newLayers,i={},a=!0,o=!1,s=void 0;try{for(var u,l=e[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;i[c.id]?r.warn("Multiple old layers with same id ".concat(me(c)))():i[c.id]=c}}catch(A){o=!0,s=A}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}var h=[],f=this._updateSublayersRecursively({newLayers:n,oldLayerMap:i,generatedLayers:h}),p=this._finalizeOldLayers(i);return this._needsUpdate=!1,{error:f||p,generatedLayers:h}}},{key:"_updateSublayersRecursively",value:function(t){var e=t.newLayers,n=t.oldLayerMap,i=t.generatedLayers,a=null,o=!0,s=!1,u=void 0;try{for(var l,c=e[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;h.context=this.context;var f=n[h.id];null===f&&r.warn("Multiple new layers with same id ".concat(me(h)))(),n[h.id]=null;var p=null;try{if(this._debug&&f!==h&&h.validateProps(),f){this._transferLayerState(f,h);var A=this._updateLayer(h);a=a||A,Lt(h)}else{var d=this._initializeLayer(h);a=a||d,jt(h)}i.push(h),p=h.isComposite&&h.getSubLayers()}catch(d){r.warn("error during matching of ".concat(me(h)),d)(),a=a||d}if(p){var v=this._updateSublayersRecursively({newLayers:p,oldLayerMap:n,generatedLayers:i});a=a||v}}}catch(d){s=!0,u=d}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}return a}},{key:"_finalizeOldLayers",value:function(t){var e=null;for(var n in t){var i=t[n];i&&(e=e||this._finalizeLayer(i))}return e}},{key:"_initializeLayer",value:function(t){r.log(2,"initializing ".concat(me(t)))();var e=null;try{t._initialize(),t.lifecycle=Vt.INITIALIZED}catch(u){r.warn("error while initializing ".concat(me(t),"\n"),u)(),e=e||u}t.internalState.layer=t;var n=!0,i=!1,a=void 0;try{for(var o,s=t.getModels()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){o.value.userData.layer=t}}catch(u){i=!0,a=u}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return e}},{key:"_transferLayerState",value:function(t,e){e._transferState(t),e.lifecycle=Vt.MATCHED,e!==t?(r.log(4,"matched ".concat(me(e)),t,"->",e)(),t.lifecycle=Vt.AWAITING_GC):r.log(4,"Matching layer is unchanged ".concat(e.id))()}},{key:"_updateLayer",value:function(t){r.log(4,"updating ".concat(t," because: ").concat(t.printChangeFlags()))();var e=null;try{t._update()}catch(n){r.warn("error during update of ".concat(me(t)),n)(),e=n}return e}},{key:"_finalizeLayer",value:function(t){d(t.lifecycle!==Vt.AWAITING_FINALIZATION),t.lifecycle=Vt.AWAITING_FINALIZATION;var e=null;this.setNeedsRedraw("finalized ".concat(me(t)));try{t._finalize()}catch(n){r.warn("error during finalization of ".concat(me(t)),n)(),e=n}return t.lifecycle=Vt.FINALIZED,r.log(2,"finalizing ".concat(me(t)))(),e}},{key:"_initSeer",value:function(){this.layers.forEach(function(t){jt(t),Lt(t)})}},{key:"_editSeer",value:function(t){var e,n,i;"edit"===t.type&&"props"===t.valuePath[0]&&(e=t.itemKey,n=t.valuePath.slice(1),i=t.value,nt.a.isReady()&&(Et.has(e)||Et.set(e,new Map),Et.get(e).set(n,i)),this.updateLayers())}}]),t}();function _e(t,e){return t===e||Object.keys(t).every(function(n){return Array.isArray(t[n])&&Array.isArray(e[n])?_e(t[n],e[n]):t[n]===e[n]})}var be=/([0-9]+\.?[0-9]*)(%|px)/;function xe(t){switch(Object(It.a)(t)){case"number":return{position:t,relative:!1};case"string":var e=t.match(be);if(e&&e.length>=3){var n="%"===e[2],i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function we(t,e){return t.relative?Math.round(t.position*e):t.position}var Se=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(T.a)(this,t);var n=e.id,i=void 0===n?null:n,r=e.x,a=void 0===r?0:r,o=e.y,s=void 0===o?0:o,u=e.width,l=void 0===u?"100%":u,c=e.height,h=void 0===c?"100%":c,f=e.projectionMatrix,p=void 0===f?null:f,A=e.fovy,v=void 0===A?50:A,g=e.near,m=void 0===g?.1:g,y=e.far,_=void 0===y?1e3:y,b=e.modelMatrix,x=void 0===b?null:b,w=e.viewportInstance,S=void 0===w?null:w,k=e.type,O=void 0===k?ve:k;d(!S||S instanceof ve),this.viewportInstance=S,this.id=i||this.constructor.displayName||"view",this.type=O,this.props=Object.assign({},e,{projectionMatrix:p,fovy:v,near:m,far:_,modelMatrix:x}),this._parseDimensions({x:a,y:s,width:l,height:h}),this.equals=this.equals.bind(this),Object.seal(this)}return Object(M.a)(t,[{key:"equals",value:function(t){return this===t||(this.viewportInstance?t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):_e(this.props,t.props))}},{key:"makeViewport",value:function(t){var e=t.width,n=t.height,i=t.viewState;if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);var r=this.getDimensions({width:e,height:n}),a=Object.assign({viewState:i},i,this.props,r);return this._getViewport(a)}},{key:"getViewStateId",value:function(){switch(Object(It.a)(this.props.viewState)){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}},{key:"filterViewState",value:function(t){if(this.props.viewState&&"object"===Object(It.a)(this.props.viewState)){if(!this.props.viewState.id)return this.props.viewState;var e=Object.assign({},t);for(var n in this.props.viewState)"id"!==n&&(e[n]=this.props.viewState[n]);return e}return t}},{key:"getDimensions",value:function(t){var e=t.width,n=t.height;return{x:we(this._x,e),y:we(this._y,n),width:we(this._width,e),height:we(this._height,n)}}},{key:"_getControllerProps",value:function(t){var e=this.props.controller;return e?!0===e?t:("function"==typeof e&&(e={type:e}),Object.assign({},t,e)):null}},{key:"_getViewport",value:function(t){return new(0,this.type)(t)}},{key:"_parseDimensions",value:function(t){var e=t.x,n=t.y,i=t.width,r=t.height;this._x=xe(e),this._y=xe(n),this._width=xe(i),this._height=xe(r)}}]),t}(),ke=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(T.a)(this,t),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractiveStateChange:e.onInteractiveStateChange},Object.seal(this),this.setProps(e)}return Object(M.a)(t,[{key:"finalize",value:function(){for(var t in this.controllers)this.controllers[t]&&this.controllers[t].finalize();this.controllers={}}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}},{key:"updateViewStates",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("time"in t)for(var e in this.controllers){var n=this.controllers[e];n&&n.updateTransition(t.time)}}},{key:"getViewports",value:function(t){return t?this._viewports.filter(function(e){return e.containsPixel(t)}):this._viewports}},{key:"getViews",value:function(){var t={};return this.views.forEach(function(e){t[e.id]=e}),t}},{key:"getView",value:function(t){return"string"==typeof t?this.views.find(function(e){return e.id===t}):t}},{key:"getViewState",value:function(t){var e=this.getView(t),n=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(n):n}},{key:"getViewport",value:function(t){return this._viewportMap[t]}},{key:"project",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{topLeft:!0},n=this.getViewports(),i=n.length-1;i>=0;--i){var r=n[i];if(r.contains(t,e))return r.project(t,e)}return null}},{key:"unproject",value:function(t,e){for(var n=this.getViewports(),i=n.length-1;i>=0;--i){var r=n[i];if(r.containsPixel(t,e))return r.unproject(t)}return null}},{key:"setProps",value:function(t){"views"in t&&this._setViews(t.views),"viewState"in t&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(t,e){d(Number.isFinite(t)&&Number.isFinite(e)),t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(t){t=st(t,{filter:Boolean}).map(function(t){return t instanceof ve?new Se({viewportInstance:t}):t}),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}},{key:"_setViewState",value:function(t){t?(!_e(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):r.warn("setting null viewState")()}},{key:"_onViewStateChange",value:function(t,e){e.viewId=t,this._eventCallbacks.onViewStateChange(e)}},{key:"_createController",value:function(t){return new(0,t.type)(Object.assign({eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractiveStateChange},t))}},{key:"_updateController",value:function(t,e,n,i){if(t.controller){var r=Object.assign({},t.controller,e,{id:t.id,x:n.x,y:n.y,width:n.width,height:n.height});return i?i.setProps(r):i=this._createController(r),i}return null}},{key:"_rebuildViewports",value:function(){var t=this,e=this.width,n=this.height,i=this.views,r=this.controllers;for(var a in this.controllers={},this._viewports=i.map(function(i){var a=t.getViewState(i),o=i.makeViewport({width:e,height:n,viewState:a});return t.controllers[i.id]=t._updateController(i,a,o,r[i.id]),o}),r)r[a]&&!this.controllers[a]&&r[a].finalize();this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var t=this;this._viewportMap={},this._viewports.forEach(function(e){e.id&&(t._viewportMap[e.id]=t._viewportMap[e.id]||e)})}},{key:"_diffViews",value:function(t,e){return t.length!==e.length||t.some(function(n,i){return!t[i].equals(e[i])})}}]),t}(),Oe=n("JX7q"),Pe=n("w+ko"),Ee=n("ZxFD"),Ce=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(T.a)(this,e);var i=n.latitude,r=void 0===i?0:i,a=n.longitude,o=void 0===a?0:a,s=n.zoom,u=void 0===s?11:s,l=n.pitch,c=void 0===l?0:l,h=n.bearing,f=void 0===h?0:h,p=n.nearZMultiplier,A=void 0===p?.1:p,d=n.farZMultiplier,v=void 0===d?10:d,g=n.orthographic,m=void 0!==g&&g,y=n.width,_=n.height,b=n.altitude,x=void 0===b?1.5:b;y=y||1,_=_||1,x=Math.max(.75,x);var w=Object(V.e)({width:y,height:_,pitch:c,altitude:x,nearZMultiplier:A,farZMultiplier:v}),S=w.fov,k=w.aspect,O=w.focalDistance,P=w.near,E=w.far,C=Object(V.f)({height:_,pitch:c,bearing:f,altitude:x}),M=Object.assign({},n,{width:y,height:_,viewMatrix:C,longitude:o,latitude:r,zoom:u,orthographic:m,fovyRadians:S,aspect:k,orthographicFocalDistance:O,near:P,far:E});return(t=Object(j.a)(this,Object(L.a)(e).call(this,M))).latitude=r,t.longitude=o,t.zoom=u,t.pitch=c,t.bearing=f,t.altitude=x,t.orthographic=m,t.metersToLngLatDelta=t.metersToLngLatDelta.bind(Object(Oe.a)(Object(Oe.a)(t))),t.lngLatDeltaToMeters=t.lngLatDeltaToMeters.bind(Object(Oe.a)(Object(Oe.a)(t))),t.addMetersToLngLat=t.addMetersToLngLat.bind(Object(Oe.a)(Object(Oe.a)(t))),Object.freeze(Object(Oe.a)(Object(Oe.a)(t))),t}return Object(I.a)(e,t),Object(M.a)(e,[{key:"metersToLngLatDelta",value:function(t){var e=Object(N.a)(t,3),n=e[0],i=e[1],r=e[2],a=void 0===r?0:r;d(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a),"Illegal argument to WebMercatorViewport");var o=this.distanceScales,s=o.pixelsPerMeter,u=o.degreesPerPixel,l=n*s[0]*u[0],c=i*s[1]*u[1];return 2===t.length?[l,c]:[l,c,a]}},{key:"lngLatDeltaToMeters",value:function(t){var e=Object(N.a)(t,3),n=e[0],i=e[1],r=e[2],a=void 0===r?0:r;d(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a),"Illegal argument to WebMercatorViewport");var o=this.distanceScales,s=o.pixelsPerDegree,u=o.metersPerPixel,l=n*s[0]*u[0],c=i*s[1]*u[1];return 2===t.length?[l,c]:[l,c,a]}},{key:"addMetersToLngLat",value:function(t,e){return Object(V.a)(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=t.pos,i=Object(V.h)(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),a=Ee.a([],r,Ee.e([],i)),o=Ee.a([],this.center,a);return this.unprojectFlat(o)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,r=this.height,a=Object(Pe.a)(Object.assign({width:i,height:r,bounds:t},n));return new e({width:i,height:r,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}(ve);Ce.displayName="WebMercatorViewport";var Te=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(T.a)(this,t),Array.isArray(e)&&(e={compare:e,extract:e,required:e});var n=e,i=n.compare,r=n.extract,a=n.required;this._propsToCompare=i,this._propsToExtract=r,this._requiredProps=a}return Object(M.a)(t,[{key:"arePropsEqual",value:function(t,e){var n=!0,i=!1,r=void 0;try{for(var a,o=(this._propsToCompare||Object.keys(e))[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(!Object(ce.e)(t[s],e[s]))return!1}}catch(u){i=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return!0}},{key:"initializeProps",value:function(t,e){var n;if(this._propsToExtract){var i={},r={},a=!0,o=!1,s=void 0;try{for(var u,l=this._propsToExtract[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;i[c]=t[c],r[c]=e[c]}}catch(h){o=!0,s=h}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}n={start:i,end:r}}else n={start:t,end:e};return this._checkRequiredProps(n.start),this._checkRequiredProps(n.end),n}},{key:"interpolateProps",value:function(t,e,n){d(!1,"interpolateProps is not implemented")}},{key:"_checkRequiredProps",value:function(t){this._requiredProps&&this._requiredProps.forEach(function(e){var n=t[e];d(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))})}}]),t}(),Me=["longitude","latitude","zoom","bearing","pitch"],je=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Me;return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).call(this,t))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"interpolateProps",value:function(t,e,n){var i={};for(var r in e)i[r]=Object(ce.g)(t[r],e[r],n);return i}}]),e}(Te),Le=function(){},Ie={BREAK:1,SNAP_TO_END:2,IGNORE:3},ze={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new je,transitionInterruption:Ie.BREAK,onTransitionStart:Le,onTransitionInterrupt:Le,onTransitionEnd:Le},De=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(T.a)(this,t),d(e),this.ControllerState=e,this.props=Object.assign({},ze,n),this.propsInTransition=null,this.time=0,this.transition=new bt,this.onViewStateChange=n.onViewStateChange,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}return Object(M.a)(t,[{key:"finalize",value:function(){}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(t){var e=!1,n=this.props;if(t=Object.assign({},ze,t),this.props=t,this._shouldIgnoreViewportChange(n,t))return e;if(this._isTransitionEnabled(t)){var i=Object.assign({},n,this.transition.interruption===Ie.SNAP_TO_END?this.transition.endProps:this.propsInTransition||n);this._triggerTransition(i,t),e=!0}else this.transition.cancel();return e}},{key:"updateTransition",value:function(t){this.time=t,this._updateTransition()}},{key:"_isTransitionEnabled",value:function(t){return t.transitionDuration>0&&t.transitionInterpolator}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.transition.inProgress&&this.transition.interpolator.arePropsEqual(t,this.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return this.transition.inProgress?this.transition.interruption===Ie.IGNORE||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}},{key:"_triggerTransition",value:function(t,e){d(this._isTransitionEnabled(e),"Transition is not enabled");var n=new this.ControllerState(t),i=new this.ControllerState(e).shortestPathFrom(n),r=e.transitionInterpolator.initializeProps(t,i);this.propsInTransition={},this.transition.start({duration:e.transitionDuration,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:r.start,endProps:r.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this._updateTransition()}},{key:"_updateTransition",value:function(){this.transition.update(this.time)}},{key:"_onTransitionEnd",value:function(t){var e=this;return function(n){e.propsInTransition=null,t(n)}}},{key:"_onTransitionUpdate",value:function(t){var e=t.interpolator,n=t.startProps,i=t.endProps,r=t.time,a=e.interpolateProps(n,i,r);this.propsInTransition=new this.ControllerState(Object.assign({},this.props,a)).getViewportProps(),this.onViewStateChange&&this.onViewStateChange({viewState:this.propsInTransition,interactionState:{inTransition:!0}})}}]),t}();De.defaultProps=ze;var Be={transitionDuration:0},Re=["wheel"],Fe=["panstart","panmove","panend"],Ne=["pinchstart","pinchmove","pinchend"],Ue=["doubletap"],Ve=["keydown"],Ge=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(T.a)(this,t),d(e),this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new De(e,n),this._events=null,this._state={isDragging:!1},this.events=[],this.onViewStateChange=null,this.onStateChange=null,this.invertPan=!1,this.handleEvent=this.handleEvent.bind(this),this.setProps(n)}return Object(M.a)(t,[{key:"finalize",value:function(){for(var t in this._events)this._events[t]&&this.eventManager.off(t,this.handleEvent);this.transitionManager.finalize()}},{key:"handleEvent",value:function(t){var e=this.ControllerState;switch(this.controllerState=new e(Object.assign({},this.controllerStateProps,this._state)),t.type){case"panstart":return this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=this.controllerStateProps,n=e.x,i=e.y,r=t.offsetCenter;return[r.x-n,r.y-i]}},{key:"isPointInBounds",value:function(t){var e=this.controllerStateProps,n=e.width,i=e.height;return t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=i}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"isDragging",value:function(){return this._state.isDragging}},{key:"setProps",value:function(t){"onViewportChange"in t&&r.removed("onViewportChange")(),"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),this.controllerStateProps=t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this.events,!0)),this.transitionManager.processViewStateChange(this.controllerStateProps);var e=t.scrollZoom,n=void 0===e||e,i=t.dragPan,a=void 0===i||i,o=t.dragRotate,s=void 0===o||o,u=t.doubleClickZoom,l=void 0===u||u,c=t.touchZoom,h=void 0===c||c,f=t.touchRotate,p=void 0!==f&&f,A=t.keyboard,d=void 0===A||A,v=Boolean(this.onViewStateChange);this.toggleEvents(Re,v&&n),this.toggleEvents(Fe,v&&(a||s)),this.toggleEvents(Ne,v&&(h||p)),this.toggleEvents(Ue,v&&l),this.toggleEvents(Ve,v&&d),this.scrollZoom=n,this.dragPan=a,this.dragRotate=s,this.doubleClickZoom=l,this.touchZoom=h,this.touchRotate=p,this.keyboard=d}},{key:"updateTransition",value:function(t){this.transitionManager.updateTransition(t)}},{key:"toggleEvents",value:function(t,e){var n=this;this.eventManager&&t.forEach(function(t){n._events[t]!==e&&(n._events[t]=e,e?n.eventManager.on(t,n.handleEvent):n.eventManager.off(t,n.handleEvent))})}},{key:"setOptions",value:function(t){return this.setProps(t)}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Object.assign({},t.getViewportProps(),e);if(this.controllerState!==t){var r=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:n,oldViewState:r})}Object.assign(this._state,Object.assign({},t.getInteractiveState(),n)),this.onStateChange&&this.onStateChange(this._state)}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var n=this.controllerState.panStart({pos:e}).rotateStart({pos:e});return this.updateViewport(n,Be,{isDragging:!0})}},{key:"_onPan",value:function(t){var e=this.isFunctionKeyPressed(t)||t.rightButton;return(e=this.invertPan?!e:e)?this._onPanMove(t):this._onPanRotate(t)}},{key:"_onPanEnd",value:function(t){var e=this.controllerState.panEnd().rotateEnd();return this.updateViewport(e,null,{isDragging:!1})}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t);if(!this.isDragging())return!1;var n=this.controllerState.pan({pos:e});return this.updateViewport(n,Be,{isDragging:!0})}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,n=t.deltaY,i=this.controllerState.getViewportProps(),r=e/i.width,a=n/i.height,o=this.controllerState.rotate({deltaScaleX:r,deltaScaleY:a});return this.updateViewport(o,Be,{isDragging:!0})}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;t.preventDefault();var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var n=t.delta,i=2/(1+Math.exp(-Math.abs(.01*n)));n<0&&0!==i&&(i=1/i);var r=this.controllerState.zoom({pos:e,scale:i});return this.updateViewport(r,Be)}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._state.startPinchRotation=t.rotation,this.updateViewport(n,Be,{isDragging:!0})}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;var e=this.controllerState;if(this.touchZoom){var n=t.scale,i=this.getCenter(t);e=e.zoom({pos:i,scale:n})}if(this.touchRotate){var r=t.rotation,a=this._state.startPinchRotation;e=e.rotate({deltaScaleX:-(r-a)/180})}return this.updateViewport(e,Be,{isDragging:!0})}},{key:"_onPinchEnd",value:function(t){var e=this.controllerState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(e,null,{isDragging:!1})}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var n=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps())}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,n=this.isFunctionKeyPressed(t),i=this.controllerState;switch(t.srcEvent.keyCode){case 189:e=n?i.zoomOut().zoomOut():i.zoomOut();break;case 187:e=n?i.zoomIn().zoomIn():i.zoomIn();break;case 37:e=n?i.rotateLeft():i.moveLeft();break;case 39:e=n?i.rotateRight():i.moveRight();break;case 38:e=n?i.rotateUp():i.moveUp();break;case 40:e=n?i.rotateDown():i.moveDown();break;default:return!1}return this.updateViewport(e,this._getTransitionProps())}},{key:"_getTransitionProps",value:function(){return Be}}]),t}(),We=6371e3,He=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.phi,i=e.theta,r=e.radius,a=e.bearing,o=e.pitch,s=(e.altitude,e.radiusScale),u=void 0===s?We:s;Object(T.a)(this,t),0===arguments.length?(this.phi=0,this.theta=0,this.radius=1):Number.isFinite(n)||Number.isFinite(i)?(this.phi=n||0,this.theta=i||0):(Number.isFinite(a)||Number.isFinite(o))&&(this.bearing=a||0,this.pitch=o||0),this.radius=r||1,this.radiusScale=u||1,this.check()}return Object(M.a)(t,[{key:"toString",value:function(){return this.formatString(ce.c)}},{key:"formatString",value:function(t){var e=t.printTypes,n=(t.printDegrees,ce.f);return"".concat(e?"Spherical":"","[rho:").concat(n(this.radius),",theta:").concat(n(this.theta),",phi:").concat(n(this.phi),"]")}},{key:"equals",value:function(t){return Object(ce.e)(this.radius,t.radius)&&Object(ce.e)(this.theta,t.theta)&&Object(ce.e)(this.phi,t.phi)}},{key:"exactEquals",value:function(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}},{key:"set",value:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this.check()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}},{key:"fromLngLatZ",value:function(t){var e=Object(N.a)(t,3),n=e[0],i=e[1],r=e[2];this.radius=1+r/this.radiusScale,this.phi=Object(ce.h)(i),this.theta=Object(ce.h)(n)}},{key:"fromVector3",value:function(t){return this.radius=U.c(t),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(Object(ce.b)(t[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new fe.a(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi))}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}},{key:"bearing",get:function(){return 180-Object(ce.d)(this.phi)},set:function(t){this.phi=Math.PI-Object(ce.h)(t)}},{key:"pitch",get:function(){return Object(ce.d)(this.theta)},set:function(t){this.theta=Object(ce.h)(t)}},{key:"longitude",get:function(){return Object(ce.d)(this.phi)}},{key:"latitude",get:function(){return Object(ce.d)(this.theta)}},{key:"lng",get:function(){return Object(ce.d)(this.phi)}},{key:"lat",get:function(){return Object(ce.d)(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}}]),t}(),qe={position:[0,0,0],lookAt:[0,0,0],up:[0,0,1],rotationX:0,rotationY:0,fov:50,near:1,far:100},Ze=function(){function t(e){Object(T.a)(this,t);var n=e.width,i=e.height,r=e.position,a=void 0===r?qe.position:r;d(Number.isFinite(n),"`width` must be supplied"),d(Number.isFinite(i),"`height` must be supplied"),this._viewportProps=this._applyConstraints(Object.assign({},e,{position:new fe.a(a)}))}return Object(M.a)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getDirection",value:function(){return new He({bearing:this._viewportProps.bearing,pitch:this._viewportProps.pitch}).toVector3().normalize()}},{key:"getDirectionFromBearing",value:function(t){return new He({bearing:t,pitch:90}).toVector3().normalize()}},{key:"shortestPathFrom",value:function(t){return this._viewportProps}},{key:"_applyConstraints",value:function(t){return t}}]),t}(),Xe=n("1A8y"),Qe=n("xLQB"),Ye={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new je,transitionInterruption:Ie.BREAK},Ke={transitionDuration:0},Je={minZoom:0,maxZoom:20,minPitch:0,maxPitch:60},$e={pitch:0,bearing:0,altitude:1.5},tn=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.width,r=n.height,a=n.latitude,o=n.longitude,s=n.zoom,u=n.bearing,l=void 0===u?$e.bearing:u,c=n.pitch,h=void 0===c?$e.pitch:c,f=n.altitude,p=void 0===f?$e.altitude:f,A=n.maxZoom,v=void 0===A?Je.maxZoom:A,g=n.minZoom,m=void 0===g?Je.minZoom:g,y=n.maxPitch,_=void 0===y?Je.maxPitch:y,b=n.minPitch,x=void 0===b?Je.minPitch:b,w=n.startPanLngLat,S=n.startZoomLngLat,k=n.startBearing,O=n.startPitch,P=n.startZoom;return Object(T.a)(this,e),d(Number.isFinite(o),"`longitude` must be supplied"),d(Number.isFinite(a),"`latitude` must be supplied"),d(Number.isFinite(s),"`zoom` must be supplied"),(t=Object(j.a)(this,Object(L.a)(e).call(this,{width:i,height:r,latitude:a,longitude:o,zoom:s,bearing:l,pitch:h,altitude:p,maxZoom:v,minZoom:m,maxPitch:_,minPitch:x})))._interactiveState={startPanLngLat:w,startZoomLngLat:S,startBearing:k,startPitch:O,startZoom:P},t}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,i=this._interactiveState.startPanLngLat||this._unproject(n);if(!i)return this;var r=this._calculateNewLngLat({startPanLngLat:i,pos:e}),a=Object(N.a)(r,2),o=a[0],s=a[1];return this._getUpdatedState({longitude:o,latitude:s})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=void 0===e?0:e,i=t.deltaScaleY,r=void 0===i?0:i,a=this._interactiveState,o=a.startBearing,s=a.startPitch;if(!Number.isFinite(o)||!Number.isFinite(s))return this;var u=this._calculateNewPitchAndBearing({deltaScaleX:n,deltaScaleY:r,startBearing:o,startPitch:s}),l=u.pitch,c=u.bearing;return this._getUpdatedState({bearing:c,pitch:l})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,i=t.scale;d(i>0,"`scale` must be a positive number");var r=this._interactiveState,a=r.startZoom,o=r.startZoomLngLat;Number.isFinite(a)||(a=this._viewportProps.zoom,o=this._unproject(n)||this._unproject(e)),d(o,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var s=this._calculateNewZoom({scale:i,startZoom:a}),u=new Xe.a(Object.assign({},this._viewportProps,{zoom:s})).getLocationAtPoint({lngLat:o,pos:e}),l=Object(N.a)(u,2),c=l[0],h=l[1];return this._getUpdatedState({zoom:s,longitude:c,latitude:h})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._zoomFromCenter(2)}},{key:"zoomOut",value:function(){return this._zoomFromCenter(.5)}},{key:"moveLeft",value:function(){return this._panFromCenter([100,0])}},{key:"moveRight",value:function(){return this._panFromCenter([-100,0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,100])}},{key:"moveDown",value:function(){return this._panFromCenter([0,-100])}},{key:"rotateLeft",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch+10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch-10})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),n=Object.assign({},this._viewportProps),i=n.bearing,r=n.longitude;return Math.abs(i-e.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-e.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}},{key:"_zoomFromCenter",value:function(t){var e=this._viewportProps,n=e.width,i=e.height;return this.zoom({pos:[n/2,i/2],scale:t})}},{key:"_panFromCenter",value:function(t){var e=this._viewportProps,n=e.width,i=e.height;return this.pan({startPos:[n/2,i/2],pos:[n/2+t[0],i/2+t[1]]})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,i=t.zoom;t.zoom=Object(ce.b)(i,n,e);var r=t.maxPitch,a=t.minPitch,o=t.pitch;return t.pitch=Object(ce.b)(o,a,r),Object.assign(t,Object(Qe.a)(t)),t}},{key:"_unproject",value:function(t){var e=new Xe.a(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,n=t.pos;return new Xe.a(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,n=t.startZoom,i=this._viewportProps,r=i.maxZoom,a=i.minZoom,o=n+Math.log2(e);return Object(ce.b)(o,a,r)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY,i=t.startBearing,r=t.startPitch;n=Object(ce.b)(n,-1,1);var a=this._viewportProps,o=a.minPitch,s=a.maxPitch,u=r;return n>0?u=r+n*(s-r):n<0&&(u=r-n*(o-r)),{pitch:u,bearing:i+180*e}}}]),e}(Ze),en=function(t){function e(t){var n;return Object(T.a)(this,e),(n=Object(j.a)(this,Object(L.a)(e).call(this,tn,t))).invertPan=!0,n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"_getTransitionProps",value:function(){return Ye}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,n=t.deltaY,i=this.getCenter(t),r=Object(N.a)(i,2)[1],a=r-n,o=this.controllerState.getViewportProps(),s=o.width,u=o.height,l=e/s,c=0;n>0?Math.abs(u-a)>5&&(c=n/(a-u)*1.2):n<0&&a>5&&(c=1-r/a),c=Math.min(1,Math.max(-1,c));var h=this.controllerState.rotate({deltaScaleX:l,deltaScaleY:c});return this.updateViewport(h,Ke,{isDragging:!0})}}]),e}(Ge),nn=function(t){function e(t){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).call(this,Object.assign({},t,{type:Ce})))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:en})}}]),e}(Se);nn.displayName="MapView";var rn=function(){function t(){Object(T.a)(this,t),this.effects=[],this._needsRedraw="Initial render",this.defaultLightingEffect=new F,this.needApplyDefaultLighting=!1}return Object(M.a)(t,[{key:"setProps",value:function(t){"effects"in t&&(t.effects.length===this.effects.length&&_e(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed")),this.checkLightingEffect()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"getEffects",value:function(){var t=this.effects;return this.needApplyDefaultLighting&&(t=this.effects.slice()).push(this.defaultLightingEffect),t}},{key:"finalize",value:function(){this.cleanup()}},{key:"setEffects",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.cleanup(),this.effects=t}},{key:"cleanup",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.effects[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){i.value.cleanup()}}catch(a){e=!0,n=a}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}this.effects.length=0}},{key:"checkLightingEffect",value:function(){var t=!1,e=!0,n=!1,i=void 0;try{for(var r,a=this.effects[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){if(r.value instanceof F){t=!0;break}}}catch(o){n=!0,i=o}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}this.needApplyDefaultLighting=!t}}]),t}(),an=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"render",value:function(t){var e=this,n=this.gl;return Object(a.withParameters)(n,{framebuffer:t.outputBuffer},function(){return e.drawLayers(t)})}},{key:"drawLayers",value:function(t){var e=this,n=t.layers,i=t.viewports,r=t.views,a=t.onViewportActive,o=t.deviceRect,s=void 0===o?null:o,u=t.parameters,l=void 0===u?{}:u,c=t.pass,h=void 0===c?"draw":c,f=t.redrawReason,p=void 0===f?"":f,A=t.clearCanvas,d=void 0===A||A,v=t.effects,g=t.effectProps,m=this.gl;d&&this.clearCanvas(m);var y=[];return i.forEach(function(t,i){var o=e.getViewportFromDescriptor(t),u=r&&r[o.id];a(o);var c=e.drawLayersInViewport(m,{layers:n,viewport:o,view:u,deviceRect:s,parameters:l,pass:h,redrawReason:p,effects:v,effectProps:g});y.push(c)}),y}},{key:"drawLayersInViewport",value:function(t,e){var n=this,i=e.layers,r=e.viewport,o=e.view,s=(e.deviceRect,e.parameters),u=void 0===s?{}:s,l=(e.pass,e.redrawReason,e.effects),c=e.effectProps,h=this.getGLViewport(t,{viewport:r});if(o&&o.props.clear){var f=!0===o.props.clear?{color:!0,depth:!0}:o.props.clear;Object(a.withParameters)(t,{scissorTest:!0,scissor:h},function(){return Object(a.clear)(t,f)})}var p={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};return Object(a.setParameters)(t,u||{}),i.forEach(function(e,i){var a=n.shouldDrawLayer(e,r);a&&e.props.pickable&&p.pickableCount++,e.isComposite&&p.compositeCount++,a&&(p.visibleCount++,n.drawLayerInViewport({gl:t,layer:e,layerIndex:i,glViewport:h,parameters:u,effects:l,effectProps:c}))}),p}},{key:"drawLayerInViewport",value:function(t){t.gl;var e=t.layer,n=t.layerIndex,i=t.glViewport,r=t.parameters,a=t.effects,o=t.effectProps,s=this.getModuleParameters(e,a,o),u=Object.assign({},e.context.uniforms,{layerIndex:n}),l=this.getLayerParameters(e,n,i,r);e.drawLayer({moduleParameters:s,uniforms:u,parameters:l})}},{key:"getViewportFromDescriptor",value:function(t){return t.viewport?t.viewport:t}},{key:"shouldDrawLayer",value:function(t,e){var n=this.props.layerFilter,i=!t.isComposite&&t.props.visible;return i&&n&&(i=n({layer:t,viewport:e,isPicking:!1})),i}},{key:"getModuleParameters",value:function(t){return Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:0,devicePixelRatio:this.props.pixelRatio})}},{key:"getLayerParameters",value:function(t,e,n,i){var r=Object.assign({},t.props.parameters||{},i);return Object.assign(r,{viewport:n}),r}},{key:"getGLViewport",value:function(t,e){var n=e.viewport,i=t.canvas?t.canvas.clientHeight||t.canvas.height:100,r=n,a=this.props.pixelRatio;return[r.x*a,(i-r.y-r.height)*a,r.width*a,r.height*a]}},{key:"clearCanvas",value:function(t){var e=t.drawingBufferWidth,n=t.drawingBufferHeight;Object(a.withParameters)(t,{viewport:[0,0,e,n]},function(){t.clear(16640)})}}]),e}(Z),on=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getModuleParameters",value:function(t,n,i){var r=Object(it.a)(Object(L.a)(e.prototype),"getModuleParameters",this).call(this,t);Object.assign(r,this.getObjectHighlightParameters(t),i);var a=!0,o=!1,s=void 0;try{for(var u,l=n[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;Object.assign(r,c.getParameters(t))}}catch(h){o=!0,s=h}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return r}},{key:"getObjectHighlightParameters",value:function(t){var e=t.props,n=e.highlightedObjectIndex,i=e.highlightColor,r={pickingHighlightColor:[i[0],i[1],i[2],i[3]||255]};return Number.isInteger(n)&&(r.pickingSelectedColor=n>=0?t.encodePickingColor(n):null),r}}]),e}(an),sn=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"render",value:function(t){t.pickingFBO?this.drawPickingBuffer(t):Object(it.a)(Object(L.a)(e.prototype),"render",this).call(this,t)}},{key:"drawPickingBuffer",value:function(t){var e=this,n=t.layers,i=t.viewports,r=t.onViewportActive,o=t.pickingFBO,s=t.effectProps,u=t.deviceRect,l=u.x,c=u.y,h=u.width,f=u.height,p=t.redrawReason,A=void 0===p?"":p,d=this.gl;return Object(a.withParameters)(d,{framebuffer:o,scissorTest:!0,scissor:[l,c,h,f],clearColor:[0,0,0,0]},function(){e.drawLayers({layers:n,viewports:i,onViewportActive:r,pass:"picking",redrawReason:A,effectProps:s,parameters:{blend:!0,blendFunc:[1,0,32771,0],blendEquation:32774,blendColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]}})})}},{key:"shouldDrawLayer",value:function(t,e){var n=this.props.layerFilter,i=!t.isComposite&&t.props.visible&&t.props.pickable;return i&&n&&(i=n({layer:t,viewport:e,isPicking:!0})),i}},{key:"getModuleParameters",value:function(t,e,n){var i=Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:1,devicePixelRatio:this.props.pixelRatio});return Object.assign(i,n),i}},{key:"getLayerParameters",value:function(t,e,n,i){var r=Object.assign({},t.props.parameters||{},i);return Object.assign(r,{viewport:n,blendColor:[0,0,0,(e+1)/255]}),r}}]),e}(an);function un(t){return d("boolean"==typeof t,"Invalid useDevicePixels"),t&&"undefined"!=typeof window?window.devicePixelRatio:1}var ln=function(){function t(e){Object(T.a)(this,t),this.gl=e,this.pixelRatio=null,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new on(e),this.pickLayersPass=new sn(e),this.renderCount=0,this._needsRedraw="Initial render",this.screenBuffer=null,this.offscreenBuffer=null,this.lastPostProcessEffect=null}return Object(M.a)(t,[{key:"setProps",value:function(t){"useDevicePixels"in t&&(this.pixelRatio=un(t.useDevicePixels)),"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed");var e=this.pixelRatio,n=this.layerFilter;this.drawLayersPass.setProps({pixelRatio:e,layerFilter:n}),this.pickLayersPass.setProps({pixelRatio:e,layerFilter:n})}},{key:"renderLayers",value:function(t){var e=this,n=t.layers,i=t.viewports,o=t.activateViewport,s=t.views,u=t.redrawReason,l=void 0===u?"unknown reason":u,c=t.clearCanvas,h=void 0===c||c,f=t.effects,p=void 0===f?[]:f,A=t.pass,d=t.stats,v=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,g=this.prepareEffects({layers:n,viewports:i,onViewportActive:o,views:s,effects:p}),m=this.lastPostProcessEffect?this.screenBuffer:a.Framebuffer.getDefaultFramebuffer(this.gl),y=v.render({layers:n,viewports:i,views:s,onViewportActive:o,redrawReason:l,clearCanvas:h,effects:p,effectProps:g,outputBuffer:m});this.postRender(p),this.renderCount++,r.priority>=2&&y.forEach(function(t){e.logRenderStats({status:t,pass:A,redrawReason:l,stats:d,renderStats:y})})}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"finalize",value:function(){this.screenBuffer&&(this.screenBuffer.delete(),this.screenBuffer=null),this.offscreenBuffer&&(this.offscreenBuffer.delete(),this.offscreenBuffer=null)}},{key:"prepareEffects",value:function(t){var e=t.effects,n={};this.lastPostProcessEffect=null;var i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;Object.assign(n,u.prepare(this.gl,t)),u instanceof Y&&(this.lastPostProcessEffect=u)}}catch(l){r=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return this.lastPostProcessEffect&&this.prepareRenderBuffers(),n}},{key:"prepareRenderBuffers",value:function(){this.screenBuffer||(this.screenBuffer=new a.Framebuffer(this.gl)),this.screenBuffer.resize(),this.offscreenBuffer||(this.offscreenBuffer=new a.Framebuffer(this.gl)),this.offscreenBuffer.resize()}},{key:"postRender",value:function(t){var e={inputBuffer:this.screenBuffer,outputBuffer:this.offscreenBuffer,target:null},n=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if(u instanceof Y){if(u===this.lastPostProcessEffect){Object.assign(e,{target:a.Framebuffer.getDefaultFramebuffer(this.gl)}),e=u.render(e);break}e=u.render(e)}}}catch(l){i=!0,r=l}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}}},{key:"logRenderStats",value:function(t){var e=t.renderStats,n=t.pass,i=t.redrawReason,a=t.stats,o=e.totalCount,s=e.visibleCount,u=e.compositeCount,l=e.pickableCount,c=o-u-s,h="";h+="RENDER #".concat(this.renderCount," ").concat(s," (of ").concat(o," layers) to ").concat(n," because ").concat(i," "),r.priority>2&&(h+="(".concat(c," hidden, ").concat(u," composite ").concat(l," pickable)")),r.log(2,h)(),a&&a.get("Redraw Layers").add(s)}}]),t}(),cn={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function hn(t){var e=t.pickedColors,n=t.layers,i=t.deviceX,a=t.deviceY,o=t.deviceRadius,s=t.deviceRect;if(e){for(var u=s.x,l=s.y,c=s.width,h=s.height,f=o*o,p=-1,A=0,d=0;d<h;d++){var v=d+l-a,g=v*v;if(g>f)A+=4*c;else for(var m=0;m<c;m++){if(e[A+3]-1>=0){var y=m+u-i,_=y*y+g;_<=f&&(f=_,p=A)}A+=4}}if(p>=0){var b=e[p+3]-1,x=e.slice(p,p+4),w=n[b];if(w){var S=w.decodePickingColor(x);return{pickedColor:x,pickedLayer:w,pickedObjectIndex:S}}r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return cn}function fn(t){var e=t.pickInfo,n=t.lastPickedInfo,i=t.mode,r=t.layers,a=t.viewports,o=t.x,s=t.y,u=t.deviceX,l=t.deviceY,c=t.pixelRatio,h=e.pickedColor,f=e.pickedLayer,p=e.pickedObjectIndex,A=f?[f]:[];if("hover"===i){var d=n.index,v=n.layerId,g=f&&f.props.id;if(g!==v||p!==d){if(g!==v){var m=r.find(function(t){return t.props.id===v});m&&A.unshift(m)}n.layerId=g,n.index=p,n.info=null}}var y={viewports:a}.viewports[0],_=y&&y.unproject([o,s]),b={color:null,layer:null,index:-1,picked:!1,x:o,y:s,pixel:[o,s],coordinate:_,lngLat:_,devicePixel:[u,l],pixelRatio:c},x=new Map;return x.set(null,b),A.forEach(function(t){var e=Object.assign({},b);if(t===f&&(e.color=h,e.index=p,e.picked=!0),e=pn({layer:t,info:e,mode:i}),t===f&&"hover"===i&&(n.info=e),e&&x.set(e.layer.id,e),"hover"===i){var r=t.props.autoHighlight&&f===t?h:null;t.setModuleParameters({pickingSelectedColor:r}),t.setNeedsRedraw()}}),x}function pn(t){for(var e=t.layer,n=t.info,i=t.mode;e&&n;){var r=n.layer||e;n.layer=e,n=e.pickLayer({info:n,mode:i,sourceLayer:r}),e=e.parent}return n}var An=function(){function t(e){Object(T.a)(this,t),this.gl=e,this.pickingFBO=null,this.pickLayersPass=new sn(e),this.pixelRatio=null,this.layerFilter=null,this.pickingEvent=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}return Object(M.a)(t,[{key:"setProps",value:function(t){"useDevicePixels"in t&&(this.pixelRatio=un(t.useDevicePixels)),"layerFilter"in t&&(this.layerFilter=t.layerFilter),this.pickLayersPass.setProps({pixelRatio:this.pixelRatio,layerFilter:this.layerFilter})}},{key:"pickObject",value:function(t){var e=t.x,n=t.y,i=t.mode,r=t.radius,a=void 0===r?0:r,o=t.layers,s=t.viewports,u=t.activateViewport,l=t.depth,c=void 0===l?1:l,h=t.event,f=void 0===h?null:h;this.pickingEvent=f;var p=this.pickClosestObject({x:e,y:n,radius:a,layers:o,mode:i,depth:c,viewports:s,onViewportActive:u});return this.pickingEvent=null,p}},{key:"pickObjects",value:function(t){var e=t.x,n=t.y,i=t.width,r=t.height,a=t.layers,o=t.viewports,s=t.activateViewport;return this.pickVisibleObjects({x:e,y:n,width:i,height:r,layers:a,mode:"pickObjects",viewports:o,onViewportActive:s})}},{key:"getLastPickedObject",value:function(t){var e=t.x,n=t.y,i=t.layers,r=t.viewports,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info,o=a&&a.layer&&a.layer.id,s=o?i.find(function(t){return t.id===o}):null,u=r[0]&&r[0].unproject([e,n]),l={x:e,y:n,coordinate:u,lngLat:u,layer:s};return s?Object.assign({},a,l):Object.assign(l,{color:null,object:null,index:-1})}},{key:"updatePickingBuffer",value:function(){var t=this.gl;return this.pickingFBO||(this.pickingFBO=new a.Framebuffer(t)),this.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.pickingFBO}},{key:"pickClosestObject",value:function(t){var e=t.layers,n=t.viewports,i=t.x,r=t.y,a=t.radius,o=t.depth,s=void 0===o?1:o,u=t.mode,l=t.onViewportActive;this.updatePickingBuffer();for(var c,h=this.pixelRatio,f=Math.round(i*h),p=Math.round(this.gl.canvas.height-r*h),A=Math.round(a*h),d=this.pickingFBO,v=d.width,g=d.height,m=this.getPickingRect({deviceX:f,deviceY:p,deviceRadius:A,deviceWidth:v,deviceHeight:g}),y=[],_={},b=0;b<s;b++){var x=hn({pickedColors:m&&this.drawAndSamplePickingBuffer({layers:e,viewports:n,onViewportActive:l,deviceRect:m,redrawReason:u}),layers:e,deviceX:f,deviceY:p,deviceRadius:A,deviceRect:m});if(x.pickedColor&&b+1<s){var w=x.pickedColor[3]-1;_[w]||(_[w]=e[w].copyPickingColors()),e[w].clearPickingColor(x.pickedColor)}c=fn({pickInfo:x,lastPickedInfo:this.lastPickedInfo,mode:u,layers:e,viewports:n,x:i,y:r,deviceX:f,deviceY:p,pixelRatio:h});var S=this.callLayerPickingCallbacks(c,u);if(S&&S.forEach(function(t){return y.push(t)}),!x.pickedColor)break}return Object.keys(_).forEach(function(t){return e[t].restorePickingColors(_[t])}),{result:y,emptyInfo:c&&c.get(null)}}},{key:"pickVisibleObjects",value:function(t){var e=t.layers,n=t.viewports,i=t.x,a=t.y,o=t.width,s=t.height,u=t.mode,l=t.onViewportActive;this.updatePickingBuffer();var c=this.pixelRatio,h=Math.round(i*c),f=Math.round(this.gl.canvas.height-a*c),p=Math.round((i+o)*c),A=Math.round(this.gl.canvas.height-(a+s)*c),d={x:h,y:A,width:p-h,height:f-A},v=function(t){var e=t.pickedColors,n=t.layers,i=new Map;if(e)for(var a=0;a<e.length;a+=4){var o=e[a+3]-1;if(o>=0){var s=e.slice(a,a+4),u=s.join(",");if(!i.has(u)){var l=n[o];l?i.set(u,{pickedColor:s,pickedLayer:l,pickedObjectIndex:l.decodePickingColor(s)}):r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}({pickedColors:this.drawAndSamplePickingBuffer({layers:e,viewports:n,onViewportActive:l,deviceRect:d,redrawReason:u}),layers:e}),g=new Map;return v.forEach(function(t){var e={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:a,width:o,height:s,pixelRatio:c};e=pn({layer:t.pickedLayer,info:e,mode:u}),g.has(e.object)||g.set(e.object,e)}),Array.from(g.values())}},{key:"drawAndSamplePickingBuffer",value:function(t){var e=t.layers,n=t.viewports,i=t.onViewportActive,r=t.deviceRect,o=t.redrawReason;if(d(r),d(Number.isFinite(r.width)&&r.width>0,"`width` must be > 0"),d(Number.isFinite(r.height)&&r.height>0,"`height` must be > 0"),e.filter(function(t){return t.isPickable()}).length<1)return null;var s=this.pickingFBO;this.pickLayersPass.render({layers:e,viewports:n,onViewportActive:i,pickingFBO:s,deviceRect:r,redrawReason:o,effectProps:{lightSources:{}}});var u=r.x,l=r.y,c=r.width,h=r.height,f=new Uint8Array(c*h*4);return Object(a.readPixelsToArray)(s,{sourceX:u,sourceY:l,sourceWidth:c,sourceHeight:h,target:f}),f}},{key:"getPickingRect",value:function(t){var e=t.deviceX,n=t.deviceY,i=t.deviceRadius,r=t.deviceWidth,a=t.deviceHeight;if(!(e>=0&&n>=0&&e<r&&n<a))return null;var o=Math.max(0,e-i),s=Math.max(0,n-i);return{x:o,y:s,width:Math.min(r,e+i)-o+1,height:Math.min(a,n+i)-s+1}}},{key:"callLayerPickingCallbacks",value:function(t,e){var n=[],i=this.pickingEvent;return t.forEach(function(t){if(t.layer){var r=!1;switch(e){case"hover":r=t.layer.onHover(t,i);break;case"query":break;default:throw new Error("unknown pick type")}r||n.push(t)}}),n}}]),t}(),dn=n("ei+1");function vn(){}var gn={id:"deckgl-overlay",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,_animate:!1,onWebGLInitialized:vn,onResize:vn,onViewStateChange:vn,onBeforeRender:vn,onAfterRender:vn,onLoad:vn,_onMetrics:null,getCursor:function(t){return t.isDragging?"grabbing":"grab"},debug:!1,drawPickingColors:!1},mn=function(){function t(e){Object(T.a)(this,t),e=Object.assign({},gn,e),this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=e.initialViewState||null,this.interactiveState={isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerLeave=this._onPointerLeave.bind(this),this._pickAndCallback=this._pickAndCallback.bind(this),this._onRendererInitialized=this._onRendererInitialized.bind(this),this._onRenderFrame=this._onRenderFrame.bind(this),this._onViewStateChange=this._onViewStateChange.bind(this),this._onInteractiveStateChange=this._onInteractiveStateChange.bind(this),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new le.a({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),this.animationLoop.start()}return Object(M.a)(t,[{key:"finalize",value:function(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null),this.viewManager&&(this.viewManager.finalize(),this.viewManager=null),this.effectManager&&(this.effectManager.finalize(),this.effectManager=null),this.deckRenderer&&(this.deckRenderer.finalize(),this.deckRenderer=null),this.eventManager&&this.eventManager.destroy(),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}},{key:"setProps",value:function(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&r.removed("onLayerHover","onHover")(),"onLayerClick"in t&&r.removed("onLayerClick","onClick")(),t=Object.assign({},this.props,t),this.props=t,this._setCanvasSize(t);var e=Object.assign({},t,{views:this._getViews(this.props),width:this.width,height:this.height}),n=this._getViewState(t);n&&(e.viewState=n),this.viewManager&&this.viewManager.setProps(e),this.layerManager&&this.layerManager.setProps(e),this.effectManager&&this.effectManager.setProps(e),this.animationLoop&&this.animationLoop.setProps(e),this.deckRenderer&&this.deckRenderer.setProps(e),this.deckPicker&&this.deckPicker.setProps(e),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(this.props._animate)return"Deck._animate";var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var n=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||n||i||r||a}},{key:"redraw",value:function(t){if(this.layerManager){var e=t||this.needsRedraw({clearRedrawFlags:!0});e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}}},{key:"getViews",value:function(){return this.viewManager.views}},{key:"getViewports",value:function(t){return this.viewManager.getViewports(t)}},{key:"pickObject",value:function(t){var e=t.x,n=t.y,i=t.radius,r=void 0===i?0:i,a=t.layerIds,o=void 0===a?null:a;this.stats.get("Pick Count").incrementCount(),this.stats.get("pickObject Time").timeStart();var s=this.layerManager.getLayers({layerIds:o}),u=this.layerManager.activateViewport,l=this.deckPicker.pickObject({x:e,y:n,radius:r,layers:s,viewports:this.getViewports({x:e,y:n}),activateViewport:u,mode:"query",depth:1}).result;return this.stats.get("pickObject Time").timeEnd(),l.length?l[0]:null}},{key:"pickMultipleObjects",value:function(t){var e=t.x,n=t.y,i=t.radius,r=void 0===i?0:i,a=t.layerIds,o=void 0===a?null:a,s=t.depth,u=void 0===s?10:s;this.stats.get("Pick Count").incrementCount(),this.stats.get("pickMultipleObjects Time").timeStart();var l=this.layerManager.getLayers({layerIds:o}),c=this.layerManager.activateViewport,h=this.deckPicker.pickObject({x:e,y:n,radius:r,layers:l,viewports:this.getViewports({x:e,y:n}),activateViewport:c,mode:"query",depth:u}).result;return this.stats.get("pickMultipleObjects Time").timeEnd(),h}},{key:"pickObjects",value:function(t){var e=t.x,n=t.y,i=t.width,r=void 0===i?1:i,a=t.height,o=void 0===a?1:a,s=t.layerIds,u=void 0===s?null:s;this.stats.get("Pick Count").incrementCount(),this.stats.get("pickObjects Time").timeStart();var l=this.layerManager.getLayers({layerIds:u}),c=this.layerManager.activateViewport,h=this.deckPicker.pickObjects({x:e,y:n,width:r,height:o,layers:l,viewports:this.getViewports({x:e,y:n,width:r,height:o}),activateViewport:c});return this.stats.get("pickObjects Time").timeEnd(),h}},{key:"_createCanvas",value:function(t){var e=t.canvas;("string"==typeof e&&d(e=document.getElementById(e)),e)||(e=document.createElement("canvas"),(t.parent||document.body).appendChild(e));var n=t.id,i=t.style;return e.id=n,Object.assign(e.style,i),e}},{key:"_setCanvasSize",value:function(t){if(this.canvas){var e=t.width,n=t.height;(e||0===e)&&(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),(n||0===n)&&(n=Number.isFinite(n)?"".concat(n,"px"):n,this.canvas.style.position="absolute",this.canvas.style.height=n)}}},{key:"_updateCanvasSize",value:function(){if(this._checkForCanvasSizeChange()){var t=this.width,e=this.height;this.viewManager.setProps({width:t,height:e}),this.props.onResize({width:this.width,height:this.height})}}},{key:"_checkForCanvasSizeChange",value:function(){var t=this.canvas;if(!t)return!1;var e=t.clientWidth||t.width,n=t.clientHeight||t.height;return(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,!0)}},{key:"_createAnimationLoop",value:function(t){var e=this,n=t.width,i=t.height,r=t.gl,o=t.glOptions,s=t.debug,u=t.useDevicePixels,l=t.autoResizeDrawingBuffer;return new a.AnimationLoop({width:n,height:i,useDevicePixels:u,autoResizeDrawingBuffer:l,gl:r,onCreateContext:function(t){return Object(a.createGLContext)(Object.assign({},o,t,{canvas:e.canvas,debug:s}))},onInitialize:this._onRendererInitialized,onRender:this._onRenderFrame,onBeforeRender:t.onBeforeRender,onAfterRender:t.onAfterRender})}},{key:"_getViewState",value:function(t){return t.viewState||this.viewState}},{key:"_getViews",value:function(t){var e=t.views||[new nn({id:"default-view"})];return(e=Array.isArray(e)?e:[e]).length&&t.controller&&(e[0].props.controller=t.controller),e}},{key:"_requestPick",value:function(t){var e=t.event,n=t.callback,i=t.mode,r=this._pickRequest;if("pointerleave"===e.type)r.x=-1,r.y=-1,r.radius=0;else{var a=e.offsetCenter;if(!a)return;r.x=a.x,r.y=a.y,r.radius=this.props.pickingRadius}r.callback=n,r.event=e,r.mode=i}},{key:"_pickAndCallback",value:function(){var t=this._pickRequest;if(t.mode){var e=this.deckPicker.pickObject(Object.assign({layers:this.layerManager.getLayers(),viewports:this.getViewports(t),activateViewport:this.layerManager.activateViewport,depth:1},t)),n=e.result,i=e.emptyInfo;if(t.callback){var r=n.find(function(t){return t.index>=0})||i;t.callback(r,t.event)}t.mode=null}}},{key:"_updateCursor",value:function(){this.canvas&&(this.canvas.style.cursor=this.props.getCursor(this.interactiveState))}},{key:"_updateAnimationProps",value:function(t){this.layerManager.context.animationProps=t}},{key:"_setGLContext",value:function(t){if(!this.layerManager){for(var e in this.canvas||(this.canvas=t.canvas,Object(a.trackContextState)(t,{enable:!0,copyState:!0})),Object(a.setParameters)(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t),this.eventManager=new dn.a(t.canvas,{events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerLeave}}),f)this.eventManager.on(e,this._onEvent);this.viewManager=new ke({eventManager:this.eventManager,onViewStateChange:this._onViewStateChange,onInteractiveStateChange:this._onInteractiveStateChange,views:this._getViews(this.props),viewState:this._getViewState(this.props),width:this.width,height:this.height}),d(this.viewManager);var n=this.viewManager.getViewports()[0];this.layerManager=new ye(t,{deck:this,stats:this.stats,viewport:n}),this.effectManager=new rn,this.deckRenderer=new ln(t),this.deckPicker=new An(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(t,e){var n=this.layerManager.context.gl;Object(a.setParameters)(n,this.props.parameters),this.props.onBeforeRender({gl:n});var i=this.layerManager.getLayers(),r=this.layerManager.activateViewport;this.deckRenderer.renderLayers(Object.assign({layers:i,viewports:this.viewManager.getViewports(),activateViewport:r,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects()},e)),this.props.onAfterRender({gl:n})}},{key:"_onRendererInitialized",value:function(t){var e=t.gl;this._setGLContext(e)}},{key:"_onRenderFrame",value:function(t){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),r.table(3,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(t),this._updateAnimationProps(t),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates(t)}},{key:"_onViewStateChange",value:function(t){var e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState[t.viewId]=e,this.viewManager.setProps({viewState:e}))}},{key:"_onInteractiveStateChange",value:function(t){var e=t.isDragging,n=void 0!==e&&e;n!==this.interactiveState.isDragging&&(this.interactiveState.isDragging=n)}},{key:"_onEvent",value:function(t){var e=f[t.type],n=t.offsetCenter;if(e&&n){var i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),a=r.layer,o=a&&(a[e.handler]||a.props[e.handler]),s=this.props[e.handler],u=!1;o&&(u=o.call(a,r,t)),!u&&s&&s(r,t)}}},{key:"_onPointerDown",value:function(t){var e=t.offsetCenter;this._lastPointerDownInfo=this.pickObject({x:e.x,y:e.y})}},{key:"_onPointerMove",value:function(t){t.leftButton||t.rightButton||this._requestPick({callback:this.props.onHover,event:t,mode:"hover"})}},{key:"_onPointerLeave",value:function(t){this._requestPick({callback:this.props.onHover,event:t,mode:"hover"})}},{key:"_getFrameStats",value:function(){this.stats.get("frameRate").timeEnd(),this.stats.get("frameRate").timeStart();var t=this.animationLoop.stats;this.stats.get("GPU Time").addTime(t.get("GPU Time").lastTiming),this.stats.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){this.metrics.fps=this.stats.get("frameRate").getHz(),this.metrics.setPropsTime=this.stats.get("setProps Time").time,this.metrics.updateAttributesTime=this.stats.get("Update Attributes").time,this.metrics.framesRedrawn=this.stats.get("Redraw Count").count,this.metrics.pickTime=this.stats.get("pickObject Time").time+this.stats.get("pickMultipleObjects Time").time+this.stats.get("pickObjects Time").time,this.metrics.pickCount=this.stats.get("Pick Count").count,this.metrics.gpuTime=this.stats.get("GPU Time").time,this.metrics.cpuTime=this.stats.get("CPU Time").time,this.metrics.gpuTimePerFrame=this.stats.get("GPU Time").getAverageTime(),this.metrics.cpuTimePerFrame=this.stats.get("CPU Time").getAverageTime();var t=a.lumaStats.get("Memory Usage");this.metrics.bufferMemory=t.get("Buffer Memory").count,this.metrics.textureMemory=t.get("Texture Memory").count,this.metrics.renderbufferMemory=t.get("Renderbuffer Memory").count,this.metrics.gpuMemory=t.get("GPU Memory").count}}]),t}();mn.getPropTypes=function(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(D)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.bool,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,debug:t.bool,drawPickingColors:t.bool,_animate:t.bool}},mn.defaultProps=gn;var yn=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(t){Object(it.a)(Object(L.a)(e.prototype),"setState",this).call(this,t),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(t){return t.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(t,e){var n=this.props._subLayerProps;return e&&e.length||n&&n[t]}},{key:"getSubLayerClass",value:function(t,e){var n=this.props._subLayerProps;return n&&n[t]&&n[t].type||e}},{key:"getSubLayerProps",value:function(t){var e=this.props,n=e.opacity,i=e.pickable,r=e.visible,a=e.parameters,o=e.getPolygonOffset,s=e.highlightedObjectIndex,u=e.autoHighlight,l=e.highlightColor,c=e.coordinateSystem,h=e.coordinateOrigin,f=e.wrapLongitude,p=e.positionFormat,A=e.modelMatrix,d=e._subLayerProps,v={opacity:n,pickable:i,visible:r,parameters:a,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:u,highlightColor:l,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:f,positionFormat:p,modelMatrix:A};return t&&Object.assign(v,t,d&&d[t.id],{id:"".concat(this.props.id,"-").concat(t.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},t.updateTriggers)}),v}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var t=this.internalState.subLayers;t&&!this.needsUpdate()?r.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(t=st(t=this.renderLayers(),{filter:Boolean}),this.internalState.subLayers=t,r.log(2,"Composite layer rendered new subLayers ".concat(this),t)());var e=!0,n=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.parent=this}}catch(s){n=!0,i=s}finally{try{e||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"isComposite",get:function(){return!0}}]),e}(ue);yn.layerName="CompositeLayer";function _n(t,e){return Number.isFinite(t)?t:e}var bn=function(t){function e(t){var n,i=t.width,r=t.height,a=t.position,o=t.bearing,s=t.pitch,u=t.longitude,l=t.latitude,c=t.zoom,h=(t.syncBearing,t.bounds,t.startPanEventPosition),f=t.startPanPosition,p=t.startRotateCenter,A=t.startRotateViewport,d=t.startZoomPos,v=t.startZoom;return Object(T.a)(this,e),(n=Object(j.a)(this,Object(L.a)(e).call(this,{width:i,height:r,position:a,bearing:o,pitch:s,longitude:u,latitude:l,zoom:c})))._interactiveState={startPanEventPosition:h,startPanPosition:f,startRotateCenter:p,startRotateViewport:A,startZoomPos:d,startZoom:v},n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,n=this._viewportProps,i=n.translationX,r=n.translationY;return this._getUpdatedState({startPanPosition:[i,r],startPanEventPosition:e})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,i=this._interactiveState.startPanEventPosition||n;if(!i)return this;var r=this._interactiveState.startPanPosition||[],a=Object(N.a)(r,2),o=a[0],s=a[1];o=_n(o,this._viewportProps.translationX),s=_n(s,this._viewportProps.translationY);var u=e[0]-i[0],l=e[1]-i[1];return this._getUpdatedState({translationX:o+u,translationY:s-l})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null,startPanPos:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startRotateCenter:this._viewportProps.position,startRotateViewport:this._viewportProps})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY;if(!this._interactiveState.startRotateCenter)return this;var i=this._viewportProps,r=i.bearing,a=i.pitch;return this._getUpdatedState({bearing:r+10*e,pitch:a-10*n})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotateCenter:null,startRotateViewport:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomPos:e,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,i=t.scale,r=this._viewportProps,a=r.zoom,o=r.minZoom,s=r.maxZoom,u=r.width,l=r.height,c=(r.translationX,r.translationY,this._interactiveState.startZoomPos||n||e),h=Object(ce.b)(a*i,o,s);e[0],c[0],e[1],c[1],c[0],c[1];return h/a<1?this.moveBackward():this.moveForward()}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPos:null,startZoom:null})}},{key:"moveLeft",value:function(){var t=this._viewportProps.bearing-2;return this._getUpdatedState({bearing:t})}},{key:"moveRight",value:function(){var t=this._viewportProps.bearing+2;return this._getUpdatedState({bearing:t})}},{key:"moveForward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),n=new fe.a(e).normalize().scale(1);return this._getUpdatedState({position:new fe.a(t).add(n)})}},{key:"moveBackward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),n=new fe.a(e).normalize().scale(-1);return this._getUpdatedState({position:new fe.a(t).add(n)})}},{key:"moveUp",value:function(){var t=this._viewportProps.position;return this._getUpdatedState({position:new fe.a(t).add([0,0,1])})}},{key:"moveDown",value:function(){var t=this._viewportProps.position,e=t[2]>=1?[0,0,-1]:[0,0,0];return this._getUpdatedState({position:new fe.a(t).add(e)})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom+.2})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom-.2})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}}]),e}(Ze),xn=function(t){function e(t){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).call(this,bn,t))}return Object(I.a)(e,t),e}(Ge);var wn=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"_getViewport",value:function(t){var e=t.viewState,n=e.modelMatrix,i=void 0===n?null:n,r=e.bearing,a=e.up,o=void 0===a?[0,0,1]:a,s=function(t){var e=t.bearing,n=t.pitch;return new He({bearing:e,pitch:n}).toVector3().normalize()}({bearing:r,pitch:89}),u=i?i.transformDirection(s):s,l=(new he.a).lookAt({eye:[0,0,0],center:u,up:o});return new ve(Object.assign({},t,{zoom:null,viewMatrix:l}))}},{key:"controller",get:function(){return this._getControllerProps({type:xn})}}]),e}(Se);wn.displayName="FirstPersonView";var Sn=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"_getViewport",value:function(t){var e=t.viewState,n=e.bearing,i=e.pitch,r=e.position,a=e.up,o=50*e.zoom,s=function(t){var e=t.bearing,n=t.pitch;return new He({bearing:e,pitch:n}).toVector3().normalize()}({bearing:n,pitch:i}).scale(-o).multiply(new fe.a(1,1,-1)),u=(new he.a).multiplyRight((new he.a).lookAt({eye:s,center:r,up:a}));return new ve(Object.assign({},t,{id:this.id,zoom:null,viewMatrix:u}))}}]),e}(Se);Sn.displayName="ThirdPersonView";var kn=n("S4Ro"),On={orbitAxis:"Z",rotationX:0,rotationOrbit:0,fovy:50,zoom:0,target:[0,0,0],minZoom:-1/0,maxZoom:1/0},Pn={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new je(["target","zoom","rotationX","rotationOrbit"]),transitionInterruption:Ie.BREAK},En=function(t){return Math.pow(2,t)},Cn=function(t){function e(t){var n,i=t.ViewportType,r=t.width,a=t.height,o=t.orbitAxis,s=void 0===o?On.orbitAxis:o,u=t.rotationX,l=void 0===u?On.rotationX:u,c=t.rotationOrbit,h=void 0===c?On.rotationOrbit:c,f=t.target,p=void 0===f?On.target:f,A=t.zoom,d=void 0===A?On.zoom:A,v=t.fovy,g=void 0===v?On.fovy:v,m=t.minZoom,y=void 0===m?On.minZoom:m,_=t.maxZoom,b=void 0===_?On.maxZoom:_,x=t.startPanPosition,w=t.startTarget,S=t.startRotationX,k=t.startRotationOrbit,O=t.startZoomPosition,P=t.startZoom;return Object(T.a)(this,e),(n=Object(j.a)(this,Object(L.a)(e).call(this,{width:r,height:a,orbitAxis:s,rotationX:l,rotationOrbit:h,target:p,fovy:g,zoom:d,minZoom:y,maxZoom:b})))._interactiveState={startPanPosition:x,startTarget:w,startRotationX:S,startRotationOrbit:k,startZoomPosition:O,startZoom:P},n.ViewportType=i,n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,n=this._viewportProps.target;return this._getUpdatedState({startPanPosition:e,startTarget:n})}},{key:"pan",value:function(t){var e=t.pos,n=(t.startPos,this._interactiveState),i=n.startPanPosition,r=n.startTarget,a=new kn.a(e).subtract(i);return this._getUpdatedState({target:this._calculateNewTarget({startTarget:r,pixelOffset:a})})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null,startTarget:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startRotationX:this._viewportProps.rotationX,startRotationOrbit:this._viewportProps.rotationOrbit})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY,i=this._interactiveState,r=i.startRotationX,a=i.startRotationOrbit;if(!Number.isFinite(r)||!Number.isFinite(a))return this;var o=Object(ce.b)(r+180*n,-89.999,89.999),s=(a+180*e)%360;return this._getUpdatedState({rotationX:o,rotationOrbit:s,isRotating:!0})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(t){return Object.assign({},this._viewportProps)}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomPosition:e,startTarget:this._viewportProps.target,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,i=t.scale,r=this._viewportProps,a=r.zoom,o=r.width,s=r.height,u=r.target,l=this._interactiveState,c=l.startZoom,h=l.startZoomPosition,f=l.startTarget;Number.isFinite(c)||(c=a,f=u,h=n||e);var p=this._calculateNewZoom({scale:i,startZoom:c}),A=En(c),d=En(p),v=(o/2-h[0])*(d/A-1),g=(s/2-h[1])*(d/A-1);return this._getUpdatedState({zoom:p,target:this._calculateNewTarget({startTarget:f,zoom:p,pixelOffset:[v,g]})})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startTarget:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:2})})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:.5})})}},{key:"moveLeft",value:function(){var t=[-50,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveRight",value:function(){var t=[50,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveUp",value:function(){var t=[0,-50];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveDown",value:function(){var t=[0,50];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"rotateLeft",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX-10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX+10})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,n=t.startZoom,i=this._viewportProps,r=i.maxZoom,a=i.minZoom;Number.isFinite(n)||(n=this._viewportProps.zoom);var o=n+Math.log2(e);return Object(ce.b)(o,a,r)}},{key:"_calculateNewTarget",value:function(t){var e=t.startTarget,n=t.zoom,i=t.pixelOffset,r=Object.assign({},this._viewportProps);Number.isFinite(n)&&(r.zoom=n),e&&(r.target=e);var a=new this.ViewportType(r),o=a.project(r.target);return a.unproject([o[0]-i[0],o[1]-i[1],o[2]])}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,i=t.zoom;return t.zoom=i>e?e:i,t.zoom=i<n?n:i,t}}]),e}(Ze),Tn=function(t){function e(t){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).call(this,Cn,t))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"_getTransitionProps",value:function(){return Pn}}]),e}(Ge),Mn=Math.PI/180;function jn(t){var e=t.height,n=t.fovy,i=t.orbitAxis,r=t.rotationX,a=t.rotationOrbit,o=(t.zoom,.5/Math.tan(n*Mn/2)),s=(new he.a).lookAt({eye:[0,0,o]});s.rotateX(r*Mn),"Z"===i?s.rotateZ(a*Mn):s.rotateY(a*Mn);var u=1/(e||1);return s.scale([u,u,u]),s}var Ln=function(t){function e(t){Object(T.a)(this,e);var n=t.id,i=t.x,r=t.y,a=t.width,o=t.height,s=t.fovy,u=void 0===s?50:s,l=t.near,c=t.far,h=t.orbitAxis,f=void 0===h?"Z":h,p=t.target,A=void 0===p?[0,0,0]:p,d=t.rotationX,v=void 0===d?0:d,g=t.rotationOrbit,m=void 0===g?0:g,y=t.zoom,_=void 0===y?0:y;return Object(j.a)(this,Object(L.a)(e).call(this,{id:n,viewMatrix:jn({height:o,fovy:u,orbitAxis:f,rotationX:v,rotationOrbit:m,zoom:_}),fovy:u,near:l,far:c,x:i,y:r,position:A,width:a,height:o,zoom:_}))}return Object(I.a)(e,t),e}(ve),In=function(t){function e(t){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).call(this,Object.assign({},t,{type:Ln})))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:Tn,ViewportType:Ln})}}]),e}(Se);In.displayName="OrbitView";var zn=Math.PI/180,Dn=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"_getViewport",value:function(t){var e=t.x,n=t.y,i=t.width,r=t.height,a=t.viewState,o=a.eye,s=a.lookAt,u=void 0===s?[0,0,0]:s,c=a.up,h=void 0===c?[0,1,0]:c,f=t.fovy||a.fovy||75,p=t.near||a.near||1,A=t.far||a.far||100,d=Number.isFinite(a.aspect)?a.aspect:i/r,v=f*zn;return new ve({id:this.id,x:e,y:n,width:i,height:r,viewMatrix:l.f([],o,u,h),projectionMatrix:l.i([],v,d,p,A)})}}]),e}(Se);Dn.displayName="PerspectiveView";var Bn={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new je(["target","zoom"]),transitionInterruption:Ie.BREAK},Rn=function(t){function e(t){var n;return Object(T.a)(this,e),(n=Object(j.a)(this,Object(L.a)(e).call(this,Cn,t))).invertPan=!0,n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"_onPanRotate",value:function(t){return!1}},{key:"_getTransitionProps",value:function(){return Bn}}]),e}(Ge),Fn=(new he.a).lookAt({eye:[0,0,1]});function Nn(t){var e=t.width,n=t.height,i=t.near,r=t.far;return e=e||1,n=n||1,(new he.a).ortho({left:-e/2,right:e/2,bottom:n/2,top:-n/2,near:i,far:r})}var Un=function(t){function e(t){var n=t.id,i=t.x,r=t.y,a=t.width,o=t.height,s=t.near,u=void 0===s?.1:s,l=t.far,c=void 0===l?1e3:l,h=t.zoom,f=void 0===h?0:h,p=t.target,A=void 0===p?[0,0,0]:p;return Object(T.a)(this,e),Object(j.a)(void 0,new ve({id:n,x:i,y:r,width:a,height:o,position:A,viewMatrix:Fn,projectionMatrix:Nn({width:a,height:o,near:u,far:c}),zoom:f}))}return Object(I.a)(e,t),e}(ve),Vn=function(t){function e(t){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).call(this,Object.assign({},t,{type:Un})))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:Rn,ViewportType:Un})}}]),e}(Se);Vn.displayName="OrthographicView";var Gn=n("O7G5"),Wn=["bearing","pitch"],Hn=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).call(this,{compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"interpolateProps",value:function(t,e,n){for(var i=Object(Gn.a)(t,e,n),r=0;r<Wn.length;r++){var a=Wn[r];i[a]=Object(ce.g)(t[a]||0,e[a]||0,n)}return i}}]),e}(Te),qn=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).overAlloc,n=void 0===e?1:e;Object(T.a)(this,t),this.overAlloc=n}return Object(M.a)(t,[{key:"allocate",value:function(t,e,n){var i=n.size,r=n.type,a=n.copy,o=void 0!==a&&a,s=e*i;if(t&&s<=t.length)return t;var u=Math.max(Math.ceil(s*this.overAlloc),1),l=this._allocate(r,u);return t&&o&&l.set(t),this._release(t),l}},{key:"_allocate",value:function(){return new(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Float32Array)(arguments.length>1?arguments[1]:void 0)}},{key:"_release",value:function(t){}}]),t}(),Zn={Tesselator:function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(T.a)(this,t);var n=e.attributes,i=void 0===n?{}:n;this.typedArrayManager=new qn,this.indexLayout=null,this.bufferLayout=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=i,this.updateGeometry(e),Object.seal(this)}return Object(M.a)(t,[{key:"updateGeometry",value:function(t){var e=t.data,n=t.getGeometry,i=t.positionFormat,r=t.fp64;this.data=e,this.getGeometry=n,this.fp64=r,this.positionSize="XY"===i?2:3,this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(t){var e=t.startRow,n=t.endRow;this._rebuildGeometry({startRow:e,endRow:n})}},{key:"updateGeometryAttributes",value:function(t,e,n){throw new Error("Not implemented")}},{key:"getGeometrySize",value:function(t){throw new Error("Not implemented")}},{key:"_forEachGeometry",value:function(t,e,n){var i=this.data,r=this.getGeometry,a=ot(i,e,n),o=a.iterable,s=a.objectInfo,u=!0,l=!1,c=void 0;try{for(var h,f=o[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;s.index++,t(r(p,s),s.index)}}catch(A){l=!0,c=A}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}}},{key:"_rebuildGeometry",value:function(t){var e=this;if(this.data&&this.getGeometry){var n=this.indexLayout,i=this.bufferLayout;t||(n=[],i=[]);var r=t||{},a=r.startRow,o=void 0===a?0:a,s=r.endRow,u=void 0===s?1/0:s;this._forEachGeometry(function(t,n){i[n]=e.getGeometrySize(t)},o,u);var l=0,c=!0,h=!1,f=void 0;try{for(var p,A=i[Symbol.iterator]();!(c=(p=A.next()).done);c=!0){l+=p.value}}catch(k){h=!0,f=k}finally{try{c||null==A.return||A.return()}finally{if(h)throw f}}var d=this.attributes,v=this._attributeDefs,g=this.typedArrayManager,m=this.fp64;for(var y in v){var _=v[y];_.copy=Boolean(t),_.fp64Only&&!m||(d[y]=g.allocate(d[y],l,_))}this.indexLayout=n,this.bufferLayout=i,this.instanceCount=l;for(var b={vertexStart:0,indexStart:0},x=0;x<o;x++)b.vertexStart+=i[x],b.indexStart+=n[x]||0;this._forEachGeometry(function(t,r){var a=i[r];b.geometryIndex=r,b.geometrySize=a,e.updateGeometryAttributes(t,b),b.vertexStart+=a,b.indexStart+=n[r]||0},o,u);for(var w=b.indexStart,S=u;S<n.length;S++)w+=n[S];this.vertexCount=w}}}]),t}(),flattenVertices:function t(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.result,r=void 0===i?[]:i,a=n.dimensions,o=void 0===a?3:a,s=-1,u=0;++s<e.length;){var l=e[s];Array.isArray(l)||ArrayBuffer.isView(l)?t(l,{result:r,dimensions:o}):u<o&&(r.push(l),u++)}return u>0&&u<o&&r.push(0),r},fillArray:ut,count:Ut,memoize:A},Xn=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function Qn(t,e,n){var i=new e(4*t.length);return t.forEach(function(t,e){var r=4*e;i[r]=t[0],i[r+1]=t[1],i[r+2]=t[2],i[r+3]=Number.isFinite(t[3])?t[3]:n}),i}var Yn,Kn=n("rePB"),Jn={SUM:1,MEAN:2,MIN:3,MAX:4};function $n(t,e){return t+e}function ti(t,e){return e>t?e:t}function ei(t,e){return e<t?e:t}function ni(t,e){switch(Jn[t.toUpperCase()]||Jn.SUM){case Jn.MIN:return function(t){return function(t,e){var n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(ei,1/0):null}(t,e)};case Jn.SUM:return function(t){return function(t,e){var n=t.map(e).filter(Number.isFinite);return n.length?n.reduce($n,0):null}(t,e)};case Jn.MEAN:return function(t){return function(t,e){var n=t.map(e).filter(Number.isFinite);return n.length?n.reduce($n,0)/n.length:null}(t,e)};case Jn.MAX:return function(t){return function(t,e){var n=t.map(e).filter(Number.isFinite);return n.length?n.reduce(ti,-1/0):null}(t,e)};default:return null}}var ii={dataChanged:!0,viewportChanged:!0,cellSizeChanged:!0},ri={changeFlags:ii,projectPoints:!1,useGPU:!0,fp64:!1,viewport:null,gridTransformMatrix:null,createBufferObjects:!0},ai=[32775,32774],oi=[32776,32774],si=[32776,32775],ui=(Yn={},Object(Kn.a)(Yn,Jn.SUM,32774),Object(Kn.a)(Yn,Jn.MEAN,32774),Object(Kn.a)(Yn,Jn.MIN,ai),Object(Kn.a)(Yn,Jn.MAX,oi),Yn),li={size:1,operation:Jn.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},ci=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function hi(t,e){var n,i=e.width,r=void 0===i?1:i,o=e.height,s=void 0===o?1:o;return new a.Texture2D(t,{data:null,format:34836,type:5126,border:0,mipmaps:!1,parameters:(n={},Object(Kn.a)(n,10240,9728),Object(Kn.a)(n,10241,9728),n),dataFormat:6408,width:r,height:s})}function fi(t,e){var n=e.id,i=e.width,r=void 0===i?1:i,o=e.height,s=void 0===o?1:o,u=e.texture;return new a.Framebuffer(t,{id:n,width:r,height:s,attachments:Object(Kn.a)({},36064,u)})}function pi(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!t||t.length<e?new Float32Array(e).fill(n):t}var Ai=a.fp64.fp64ifyMatrix4,di=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],vi={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},gi=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(T.a)(this,t),this.id=n.id||"gpu-grid-aggregator",this.shaderCache=n.shaderCache||null,this.gl=e,this.state={weights:null,gridPositions:null,positionsBuffer:null,positions64xyLowBuffer:null,vertexCount:0,fp64:null,useGPU:null,numCol:0,numRow:0,windowSize:null,cellSize:null,weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(a.isWebGL2)(e)&&Object(a.hasFeatures)(this.gl,a.FEATURES.BLEND_EQUATION_MINMAX,a.FEATURES.COLOR_ATTACHMENT_RGBA32F,a.FEATURES.TEXTURE_FLOAT)}return Object(M.a)(t,null,[{key:"getAggregationData",value:function(t){var e=t.aggregationData,n=t.maxData,i=t.minData,r=t.maxMinData,a=4*t.pixelIndex,o={};return e&&(o.cellCount=e[a+3],o.cellWeight=e[a]),r?(o.maxCellWieght=r[0],o.minCellWeight=r[3]):(n&&(o.maxCellWieght=n[0],o.totalCount=n[3]),i&&(o.minCellWeight=i[0],o.totalCount=n[3])),o}},{key:"getCellData",value:function(t){for(var e=t.countsData,n=t.size,i=void 0===n?1:n,r=e.length/4,a=new Float32Array(r*i),o=new Uint32Array(r),s=0;s<r;s++){for(var u=0;u<i;u++)a[s*i+u]=e[4*s+u];o[s]=e[4*s+3]}return{cellCounts:o,cellWeights:a}}},{key:"isSupported",value:function(t){return Object(a.isWebGL2)(t)&&Object(a.hasFeatures)(t,a.FEATURES.BLEND_EQUATION_MINMAX,a.FEATURES.COLOR_ATTACHMENT_RGBA32F,a.FEATURES.TEXTURE_FLOAT)}}]),Object(M.a)(t,[{key:"delete",value:function(){var t=this.gridAggregationModel,e=this.allAggregationModel,n=this.meanTransform,i=this.state,r=i.positionsBuffer,a=i.positions64xyLowBuffer,o=i.textures,s=i.framebuffers,u=i.maxMinFramebuffers,l=i.minFramebuffers,c=i.maxFramebuffers,h=i.meanTextures,f=i.resources;t&&t.delete(),e&&e.delete(),n&&n.delete(),r&&r.delete(),a&&a.delete(),this.deleteResources([s,o,u,l,c,h,f])}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({results:{}});var e=this.getAggregationParams(t);this.updateGridSize(e);var n=e.useGPU;return this._hasGPUSupport&&n?this.runAggregationOnGPU(e):(n&&r.info("GPUGridAggregator: GPU Aggregation not supported, falling back to CPU")(),this.runAggregationOnCPU(e))}},{key:"getData",value:function(t){var e={},n=this.state.results;for(var i in n[t].aggregationData||(n[t].aggregationData=n[t].aggregationBuffer.getData()),e.aggregationData=n[t].aggregationData,vi){var r=vi[i];(n[t][i]||n[t][r])&&(n[t][i]=n[t][i]||n[t][r].getData(),e[i]=n[t][i])}return e}},{key:"deleteResources",value:function(t){(t=Array.isArray(t)?t:[t]).forEach(function(t){for(var e in t)t[e].delete()})}},{key:"getAggregationParams",value:function(t){var e=Object.assign({},ri,t),n=e.useGPU,i=e.gridTransformMatrix,r=e.viewport,a=e.weights,o=e.projectPoints,s=e.cellSize;return this.state.useGPU!==n&&(e.changeFlags=Object.assign({},e.changeFlags,ii)),!s||this.state.cellSize&&this.state.cellSize[0]===s[0]&&this.state.cellSize[1]===s[1]||(e.changeFlags.cellSizeChanged=!0,this.setState({cellSize:s})),this.validateProps(e,t),this.setState({useGPU:n}),e.gridTransformMatrix=(o?r.viewportMatrix:i)||ci,a&&(e.weights=this.normalizeWeightParams(a),this.setState({weights:e.weights})),e}},{key:"normalizeWeightParams",value:function(t){var e={};for(var n in t)e[n]=Object.assign({},li,t[n]);return e}},{key:"setState",value:function(t){Object.assign(this.state,t)}},{key:"shouldTransformToGrid",value:function(t){var e=t.projectPoints,n=t.changeFlags;return!!(!this.state.gridPositions||n.dataChanged||e&&n.viewportChanged)}},{key:"updateGridSize",value:function(t){var e=t.viewport,n=t.cellSize,i=t.width||e.width,r=t.height||e.height,a=Math.ceil(i/n[0]),o=Math.ceil(r/n[1]);this.setState({numCol:a,numRow:o,windowSize:[i,r]})}},{key:"validateProps",value:function(t,e){var n=t.changeFlags,i=t.projectPoints,a=t.gridTransformMatrix;r.assert(n.dataChanged||n.viewportChanged||n.cellSizeChanged),r.assert(!n.dataChanged||e.positions&&e.weights&&(!e.projectPositions||e.viewport)&&e.cellSize),r.assert(!n.cellSizeChanged||e.cellSize),r.assert(!(n.viewportChanged&&i)||e.viewport),i&&a&&r.warn("projectPoints is true, gridTransformMatrix is ignored")()}},{key:"calculateAggregationData",value:function(t){var e=t.weights,n=t.results,i=t.cellIndex,a=t.posIndex;for(var o in e){for(var s=e[o],u=s.values,l=s.size,c=s.operation,h=n[o].aggregationData,f=0;f<l;f++){var p=i+f,A=u[3*a+f];if(0===h[i+3])h[p]=A;else switch(c){case Jn.SUM:case Jn.MEAN:h[p]+=A;break;case Jn.MIN:h[p]=Math.min(h[p],A);break;case Jn.MAX:h[p]=Math.max(h[p],A);break;default:r.assert(!1)}}h[i+3]++}}},{key:"calculateMeanMaxMinData",value:function(t){var e=t.validCellIndices,n=t.results,i=t.weights;e.forEach(function(t){for(var e in n){for(var r=i[e],a=r.size,o=r.needMin,s=r.needMax,u=r.operation,l=n[e],c=l.aggregationData,h=l.minData,f=l.maxData,p=l.maxMinData,A=o||s,d=u===Jn.MEAN,v=o&&s&&i[e].combineMaxMin,g=c[t+4-1],m=0;m<a&&(A||d);m++){var y=t+m,_=c[y];d&&(c[y]/=g,_=c[y]),v?p[m]=Math.max(p[m],_):(o&&(h[m]=Math.min(h[m],_)),s&&(f[m]=Math.max(f[m],_)))}v?p[3]=Math.min(p[3],c[t+0]):(o&&(h[3]+=g),s&&(f[3]+=g))}})}},{key:"initCPUResults",value:function(t){var e=t.weights||this.state.weights,n=this.state,i=n.numCol,r=n.numRow,a={};for(var o in e){var s=e[o],u=s.aggregationData,l=s.minData,c=s.maxData,h=s.maxMinData,f=e[o],p=f.needMin,A=f.needMax,d=p&&A&&e[o].combineMaxMin;u=pi(u,i*r*4),d?((h=pi(h,4)).fill(-1/0,0,3),h[3]=1/0):(p&&((l=pi(l,4,1/0))[3]=0),A&&((c=pi(c,4,-1/0))[3]=0)),a[o]=Object.assign({},e[o],{aggregationData:u,minData:l,maxData:c,maxMinData:h})}return a}},{key:"runAggregationOnCPU",value:function(t){var e,n,i=t.positions,a=t.cellSize,o=t.gridTransformMatrix,s=t.viewport,u=t.projectPoints,l=t.weights,c=this.state,h=c.numCol,f=c.numRow,p=this.initCPUResults(t),A=this.shouldTransformToGrid(t),d=[0,0,0];r.assert(A||t.changeFlags.cellSizeChanged),A?(n=i.length/2,e=new Float64Array(i.length),this.setState({gridPositions:e})):(e=this.state.gridPositions,l=this.state.weights,n=e.length/2);for(var v=new Set,g=0;g<n;g++){var m=void 0,y=void 0;if(A){if(d[0]=i[2*g],d[1]=i[2*g+1],u){var _=s.project(d),b=Object(N.a)(_,2);m=b[0],y=b[1]}else{var x=Object(V.k)(d,o),w=Object(N.a)(x,2);m=w[0],y=w[1]}e[2*g]=m,e[2*g+1]=y}else m=e[2*g],y=e[2*g+1];var S=Math.floor(m/a[0]),k=Math.floor(y/a[1]);if(S>=0&&S<h&&k>=0&&k<f){var O=4*(S+k*h);v.add(O),this.calculateAggregationData({weights:l,results:p,cellIndex:O,posIndex:g})}}return this.calculateMeanMaxMinData({validCellIndices:v,results:p,weights:l}),this.updateAggregationBuffers(t,p),this.setState({results:p}),p}},{key:"updateCPUResultBuffer",value:function(t){var e=t.gl,n=t.bufferName,i=t.id,r=t.data,o=t.result,s=this.state.resources,u="cpu-result-".concat(i,"-").concat(n);o[n]=o[n]||s[u],o[n]?o[n].setData({data:r}):(s[u]=new a.Buffer(e,r),o[n]=s[u])}},{key:"updateAggregationBuffers",value:function(t,e){if(t.createBufferObjects){var n=t.weights||this.state.weights;for(var i in e){var r=e[i],a=r.aggregationData,o=r.minData,s=r.maxData,u=r.maxMinData,l=n[i],c=l.needMin,h=l.needMax,f=c&&h&&n[i].combineMaxMin;this.updateCPUResultBuffer({gl:this.gl,bufferName:"aggregationBuffer",id:i,data:a,result:e[i]}),f?this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxMinBuffer",id:i,data:u,result:e[i]}):(c&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"minBuffer",id:i,data:o,result:e[i]}),h&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxBuffer",id:i,data:s,result:e[i]}))}}}},{key:"getAggregateData",value:function(t){var e={},n=this.state,i=n.textures,r=n.framebuffers,o=n.maxMinFramebuffers,s=n.minFramebuffers,u=n.maxFramebuffers,l=n.weights;for(var c in l){e[c]={};var h=l[c],f=h.needMin,p=h.needMax,A=h.combineMaxMin;e[c].aggregationTexture=i[c],e[c].aggregationBuffer=Object(a.readPixelsToBuffer)(r[c],{target:l[c].aggregationBuffer,sourceType:5126}),f&&p&&A?e[c].maxMinBuffer=Object(a.readPixelsToBuffer)(o[c],{target:l[c].maxMinBuffer,sourceType:5126}):(f&&(e[c].minBuffer=Object(a.readPixelsToBuffer)(s[c],{target:l[c].minBuffer,sourceType:5126})),p&&(e[c].maxBuffer=Object(a.readPixelsToBuffer)(u[c],{target:l[c].maxBuffer,sourceType:5126})))}return this.trackGPUResultBuffers(e,l),e}},{key:"getAggregationModel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.gl,n=this.shaderCache;return new a.Model(e,{id:"Gird-Aggregation-Model",vs:t?"#define SHADER_NAME gpu-aggregation-to-grid-vs-64\n\nattribute vec2 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform vec2 uProjectionMatrixFP64[16];\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvoid project_to_pixel(vec2 pos, vec2 pos64xyLow, out vec2 pixelXY64[2]) {\n\n  vec2 result64[4];\n  vec2 position64[4];\n  position64[0] = vec2(pos.x, pos64xyLow.x);\n  position64[1] = vec2(pos.y, pos64xyLow.y);\n  position64[2] = vec2(0., 0.);\n  position64[3] = vec2(1., 0.);\n  mat4_vec4_mul_fp64(uProjectionMatrixFP64, position64,\n  result64);\n\n  pixelXY64[0] = div_fp64(result64[0], result64[3]);\n  pixelXY64[1] = div_fp64(result64[1], result64[3]);\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec2 windowPos = positions;\n  vec2 windowPos64xyLow = positions64xyLow;\n  if (projectPoints) {\n    vec2 projectedXY[2];\n    project_position_fp64(windowPos, windowPos64xyLow, projectedXY);\n    windowPos.x = projectedXY[0].x;\n    windowPos.y = projectedXY[1].x;\n    windowPos64xyLow.x = projectedXY[0].y;\n    windowPos64xyLow.y = projectedXY[1].y;\n  }\n\n  vec2 pixelXY64[2];\n  project_to_pixel(windowPos, windowPos64xyLow, pixelXY64);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  vec2 pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n":"#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec2 positions;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform mat4 uProjectionMatrix;\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result =  uProjectionMatrix * pos;\n  return result.xy/result.w;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 0, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(vec3(positions, 0), vec2(0, 0), vec3(0, 0, 0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n  pos = floor(pos / cellSize);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",fs:"#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n}\n",modules:t?["fp64","project64"]:["project32"],shaderCache:n,vertexCount:0,drawMode:0})}},{key:"getAllAggregationModel",value:function(){var t=this.gl,e=this.shaderCache,n=this.state,i=n.numCol,r=n.numRow;return new a.Model(t,{id:"All-Aggregation-Model",vs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",modules:["fp64"],shaderCache:e,vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:i*r,attributes:{position:[0,0]}})}},{key:"getMeanTransform",value:function(t){return this.meanTransform?this.meanTransform.update(t):this.meanTransform=new a.Transform(this.gl,Object.assign({},{vs:"#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n}\n",_targetTextureVarying:"meanValues"},t)),this.meanTransform}},{key:"renderAggregateData",value:function(t){var e=t.cellSize,n=t.viewport,i=t.gridTransformMatrix,r=t.projectPoints,a=this.state,o=a.numCol,s=a.numRow,u=a.windowSize,l=a.maxMinFramebuffers,c=a.minFramebuffers,h=a.maxFramebuffers,f=a.weights,p=[o,s],A={blend:!0,depthTest:!1,blendFunc:[1,1]},d={viewport:n},v={windowSize:u,cellSize:e,gridSize:p,uProjectionMatrix:i,uProjectionMatrixFP64:Ai(i),projectPoints:r};for(var g in f){var m=f[g],y=m.needMin,_=m.needMax,b=y&&_&&f[g].combineMaxMin;this.renderToWeightsTexture({id:g,parameters:A,moduleSettings:d,uniforms:v,gridSize:p}),b?this.renderToMaxMinTexture({id:g,parameters:Object.assign({},A,{blendEquation:si}),gridSize:p,minOrMaxFb:l[g],clearParams:{clearColor:[0,0,0,3.402823466e38]},combineMaxMin:b}):(y&&this.renderToMaxMinTexture({id:g,parameters:Object.assign({},A,{blendEquation:ai}),gridSize:p,minOrMaxFb:c[g],clearParams:{clearColor:[3.402823466e38,3.402823466e38,3.402823466e38,0]},combineMaxMin:b}),_&&this.renderToMaxMinTexture({id:g,parameters:Object.assign({},A,{blendEquation:oi}),gridSize:p,minOrMaxFb:h[g],combineMaxMin:b}))}}},{key:"renderToMaxMinTexture",value:function(t){var e=t.id,n=t.parameters,i=t.gridSize,r=t.minOrMaxFb,o=t.combineMaxMin,s=t.clearParams,u=void 0===s?{}:s,l=this.state.framebuffers,c=this.gl,h=this.allAggregationModel;r.bind(),c.viewport(0,0,i[0],i[1]),Object(a.withParameters)(c,u,function(){c.clear(16384)}),h.draw({parameters:n,uniforms:{uSampler:l[e].texture,gridSize:i,combineMaxMin:o}}),r.unbind()}},{key:"renderToWeightsTexture",value:function(t){var e=t.id,n=t.parameters,i=t.moduleSettings,r=t.uniforms,o=t.gridSize,s=this.state,u=s.framebuffers,l=s.equations,c=s.weightAttributes,h=s.weights,f=this.gl,p=this.gridAggregationModel,A=h[e].operation;u[e].bind(),f.viewport(0,0,o[0],o[1]);var d=A===Jn.MIN?[3.402823466e38,3.402823466e38,3.402823466e38,0]:[0,0,0,0];Object(a.withParameters)(f,{clearColor:d},function(){f.clear(16384)});var v={weights:c[e]};if(p.draw({parameters:Object.assign({},n,{blendEquation:l[e]}),moduleSettings:i,uniforms:r,attributes:v}),u[e].unbind(),A===Jn.MEAN){var g=this.state,m=g.meanTextures,y=g.textures,_={_sourceTextures:{aggregationValues:m[e]},_targetTexture:y[e],elementCount:y[e].width*y[e].height};this.getMeanTransform(_).run({parameters:{blend:!1,depthTest:!1}}),u[e].attach(Object(Kn.a)({},36064,y[e]))}}},{key:"runAggregationOnGPU",value:function(t){this.updateModels(t),this.setupFramebuffers(t),this.renderAggregateData(t);var e=this.getAggregateData(t);return this.setState({results:e}),e}},{key:"setupFramebuffers",value:function(t){var e=this.state,n=e.numCol,i=e.numRow,r=e.textures,a=e.framebuffers,o=e.maxMinFramebuffers,s=e.minFramebuffers,u=e.maxFramebuffers,l=e.resources,c=e.meanTextures,h=e.equations,f=e.weights,p={width:n,height:i};for(var A in f){var d=f[A],v=d.needMin,g=d.needMax,m=d.combineMaxMin,y=d.operation;r[A]=f[A].aggregationTexture||r[A]||hi(this.gl,{id:"".concat(A,"-texture"),width:n,height:i}),r[A].resize(p);var _=r[A];y===Jn.MEAN&&(c[A]=c[A]||hi(this.gl,{id:"".concat(A,"-mean-texture"),width:n,height:i}),c[A].resize(p),_=c[A]),a[A]?a[A].attach(Object(Kn.a)({},36064,_)):a[A]=fi(this.gl,{id:"".concat(A,"-fb"),width:n,height:i,texture:_}),a[A].resize(p),h[A]=ui[y],(v||g)&&(v&&g&&m?o[A]||(l["".concat(A,"-maxMin")]=hi(this.gl,{id:"".concat(A,"-maxMinTex")}),o[A]=fi(this.gl,{id:"".concat(A,"-maxMinFb"),texture:l["".concat(A,"-maxMin")]})):(v&&(s[A]||(l["".concat(A,"-min")]=hi(this.gl,{id:"".concat(A,"-minTex")}),s[A]=fi(this.gl,{id:"".concat(A,"-minFb"),texture:l["".concat(A,"-min")]}))),g&&(u[A]||(l["".concat(A,"-max")]=hi(this.gl,{id:"".concat(A,"-maxTex")}),u[A]=fi(this.gl,{id:"".concat(A,"-maxFb"),texture:l["".concat(A,"-max")]})))))}}},{key:"setupModels",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.gridAggregationModel&&this.gridAggregationModel.delete(),this.gridAggregationModel=this.getAggregationModel(t),this.allAggregationModel||(this.allAggregationModel=this.getAllAggregationModel())}},{key:"setupWeightAttributes",value:function(t){var e=this.state,n=e.weightAttributes,i=e.vertexCount,o=e.weights,s=e.resources;for(var u in o){var l=o[u].values;if(Array.isArray(l)||l.constructor===Float32Array){r.assert(l.length/3===i);var c=Array.isArray(l)?new Float32Array(l):l;n[u]instanceof a.Buffer?n[u].setData(c):(s["".concat(u,"-buffer")]=new a.Buffer(this.gl,c),n[u]=s["".concat(u,"-buffer")])}else r.assert(l instanceof a.Buffer),n[u]=l}}},{key:"trackGPUResultBuffers",value:function(t,e){var n=this.state.resources;for(var i in t)if(t[i])for(var r=0;r<di.length;r++){var a=di[r];if(t[i][a]&&e[i][a]!==t[i][a]){var o="gpu-result-".concat(i,"-").concat(a);n[o]&&n[o].delete(),n[o]=t[i][a]}}}},{key:"updateModels",value:function(t){var e=this.gl,n=t.positions,i=t.positions64xyLow,r=t.changeFlags,o=this.state,s=o.numCol,u=o.numRow,l={},c=!1;if(t.fp64!==this.state.fp64&&(this.setupModels(t.fp64),this.setState({fp64:t.fp64}),c=!0),r.dataChanged||!this.state.positionsBuffer){var h=this.state,f=h.positionsBuffer,p=h.positions64xyLowBuffer;f&&f.delete(),p&&p.delete();var A=n.length/2;f=new a.Buffer(e,new Float32Array(n)),p=new a.Buffer(e,{data:new Float32Array(i),accessor:{size:2}}),this.setState({positionsBuffer:f,positions64xyLowBuffer:p,vertexCount:A}),this.setupWeightAttributes(t),c=!0}if(c){var d=this.state,v=d.vertexCount,g=d.positionsBuffer,m=d.positions64xyLowBuffer;l.positions=g,t.fp64&&(l.positions64xyLow=m),this.gridAggregationModel.setVertexCount(v),this.gridAggregationModel.setAttributes(l)}(r.cellSizeChanged||r.viewportChanged)&&this.allAggregationModel.setInstanceCount(s*u)}}]),t}(),mi=Zn.count,yi=[0,0,0,0],_i=[0,255,0,255],bi=["minColor","maxColor","colorRange","colorDomain"],xi={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:Xn,getPosition:{type:"accessor",value:function(t){return t.position}},getWeight:{type:"accessor",value:function(t){return[1,0,0]}},gpuAggregation:!0,aggregation:"SUM"},wi=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){var t=Object(a.isWebGL2)(this.context.gl)?{vs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 instancePositions;\nin vec4 instanceCounts;\nin vec3 instancePickingColors;\n\nlayout(std140) uniform;\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform AggregationData\n{\n  vec4 maxCount;\n} aggregationData;\n\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nout vec4 vColor;\nout float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r ;\n  float maxWeight = aggregationData.maxCount.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\nin float vSampleCount;\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  fragColor = vColor;\n\n  fragColor = picking_filterColor(fragColor);\n}\n"}:{vs:"#define SHADER_NAME screen-grid-layer-vertex-shader-webgl1\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform float maxWeight;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#define SHADER_NAME screen-grid-layer-fragment-shader-webgl1\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  gl_FragColor = picking_filterColor(gl_FragColor);\n}\n"};return t.modules=["picking"],t}},{key:"initializeState",value:function(){var t=this.getAttributeManager(),e=this.context.gl;t.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,transition:!0,accessor:["getPosition","getWeight"],update:this.calculateInstanceCounts,noAlloc:!0}});var n={id:"".concat(this.id,"-aggregator"),shaderCache:this.context.shaderCache},i=this._getMaxCountBuffer(e),r={color:{size:1,operation:Jn.SUM,needMax:!0,maxBuffer:i}};this.setState({model:this._getModel(e),gpuGridAggregator:new gi(e,n),maxBuffer:i,weights:r}),this._setupUniformBuffer()}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,t),this._updateUniforms(t),t.changeFlags.dataChanged&&this._processData();var n=this._getAggregationChangeFlags(t);n&&this._updateAggregation(n)}},{key:"finalizeState",value:function(){Object(it.a)(Object(L.a)(e.prototype),"finalizeState",this).call(this);var t=this.state,n=t.aggregationBuffer,i=t.maxBuffer;t.gpuGridAggregator.delete(),n&&n.delete(),i&&i.delete()}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.gl,i=this.props.parameters,r=void 0===i?{}:i,o=this.props.minColor||yi,s=this.props.maxColor||_i,u=this.props.colorDomain||[1,0],l=this.state,c=l.model,h=l.maxBuffer,f=l.cellScale,p=l.shouldUseMinMax,A=l.colorRange,d=l.maxWeight,v={minColor:o,maxColor:s,cellScale:f,colorRange:A,colorDomain:u,shouldUseMinMax:p};Object(a.isWebGL2)(n)?h.bind({target:35345}):v.maxWeight=d,e=Object.assign(v,e),c.draw({uniforms:e,parameters:Object.assign({depthTest:!1,depthMask:!1},r)}),Object(a.isWebGL2)(n)&&h.unbind()}},{key:"calculateInstancePositions",value:function(t,e){for(var n=e.numInstances,i=this.context.viewport,r=i.width,a=i.height,o=this.props.cellSizePixels,s=this.state.numCol,u=t.value,l=t.size,c=0;c<n;c++){var h=c%s,f=Math.floor(c/s);u[c*l+0]=h*o/r*2-1,u[c*l+1]=1-f*o/a*2,u[c*l+2]=0}}},{key:"calculateInstanceCounts",value:function(t,e){e.numInstances;var n=this.state.aggregationBuffer;t.update({buffer:n})}},{key:"getPickingInfo",value:function(t){var e=t.info,n=(t.mode,e.index);if(n>=0){var i=this.state.gpuGridAggregator.getData("color");e.object=gi.getAggregationData(Object.assign({pixelIndex:n},i))}return e}},{key:"_getAggregationChangeFlags",value:function(t){var e=t.oldProps,n=t.props,i=t.changeFlags,r=n.cellSizePixels!==e.cellSizePixels||n.cellMarginPixels!==e.cellMarginPixels,a=i.dataChanged||n.aggregation!==e.aggregation,o=i.viewportChanged;return r||a||o?{cellSizeChanged:r,dataChanged:a,viewportChanged:o}:null}},{key:"_getModel",value:function(t){return new a.Model(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new a.Geometry({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_getMaxCountBuffer",value:function(t){return new a.Buffer(t,{byteLength:16,index:0,accessor:{size:4}})}},{key:"_processData",value:function(){var t=this.props,e=t.data,n=t.getPosition,i=t.getWeight,r=mi(e),a=new Float64Array(2*r),o=new Float32Array(3*r),s=this.state.weights,u=ot(e),l=u.iterable,c=u.objectInfo,h=!0,f=!1,p=void 0;try{for(var A,d=l[Symbol.iterator]();!(h=(A=d.next()).done);h=!0){var v=A.value;c.index++;var g=n(v,c),m=i(v,c),y=c.index;a[2*y]=g[0],a[2*y+1]=g[1],Array.isArray(m)?(o[3*y]=m[0],o[3*y+1]=m[1],o[3*y+2]=m[2]):o[3*y]=m}}catch(_){f=!0,p=_}finally{try{h||null==d.return||d.return()}finally{if(f)throw p}}s.color.values=o,this.setState({positions:a})}},{key:"_setupUniformBuffer",value:function(){var t=this.context.gl;if(Object(a.isWebGL2)(t)){var e=this.state.model.program.handle,n=t.getUniformBlockIndex(e,"AggregationData");t.uniformBlockBinding(e,n,0)}}},{key:"_shouldUseMinMax",value:function(){var t=this.props,e=t.minColor,n=t.maxColor,i=t.colorDomain,a=t.colorRange;return e||n?(r.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!i&&!a}},{key:"_updateAggregation",value:function(t){var e=this.getAttributeManager();(t.cellSizeChanged||t.viewportChanged)&&(this._updateGridParams(),e.invalidateAll());var n=this.props,i=n.cellSizePixels,r=n.gpuAggregation,a=this.state,o=a.positions,s=a.weights,u=this.context.viewport;s.color.operation=Jn[this.props.aggregation.toUpperCase()]||Jn.SUM;var l=!1,c=null;this.context.viewport instanceof Ce?l=!0:(l=!1,c=u.pixelProjectionMatrix);var h=this.state.gpuGridAggregator.run({positions:o,weights:s,cellSize:[i,i],viewport:u,changeFlags:t,useGPU:r,projectPoints:l,gridTransformMatrix:c}),f=h.color.maxData&&Number.isFinite(h.color.maxData[0])?h.color.maxData[0]:0;this.setState({maxWeight:f}),e.invalidate("instanceCounts")}},{key:"_updateUniforms",value:function(t){var e=t.oldProps,n=t.props,i=t.changeFlags,r={};if(bi.some(function(t){return e[t]!==n[t]})&&(r.shouldUseMinMax=this._shouldUseMinMax()),e.colorRange!==n.colorRange&&(r.colorRange=Qn(n.colorRange,Float32Array,255)),e.cellMarginPixels!==n.cellMarginPixels||e.cellSizePixels!==n.cellSizePixels||i.viewportChanged){var a=this.context.viewport,o=a.width,s=a.height,u=this.props,l=u.cellSizePixels,c=u.cellMarginPixels,h=l>c?c:0;r.cellScale=new Float32Array([(l-h)/o*2,-(l-h)/s*2,1])}this.setState(r)}},{key:"_updateGridParams",value:function(){var t=this.context.viewport,e=t.width,n=t.height,i=this.props.cellSizePixels,r=this.context.gl,o=Math.ceil(e/i),s=Math.ceil(n/i),u=o*s,l=4*u*4,c=this.state.aggregationBuffer;c&&c.delete(),c=new a.Buffer(r,{byteLength:l,accessor:{size:4,type:5126,divisor:1}}),this.state.weights.color.aggregationBuffer=c,this.setState({numCol:o,numRow:s,numInstances:u,aggregationBuffer:c})}}]),e}(ue);wi.layerName="ScreenGridLayer",wi.defaultProps=xi;var Si=n("vpQ4"),ki=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(T.a)(this,e);var n=t.id,i=void 0===n?Object(a.uid)("column-geometry"):n,o=function(t){var e=t.radius,n=t.height,i=void 0===n?1:n,a=t.nradial,o=void 0===a?10:a,s=t.vertices;r.assert(!s||s.length>=o);for(var u=o+1,l=3*u,c=2*Math.PI/o,h=new Uint16Array(3*o*2),f=new Float32Array(3*l),p=new Float32Array(3*l),A=0,d=0;d<u;d++)for(var v=d*c,g=s&&s[d%o],m=s&&s[(d+1)%o],y=Math.sin(v),_=Math.cos(v),b=0;b<2;b++)f[A+0]=g?g[0]:_*e,f[A+1]=g?g[1]:y*e,f[A+2]=(.5-b)*i,p[A+0]=g?m[0]-g[0]:_,p[A+1]=g?m[1]-g[1]:y,A+=3;for(var x=0;x<u;x++){var w=Math.floor(x/2)*Math.sign(x%2-.5),S=w*c,k=s&&s[(w+o)%o],O=Math.sin(S),P=Math.cos(S);f[A+0]=k?k[0]:P*e,f[A+1]=k?k[1]:O*e,f[A+2]=i/2,p[A+2]=1,A+=3}for(var E=0,C=0;C<o;C++)h[E++]=2*C+0,h[E++]=2*C+2,h[E++]=2*C+0,h[E++]=2*C+1,h[E++]=2*C+1,h[E++]=2*C+3;return{indices:h,attributes:{POSITION:{size:3,value:f},NORMAL:{size:3,value:p}}}}(t),s=o.indices,u=o.attributes;return Object(j.a)(this,Object(L.a)(e).call(this,Object(Si.a)({},t,{id:i,indices:s,attributes:u})))}return Object(I.a)(e,t),e}(a.Geometry);var Oi=a.fp64.fp64LowPart,Pi=new a.PhongMaterial,Ei=[0,0,0,255],Ci={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,fp64:!1,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(t){return t.position}},getFillColor:{type:"accessor",value:Ei},getLineColor:{type:"accessor",value:Ei},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:Pi,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Ti=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  \n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceFillColors:{size:4,type:5121,transition:!0,accessor:"getFillColor",defaultValue:Ei},instanceLineColors:{size:4,type:5121,transition:!0,accessor:"getLineColor",defaultValue:Ei},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(t){var n=t.props,i=t.oldProps,r=t.changeFlags;Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r});var a=n.fp64!==i.fp64;if(a){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.getAttributeManager().invalidateAll()}(a||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(t,e){var n=new ki({radius:1,height:2,vertices:e,nradial:t}),i=0;if(e)for(var r=0;r<t;r++){var a=e[r];i+=Math.sqrt(a[0]*a[0]+a[1]*a[1])/t}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*i}),n}},{key:"_getModel",value:function(t){return new a.Model(t,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_updateGeometry",value:function(t){var e=t.diskResolution,n=t.vertices,i=this.getGeometry(e,n);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3,wireframeVertexCount:i.indices.value.length}),this.state.model.setProps({geometry:i})}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,i=this.props,r=i.lineWidthUnits,a=i.lineWidthScale,o=i.lineWidthMinPixels,s=i.lineWidthMaxPixels,u=i.elevationScale,l=i.extruded,c=i.filled,h=i.stroked,f=i.wireframe,p=i.offset,A=i.coverage,d=i.radius,v=i.angle,g=this.state,m=g.model,y=g.fillVertexCount,_=g.wireframeVertexCount,b=g.edgeDistance,x="pixels"===r?n.distanceScales.metersPerPixel[2]:1;m.setUniforms(Object.assign({},e,{radius:d,angle:v/180*Math.PI,offset:p,extruded:l,coverage:A,elevationScale:u,edgeDistance:b,widthScale:a*x,widthMinPixels:o,widthMaxPixels:s})),l&&f&&(m.setProps({isIndexed:!0}),m.setVertexCount(_).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(m.setProps({isIndexed:!1}),m.setVertexCount(y).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!l&&h&&(m.setProps({isIndexed:!1}),m.setVertexCount(2*y/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}},{key:"calculateInstancePositions64xyLow",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.use64bitPositions();if(t.constant=!r,r){var a=this.props,o=a.data,s=a.getPosition,u=t.value,l=n*t.size,c=ot(o,n,i),h=c.iterable,f=c.objectInfo,p=!0,A=!1,d=void 0;try{for(var v,g=h[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var m=v.value;f.index++;var y=s(m,f);u[l++]=Oi(y[0]),u[l++]=Oi(y[1])}}catch(_){A=!0,d=_}finally{try{p||null==g.return||g.return()}finally{if(A)throw d}}}else t.value=new Float32Array(2)}}]),e}(ue);Ti.layerName="ColumnLayer",Ti.defaultProps=Ci;var Mi=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getGeometry",value:function(t){return new a.CubeGeometry}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,i=n.elevationScale,r=n.extruded,a=n.offset,o=n.coverage,s=n.cellSize,u=n.angle;this.state.model.setUniforms(Object.assign({},e,{radius:s/2,angle:u,offset:a,extruded:r,coverage:o,elevationScale:i,edgeDistance:1,isWireframe:!1})).draw()}}]),e}(Ti);Mi.layerName="GridCellLayer",Mi.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var ji=function(t){return t.length},Li=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ji;Object(T.a)(this,t),this.sortedBins=this.getSortedBins(e,n),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(M.a)(t,[{key:"getSortedBins",value:function(t,e){return t.reduce(function(t,n,i){var r=e(n.points);return null!=r&&t.push({i:Number.isFinite(n.index)?n.index:i,value:r,counts:n.points.length}),t},[]).sort(function(t,e){return t.value-e.value})}},{key:"getValueRange",value:function(t){var e=Object(N.a)(t,2),n=e[0],i=e[1],r=this.sortedBins.length;if(!r)return[0,0];var a=Math.ceil(n/100*(r-1)),o=Math.floor(i/100*(r-1));return[this.sortedBins[a].value,this.sortedBins[o].value]}},{key:"getMaxCount",value:function(){var t=0;return this.sortedBins.forEach(function(e){return t=t>e.counts?t:e.counts}),t}},{key:"getBinMap",value:function(){return this.sortedBins.reduce(function(t,e){return Object.assign(t,Object(Kn.a)({},e.i,e))},{})}}]),t}();function Ii(t,e,n){var i=t[1]-t[0];if(i<=0)return r.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];var a=i/e.length,o=Math.floor((n-t[0])/a);return e[Math.max(Math.min(o,e.length-1),0)]}function zi(t,e){return function(n){return Ii(t,e,n)}}function Di(t,e){return function(n){return(n-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}}var Bi=6378e3;function Ri(t,e,n){var i=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r=1/0,a=-1/0,o=ot(e),s=o.iterable,u=o.objectInfo,l=!0,c=!1,h=void 0;try{for(var f,p=s[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var A=f.value;u.index++,t=i(A,u)[1],Number.isFinite(t)&&(r=t<r?t:r,a=t>a?t:a)}}catch(T){c=!0,h=T}finally{try{l||null==p.return||p.return()}finally{if(c)throw h}}var d=function(t,e){var n=(o=t,o/Bi*(180/Math.PI)),i=(r=e,a=t,a/Bi*(180/Math.PI)/Math.cos(r*Math.PI/180));var r,a;var o;return{yOffset:n,xOffset:i}}(n,(r+a)/2);if(d.xOffset<=0||d.yOffset<=0)return{gridHash:{},gridOffset:d};var v={};u.index=-1;var g=!0,m=!1,y=void 0;try{for(var _,b=s[Symbol.iterator]();!(g=(_=b.next()).done);g=!0){var x=_.value;u.index++;var w=i(x,u),S=Object(N.a)(w,2),k=S[0],O=S[1];if(Number.isFinite(O)&&Number.isFinite(k)){var P=Math.floor((O+90)/d.yOffset),E=Math.floor((k+180)/d.xOffset),C="".concat(P,"-").concat(E);v[C]=v[C]||{count:0,points:[]},v[C].count+=1,v[C].points.push(x)}}}catch(T){m=!0,y=T}finally{try{g||null==b.return||b.return()}finally{if(m)throw y}}return{gridHash:v,gridOffset:d}}(t,e,n),r=i.gridHash,a=i.gridOffset;return{gridHash:r,gridOffset:a,layerData:function(t,e){return Object.keys(t).reduce(function(n,i,r){var a=i.split("-"),o=parseInt(a[0],10),s=parseInt(a[1],10);return n.push(Object.assign({index:r,position:[e.xOffset*s-180,e.yOffset*o-90]},t[i])),n},[])}(r,a)}}function Fi(){}var Ni={colorDomain:null,colorRange:Xn,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(t){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},onSetColorDomain:Fi,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(t){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:Fi,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(t){return t.position}},extruded:!1,fp64:!1,material:new a.PhongMaterial},Ui=["getColorValue","colorAggregation","getColorWeight"],Vi=["getElevationValue","elevationAggregation","getElevationWeight"],Gi=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:Fi,elevationScaleFunc:Fi,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(t){var e=this,n=t.oldProps,i=t.props,r=t.changeFlags;this.updateGetValueFuncs(n,i);var a=this.needsReProjectPoints(n,i,r);r.dataChanged||a?this.getLayerData():(this.getDimensionChanges(n,i)||[]).forEach(function(t){return"function"==typeof t&&t.apply(e)})}},{key:"colorElevationPropsChanged",value:function(t,e){for(var n=!1,i=!1,r=0;r<Ui.length;r++){var a=Ui[r];t[a]!==e[a]&&(n=!0)}for(var o=0;o<Vi.length;o++){var s=Vi[o];t[s]!==e[s]&&(i=!0)}return{colorChanged:n,elevationChanged:i}}},{key:"updateGetValueFuncs",value:function(t,e){var n=e.getColorValue,i=e.getElevationValue,r=this.props,a=r.colorAggregation,o=r.getColorWeight,s=r.elevationAggregation,u=r.getElevationWeight,l=this.colorElevationPropsChanged(t,e),c=l.colorChanged,h=l.elevationChanged;c&&null===n&&(n=ni(a,o)),h&&null===i&&(i=ni(s,u)),n&&this.setState({getColorValue:n}),i&&this.setState({getElevationValue:i})}},{key:"needsReProjectPoints",value:function(t,e,n){return t.cellSize!==e.cellSize||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(t,e){var n=this.state.dimensionUpdaters,i=[];for(var r in n){var a=n[r].find(function(n){return n.triggers.some(function(n){return t[n]!==e[n]})});a&&i.push(a.updater)}return i.length?i:null}},{key:"getPickingInfo",value:function(t){var e=t.info,n=this.state,i=n.sortedColorBins,r=n.sortedElevationBins,a=null;if(e.picked&&e.index>-1){var o=this.state.layerData[e.index],s=i.binMap[o.index]&&i.binMap[o.index].value,u=r.binMap[o.index]&&r.binMap[o.index].value;a=Object.assign({colorValue:s,elevationValue:u},o)}return Object.assign(e,{picked:Boolean(a),object:a})}},{key:"getUpdateTriggers",value:function(){var t=this,e=this.state.dimensionUpdaters,n={},i=function(i){n[i]={};var r=!0,a=!1,o=void 0;try{for(var s,u=e[i][Symbol.iterator]();!(r=(s=u.next()).done);r=!0){s.value.triggers.forEach(function(e){n[i][e]=t.props[e]})}}catch(l){a=!0,o=l}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}};for(var r in e)i(r);return n}},{key:"getLayerData",value:function(){var t=this.props,e=Ri(t.data,t.cellSize,t.getPosition).layerData;this.setState({layerData:e}),this.getSortedBins()}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var t=this.state.getColorValue,e=new Li(this.state.layerData||[],t);this.setState({sortedColorBins:e}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var t=this.state.getElevationValue,e=new Li(this.state.layerData||[],t);this.setState({sortedElevationBins:e}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var t=this.props,e=t.lowerPercentile,n=t.upperPercentile,i=t.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([e,n]),"function"==typeof i&&i(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var t=this.props,e=t.elevationLowerPercentile,n=t.elevationUpperPercentile,i=t.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([e,n]),"function"==typeof i&&i(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var t=this.props.colorRange,e=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=zi(e,t)}},{key:"getElevationScale",value:function(){var t=this.props.elevationRange,e=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Di(e,t)}},{key:"_onGetSublayerColor",value:function(t){var e=this.state,n=e.sortedColorBins,i=e.colorScaleFunc,r=e.colorValueDomain,a=n.binMap[t.index]&&n.binMap[t.index].value,o=this.props.colorDomain||r,s=a>=o[0]&&a<=o[o.length-1]?i(a):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(t){var e=this.state,n=e.sortedElevationBins,i=e.elevationScaleFunc,r=e.elevationValueDomain,a=n.binMap[t.index]&&n.binMap[t.index].value,o=this.props.elevationDomain||r;return a>=o[0]&&a<=o[o.length-1]?i(a):-1}},{key:"renderLayers",value:function(){var t=this.props,e=t.elevationScale,n=t.fp64,i=t.extruded,r=t.cellSize,a=t.coverage,o=t.material,s=t.transitions;return new(this.getSubLayerClass("grid-cell",Mi))({fp64:n,cellSize:r,coverage:a,material:o,elevationScale:e,extruded:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.layerData})}}]),e}(yn);Gi.layerName="CPUGridLayer",Gi.defaultProps=Ni;var Wi=Math.PI/3,Hi=[0,Wi,2*Wi,3*Wi,4*Wi,5*Wi];function qi(t){return t[0]}function Zi(t){return t[1]}var Xi=function(){var t,e,n,i=0,r=0,a=1,o=1,s=qi,u=Zi;function l(t){var i,r={},a=[],o=t.length;for(i=0;i<o;++i)if(!isNaN(c=+s.call(null,l=t[i],i,t))&&!isNaN(h=+u.call(null,l,i,t))){var l,c,h,f=Math.round(h/=n),p=Math.round(c=c/e-(1&f)/2),A=h-f;if(3*Math.abs(A)>1){var d=c-p,v=p+(c<p?-1:1)/2,g=f+(h<f?-1:1),m=c-v,y=h-g;d*d+A*A>m*m+y*y&&(p=v+(1&f?1:-1)/2,f=g)}var _=p+"-"+f,b=r[_];b?b.push(l):(a.push(b=r[_]=[l]),b.x=(p+(1&f)/2)*e,b.y=f*n)}return a}function c(t){var e=0,n=0;return Hi.map(function(i){var r=Math.sin(i)*t,a=-Math.cos(i)*t,o=r-e,s=a-n;return e=r,n=a,[o,s]})}return l.hexagon=function(e){return"m"+c(null==e?t:+e).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(r/n),l=Math.round(i/e),c=u*n;c<o+t;c+=n,++u)for(var h=l*e+(1&u)*e/2;h<a+e/2;h+=e)s.push([h,c]);return s},l.mesh=function(){var e=c(t).slice(0,4).join("l");return l.centers().map(function(t){return"M"+t+"m"+e}).join("")},l.x=function(t){return arguments.length?(s=t,l):s},l.y=function(t){return arguments.length?(u=t,l):u},l.radius=function(i){return arguments.length?(e=2*(t=+i)*Math.sin(Wi),n=1.5*t,l):t},l.size=function(t){return arguments.length?(i=r=0,a=+t[0],o=+t[1],l):[a-i,o-r]},l.extent=function(t){return arguments.length?(i=+t[0][0],r=+t[0][1],a=+t[1][0],o=+t[1][1],l):[[i,r],[a,o]]},l.radius(1)};function Qi(){}var Yi={colorDomain:null,colorRange:Xn,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(t){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},onSetColorDomain:Qi,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(t){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},onSetElevationDomain:Qi,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(t,e){var n=t.data,i=t.radius,r=t.getPosition,a=function(t,e){var n=e.getDistanceScales().pixelsPerMeter;return t*n[0]}(i,e),o=[],s=ot(n),u=s.iterable,l=s.objectInfo,c=!0,h=!1,f=void 0;try{for(var p,A=u[Symbol.iterator]();!(c=(p=A.next()).done);c=!0){var d=p.value;l.index++,o.push(Object.assign({screenCoord:e.projectFlat(r(d,l))},d))}}catch(v){h=!0,f=v}finally{try{c||null==A.return||A.return()}finally{if(h)throw f}}return{hexagons:Xi().radius(a).x(function(t){return t.screenCoord[0]}).y(function(t){return t.screenCoord[1]})(o).map(function(t,n){return{position:e.unprojectFlat([t.x,t.y]),points:t,index:n}})}},getPosition:{type:"accessor",value:function(t){return t.position}},fp64:!1,material:new a.PhongMaterial},Ki=["getColorValue","colorAggregation","getColorWeight"],Ji=["getElevationValue","elevationAggregation","getElevationWeight"],$i=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){this.state={hexagons:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:Qi,elevationScaleFunc:Qi,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(t){var e=this,n=t.oldProps,i=t.props,r=t.changeFlags;this.updateGetValueFuncs(n,i);var a=this.getDimensionChanges(n,i);r.dataChanged||this.needsReProjectPoints(n,i)?this.getHexagons():a&&a.forEach(function(t){return"function"==typeof t&&t.apply(e)})}},{key:"colorElevationPropsChanged",value:function(t,e){for(var n=!1,i=!1,r=0;r<Ki.length;r++){var a=Ki[r];t[a]!==e[a]&&(n=!0)}for(var o=0;o<Ji.length;o++){var s=Ji[o];t[s]!==e[s]&&(i=!0)}return{colorChanged:n,elevationChanged:i}}},{key:"updateGetValueFuncs",value:function(t,e){var n=e.getColorValue,i=e.getElevationValue,r=this.props,a=r.colorAggregation,o=r.getColorWeight,s=r.elevationAggregation,u=r.getElevationWeight,l=this.colorElevationPropsChanged(t,e),c=l.colorChanged,h=l.elevationChanged;c&&null===n&&(n=ni(a,o)),h&&null===i&&(i=ni(s,u)),n&&this.setState({getColorValue:n}),i&&this.setState({getElevationValue:i})}},{key:"needsReProjectPoints",value:function(t,e){return t.radius!==e.radius||t.hexagonAggregator!==e.hexagonAggregator}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(t,e){var n=this.state.dimensionUpdaters,i=[];for(var r in n){var a=n[r].find(function(n){return n.triggers.some(function(n){return t[n]!==e[n]})});a&&i.push(a.updater)}return i.length?i:null}},{key:"getHexagons",value:function(){var t=this.props.hexagonAggregator,e=this.context.viewport,n=t(this.props,e),i=n.hexagons,r=n.hexagonVertices;this.updateRadiusAngle(r),this.setState({hexagons:i}),this.getSortedBins()}},{key:"getPickingInfo",value:function(t){var e=t.info,n=this.state,i=n.sortedColorBins,r=n.sortedElevationBins,a=null;if(e.picked&&e.index>-1){var o=this.state.hexagons[e.index],s=i.binMap[o.index]&&i.binMap[o.index].value,u=r.binMap[o.index]&&r.binMap[o.index].value;a=Object.assign({colorValue:s,elevationValue:u},o)}return Object.assign(e,{picked:Boolean(a),object:a})}},{key:"getUpdateTriggers",value:function(){var t=this,e=this.state.dimensionUpdaters,n={},i=function(i){n[i]={};var r=!0,a=!1,o=void 0;try{for(var s,u=e[i][Symbol.iterator]();!(r=(s=u.next()).done);r=!0){s.value.triggers.forEach(function(e){n[i][e]=t.props[e]})}}catch(l){a=!0,o=l}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}};for(var r in e)i(r);return n}},{key:"updateRadiusAngle",value:function(t){var e=this.props.radius,n=90;if(Array.isArray(t)){t.length<6&&r.error("HexagonCellLayer: hexagonVertices needs to be an array of 6 points")();var i=t[0],a=t[3],o=this.context.viewport.getDistanceScales().pixelsPerMeter,s=this.projectFlat(i),u=this.projectFlat(a),l=s[0]-u[0],c=s[1]-u[1],h=Math.sqrt(l*l+c*c);n=Math.acos(l/h)*-Math.sign(c)/Math.PI*180+90,e=h/2/o[0]}this.setState({angle:n,radius:e})}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var t=this.state.getColorValue,e=new Li(this.state.hexagons||[],t);this.setState({sortedColorBins:e}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var t=this.state.getElevationValue,e=new Li(this.state.hexagons||[],t);this.setState({sortedElevationBins:e}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var t=this.props,e=t.lowerPercentile,n=t.upperPercentile,i=t.onSetColorDomain;e>n&&r.warn("HexagonLayer: lowerPercentile is bigger than upperPercentile")(),this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([e,n]),"function"==typeof i&&i(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var t=this.props,e=t.elevationLowerPercentile,n=t.elevationUpperPercentile,i=t.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([e,n]),"function"==typeof i&&i(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var t=this.props.colorRange,e=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=zi(e,t)}},{key:"getElevationScale",value:function(){var t=this.props.elevationRange,e=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Di(e,t)}},{key:"_onGetSublayerColor",value:function(t){var e=this.state,n=e.sortedColorBins,i=e.colorScaleFunc,r=e.colorValueDomain,a=n.binMap[t.index]&&n.binMap[t.index].value,o=this.props.colorDomain||r,s=a>=o[0]&&a<=o[o.length-1]?i(a):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(t){var e=this.state,n=e.sortedElevationBins,i=e.elevationScaleFunc,r=e.elevationValueDomain,a=n.binMap[t.index]&&n.binMap[t.index].value,o=this.props.elevationDomain||r;return a>=o[0]&&a<=o[o.length-1]?i(a):-1}},{key:"renderLayers",value:function(){var t=this.props,e=t.elevationScale,n=t.extruded,i=t.coverage,r=t.material,a=t.fp64,o=t.transitions,s=this.state,u=s.angle,l=s.radius;return new(this.getSubLayerClass("hexagon-cell",Ti))({fp64:a,radius:l,diskResolution:6,elevationScale:e,angle:u,extruded:n,coverage:i,material:r,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.hexagons})}}]),e}(yn);$i.layerName="HexagonLayer",$i.defaultProps=Yi;var tr=a.fp64.fp64LowPart,er={fp64:!1,getSourcePosition:{type:"accessor",value:function(t){return t.sourcePosition}},getTargetPosition:{type:"accessor",value:function(t){return t.targetPosition}},getColor:{type:"accessor",value:[0,0,0,255]},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0},getStrokeWidth:{deprecatedFor:"getWidth"}},nr=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec4 instanceSourceTargetPositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nvoid main(void) {\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourceTargetPositions64xyLow.xy, vec3(0.));\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceSourceTargetPositions64xyLow.zw, vec3(0.));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n  vec2 offset = getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels);\n  gl_Position = p + vec4(offset, 0.0, 0.0);\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,transition:!0,accessor:"getTargetPosition"},instanceSourceTargetPositions64xyLow:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstanceSourceTargetPositions64xyLow},instanceColors:{size:4,type:5121,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(t){var n=t.props,i=t.oldProps,r=t.changeFlags;if(Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r}),n.fp64!==i.fp64){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,i=this.props,r=i.widthUnits,a=i.widthScale,o=i.widthMinPixels,s=i.widthMaxPixels,u="pixels"===r?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},e,{widthScale:a*u,widthMinPixels:o,widthMaxPixels:s})).draw()}},{key:"_getModel",value:function(t){return new a.Model(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new a.Geometry({drawMode:5,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstanceSourceTargetPositions64xyLow",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.use64bitPositions();if(t.constant=!r,r){var a=this.props,o=a.data,s=a.getSourcePosition,u=a.getTargetPosition,l=t.value,c=n*t.size,h=ot(o,n,i),f=h.iterable,p=h.objectInfo,A=!0,d=!1,v=void 0;try{for(var g,m=f[Symbol.iterator]();!(A=(g=m.next()).done);A=!0){var y=g.value;p.index++;var _=s(y,p),b=u(y,p);l[c++]=tr(_[0]),l[c++]=tr(_[1]),l[c++]=tr(b[0]),l[c++]=tr(b[1])}}catch(x){d=!0,v=x}finally{try{A||null==m.return||m.return()}finally{if(d)throw v}}}else t.value=new Float32Array(4)}}]),e}(ue);nr.layerName="LineLayer",nr.defaultProps=er;var ir=n("VmRL"),rr=n.n(ir);function ar(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function or(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function sr(t){var e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function ur(t,e,n,i){for(var r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function lr(t,e,n,i){for(var r=e,a=n.length,o=0;o<a;o++)for(var s=0;s<i;s++)t[r++]=n[o][s]||0;if(!sr(n))for(var u=0;u<i;u++)t[r++]=n[0][u]||0;return r}function cr(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,o=(a=a||n.length)-r;if(o<=0)return e;for(var s=e,u=0;u<o;u++)t[s++]=n[r+u];if(!ur(n,i,r,a))for(var l=0;l<i;l++)t[s++]=n[r+l];return s}function hr(t){return(sr(t)?0:1)+t.length}function fr(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;return n>=(i=i||t.length)?0:(ur(t,e,n,i)?0:1)+(i-n)/e}function pr(t,e){if(ar(t),t.positions){var n=t,i=n.positions,r=n.holeIndices;if(r){for(var a=0,o=0;o<=r.length;o++)a+=fr(t.positions,e,r[o-1],r[o]);return a}t=i}if(Number.isFinite(t[0]))return fr(t,e);if(!or(t)){var s=0,u=!0,l=!1,c=void 0;try{for(var h,f=t[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){s+=hr(h.value)}}catch(p){l=!0,c=p}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}return s}return hr(t)}function Ar(t,e,n){ar(t),n=n||pr(t,e);var i=new Float64Array(n*e),r=[];if(t.positions){var a=t,o=a.positions,s=a.holeIndices;if(s){for(var u=0,l=0;l<=s.length;l++)u=cr(i,u,o,e,s[l-1],s[l]),r.push(u);return r.pop(),{positions:i,holeIndices:r}}t=o}if(Number.isFinite(t[0]))return cr(i,0,t,e),{positions:i,holeIndices:null};if(!or(t)){var c=0,h=!0,f=!1,p=void 0;try{for(var A,d=t[Symbol.iterator]();!(h=(A=d.next()).done);h=!0){c=lr(i,c,A.value,e),r.push(c)}}catch(v){f=!0,p=v}finally{try{h||null==d.return||d.return()}finally{if(f)throw p}}return r.pop(),{positions:i,holeIndices:r}}return lr(i,0,t,e),{positions:i,holeIndices:null}}var dr,vr=Zn.Tesselator,gr=a.fp64.fp64LowPart,mr=function(t){function e(t){var n=t.data,i=t.getGeometry,r=t.fp64,a=t.positionFormat,o=t.IndexType,s=void 0===o?Uint32Array:o;return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).call(this,{data:n,getGeometry:i,fp64:r,positionFormat:a,attributes:{positions:{size:3},positions64xyLow:{size:2,fp64Only:!0},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:s,size:1}}}))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"get",value:function(t){return"indices"===t?this.attributes.indices.subarray(0,this.vertexCount):this.attributes[t]}},{key:"getGeometrySize",value:function(t){return pr(t,this.positionSize)}},{key:"updateGeometryAttributes",value:function(t,e){t=Ar(t,this.positionSize,e.geometrySize),this._updateIndices(t,e),this._updatePositions(t,e)}},{key:"_updateIndices",value:function(t,e){var n,i,r,a=e.geometryIndex,o=e.vertexStart,s=e.indexStart,u=this.attributes,l=this.indexLayout,c=this.typedArrayManager,h=u.indices,f=h.length,p=s,A=(n=t,i=this.positionSize,r=null,n.holeIndices&&(r=n.holeIndices.map(function(t){return t/i})),rr()(n.positions,r,i));f<p+A.length&&(f=2*(p+A.length),h=c.allocate(h,f,{type:h.constructor,size:1,copy:!0}));for(var d=0;d<A.length;d++)h[p++]=A[d]+o;l[a]=A.length,u.indices=h}},{key:"_updatePositions",value:function(t,e){for(var n=e.vertexStart,i=e.geometrySize,r=this.attributes,a=r.positions,o=r.positions64xyLow,s=r.vertexValid,u=this.fp64,l=this.positionSize,c=n,h=t.positions,f=t.holeIndices,p=0;p<i;p++){var A=h[p*l],d=h[p*l+1],v=l>2?h[p*l+2]:0;a[3*c]=A,a[3*c+1]=d,a[3*c+2]=v,u&&(o[2*c]=gr(A),o[2*c+1]=gr(d)),s[c]=1,c++}if(f)for(var g=0;g<f.length;g++)s[n+f[g]/l-1]=0;s[n+i-1]=0}}]),e}(vr),yr="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec2 positions64xyLow;\n  vec2 nextPositions64xyLow;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n  vec3 pos;\n  vec2 pos64xyLow;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64xyLow = mix(props.positions64xyLow, props.nextPositions64xyLow, vertexPositions.x);\n  isValid = vertexValid;\n#else\n  pos = props.positions;\n  pos64xyLow = props.positions64xyLow;\n  isValid = 1.0;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n  }\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(pos, pos64xyLow, vec3(0.), position_commonspace);\n\n  if (extruded) {\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(props.positions.y - props.nextPositions.y, props.nextPositions.x - props.positions.x, 0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, position_commonspace.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(props.pickingColors);\n}\n",_r="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(yr,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64xyLow = positions64xyLow;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),br="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 nextPositions;\nattribute vec2 nextPositions64xyLow;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(yr,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = instancePositions;\n  props.positions64xyLow = instancePositions64xyLow;\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n  props.nextPositions = nextPositions;\n  props.nextPositions64xyLow = nextPositions64xyLow;\n\n  calculatePosition(props);\n}\n"),xr=[0,0,0,255],wr=new a.PhongMaterial,Sr={filled:!0,extruded:!1,wireframe:!1,fp64:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(t){return t.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:xr},getLineColor:{type:"accessor",value:xr},material:wr},kr={enter:function(t,e){return e.length?e.subarray(e.length-t.length):t}},Or=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(t){return{vs:t,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){var t=this,e=this.context.gl;this.setState({numInstances:0,polygonTesselator:new mr({IndexType:!e||Object(a.hasFeature)(e,a.FEATURES.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var n=this.getAttributeManager();n.remove(["instancePickingColors"]),n.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,transition:kr,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{offset:0,divisor:0},instancePositions:{offset:0,divisor:1},nextPositions:{offset:12,divisor:1}}},positions64xyLow:{size:2,update:this.calculatePositionsLow,noAlloc:!0,shaderAttributes:{positions64xyLow:{offset:0,divisor:0},instancePositions64xyLow:{offset:0,divisor:1},nextPositions64xyLow:{offset:8,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:kr,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:4,type:5121,transition:kr,accessor:"getFillColor",defaultValue:xr,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:4,type:5121,transition:kr,accessor:"getLineColor",defaultValue:xr,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(e,n){var i=n.index,r=n.target;return t.encodePickingColor(i,r)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,i=n.extruded,r=n.filled,a=n.wireframe,o=n.elevationScale,s=this.state,u=s.topModel,l=s.sideModel,c=s.polygonTesselator,h=Object.assign({},e,{extruded:Boolean(i),elevationScale:o});l&&(l.setInstanceCount(c.instanceCount-1),l.setUniforms(h),a&&(l.setDrawMode(3),l.setUniforms({isWireframe:!0}).draw()),r&&(l.setDrawMode(6),l.setUniforms({isWireframe:!1}).draw())),u&&(u.setVertexCount(c.get("indices").length),u.setUniforms(h).draw())}},{key:"updateState",value:function(t){Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,t),this.updateGeometry(t);var n=t.props,i=t.oldProps,r=this.getAttributeManager();(n.fp64!==i.fp64||n.filled!==i.filled||n.extruded!==i.extruded)&&(this.state.models&&this.state.models.forEach(function(t){return t.delete()}),this.setState(this._getModels(this.context.gl)),r.invalidateAll())}},{key:"updateGeometry",value:function(t){var e=t.props,n=t.oldProps,i=t.changeFlags;if(i.dataChanged||e.fp64!==n.fp64||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){var r=this.state.polygonTesselator;r.updateGeometry({data:e.data,getGeometry:e.getPolygon,positionFormat:e.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:r.instanceCount,bufferLayout:r.bufferLayout}),this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(t){var e,n,i=this.props,r=i.id,o=i.filled,s=i.extruded;return o&&(e=new a.Model(t,Object.assign({},this.getShaders(_r),{id:"".concat(r,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0,shaderCache:this.context.shaderCache}))),s&&((n=new a.Model(t,Object.assign({},this.getShaders(br),{id:"".concat(r,"-side"),geometry:new a.Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,1,0,1,0,0,1,0])}}}),instanceCount:0,isInstanced:1,shaderCache:this.context.shaderCache}))).userData.excludeAttributes={indices:!0}),{models:[n,e].filter(Boolean),topModel:e,sideModel:n}}},{key:"calculateIndices",value:function(t){var e=this.state.polygonTesselator;t.bufferLayout=e.indexLayout,t.value=e.get("indices")}},{key:"calculatePositions",value:function(t){var e=this.state.polygonTesselator;t.bufferLayout=e.bufferLayout,t.value=e.get("positions")}},{key:"calculatePositionsLow",value:function(t){var e=this.use64bitPositions();t.constant=!e,t.value=e?this.state.polygonTesselator.get("positions64xyLow"):new Float32Array(2)}},{key:"calculateVertexValid",value:function(t){t.value=this.state.polygonTesselator.get("vertexValid")}},{key:"clearPickingColor",value:function(t){for(var e=this.decodePickingColor(t),n=this.state.polygonTesselator.bufferLayout,i=n[e],r=0,a=0;a<e;a++)r+=n[a];var o=this.getAttributeManager().attributes.pickingColors,s=o.value,u=r+i;s.fill(0,3*r,3*u),o.update({value:s})}}]),e}(ue);Or.layerName="SolidPolygonLayer",Or.defaultProps=Sr;var Pr={N:[0,.5],E:[.5,0],S:[0,-.5],W:[-.5,0],NE:[.5,.5],NW:[-.5,.5],SE:[.5,-.5],SW:[-.5,-.5]},Er=[Pr.W,Pr.SW,Pr.S],Cr=[Pr.S,Pr.SE,Pr.E],Tr=[Pr.E,Pr.NE,Pr.N],Mr=[Pr.NW,Pr.W,Pr.N],jr=[[-.5,1/6],[-.5,-1/6],[-1/6,-.5],[1/6,-.5]],Lr=[[-1/6,-.5],[1/6,-.5],[.5,-1/6],[.5,1/6]],Ir=[[.5,-1/6],[.5,1/6],[1/6,.5],[-1/6,.5]],zr=[[-.5,1/6],[-.5,-1/6],[1/6,.5],[-1/6,.5]],Dr=[Pr.W,Pr.SW,Pr.SE,Pr.E],Br=[Pr.S,Pr.SE,Pr.NE,Pr.N],Rr=[Pr.NW,Pr.W,Pr.E,Pr.NE],Fr=[Pr.NW,Pr.SW,Pr.S,Pr.N],Nr=[[-.5,1/6],[-.5,-1/6],[.5,-1/6],[.5,1/6]],Ur=[[-1/6,-.5],[1/6,-.5],[1/6,.5],[-1/6,.5]],Vr=[Pr.NW,Pr.SW,Pr.SE,Pr.NE],Gr=[Pr.NW,Pr.SW,Pr.SE,Pr.E,Pr.N],Wr=[Pr.W,Pr.SW,Pr.SE,Pr.NE,Pr.N],Hr=[Pr.NW,Pr.W,Pr.S,Pr.SE,Pr.NE],qr=[Pr.NW,Pr.SW,Pr.S,Pr.E,Pr.NE],Zr=[Pr.NW,Pr.W,[.5,-1/6],[.5,1/6],Pr.N],Xr=[[-1/6,-.5],[1/6,-.5],Pr.E,Pr.NE,Pr.N],Qr=[[-.5,1/6],[-.5,-1/6],Pr.S,Pr.SE,Pr.E],Yr=[Pr.W,Pr.SW,Pr.S,[1/6,.5],[-1/6,.5]],Kr=[Pr.NW,Pr.W,[-1/6,-.5],[1/6,-.5],Pr.N],Jr=[[-.5,1/6],[-.5,-1/6],Pr.E,Pr.NE,Pr.N],$r=[Pr.S,Pr.SE,Pr.E,[1/6,.5],[-1/6,.5]],ta=[Pr.W,Pr.SW,Pr.S,[.5,-1/6],[.5,1/6]],ea=[Pr.W,Pr.SW,Pr.SE,Pr.E,[1/6,.5],[-1/6,.5]],na=[[-.5,1/6],[-.5,-1/6],Pr.S,Pr.SE,Pr.NE,Pr.N],ia=[Pr.NW,Pr.W,[-1/6,-.5],[1/6,-.5],Pr.E,Pr.NE],ra=[Pr.NW,Pr.SW,Pr.S,[.5,-1/6],[.5,1/6],Pr.N],aa=[Pr.W,Pr.SW,Pr.S,Pr.E,Pr.NE,Pr.N],oa=[Pr.NW,Pr.W,Pr.S,Pr.SE,Pr.E,Pr.N],sa=[[-.5,1/6],[-.5,-1/6],[-1/6,-.5],[1/6,-.5],Pr.E,Pr.NE,Pr.N],ua=[Pr.W,Pr.SW,Pr.S,[.5,-1/6],[.5,1/6],[1/6,.5],[-1/6,.5]],la=[Pr.NW,Pr.W,[-1/6,-.5],[1/6,-.5],[.5,-1/6],[.5,1/6],Pr.N],ca=[[-.5,1/6],[-.5,-1/6],Pr.S,Pr.SE,Pr.E,[1/6,.5],[-1/6,.5]],ha=[[-.5,1/6],[-.5,-1/6],[-1/6,-.5],[1/6,-.5],[.5,-1/6],[.5,1/6],[1/6,.5],[-1/6,.5]],fa={0:[],1:[[Pr.W,Pr.S]],2:[[Pr.S,Pr.E]],3:[[Pr.W,Pr.E]],4:[[Pr.N,Pr.E]],5:{0:[[Pr.W,Pr.S],[Pr.N,Pr.E]],1:[[Pr.W,Pr.N],[Pr.S,Pr.E]]},6:[[Pr.N,Pr.S]],7:[[Pr.W,Pr.N]],8:[[Pr.W,Pr.N]],9:[[Pr.N,Pr.S]],10:{0:[[Pr.W,Pr.N],[Pr.S,Pr.E]],1:[[Pr.W,Pr.S],[Pr.N,Pr.E]]},11:[[Pr.N,Pr.E]],12:[[Pr.W,Pr.E]],13:[[Pr.S,Pr.E]],14:[[Pr.W,Pr.S]],15:[]};function pa(t){return parseInt(t,4)}var Aa=(dr={},Object(Kn.a)(dr,pa("0000"),[]),Object(Kn.a)(dr,pa("2222"),[]),Object(Kn.a)(dr,pa("2221"),[Er]),Object(Kn.a)(dr,pa("2212"),[Cr]),Object(Kn.a)(dr,pa("2122"),[Tr]),Object(Kn.a)(dr,pa("1222"),[Mr]),Object(Kn.a)(dr,pa("0001"),[Er]),Object(Kn.a)(dr,pa("0010"),[Cr]),Object(Kn.a)(dr,pa("0100"),[Tr]),Object(Kn.a)(dr,pa("1000"),[Mr]),Object(Kn.a)(dr,pa("2220"),[jr]),Object(Kn.a)(dr,pa("2202"),[Lr]),Object(Kn.a)(dr,pa("2022"),[Ir]),Object(Kn.a)(dr,pa("0222"),[zr]),Object(Kn.a)(dr,pa("0002"),[jr]),Object(Kn.a)(dr,pa("0020"),[Lr]),Object(Kn.a)(dr,pa("0200"),[Ir]),Object(Kn.a)(dr,pa("2000"),[zr]),Object(Kn.a)(dr,pa("0011"),[Dr]),Object(Kn.a)(dr,pa("0110"),[Br]),Object(Kn.a)(dr,pa("1100"),[Rr]),Object(Kn.a)(dr,pa("1001"),[Fr]),Object(Kn.a)(dr,pa("2211"),[Dr]),Object(Kn.a)(dr,pa("2112"),[Br]),Object(Kn.a)(dr,pa("1122"),[Rr]),Object(Kn.a)(dr,pa("1221"),[Fr]),Object(Kn.a)(dr,pa("2200"),[Nr]),Object(Kn.a)(dr,pa("2002"),[Ur]),Object(Kn.a)(dr,pa("0022"),[Nr]),Object(Kn.a)(dr,pa("0220"),[Ur]),Object(Kn.a)(dr,pa("1111"),[Vr]),Object(Kn.a)(dr,pa("1211"),[Gr]),Object(Kn.a)(dr,pa("2111"),[Wr]),Object(Kn.a)(dr,pa("1112"),[Hr]),Object(Kn.a)(dr,pa("1121"),[qr]),Object(Kn.a)(dr,pa("1011"),[Gr]),Object(Kn.a)(dr,pa("0111"),[Wr]),Object(Kn.a)(dr,pa("1110"),[Hr]),Object(Kn.a)(dr,pa("1101"),[qr]),Object(Kn.a)(dr,pa("1200"),[Zr]),Object(Kn.a)(dr,pa("0120"),[Xr]),Object(Kn.a)(dr,pa("0012"),[Qr]),Object(Kn.a)(dr,pa("2001"),[Yr]),Object(Kn.a)(dr,pa("1022"),[Zr]),Object(Kn.a)(dr,pa("2102"),[Xr]),Object(Kn.a)(dr,pa("2210"),[Qr]),Object(Kn.a)(dr,pa("0221"),[Yr]),Object(Kn.a)(dr,pa("1002"),[Kr]),Object(Kn.a)(dr,pa("2100"),[Jr]),Object(Kn.a)(dr,pa("0210"),[$r]),Object(Kn.a)(dr,pa("0021"),[ta]),Object(Kn.a)(dr,pa("1220"),[Kr]),Object(Kn.a)(dr,pa("0122"),[Jr]),Object(Kn.a)(dr,pa("2012"),[$r]),Object(Kn.a)(dr,pa("2201"),[ta]),Object(Kn.a)(dr,pa("0211"),[ea]),Object(Kn.a)(dr,pa("2110"),[na]),Object(Kn.a)(dr,pa("1102"),[ia]),Object(Kn.a)(dr,pa("1021"),[ra]),Object(Kn.a)(dr,pa("2011"),[ea]),Object(Kn.a)(dr,pa("0112"),[na]),Object(Kn.a)(dr,pa("1120"),[ia]),Object(Kn.a)(dr,pa("1201"),[ra]),Object(Kn.a)(dr,pa("2101"),[aa]),Object(Kn.a)(dr,pa("0121"),[aa]),Object(Kn.a)(dr,pa("1012"),[oa]),Object(Kn.a)(dr,pa("1210"),[oa]),Object(Kn.a)(dr,pa("0101"),{0:[Er,Tr],1:[aa],2:[aa]}),Object(Kn.a)(dr,pa("1010"),{0:[Mr,Cr],1:[oa],2:[oa]}),Object(Kn.a)(dr,pa("2121"),{0:[aa],1:[aa],2:[Er,Tr]}),Object(Kn.a)(dr,pa("1212"),{0:[oa],1:[oa],2:[Mr,Cr]}),Object(Kn.a)(dr,pa("2120"),{0:[sa],1:[sa],2:[jr,Tr]}),Object(Kn.a)(dr,pa("2021"),{0:[ua],1:[ua],2:[Er,Ir]}),Object(Kn.a)(dr,pa("1202"),{0:[la],1:[la],2:[Mr,Lr]}),Object(Kn.a)(dr,pa("0212"),{0:[ca],1:[ca],2:[Cr,zr]}),Object(Kn.a)(dr,pa("0102"),{0:[jr,Tr],1:[sa],2:[sa]}),Object(Kn.a)(dr,pa("0201"),{0:[Er,Ir],1:[ua],2:[ua]}),Object(Kn.a)(dr,pa("1020"),{0:[Mr,Lr],1:[la],2:[la]}),Object(Kn.a)(dr,pa("2010"),{0:[Cr,zr],1:[ca],2:[ca]}),Object(Kn.a)(dr,pa("2020"),{0:[zr,Lr],1:[ha],2:[jr,Ir]}),Object(Kn.a)(dr,pa("0202"),{0:[Ir,jr],1:[ha],2:[zr,Lr]}),dr),da={ISO_LINES:1,ISO_BANDS:2},va={zIndex:0,zOffset:.005};function ga(t,e){return Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function ma(t){var e=t.cellWeights,n=t.x,i=t.y,a=t.width,o=t.height,s=t.threshold;t.thresholdValue&&(r.deprecated("thresholdValue","threshold")(),s=t.thresholdValue);var u=n<0,l=n>=a-1,c=i<0,h=i>=o-1,f=u||l||c||h,p={},A={};u||h?A.top=0:(p.top=e[(i+1)*a+n],A.top=ga(p.top,s)),l||h?A.topRight=0:(p.topRight=e[(i+1)*a+n+1],A.topRight=ga(p.topRight,s)),l||c?A.right=0:(p.right=e[i*a+n+1],A.right=ga(p.right,s)),u||c?A.current=0:(p.current=e[i*a+n],A.current=ga(p.current,s));var d=A.top,v=A.topRight,g=A.right,m=A.current,y=-1;Number.isFinite(s)&&(y=d<<3|v<<2|g<<1|m),Array.isArray(s)&&(y=d<<6|v<<4|g<<2|m);var _=0;return f||(_=ga((p.top+p.topRight+p.right+p.current)/4,s)),{code:y,meanCode:_}}function ya(t){var e=t.gridOrigin,n=t.cellSize,i=t.x,r=t.y,a=t.code,o=t.meanCode,s=t.type,u=void 0===s?da.ISO_LINES:s,l=Object.assign({},va,t.thresholdData),c=u===da.ISO_BANDS?Aa[a]:fa[a];Array.isArray(c)||(c=c[o]);var h=l.zIndex*l.zOffset,f=(i+1)*n[0],p=(r+1)*n[1],A=e[0]+f,d=e[1]+p;if(u===da.ISO_BANDS){var v=[];return c.forEach(function(t){var e=[];t.forEach(function(t){var i=A+t[0]*n[0],r=d+t[1]*n[1];e.push([i,r,h])}),v.push(e)}),v}var g=[];return c.forEach(function(t){t.forEach(function(t){var e=A+t[0]*n[0],i=d+t[1]*n[1];g.push([e,i,h])})}),g}var _a=Zn.count,ba=a.fp64.fp64LowPart,xa=6378e3;function wa(t){return Number.isFinite(t)?t:0}function Sa(t){var e=t.data,n=t.getPosition,i=t.cellSizeMeters,a=t.gpuGridAggregator,o=t.gpuAggregation,s=t.aggregationFlags,u=t.weightParams,l=t.fp64,c=void 0!==l&&l,f=t.coordinateSystem,p=void 0===f?h.LNGLAT:f,A=t.viewport,d=void 0===A?null:A,v=t.boundingBox,g=void 0===v?null:v,m={};s.dataChanged&&(g=(m=function(t,e,n){var i,r,a=_a(t),o=new Float64Array(2*a),s=new Float32Array(2*a),u=1/0,l=-1/0,c=1/0,h=-1/0,f={};for(var p in n)f[p]=Object.assign({},n[p],{values:new Float32Array(3*a)});var A=ot(t),d=A.iterable,v=A.objectInfo,g=!0,m=!1,y=void 0;try{for(var _,b=d[Symbol.iterator]();!(g=(_=b.next()).done);g=!0){var x=_.value;v.index++;var w=e(x,v),S=v.index;for(var k in r=w[0],i=w[1],o[2*S]=r,o[2*S+1]=i,s[2*S]=ba(r),s[2*S+1]=ba(i),n){var O=n[k].getWeight(x);Array.isArray(O)?(f[k].values[3*S]=O[0],f[k].values[3*S+1]=O[1],f[k].values[3*S+2]=O[2]):f[k].values[3*S]=O}Number.isFinite(i)&&Number.isFinite(r)&&(u=i<u?i:u,l=i>l?i:l,c=r<c?r:c,h=r>h?r:h)}}catch(E){m=!0,y=E}finally{try{g||null==b.return||b.return()}finally{if(m)throw y}}var P={xMin:wa(c),xMax:wa(h),yMin:wa(u),yMax:wa(l)};return{positions:o,positions64xyLow:s,weights:f,boundingBox:P}}(e,n,u)).boundingBox);var y=[i,i],_=[0,0];switch(r.assert(p===h.LNGLAT||p===h.IDENTITY),p){case h.LNGLAT:case h.LNGLAT_DEPRECATED:var b=function(t,e){var n=t.yMin,i=t.yMax;return function(t,e){var n=(o=t,o/xa*(180/Math.PI)),i=(r=e,a=t,a/xa*(180/Math.PI)/Math.cos(r*Math.PI/180));var r,a;var o;return{yOffset:n,xOffset:i}}(e,(n+i)/2)}(g,i);y=[b.xOffset,b.yOffset],_=[-180,-90];break;case h.IDENTITY:_=[-d.width/2,-d.height/2];break;default:r.assert(!1)}var x=function(t){var e=t.boundingBox,n=t.cellSize,i=t.worldOrigin,r=e.yMin,a=e.yMax,o=e.xMin,s=e.xMax,u=ka(o-i[0],n[0])+i[0],l=ka(r-i[1],n[1])+i[1],c=(new he.a).translate([-1*u,-1*l,0]),h=[u,l],f=s-o+n[0],p=a-r+n[1],A=[Math.ceil(f/n[0]),Math.ceil(p/n[1])];return{gridOrigin:h,gridSize:A,width:f,height:p,gridTransformMatrix:c}}({boundingBox:g,cellSize:y,worldOrigin:_});return{weights:a.run({positions:m.positions,positions64xyLow:m.positions64xyLow,weights:m.weights,cellSize:y,width:x.width,height:x.height,gridTransformMatrix:x.gridTransformMatrix,useGPU:o,changeFlags:s,fp64:c}),gridSize:x.gridSize,gridOrigin:x.gridOrigin,cellSize:y,boundingBox:g}}function ka(t,e){var n=t<0?-1:1,i=n<0?Math.abs(t)+e:Math.abs(t);return(i=Math.floor(i/e)*e)*n}var Oa=[255,255,255,255],Pa={cellSize:{type:"number",min:1,max:1e3,value:1e3},getPosition:{type:"accessor",value:function(t){return t.position}},getWeight:{type:"accessor",value:function(t){return 1}},contours:[{threshold:1}],fp64:!1,zOffset:.005},Ea=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){var t=this.context.gl,e={id:"".concat(this.id,"-gpu-aggregator"),shaderCache:this.context.shaderCache};this.state={contourData:{},gridAggregator:new gi(t,e),colorTrigger:0,strokeWidthTrigger:0}}},{key:"updateState",value:function(t){var e=t.oldProps,n=t.props,i=t.changeFlags,r=!1,a=!1,o=this._getAggregationFlags({oldProps:e,props:n,changeFlags:i});o&&(r=!0,this.setState({countsData:null}),this._aggregateData(o)),this._shouldRebuildContours({oldProps:e,props:n})&&(a=!0,this._updateThresholdData(n)),r||a?this._generateContours():this._updateSubLayerTriggers(e,n)}},{key:"finalizeState",value:function(){Object(it.a)(Object(L.a)(e.prototype),"finalizeState",this).call(this),this.state.gridAggregator.delete()}},{key:"renderLayers",value:function(){var t=this.state.contourData,e=t.contourSegments,n=t.contourPolygons,i=e&&e.length>0,r=n&&n.length>0;return[i&&new nr(this._getLineLayerProps()),r&&new Or(this._getSolidPolygonLayerProps())]}},{key:"_aggregateData",value:function(t){var e=this.props,n=e.data,i=e.cellSize,r=e.getPosition,a=e.getWeight,o=e.gpuAggregation,s=e.fp64,u=e.coordinateSystem,l=Sa({data:n,cellSizeMeters:i,getPosition:r,weightParams:{count:{getWeight:a}},gpuAggregation:o,gpuGridAggregator:this.state.gridAggregator,fp64:s,coordinateSystem:u,viewport:this.context.viewport,boundingBox:this.state.boundingBox,aggregationFlags:t}),c=l.weights,h=l.gridSize,f=l.gridOrigin,p=l.cellSize,A=l.boundingBox;this.setState({countsData:c.count.aggregationData,countsBuffer:c.count.aggregationBuffer,gridSize:h,gridOrigin:f,cellSize:p,boundingBox:A})}},{key:"_generateContours",value:function(){var t=this.state,e=t.gridSize,n=t.gridOrigin,i=t.cellSize,r=t.thresholdData,a=this.state.countsData;a||(a=this.state.countsBuffer.getData(),this.setState({countsData:a}));var o=function(t){var e=t.thresholdData,n=(t.colors,t.cellWeights),i=t.gridSize,r=t.gridOrigin,a=t.cellSize,o=[],s=[],u=i[0],l=i[1];return e.forEach(function(t,e){for(var i=t.threshold,c=-1;c<u;c++)for(var h=-1;h<l;h++){var f=ma({cellWeights:n,threshold:i,x:c,y:h,width:u,height:l}),p=f.code,A=f.meanCode,d={gridOrigin:r,cellSize:a,x:c,y:h,width:u,height:l,code:p,meanCode:A,thresholdData:t};if(Array.isArray(i))d.type=da.ISO_BANDS,ya(d).forEach(function(t){s.push({vertices:t,threshold:i})});else{d.type=da.ISO_LINES;for(var v=ya(d),g=0;g<v.length;g+=2)o.push({start:v[g],end:v[g+1],threshold:i})}}}),{contourSegments:o,contourPolygons:s}}({thresholdData:r,cellWeights:gi.getCellData({countsData:a}).cellWeights,gridSize:e,gridOrigin:n,cellSize:i});this.setState({contourData:o})}},{key:"_getAggregationFlags",value:function(t){var e=t.oldProps,n=t.props,i=t.changeFlags,r=null;return(i.dataChanged||e.gpuAggregation!==n.gpuAggregation||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition))&&(r=Object.assign({},r,{dataChanged:!0})),e.cellSize!==n.cellSize&&(r=Object.assign({},r,{cellSizeChanged:!0})),r}},{key:"_getLineLayerProps",value:function(){var t=this.props.fp64,e=this.state,n=e.colorTrigger,i=e.strokeWidthTrigger;return this.getSubLayerProps({id:"contour-line-layer",data:this.state.contourData.contourSegments,fp64:t,getSourcePosition:function(t){return t.start},getTargetPosition:function(t){return t.end},getColor:this._onGetSublayerColor.bind(this),getWidth:this._onGetSublayerStrokeWidth.bind(this),widthUnits:"pixels",updateTriggers:{getColor:n,getWidth:i}})}},{key:"_getSolidPolygonLayerProps",value:function(){var t=this.props.fp64,e=this.state.colorTrigger;return this.getSubLayerProps({id:"contour-solid-polygon-layer",data:this.state.contourData.contourPolygons,fp64:t,getPolygon:function(t){return t.vertices},getFillColor:this._onGetSublayerColor.bind(this),updateTriggers:{getFillColor:e}})}},{key:"_onGetSublayerColor",value:function(t){var e=this.props.contours,n=Oa;return e.forEach(function(e){Object(ce.e)(e.threshold,t.threshold)&&(n=e.color||Oa)}),n}},{key:"_onGetSublayerStrokeWidth",value:function(t){var e=this.props.contours,n=1;return e.some(function(e){return e.threshold===t.threshold&&(n=e.strokeWidth||1,!0)}),n}},{key:"_shouldRebuildContours",value:function(t){var e=t.oldProps,n=t.props;if(!e.contours||!e.zOffset||e.contours.length!==n.contours.length||e.zOffset!==n.zOffset)return!0;var i=e.contours.map(function(t){return t.threshold}),r=n.contours.map(function(t){return t.threshold});return r.some(function(t,e){return!Object(ce.e)(r[e],i[e])})}},{key:"_updateSubLayerTriggers",value:function(t,e){t&&t.contours&&e&&e.contours&&(e.contours.some(function(e,n){return e.color!==t.contours[n].color})&&this.state.colorTrigger++,e.contours.some(function(e,n){return e.strokeWidth!==t.contours[n].strokeWidth})&&this.state.strokeWidthTrigger++)}},{key:"_updateThresholdData",value:function(t){var e=t.contours.map(function(e,n){return{threshold:e.threshold,zIndex:e.zIndex||n,zOffset:t.zOffset}});this.setState({thresholdData:e})}}]),e}(yn);Ea.layerName="ContourLayer",Ea.defaultProps=Pa;var Ca=a.fp64.fp64LowPart,Ta=new a.PhongMaterial,Ma={colorDomain:null,colorRange:Xn,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,fp64:!1,material:Ta},ja=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){return{vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec2 centroidPosition64xyLow = vec2(instancePositionXFP64[1], instancePositionYFP64[1]);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:["project32","gouraud-lighting","picking","fp64"]}}},{key:"initializeState",value:function(){var t=this.context.gl;this.getAttributeManager().addInstanced({colors:{size:4,update:this.calculateColors,noAlloc:!0},elevations:{size:4,update:this.calculateElevations,noAlloc:!0}});var e=this._getModel(t);this._setupUniformBuffer(e),this.setState({model:e})}},{key:"_getModel",value:function(t){return new a.Model(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new a.CubeGeometry,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,i=n.data,r=n.cellSize,a=n.offset,o=n.extruded,s=n.elevationScale,u=n.coverage,l=n.gridSize,c=n.gridOrigin,h=n.gridOffset,f=n.colorRange,p=n.elevationRange,A=[Ca(c[0]),Ca(c[1])],d=[Ca(h[0]),Ca(h[1])],v=i.color.maxMinBuffer,g=i.elevation.maxMinBuffer;v.bind({target:35345,index:0}),g.bind({target:35345,index:1});var m=this.getDomainUniforms();this.state.model.setUniforms(Object.assign({},e,m,{cellSize:r,offset:a,extruded:o,elevationScale:s,coverage:u,gridSize:l,gridOrigin:c,gridOriginLow:A,gridOffset:h,gridOffsetLow:d,colorRange:f,elevationRange:p})).draw(),v.unbind({target:35345,index:0}),g.unbind({target:35345,index:1})}},{key:"calculateColors",value:function(t){var e=this.props.data;t.update({buffer:e.color.aggregationBuffer})}},{key:"calculateElevations",value:function(t){var e=this.props.data;t.update({buffer:e.elevation.aggregationBuffer})}},{key:"getDomainUniforms",value:function(){var t=this.props,e=t.colorDomain,n=t.elevationDomain,i={};return null!==e?(i.colorDomainValid=!0,i.colorDomain=e):i.colorDomainValid=!1,null!==n?(i.elevationDomainValid=!0,i.elevationDomain=n):i.elevationDomainValid=!1,i}},{key:"_setupUniformBuffer",value:function(t){var e=this.context.gl,n=t.program.handle,i=e.getUniformBlockIndex(n,"ColorData"),r=e.getUniformBlockIndex(n,"ElevationData");e.uniformBlockBinding(n,i,0),e.uniformBlockBinding(n,r,1)}}]),e}(ue);ja.layerName="GPUGridCellLayer",ja.defaultProps=Ma;var La={colorDomain:null,colorRange:Xn,getColorWeight:{type:"accessor",value:function(t){return 1}},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:function(t){return 1}},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(t){return t.position}},extruded:!1,fp64:!1,material:new a.PhongMaterial,gpuAggregation:!0},Ia=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){var t=this.context.gl,e=gi.isSupported(t);e||r.error("GPUGridLayer is not supported on this browser, use GridLayer instead")();var n={id:"".concat(this.id,"-gpu-aggregator"),shaderCache:this.context.shaderCache};this.state={gpuGridAggregator:new gi(t,n),isSupported:e}}},{key:"updateState",value:function(t){var e=this.getAggregationFlags(t);e&&(this.getLayerData(e),this.setState({gridHash:null}))}},{key:"finalizeState",value:function(){Object(it.a)(Object(L.a)(e.prototype),"finalizeState",this).call(this),this.state.gpuGridAggregator.delete()}},{key:"getAggregationFlags",value:function(t){var e=t.oldProps,n=t.props,i=t.changeFlags,r=null;return!!this.state.isSupported&&(this.isDataChanged({oldProps:e,props:n,changeFlags:i})&&(r=Object.assign({},r,{dataChanged:!0})),e.cellSize!==n.cellSize&&(r=Object.assign({},r,{cellSizeChanged:!0})),r)}},{key:"isDataChanged",value:function(t){var e=t.oldProps,n=t.props,i=t.changeFlags;return!!i.dataChanged||(e.gpuAggregation!==n.gpuAggregation||(e.colorAggregation!==n.colorAggregation||e.elevationAggregation!==n.elevationAggregation||!(!i.updateTriggersChanged||!(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition||i.updateTriggersChanged.getColorWeight||i.updateTriggersChanged.getElevationWeight))))}},{key:"getHashKeyForIndex",value:function(t){var e=this.state,n=e.gridSize,i=e.gridOrigin,r=e.cellSize,a=Math.floor(t/n[0]),o=t-a*n[0],s=Math.floor((a*r[1]+i[1]+90+r[1]/2)/r[1]),u=Math.floor((o*r[0]+i[0]+180+r[0]/2)/r[0]);return"".concat(s,"-").concat(u)}},{key:"getPositionForIndex",value:function(t){var e=this.state,n=e.gridSize,i=e.gridOrigin,r=e.cellSize,a=Math.floor(t/n[0]),o=t-a*n[0],s=a*r[1]+i[1];return[o*r[0]+i[0],s]}},{key:"getPickingInfo",value:function(t){var e=t.info,n=t.mode,i=e.index,r=null;if(i>=0){var a=this.state.gpuGridAggregator,o=this.getPositionForIndex(i),s=gi.getAggregationData(Object.assign({pixelIndex:i},a.getData("color"))),u=gi.getAggregationData(Object.assign({pixelIndex:i},a.getData("elevation")));if(r={colorValue:s.cellWeight,elevationValue:u.cellWeight,count:s.cellCount||u.cellCount,position:o,totalCount:s.totalCount||u.totalCount},"hover"!==n){var l=this.props,c=l.data,h=l.getPosition,f=this.state.gridHash;if(!f)f=Ri(c,this.props.cellSize,h).gridHash,this.setState({gridHash:f});var p=f[this.getHashKeyForIndex(i)];Object.assign(r,p)}}return Object.assign(e,{picked:Boolean(r),object:r})}},{key:"getLayerData",value:function(t){var e=this.props,n=e.data,i=e.cellSize,r=e.getPosition,a=e.gpuAggregation,o=e.getColorWeight,s=e.colorAggregation,u=e.getElevationWeight,l=e.elevationAggregation,c=e.fp64,h=Sa({data:n,cellSizeMeters:i,getPosition:r,weightParams:{color:{getWeight:o,operation:Jn[s]||Jn[La.colorAggregation],needMin:!0,needMax:!0,combineMaxMin:!0},elevation:{getWeight:u,operation:Jn[l]||Jn[La.elevationAggregation],needMin:!0,needMax:!0,combineMaxMin:!0}},gpuAggregation:a,gpuGridAggregator:this.state.gpuGridAggregator,boundingBox:this.state.boundingBox,aggregationFlags:t,fp64:c}),f=h.weights,p=h.gridSize,A=h.gridOrigin,d=h.cellSize,v=h.boundingBox;this.setState({weights:f,gridSize:p,gridOrigin:A,cellSize:d,boundingBox:v})}},{key:"renderLayers",value:function(){if(!this.state.isSupported)return null;var t=this.props,e=t.elevationScale,n=t.fp64,i=t.extruded,r=t.cellSize,a=t.coverage,o=t.material,s=t.elevationRange,u=t.colorDomain,l=t.elevationDomain,c=this.state,h=c.weights,f=c.gridSize,p=c.gridOrigin,A=c.cellSize,d=Qn(this.props.colorRange,Float32Array,255);return new(this.getSubLayerClass("gpu-grid-cell",ja))({gridSize:f,gridOrigin:p,gridOffset:A,colorRange:d,elevationRange:s,colorDomain:u,elevationDomain:l,fp64:n,cellSize:r,coverage:a,material:o,elevationScale:e,extruded:i},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:h,numInstances:f[0]*f[1]})}}]),e}(yn);Ia.layerName="GPUGridLayer",Ia.defaultProps=La;var za=Object.assign({},Ia.defaultProps,Gi.defaultProps,{gpuAggregation:!1}),Da=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){this.state={useGPUAggregation:!0}}},{key:"updateState",value:function(t){t.oldProps;var e=t.props,n=(t.changeFlags,{});n.useGPUAggregation=this.canUseGPUAggregation(e),this.setState(n)}},{key:"renderLayers",value:function(){var t=this.props,e=t.data,n=t.updateTriggers,i=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",Ia):this.getSubLayerClass("CPU",Gi))(this.props,this.getSubLayerProps({id:i,updateTriggers:n}),{data:e})}},{key:"canUseGPUAggregation",value:function(t){var e=t.gpuAggregation,n=t.lowerPercentile,i=t.upperPercentile,r=t.getColorValue,a=t.getElevationValue;return!!e&&(!!gi.isSupported(this.context.gl)&&(0===n&&100===i&&(null===r&&null===a)))}}]),e}(yn);Da.layerName="GridLayer",Da.defaultProps=za;var Ba={BinSorter:Li,linearScale:function(t,e,n){return(n-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]},getLinearScale:Di,quantizeScale:Ii,getQuantizeScale:zi,defaultColorRange:Xn},Ra="#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",Fa=a.fp64.fp64LowPart,Na=[0,0,0,255],Ua={fp64:!1,getSourcePosition:{type:"accessor",value:function(t){return t.sourcePosition}},getTargetPosition:{type:"accessor",value:function(t){return t.targetPosition}},getSourceColor:{type:"accessor",value:Na},getTargetColor:{type:"accessor",value:Na},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0},getStrokeWidth:{deprecatedFor:"getWidth"}},Va=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){return this.use64bitProjection()?{vs:"#define SHADER_NAME arc-layer-vertex-shader-64\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\n\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\n\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\n\nvec2 paraboloid_fp64(vec2 source[2], vec2 target[2], float ratio) {\n\n  vec2 x[2];\n  vec2_mix_fp64(source, target, ratio, x);\n  vec2 center[2];\n  vec2_mix_fp64(source, target, 0.5, center);\n\n  vec2 dSourceCenter = vec2_distance_fp64(source, center);\n  vec2 dXCenter = vec2_distance_fp64(x, center);\n  return mul_fp64(sum_fp64(dSourceCenter, dXCenter), sub_fp64(dSourceCenter, dXCenter));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvoid get_pos_fp64(vec2 source[2], vec2 target[2], float segmentRatio, out vec2 position[4]) {\n\n  vec2 vertex_height = paraboloid_fp64(source, target, segmentRatio);\n\n  vec2 position_temp[2];\n\n  vec2_mix_fp64(source, target, segmentRatio, position_temp);\n\n  position[0] = position_temp[0];\n  position[1] = position_temp[1];\n\n  if (vertex_height.x < 0.0 || (vertex_height.x == 0.0 && vertex_height.y <= 0.0)) {\n    vertex_height = vec2(0.0, 0.0);\n  }\n\n  position[2] = sqrt_fp64(vertex_height);\n  position[3] = vec2(1.0, 0.0);\n}\n\nvoid main(void) {\n  vec2 projected_source_coord[2];\n  vec2 projected_target_coord[2];\n\n  project_position_fp64(instancePositions.xy, instancePositions64Low.xy, projected_source_coord);\n  project_position_fp64(instancePositions.zw, instancePositions64Low.zw, projected_target_coord);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 curr_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, segmentRatio,\n    curr_pos_modelspace);\n\n  vec2 next_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, nextSegmentRatio,\n    next_pos_modelspace);\n\n  vec4 curr_pos_clipspace = project_common_position_to_clipspace_fp64(curr_pos_modelspace);\n  vec4 next_pos_clipspace = project_common_position_to_clipspace_fp64(next_pos_modelspace);\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n\n  vec2 offset = getExtrusionOffset(next_pos_clipspace.xy - curr_pos_clipspace.xy, positions.y, widthPixels);\n\n  gl_Position = curr_pos_clipspace + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:Ra,modules:["project64","picking"]}:{vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertexHeight = sqrt(max(0.0, paraboloid(source, target, segmentRatio))) * instanceHeights;\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target - source);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * vertexHeight * sin(tiltAngle);\n\n  return vec3(\n    mix(source, target, segmentRatio) + tilt,\n    vertexHeight * cos(tiltAngle)\n  );\n}\n\nvoid main(void) {\n  vec2 source = project_position(vec3(instancePositions.xy, 0.0), instancePositions64Low.xy).xy;\n  vec2 target = project_position(vec3(instancePositions.zw, 0.0), instancePositions64Low.zw).xy;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec3 currPos = getPos(source, target, segmentRatio);\n  vec3 nextPos = getPos(source, target, nextSegmentRatio);\n  vec4 curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n  vec4 next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:Ra,modules:["picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:4,transition:!0,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions},instancePositions64Low:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions64Low},instanceSourceColors:{size:4,type:5121,transition:!0,accessor:"getSourceColor",defaultValue:Na},instanceTargetColors:{size:4,type:5121,transition:!0,accessor:"getTargetColor",defaultValue:Na},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(t){var n=t.props,i=t.oldProps,r=t.changeFlags;if(Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r}),n.fp64!==i.fp64){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,i=this.props,r=i.widthUnits,a=i.widthScale,o=i.widthMinPixels,s=i.widthMaxPixels,u="pixels"===r?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},e,{widthScale:a*u,widthMinPixels:o,widthMaxPixels:s})).draw()}},{key:"_getModel",value:function(t){for(var e=[],n=0;n<50;n++)e=e.concat([n,-1,0,n,1,0]);var i=new a.Model(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new a.Geometry({drawMode:5,attributes:{positions:new Float32Array(e)}}),isInstanced:!0,shaderCache:this.context.shaderCache}));return i.setUniforms({numSegments:50}),i}},{key:"calculateInstancePositions",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.props,a=r.data,o=r.getSourcePosition,s=r.getTargetPosition,u=t.value,l=n*t.size,c=ot(a,n,i),h=c.iterable,f=c.objectInfo,p=!0,A=!1,d=void 0;try{for(var v,g=h[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var m=v.value;f.index++;var y=o(m,f);u[l++]=y[0],u[l++]=y[1];var _=s(m,f);u[l++]=_[0],u[l++]=_[1]}}catch(b){A=!0,d=b}finally{try{p||null==g.return||g.return()}finally{if(A)throw d}}}},{key:"calculateInstancePositions64Low",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.use64bitPositions();if(t.constant=!r,r){var a=this.props,o=a.data,s=a.getSourcePosition,u=a.getTargetPosition,l=t.value,c=n*t.size,h=ot(o,n,i),f=h.iterable,p=h.objectInfo,A=!0,d=!1,v=void 0;try{for(var g,m=f[Symbol.iterator]();!(A=(g=m.next()).done);A=!0){var y=g.value;p.index++;var _=s(y,p);l[c++]=Fa(_[0]),l[c++]=Fa(_[1]);var b=u(y,p);l[c++]=Fa(b[0]),l[c++]=Fa(b[1])}}catch(x){d=!0,v=x}finally{try{A||null==m.return||m.return()}finally{if(d)throw v}}}else t.value=new Float32Array(4)}}]),e}(ue);Va.layerName="ArcLayer",Va.defaultProps=Ua;var Ga=n("o0o1"),Wa=n.n(Ga),Ha=n("HaE+"),qa=n("eqkD"),Za=!1,Xa=!0,Qa=new Map([["image/png",{test:function(t){return t.byteLength>=24&&2303741511===t.getUint32(0,Za)},getSize:function(t){return{width:t.getUint32(16,Za),height:t.getUint32(20,Za)}}}],["image/jpeg",{test:function(t){return t.byteLength>=2&&65496===t.getUint16(0,Za)},getSize:function(t){if(t.byteLength<2||65496!==t.getUint16(0,Za))return null;var e=function(){for(var t=new Set([65499,65476,65484,65501,65534]),e=65504;e<65520;++e)t.add(e);var n=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:n}}(),n=e.tableMarkers,i=e.sofMarkers,r=2;for(;r<t.byteLength;){var a=t.getUint16(r,Za);if(i.has(a))return{height:t.getUint16(r+5,Za),width:t.getUint16(r+7,Za)};if(!n.has(a))return null;r+=2,r+=t.getUint16(r,Za)}return null}}],["image/gif",{test:function(t){return t.byteLength>=10&&1195984440===t.getUint32(0,Za)},getSize:function(t){return{width:t.getUint16(6,Xa),height:t.getUint16(8,Xa)}}}],["image/bmp",{test:function(t){return t.byteLength>=2&&16973===t.getUint16(0,Za)},getSize:function(t){return{width:t.getUint32(18,Xa),height:t.getUint32(22,Xa)}}}]]);var Ya="Invalid MIME type. Supported MIME types are: ".concat(Array.from(Qa.keys()).join(", "));function Ka(t){var e=to(t),n=!0,i=!1,r=void 0;try{for(var a,o=Qa.entries()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=Object(N.a)(a.value,2),u=s[0];if((0,s[1].test)(e))return u}}catch(l){i=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return null}function Ja(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(0,$a(e=e||Ka(t)).getSize)(to(t));if(!n)throw new Error("invalid image data for type: ".concat(e));return n}(t,e=e||Ka(t));return n.mimeType=e,n}function $a(t){var e=Qa.get(t);if(!e)throw new Error(Ya);return e}function to(t){if(t instanceof ArrayBuffer||ArrayBuffer.isView(t))return new DataView(t.buffer||t);throw new Error("toDataView")}qa.a._parseImageNode;function eo(t,e){if(qa.a._parseImageNode){var n=Ja(t).mimeType;return qa.a._parseImageNode(t,n,e)}return function(t){if("undefined"==typeof createImageBitmap)throw new Error("parseImage");var e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)}(t)}function no(t,e){return io.apply(this,arguments)}function io(){return(io=Object(Ha.a)(Wa.a.mark(function t(e,n){var i,r;return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"!=typeof Image){t.next=8;break}return t.next=3,fetch(e,n);case 3:return i=t.sent,t.next=6,i.arrayBuffer();case 6:return r=t.sent,t.abrupt("return",eo(r));case 8:return t.next=10,ro(e,n);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}},t)}))).apply(this,arguments)}function ro(t,e){return ao.apply(this,arguments)}function ao(){return(ao=Object(Ha.a)(Wa.a.mark(function t(e,n){var i,r,a;return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!/\.svg((\?|#).*)?$/.test(e)){t.next=10;break}return t.next=3,fetch(e,n);case 3:return r=t.sent,t.next=6,r.text();case 6:a=t.sent,i="data:image/svg+xml;base64,".concat(btoa(a)),t.next=13;break;case 10:return t.next=12,e;case 12:i=t.sent;case 13:return t.next=15,new Promise(function(t,r){try{var a=new Image;a.onload=function(){return t(a)},a.onerror=function(t){return r(new Error("Could not load image ".concat(e,": ").concat(t)))},a.crossOrigin=n&&n.crossOrigin||"anonymous",a.src=i}catch(o){r(o)}});case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}},t)}))).apply(this,arguments)}var oo,so=a.fp64.fp64LowPart,uo=(oo={},Object(Kn.a)(oo,10241,9987),Object(Kn.a)(oo,10240,9729),Object(Kn.a)(oo,10242,33071),Object(Kn.a)(oo,10243,33071),oo),lo=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 instancePickingColors;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, positions64xyLow, vec3(0.0));\n \n  vTexCoord = texCoords;\n \n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor / 255.0;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor / 255.0, vec4(color, 1.0), alpha);\n}\n\nvoid main(void) {\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().add({positions:{size:3,update:this.calculatePositions,value:new Float32Array(12)},positions64xyLow:{size:3,update:this.calculatePositions64xyLow,value:new Float32Array(12)}}),this.setState({numInstances:4})}},{key:"updateState",value:function(t){var e=t.props,n=t.oldProps;t.changeFlags;if(e.fp64!==n.fp64){var i=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(i)}),this.getAttributeManager().invalidateAll()}e.image!==n.image&&this.loadTexture(e.image);var r=this.getAttributeManager();e.bounds!==n.bounds&&(this.setState({positions:this._getPositionsFromBounds(e.bounds)}),r.invalidate("positions"),r.invalidate("positions64xyLow"))}},{key:"finalizeState",value:function(){Object(it.a)(Object(L.a)(e.prototype),"finalizeState",this).call(this),this.state.bitmapTexture&&this.state.bitmapTexture.delete()}},{key:"_getPositionsFromBounds",value:function(t){var e=new Array(12);if(Number.isFinite(t[0]))e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[0],e[4]=t[3],e[5]=0,e[6]=t[2],e[7]=t[3],e[8]=0,e[9]=t[2],e[10]=t[1],e[11]=0;else for(var n=0;n<t.length;n++)e[3*n+0]=t[n][0],e[3*n+1]=t[n][1],e[3*n+2]=t[n][2]||0;return e}},{key:"_getModel",value:function(t){return t?new a.Model(t,Object.assign({},this.getShaders(),{id:this.props.id,shaderCache:this.context.shaderCache,geometry:new a.Geometry({drawMode:6,vertexCount:4,attributes:{texCoords:new Float32Array([0,0,0,1,1,1,1,0])}}),isInstanced:!1})):null}},{key:"draw",value:function(t){var e=t.uniforms,n=this.state,i=n.bitmapTexture,r=n.model,a=this.props,o=a.desaturate,s=a.transparentColor,u=a.tintColor;i&&r&&r.setUniforms(Object.assign({},e,{bitmapTexture:i,desaturate:o,transparentColor:s,tintColor:u})).draw()}},{key:"loadTexture",value:function(t){var e=this;if("string"==typeof t&&(t=no(t)),t instanceof Promise)t.then(function(t){return e.loadTexture(t)});else{var n=this.context.gl;this.state.bitmapTexture&&this.state.bitmapTexture.delete(),t instanceof a.Texture2D?this.setState({bitmapTexture:t}):(t instanceof Image||t instanceof HTMLCanvasElement)&&this.setState({bitmapTexture:new a.Texture2D(n,{data:t,parameters:uo})})}}},{key:"calculatePositions",value:function(t){var e=t.value,n=this.state.positions;e.set(n)}},{key:"calculatePositions64xyLow",value:function(t){var e=this.use64bitPositions();(t.constant=!e,e)?t.value.set(this.state.positions.map(so)):t.value=new Float32Array(4)}}]),e}(ue);lo.layerName="BitmapLayer",lo.defaultProps={image:null,bounds:{type:"array",value:[1,0,0,1],compare:!0},fp64:!1,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};var co,ho=1024,fo=4,po=function(){},Ao=(co={},Object(Kn.a)(co,10241,9987),Object(Kn.a)(co,10240,9729),co);function vo(t){return t&&(t.id||t.url)}function go(t,e,n){for(var i=0;i<e.length;i++){var r=e[i],a=r.icon,o=r.xOffset;t[vo(a)]=Object.assign({},a,{x:o,y:n})}}var mo=function(){function t(e,n){var i=n.onUpdate,r=void 0===i?po:i;Object(T.a)(this,t),this.gl=e,this.onUpdate=r,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._buffer=fo,this._canvasWidth=ho,this._canvasHeight=0,this._canvas=null}return Object(M.a)(t,[{key:"finalize",value:function(){this._texture&&this._texture.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(t,e){var n=this._getIcon(t,e),i=this._autoPacking?vo(n):n;return this._mapping[i]||{}}},{key:"setProps",value:function(t){var e=t.autoPacking,n=t.iconAtlas,i=t.iconMapping,r=t.data,a=t.getIcon;void 0!==e&&(this._autoPacking=e),a&&(this._getIcon=a),i&&(this._mapping=i),n&&this._updateIconAtlas(n),this._autoPacking&&(r||a)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(r))}},{key:"_updateIconAtlas",value:function(t){var e=this;this._texture&&(this._texture.delete(),this._texture=null),t instanceof a.Texture2D?(t.setParameters(Ao),this._externalTexture=t,this.onUpdate()):"string"==typeof t&&no(t).then(function(t){e._texture=new a.Texture2D(e.gl,{data:t,parameters:Ao}),e.onUpdate()})}},{key:"_updateAutoPacking",value:function(t){var e,n,i,r,o,s,u=Object.values(function(t,e,n){if(!t||!e)return null;n=n||{};var i={},r=ot(t),a=r.iterable,o=r.objectInfo,s=!0,u=!1,l=void 0;try{for(var c,h=a[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var f=c.value;o.index++;var p=e(f,o),A=vo(p);if(!p)throw new Error("Icon is missing.");if(!p.url)throw new Error("Icon url is missing.");i[A]||n[A]&&p.url===n[A].url||(i[A]=p)}}catch(d){u=!0,l=d}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}return i}(t,this._getIcon,this._mapping)||{});if(u.length>0){var l=function(t){for(var e,n=t.icons,i=t.buffer,r=t.mapping,a=void 0===r?{}:r,o=t.xOffset,s=void 0===o?0:o,u=t.yOffset,l=void 0===u?0:u,c=t.canvasWidth,h=0,f=[],p=0;p<n.length;p++){var A=n[p];if(!a[vo(A)]){var d=A.height,v=A.width;s+v+i>c&&(go(a,f,l),s=0,l=h+l+i,h=0,f=[]),f.push({icon:A,xOffset:s}),s=s+v+i,h=Math.max(h,d)}}return f.length>0&&go(a,f,l),{mapping:a,xOffset:s,yOffset:l,canvasWidth:c,canvasHeight:(e=h+l+i,Math.pow(2,Math.ceil(Math.log2(e))))}}({icons:u,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,xOffset:this._xOffset,yOffset:this._yOffset}),c=l.mapping,h=l.xOffset,f=l.yOffset,p=l.canvasHeight;this._mapping=c,this._xOffset=h,this._yOffset=f,this._canvasHeight=p,this._texture||(this._texture=new a.Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:Ao})),this._texture.height!==this._canvasHeight&&(e=this._texture,n=this._canvasWidth,i=this._canvasHeight,r=e.width,o=e.height,s=Object(a.readPixelsToBuffer)(e,{}),e.resize({width:n,height:i}),e.setSubImageData({data:s,x:0,y:i-o,width:r,height:o,parameters:Ao}),e.generateMipmap(),s.delete()),this.onUpdate(),this._loadIcons(u)}}},{key:"_loadIcons",value:function(t){var e=this,n=this._canvas.getContext("2d"),i=this._texture.height,r=!0,a=!1,o=void 0;try{for(var s,u=function(){var t=s.value;no(t.url).then(function(r){var a=vo(t),o=e._mapping[a],s=o.x,u=o.y,l=o.width,c=o.height,h=function(t,e,n,i){var r=e.naturalWidth,a=e.naturalHeight;return n===r&&i===a?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,r,a,0,0,n,i),t.canvas)}(n,r,l,c);e._texture.setSubImageData({data:h,x:s,y:i-u-c,width:l,height:c,parameters:Object.assign({},Ao,Object(Kn.a)({},37440,!0))}),e._texture.generateMipmap(),e.onUpdate()})},l=t[Symbol.iterator]();!(r=(s=l.next()).done);r=!0)u()}catch(c){a=!0,o=c}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}}}]),t}(),yo=a.fp64.fp64LowPart,_o=[0,0,0,255],bo={iconAtlas:null,iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},fp64:!1,billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:function(t){return t.position}},getIcon:{type:"accessor",value:function(t){return t.icon}},getColor:{type:"accessor",value:_o},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0}},xo=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n\n  if (billboard)  {\n    pixelOffset.y *= -1.0;\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.0)); \n    gl_Position.xy += project_pixel_size_to_clipspace(pixelOffset);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset_common); \n  }\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vColor = instanceColors / 255.;\n\n  vColorMode = instanceColorModes;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nconst float MIN_ALPHA = 0.05;\n\nvoid main(void) {\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < MIN_ALPHA) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){var t=this;this.state={iconManager:new mo(this.context.gl,{onUpdate:function(){return t._onUpdate()}})},this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",update:this.calculateInstanceOffsets},instanceIconFrames:{size:4,accessor:"getIcon",update:this.calculateInstanceIconFrames},instanceColorModes:{size:1,type:5121,accessor:"getIcon",update:this.calculateInstanceColorMode},instanceColors:{size:4,type:5121,transition:!0,accessor:"getColor",defaultValue:_o},instanceAngles:{size:1,transition:!0,accessor:"getAngle",defaultValue:0}})}},{key:"updateState",value:function(t){var n=t.oldProps,i=t.props,r=t.changeFlags;Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:r});var a=this.getAttributeManager(),o=this.state.iconManager,s=i.iconAtlas,u=i.iconMapping,l=i.data,c=i.getIcon,h=!1;if(s?(n.iconAtlas!==i.iconAtlas&&o.setProps({iconAtlas:s,autoPacking:!1}),n.iconMapping!==i.iconMapping&&(o.setProps({iconMapping:u}),h=!0)):o.setProps({autoPacking:!0}),(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&(o.setProps({data:l,getIcon:c}),h=!0),h&&(a.invalidate("instanceOffsets"),a.invalidate("instanceIconFrames"),a.invalidate("instanceColorModes")),i.fp64!==n.fp64){var f=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(f)}),a.invalidateAll()}}},{key:"finalizeState",value:function(){Object(it.a)(Object(L.a)(e.prototype),"finalizeState",this).call(this),this.state.iconManager.finalize()}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,i=n.sizeScale,r=n.sizeMinPixels,a=n.sizeMaxPixels,o=n.sizeUnits,s=n.billboard,u=this.state.iconManager,l=this.context.viewport,c=u.getTexture();c&&this.state.model.setUniforms(Object.assign({},e,{iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeScale:i*("pixels"===o?l.distanceScales.metersPerPixel[2]:1),sizeMinPixels:r,sizeMaxPixels:a,billboard:s})).draw()}},{key:"_getModel",value:function(t){return new a.Model(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new a.Geometry({drawMode:6,attributes:{positions:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"calculateInstancePositions64xyLow",value:function(t){var e=this.use64bitPositions();if(t.constant=!e,e){var n=this.props,i=n.data,r=n.getPosition,a=t.value,o=0,s=ot(i),u=s.iterable,l=s.objectInfo,c=!0,h=!1,f=void 0;try{for(var p,A=u[Symbol.iterator]();!(c=(p=A.next()).done);c=!0){var d=p.value;l.index++;var v=r(d,l);a[o++]=yo(v[0]),a[o++]=yo(v[1])}}catch(g){h=!0,f=g}finally{try{c||null==A.return||A.return()}finally{if(h)throw f}}}else t.value=new Float32Array(2)}},{key:"calculateInstanceOffsets",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.props.data,a=this.state.iconManager,o=t.value,s=n*t.size,u=ot(r,n,i),l=u.iterable,c=u.objectInfo,h=!0,f=!1,p=void 0;try{for(var A,d=l[Symbol.iterator]();!(h=(A=d.next()).done);h=!0){var v=A.value;c.index++;var g=a.getIconMapping(v,c);o[s++]=g.width/2-g.anchorX||0,o[s++]=g.height/2-g.anchorY||0}}catch(m){f=!0,p=m}finally{try{h||null==d.return||d.return()}finally{if(f)throw p}}}},{key:"calculateInstanceColorMode",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.props.data,a=this.state.iconManager,o=t.value,s=n*t.size,u=ot(r,n,i),l=u.iterable,c=u.objectInfo,h=!0,f=!1,p=void 0;try{for(var A,d=l[Symbol.iterator]();!(h=(A=d.next()).done);h=!0){var v=A.value;c.index++;var g=a.getIconMapping(v,c).mask;o[s++]=g?1:0}}catch(m){f=!0,p=m}finally{try{h||null==d.return||d.return()}finally{if(f)throw p}}}},{key:"calculateInstanceIconFrames",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.props.data,a=this.state.iconManager,o=t.value,s=n*t.size,u=ot(r,n,i),l=u.iterable,c=u.objectInfo,h=!0,f=!1,p=void 0;try{for(var A,d=l[Symbol.iterator]();!(h=(A=d.next()).done);h=!0){var v=A.value;c.index++;var g=a.getIconMapping(v,c);o[s++]=g.x||0,o[s++]=g.y||0,o[s++]=g.width||0,o[s++]=g.height||0}}catch(m){f=!0,p=m}finally{try{h||null==d.return||d.return()}finally{if(f)throw p}}}}]),e}(ue);xo.layerName="IconLayer",xo.defaultProps=bo;var wo=a.fp64.fp64LowPart,So=[0,0,0,255],ko=[0,0,1],Oo=new a.PhongMaterial,Po={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},fp64:!1,getPosition:{type:"accessor",value:function(t){return t.position}},getNormal:{type:"accessor",value:ko},getColor:{type:"accessor",value:So},material:Oo,radiusPixels:{deprecatedFor:"pointSize"}},Eo=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(t){return{vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  unitPosition = positions.xy;\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.), position_commonspace);\n  gl_Position.xy += project_pixel_size_to_clipspace(positions.xy * radiusPixels);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, position_commonspace.xyz, project_normal(instanceNormals));\n  vColor = vec4(lightColor, instanceColors.a * opacity) / 255.0;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:ko},instanceColors:{size:4,type:5121,transition:!0,accessor:"getColor",defaultValue:So}})}},{key:"updateState",value:function(t){var n=t.props,i=t.oldProps,r=t.changeFlags;if(Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r}),n.fp64!==i.fp64){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,i=this.props,r=i.pointSize,a="meters"===i.sizeUnits?n.distanceScales.pixelsPerMeter[2]:1;this.state.model.setUniforms(Object.assign({},e,{radiusPixels:r*a})).draw()}},{key:"_getModel",value:function(t){for(var e=[],n=0;n<3;n++){var i=n/3*Math.PI*2;e.push(2*Math.cos(i),2*Math.sin(i),0)}return new a.Model(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new a.Geometry({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.use64bitPositions();if(t.constant=!r,r){var a=this.props,o=a.data,s=a.getPosition,u=t.value,l=n*t.size,c=ot(o,n,i),h=c.iterable,f=c.objectInfo,p=!0,A=!1,d=void 0;try{for(var v,g=h[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var m=v.value;f.index++;var y=s(m,f);u[l++]=wo(y[0]),u[l++]=wo(y[1])}}catch(_){A=!0,d=_}finally{try{p||null==g.return||g.return()}finally{if(A)throw d}}}else t.value=new Float32Array(2)}}]),e}(ue);Eo.layerName="PointCloudLayer",Eo.defaultProps=Po;var Co=a.fp64.fp64LowPart,To=[0,0,0,255],Mo={radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,fp64:!1,filled:!0,getPosition:{type:"accessor",value:function(t){return t.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:To},getLineColor:{type:"accessor",value:To},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},jo=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(t){return{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  float outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity) / 255.;\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  } \n  if (distToCenter > innerUnitRadius) {\n    gl_FragColor = vLineColor;\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:4,transition:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(t){var n=t.props,i=t.oldProps,r=t.changeFlags;if(Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r}),n.fp64!==i.fp64){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,i=this.props,r=i.radiusScale,a=i.radiusMinPixels,o=i.radiusMaxPixels,s=i.stroked,u=i.filled,l=i.lineWidthUnits,c=i.lineWidthScale,h=i.lineWidthMinPixels,f=i.lineWidthMaxPixels,p="pixels"===l?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},e,{stroked:s?1:0,filled:u,radiusScale:r,radiusMinPixels:a,radiusMaxPixels:o,lineWidthScale:c*p,lineWidthMinPixels:h,lineWidthMaxPixels:f})).draw()}},{key:"_getModel",value:function(t){return new a.Model(t,Object.assign(this.getShaders(),{id:this.props.id,geometry:new a.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.use64bitPositions();if(t.constant=!r,r){var a=this.props,o=a.data,s=a.getPosition,u=t.value,l=n*t.size,c=ot(o,n,i),h=c.iterable,f=c.objectInfo,p=!0,A=!1,d=void 0;try{for(var v,g=h[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var m=v.value;f.index++;var y=s(m,f);u[l++]=Co(y[0]),u[l++]=Co(y[1])}}catch(_){A=!0,d=_}finally{try{p||null==g.return||g.return()}finally{if(A)throw d}}}else t.value=new Float32Array(2)}}]),e}(ue);jo.layerName="ScatterplotLayer",jo.defaultProps=Mo;var Lo=Zn.Tesselator,Io=a.fp64.fp64LowPart,zo=function(t){function e(t){var n=t.data,i=t.getGeometry,r=t.positionFormat,a=t.fp64;return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).call(this,{data:n,getGeometry:i,fp64:a,positionFormat:r,attributes:{startPositions:{size:3},endPositions:{size:3},leftPositions:{size:3},rightPositions:{size:3},startEndPositions64XyLow:{size:4,fp64Only:!0},neighborPositions64XyLow:{size:4,fp64Only:!0}}}))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"get",value:function(t){return this.attributes[t]}},{key:"getGeometrySize",value:function(t){return Math.max(0,this.getPathLength(t)-1)}},{key:"updateGeometryAttributes",value:function(t,e){var n=this.attributes,i=n.startPositions,r=n.endPositions,a=n.leftPositions,o=n.rightPositions,s=n.startEndPositions64XyLow,u=n.neighborPositions64XyLow,l=this.fp64,c=e.geometrySize+1;if(!(c<2))for(var h,f=this.isClosed(t),p=this.getPointOnPath(t,0),A=this.getPointOnPath(t,1),d=f?this.getPointOnPath(t,c-2):p,v=e.vertexStart,g=1;g<c;v++,g++)h=g+1<c?this.getPointOnPath(t,g+1):f?this.getPointOnPath(t,1):A,i[3*v]=p[0],i[3*v+1]=p[1],i[3*v+2]=p[2]||0,r[3*v]=A[0],r[3*v+1]=A[1],r[3*v+2]=A[2]||0,a[3*v]=d[0],a[3*v+1]=d[1],a[3*v+2]=d[2]||0,o[3*v]=h[0],o[3*v+1]=h[1],o[3*v+2]=h[2]||0,l&&(s[4*v]=Io(p[0]),s[4*v+1]=Io(p[1]),s[4*v+2]=Io(A[0]),s[4*v+3]=Io(A[1]),u[4*v]=Io(d[0]),u[4*v+1]=Io(d[1]),u[4*v+2]=Io(h[0]),u[4*v+3]=Io(h[1])),d=p,p=A,A=h}},{key:"getPathLength",value:function(t){return Number.isFinite(t[0])?t.length/this.positionSize:t.length}},{key:"getPointOnPath",value:function(t,e){if(Number.isFinite(t[0])){var n=this.positionSize;return[t[e*n],t[e*n+1],3===n?t[e*n+2]:0]}return t[e]}},{key:"isClosed",value:function(t){var e=this.getPathLength(t),n=this.getPointOnPath(t,0),i=this.getPointOnPath(t,e-1);return n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]}}]),e}(Lo),Do="#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\nuniform float alignMode;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nfloat mod2(float a, float b) {\n  return a - floor(a / b) * b;\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\nbool dash_isFragInGap() {\n  float solidLength = vDashArray.x;\n  float gapLength = vDashArray.y;\n\n  float unitLength = solidLength + gapLength;\n\n  if (unitLength == 0.0) {\n    return false;\n  }\n\n  unitLength = mix(\n    unitLength,\n    vPathLength / round(vPathLength / unitLength),\n    alignMode\n  );\n\n  float offset = alignMode * solidLength / 2.0;\n\n  return gapLength > 0.0 &&\n    vPathPosition.y >= 0.0 &&\n    vPathPosition.y <= vPathLength &&\n    mod2(vPathPosition.y + offset, unitLength) > solidLength;\n}\n\nvoid main(void) {\n  if (jointType > 0.0 && vMiterLength > 0.0 && length(vCornerOffset) > 1.0) {\n    discard;\n  }\n  if (jointType == 0.0 && vMiterLength > miterLimit) {\n    discard;\n  }\n  if (vColor.a == 0.0 || dash_isFragInGap()) {\n    discard;\n  }\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",Bo=[0,0,0,255],Ro={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},fp64:!1,dashJustified:!1,billboard:!1,getPath:{type:"accessor",value:function(t){return t.path}},getColor:{type:"accessor",value:Bo},getWidth:{type:"accessor",value:1},getDashArray:{type:"accessor",value:[0,0]}},Fo={enter:function(t,e){return e.length?e.subarray(e.length-t.length):t}},No=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){return this.use64bitProjection()?{vs:"\n#define SHADER_NAME path-layer-vertex-shader-64\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\nvec3 lineJoin(vec2 prevPoint64[2], vec2 currPoint64[2], vec2 nextPoint64[2]) {\n\n  float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n  float width = project_pixel_size(widthPixels);\n\n  vec2 deltaA64[2];\n  vec2 deltaB64[2];\n\n  vec2_sub_fp64(currPoint64, prevPoint64, deltaA64);\n  vec2_sub_fp64(nextPoint64, currPoint64, deltaB64);\n\n  vec2 lengthA64 = vec2_length_fp64(deltaA64);\n  vec2 lengthB64 = vec2_length_fp64(deltaB64);\n\n  vec2 deltaA = vec2(deltaA64[0].x, deltaA64[1].x);\n  vec2 deltaB = vec2(deltaB64[0].x, deltaB64[1].x);\n\n  float lenA = lengthA64.x;\n  float lenB = lengthB64.x;\n\n  vec2 offsetVec;\n  float offsetScale;\n  float offsetDirection;\n  lenA = lenA / width > EPSILON ? lenA : 0.0;\n  lenB = lenB / width > EPSILON ? lenB : 0.0;\n  vec2 dirA = lenA > 0. ? deltaA / lenA : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? deltaB / lenB : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = mix(perpB, perpA, positions.x);\n  float L = mix(lenB, lenA, positions.x);\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n  float cornerPosition = mix(\n    flipIfTrue(turnsRight == (positions.y > 0.0)),\n    0.0,\n    positions.z\n  );\n\n  offsetScale = 1.0 / max(sinHalfA, EPSILON);\n  cornerPosition *= float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n  offsetScale = mix(\n    offsetScale,\n    min(offsetScale, L / width / max(cosHalfA, EPSILON)),\n    float(cornerPosition < 0.0)\n  );\n\n  vMiterLength = mix(\n    offsetScale * cornerPosition,\n    mix(offsetScale, 0.0, cornerPosition),\n    step(0.0, cornerPosition)\n  ) - sinHalfA * jointType;\n  offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n  offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  float isStartCap = step(lenA, 1.0e-5);\n  float isEndCap = step(lenB, 1.0e-5);\n  float isCap = max(isStartCap, isEndCap);\n  cornerPosition = isCap * (1.0 - positions.z);\n  offsetVec = mix(offsetVec, mix(dirB, perpB, cornerPosition), isStartCap);\n  offsetVec = mix(offsetVec, mix(dirA, perpA, cornerPosition), isEndCap);\n  offsetScale = mix(\n    offsetScale,\n    mix(4.0 * jointType, 1.0, cornerPosition),\n    isCap\n  );\n  vMiterLength = mix(vMiterLength, 1.0 - cornerPosition, isCap);\n\n  offsetDirection = mix(\n    offsetDirection,\n    mix(flipIfTrue(isStartCap > 0.), positions.y, cornerPosition),\n    isCap\n  );\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L / width;\n  float isEnd = positions.x;\n  vec2 offsetFromStartOfPath = mix(vCornerOffset, vCornerOffset + deltaA / width, isEnd);\n  vec2 dir = mix(dirB, dirA, isEnd);\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return vec3(vCornerOffset * width, 0.0);\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n  vec2 projected_curr_position[2];\n  project_position_fp64(currPosition.xy, currPosition64xyLow, projected_curr_position);\n  float projected_curr_position_z = project_size(currPosition.z);\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec2 projected_prev_position[2];\n  project_position_fp64(prevPosition.xy, prevPosition64xyLow, projected_prev_position);\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  vec2 projected_next_position[2];\n  project_position_fp64(nextPosition.xy, nextPosition64xyLow, projected_next_position);\n\n  vec3 pos = lineJoin(projected_prev_position, projected_curr_position, projected_next_position);\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = sum_fp64(vec2(pos.x, 0.0), projected_curr_position[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vec2(pos.y, 0.0), projected_curr_position[1]);\n  vertex_pos_modelspace[2] = vec2(pos.z + projected_curr_position_z, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_common_position_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",fs:Do,modules:["project64","picking"]}:{vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  float relativePosition, bool isEnd, bool isJoint,\n  vec2 width\n) {\n  vec2 deltaA = (currPoint.xy - prevPoint.xy) / width;\n  vec2 deltaB = (nextPoint.xy - currPoint.xy) / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n  lenA = lenA > EPSILON ? lenA : 0.0;\n  lenB = lenB > EPSILON ? lenB : 0.0;\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  float offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  float cornerPosition = isJoint ?\n    0.0 :\n    flipIfTrue(turnsRight == (relativePosition > 0.0));\n  cornerPosition *=\n    float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) * cosHalfA);\n  if (cornerPosition < 0.0) {\n    offsetScale = min(offsetScale, L / max(cosHalfA, EPSILON));\n  }\n\n  vMiterLength = cornerPosition >= 0.0 ?\n    mix(offsetScale, 0.0, cornerPosition) :\n    offsetScale * cornerPosition;\n  vMiterLength -= sinHalfA * jointType;\n\n  float offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  bool isStartCap = step(0.0, -lenA) > 0.5;\n  bool isEndCap = step(0.0, -lenB) > 0.5;\n  bool isCap = isStartCap || isEndCap;\n  cornerPosition = isCap ? (1.0 - positions.z) : 0.;\n  if (isStartCap) {\n    offsetVec = mix(dirB, perpB, cornerPosition);\n  }\n  if (isEndCap) {\n    offsetVec = mix(dirA, perpA, cornerPosition);\n  }\n  if (isCap) {\n    offsetScale = mix(4.0 * jointType, 1.0, cornerPosition);\n    vMiterLength = 1.0 - cornerPosition;\n    offsetDirection = mix(flipIfTrue(isStartCap), positions.y, cornerPosition);\n  }\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L;\n  vec2 offsetFromStartOfPath = vCornerOffset;\n  if (isEnd) {\n    offsetFromStartOfPath += deltaA;\n  }\n  vec2 dir = isEnd ? dirA : dirB;\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return currPoint + vec3(vCornerOffset * width, 0.0);\n}\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  float relativePosition = positions.y;\n  bool isEnd = positions.x > EPSILON;\n  bool isJoint = positions.z > EPSILON;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n\n  return lineJoin(\n    prevPoint, currPoint, nextPoint,\n    relativePosition, isEnd, isJoint,\n    billboard ? project_pixel_size_to_clipspace(widthPixels) : project_pixel_size(widthPixels)\n  );\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64xyLow, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64xyLow, ZERO_OFFSET);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64xyLow, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64xyLow);\n    currPosition = project_position(currPosition, currPosition64xyLow);\n    nextPosition = project_position(nextPosition, nextPosition64xyLow);\n\n    vec3 pos = lineJoin(prevPosition, currPosition, nextPosition);\n    gl_Position = project_common_position_to_clipspace(vec4(pos, 1.0));\n  }\n}\n",fs:Do,modules:["project32","picking"]}}},{key:"initializeState",value:function(){var t=this;this.getAttributeManager().addInstanced({instanceStartPositions:{size:3,transition:Fo,accessor:"getPath",update:this.calculateStartPositions,noAlloc:!0},instanceEndPositions:{size:3,transition:Fo,accessor:"getPath",update:this.calculateEndPositions,noAlloc:!0},instanceStartEndPositions64xyLow:{size:4,update:this.calculateInstanceStartEndPositions64xyLow,noAlloc:!0},instanceLeftPositions:{size:3,accessor:"getPath",update:this.calculateLeftPositions,noAlloc:!0},instanceRightPositions:{size:3,accessor:"getPath",update:this.calculateRightPositions,noAlloc:!0},instanceNeighborPositions64xyLow:{size:4,update:this.calculateInstanceNeighborPositions64xyLow,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Fo,defaultValue:1},instanceDashArrays:{size:2,accessor:"getDashArray"},instanceColors:{size:4,type:5121,accessor:"getColor",transition:Fo,defaultValue:Bo},instancePickingColors:{size:3,type:5121,accessor:function(e,n){var i=n.index,r=n.target;return t.encodePickingColor(i,r)}}}),this.setState({pathTesselator:new zo({})})}},{key:"updateState",value:function(t){var n=t.oldProps,i=t.props,r=t.changeFlags;Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:r});var a=this.getAttributeManager();if(r.dataChanged||i.fp64!==n.fp64||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){var o=this.state.pathTesselator;o.updateGeometry({data:i.data,getGeometry:i.getPath,positionFormat:i.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:o.instanceCount,bufferLayout:o.bufferLayout}),a.invalidateAll()}if(i.fp64!==n.fp64){var s=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(s)}),a.invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.context.viewport,i=this.props,r=i.rounded,a=i.billboard,o=i.miterLimit,s=i.widthUnits,u=i.widthScale,l=i.widthMinPixels,c=i.widthMaxPixels,h=i.dashJustified,f="pixels"===s?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},e,{jointType:Number(r),billboard:a,alignMode:Number(h),widthScale:u*f,miterLimit:o,widthMinPixels:l,widthMaxPixels:c})).draw()}},{key:"_getModel",value:function(t){return new a.Model(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new a.Geometry({drawMode:4,attributes:{indices:new Uint16Array([0,2,1,1,2,4,1,4,3,3,4,5]),positions:new Float32Array([0,0,1,0,-1,0,0,1,0,1,-1,0,1,1,0,1,0,1])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateStartPositions",value:function(t){var e=this.state.pathTesselator;t.bufferLayout=e.bufferLayout,t.value=e.get("startPositions")}},{key:"calculateEndPositions",value:function(t){var e=this.state.pathTesselator;t.bufferLayout=e.bufferLayout,t.value=e.get("endPositions")}},{key:"calculateInstanceStartEndPositions64xyLow",value:function(t){var e=this.use64bitPositions();t.constant=!e,t.value=e?this.state.pathTesselator.get("startEndPositions64XyLow"):new Float32Array(4)}},{key:"calculateLeftPositions",value:function(t){var e=this.state.pathTesselator;t.value=e.get("leftPositions")}},{key:"calculateRightPositions",value:function(t){var e=this.state.pathTesselator;t.value=e.get("rightPositions")}},{key:"calculateInstanceNeighborPositions64xyLow",value:function(t){var e=this.use64bitPositions();t.constant=!e,t.value=e?this.state.pathTesselator.get("neighborPositions64XyLow"):new Float32Array(4)}},{key:"clearPickingColor",value:function(t){for(var e=this.decodePickingColor(t),n=this.state.pathTesselator.bufferLayout,i=n[e],r=0,a=0;a<e;a++)r+=n[a];var o=this.getAttributeManager().attributes.instancePickingColors,s=o.value,u=r+i;s.fill(0,3*r,3*u),o.update({value:s})}}]),e}(ue);No.layerName="PathLayer",No.defaultProps=Ro;var Uo=new a.PhongMaterial,Vo={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,lineDashJustified:!1,fp64:!1,getPolygon:{type:"accessor",value:function(t){return t.polygon}},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},material:Uo},Go=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){this.state={paths:[]}}},{key:"updateState",value:function(t){t.oldProps;var e=t.props,n=t.changeFlags;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon))&&(this.state.paths=this._getPaths(e))}},{key:"getPickingInfo",value:function(t){var e=t.info;return Object.assign(e,{object:e.object&&e.object.object||e.object})}},{key:"_getPaths",value:function(t){var e=t.data,n=t.getPolygon,i=[],r="XY"===t.positionFormat?2:3,a=ot(e),o=a.iterable,s=a.objectInfo,u=!0,l=!1,c=void 0;try{for(var h,f=o[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;s.index++;var A=Ar(n(p,s),r),d=A.positions,v=A.holeIndices;if(v)for(var g=0;g<=v.length;g++){var m=d.subarray(v[g-1]||0,v[g]||d.length);i.push({path:m,object:p})}else i.push({path:d,object:p})}}catch(y){l=!0,c=y}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}return i}},{key:"_getAccessor",value:function(t){return"function"==typeof t?function(e){return t(e.object)}:t}},{key:"renderLayers",value:function(){var t=this.props,e=t.data,n=t.stroked,i=t.filled,r=t.extruded,a=t.wireframe,o=t.elevationScale,s=t.transitions,u=this.props,l=u.lineWidthUnits,c=u.lineWidthScale,h=u.lineWidthMinPixels,f=u.lineWidthMaxPixels,p=u.lineJointRounded,A=u.lineMiterLimit,d=u.lineDashJustified,v=u.fp64,g=this.props,m=g.getFillColor,y=g.getLineColor,_=g.getLineWidth,b=g.getLineDashArray,x=g.getElevation,w=g.getPolygon,S=g.updateTriggers,k=g.material,O=this.state.paths,P=this.getSubLayerClass("fill",Or),E=this.getSubLayerClass("stroke",No),C=this.shouldRenderSubLayer("fill",O)&&new P({extruded:r,elevationScale:o,fp64:v,filled:i,wireframe:a,getElevation:x,getFillColor:m,getLineColor:y,material:k,transitions:s},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:S.getPolygon,getElevation:S.getElevation,getFillColor:S.getFillColor,getLineColor:S.getLineColor}}),{data:e,getPolygon:w});return[!r&&C,!r&&n&&this.shouldRenderSubLayer("stroke",O)&&new E({fp64:v,widthUnits:l,widthScale:c,widthMinPixels:h,widthMaxPixels:f,rounded:p,miterLimit:A,dashJustified:d,transitions:s&&{getWidth:s.getLineWidth,getColor:s.getLineColor,getPath:s.getPolygon},getColor:this._getAccessor(y),getWidth:this._getAccessor(_),getDashArray:this._getAccessor(b)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:S.getLineWidth,getColor:S.getLineColor,getDashArray:S.getLineDashArray}}),{data:O,getPath:function(t){return t.path}}),r&&C]}}]),e}(yn);function Wo(t,e){if(!t)throw new Error("deck.gl: ".concat(e))}function Ho(t,e,n){var i=t.type,r=t.coordinates,a=e.pointFeatures,o=e.lineFeatures,s=e.polygonFeatures,u=e.polygonOutlineFeatures;switch(function(t,e){var n=Zo[t];Wo(n,"Unknown GeoJSON type ".concat(t));for(;e&&--n>0;)e=e[0];Wo(e&&Number.isFinite(e[0]),"".concat(t," coordinates are malformed"))}(i,r),i){case"Point":a.push({geometry:t,sourceFeature:n});break;case"MultiPoint":r.forEach(function(t){a.push({geometry:{type:"Point",coordinates:t},sourceFeature:n})});break;case"LineString":o.push({geometry:t,sourceFeature:n});break;case"MultiLineString":r.forEach(function(t){o.push({geometry:{type:"LineString",coordinates:t},sourceFeature:n})});break;case"Polygon":s.push({geometry:t,sourceFeature:n}),r.forEach(function(t){u.push({geometry:{type:"LineString",coordinates:t},sourceFeature:n})});break;case"MultiPolygon":r.forEach(function(t){s.push({geometry:{type:"Polygon",coordinates:t},sourceFeature:n}),t.forEach(function(t){u.push({geometry:{type:"LineString",coordinates:t},sourceFeature:n})})})}}function qo(t){return t.sourceFeature.feature}Go.layerName="PolygonLayer",Go.defaultProps=Vo;var Zo={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};var Xo=new a.PhongMaterial,Qo={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,lineDashJustified:!1,fp64:!1,getLineColor:{type:"accessor",value:[0,0,0,255]},getFillColor:{type:"accessor",value:[0,0,0,255]},getRadius:{type:"accessor",value:1},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},material:Xo};function Yo(t){return t.geometry.coordinates}function Ko(t){return"function"!=typeof t?t:function(e){return t(qo(e))}}var Jo=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){this.state={features:{}}}},{key:"updateState",value:function(t){t.oldProps;var e=t.props;if(t.changeFlags.dataChanged){var n=function(t){if(Array.isArray(t))return t;switch(Wo(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Wo(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}(e.data);this.state.features=function(t){for(var e={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},n=0;n<t.length;n++){var i=t[n];Wo(i&&i.geometry,"GeoJSON does not have geometry");var r=i.geometry,a={feature:i,index:n};if("GeometryCollection"===r.type){Wo(Array.isArray(r.geometries),"GeoJSON does not have geometries array");for(var o=r.geometries,s=0;s<o.length;s++)Ho(o[s],e,a)}else Ho(r,e,a)}return e}(n)}}},{key:"getPickingInfo",value:function(t){var e,n=t.info;t.sourceLayer;return Object.assign(n,{object:n.object?qo(n.object):n.object,index:n.object?(e=n.object,e.sourceFeature.index):n.index})}},{key:"renderLayers",value:function(){var t=this.state.features,e=t.pointFeatures,n=t.lineFeatures,i=t.polygonFeatures,r=t.polygonOutlineFeatures,a=this.props,o=a.stroked,s=a.filled,u=a.extruded,l=a.wireframe,c=a.material,h=a.transitions,f=this.props,p=f.lineWidthUnits,A=f.lineWidthScale,d=f.lineWidthMinPixels,v=f.lineWidthMaxPixels,g=f.lineJointRounded,m=f.lineMiterLimit,y=f.pointRadiusScale,_=f.pointRadiusMinPixels,b=f.pointRadiusMaxPixels,x=f.elevationScale,w=f.lineDashJustified,S=f.fp64,k=this.props,O=k.getLineColor,P=k.getFillColor,E=k.getRadius,C=k.getLineWidth,T=k.getLineDashArray,M=k.getElevation,j=k.updateTriggers,L=this.getSubLayerClass("polygons-fill",Or),I=this.getSubLayerClass("polygons-stroke",No),z=this.getSubLayerClass("line-strings",No),D=this.getSubLayerClass("points",jo),B=this.shouldRenderSubLayer("polygons-fill",i)&&new L({fp64:S,extruded:u,elevationScale:x,filled:s,wireframe:l,material:c,getElevation:Ko(M),getFillColor:Ko(P),getLineColor:Ko(O),transitions:h&&{getPolygon:h.geometry,getElevation:h.getElevation,getFillColor:h.getFillColor,getLineColor:h.getLineColor}},this.getSubLayerProps({id:"polygons-fill",updateTriggers:{getElevation:j.getElevation,getFillColor:j.getFillColor,getLineColor:j.getLineColor}}),{data:i,getPolygon:Yo});return[!u&&B,!u&&o&&this.shouldRenderSubLayer("polygons-stroke",r)&&new I({fp64:S,widthUnits:p,widthScale:A,widthMinPixels:d,widthMaxPixels:v,rounded:g,miterLimit:m,dashJustified:w,getColor:Ko(O),getWidth:Ko(C),getDashArray:Ko(T),transitions:h&&{getPath:h.geometry,getColor:h.getLineColor,getWidth:h.getLineWidth}},this.getSubLayerProps({id:"polygons-stroke",updateTriggers:{getColor:j.getLineColor,getWidth:j.getLineWidth,getDashArray:j.getLineDashArray}}),{data:r,getPath:Yo}),this.shouldRenderSubLayer("linestrings",n)&&new z({fp64:S,widthUnits:p,widthScale:A,widthMinPixels:d,widthMaxPixels:v,rounded:g,miterLimit:m,dashJustified:w,getColor:Ko(O),getWidth:Ko(C),getDashArray:Ko(T),transitions:h&&{getPath:h.geometry,getColor:h.getLineColor,getWidth:h.getLineWidth}},this.getSubLayerProps({id:"line-strings",updateTriggers:{getColor:j.getLineColor,getWidth:j.getLineWidth,getDashArray:j.getLineDashArray}}),{data:n,getPath:Yo}),this.shouldRenderSubLayer("points",e)&&new D({fp64:S,stroked:o,filled:s,radiusScale:y,radiusMinPixels:_,radiusMaxPixels:b,lineWidthUnits:p,lineWidthScale:A,lineWidthMinPixels:d,lineWidthMaxPixels:v,getFillColor:Ko(P),getLineColor:Ko(O),getRadius:Ko(E),getLineWidth:Ko(C),transitions:h&&{getPosition:h.geometry,getFillColor:h.getFillColor,getLineColor:h.getLineColor,getRadius:h.getRadius,getLineWidth:h.getLineWidth}},this.getSubLayerProps({id:"points",updateTriggers:{getFillColor:j.getFillColor,getLineColor:j.getLineColor,getRadius:j.getRadius,getLineWidth:j.getLineWidth}}),{data:e,getPosition:Yo}),u&&B]}}]),e}(yn);Jo.layerName="GeoJsonLayer",Jo.defaultProps=Qo;var $o=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){return Object.assign({},Object(it.a)(Object(L.a)(e.prototype),"getShaders",this).call(this),{vs:"#define SHADER_NAME multi-icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec2 iconsTextureDim;\nuniform float gamma;\nuniform float opacity;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying float vGamma;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  \n  if (billboard)  {\n    pixelOffset.y *= -1.0;\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.0)); \n    gl_Position.xy += project_pixel_size_to_clipspace(pixelOffset);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset_common); \n  }\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  vGamma = gamma / (sizeScale * iconSize.y);\n}\n",fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform sampler2D iconsTexture;\nuniform float buffer;\nuniform bool sdf;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying float vGamma;\n\nconst float MIN_ALPHA = 0.05;\n\nvoid main(void) {\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  \n  float alpha = texColor.a;\n  if (sdf) {\n    float distance = texture2D(iconsTexture, vTextureCoords).a;\n    alpha = smoothstep(buffer - vGamma, buffer + vGamma, distance);\n  }\n  float a = alpha * vColor.a;\n\n  if (a < MIN_ALPHA) {\n    discard;\n  }\n\n  gl_FragColor = vec4(vColor.rgb, a);\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n"})}},{key:"initializeState",value:function(){Object(it.a)(Object(L.a)(e.prototype),"initializeState",this).call(this),this.getAttributeManager().addInstanced({instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(t){Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,t);var n=t.changeFlags;n.updateTriggersChanged&&(n.updateTriggersChanged.getAnchorX||n.updateTriggersChanged.getAnchorY)&&this.getAttributeManager().invalidate("instanceOffsets")}},{key:"draw",value:function(t){var n=t.uniforms,i=this.props.sdf;Object(it.a)(Object(L.a)(e.prototype),"draw",this).call(this,{uniforms:Object.assign({},n,{buffer:.75,gamma:.2,sdf:Boolean(i)})})}},{key:"calculateInstanceOffsets",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.props,a=r.data,o=r.iconMapping,s=r.getIcon,u=r.getAnchorX,l=r.getAnchorY,c=r.getLengthOfQueue,h=r.getShiftInQueue,f=t.value,p=n*t.size,A=ot(a,n,i).iterable,d=!0,v=!1,g=void 0;try{for(var m,y=A[Symbol.iterator]();!(d=(m=y.next()).done);d=!0){var _=m.value,b=o[s(_)]||{},x=c(_),w=h(_);f[p++]=(u(_)-1)*x/2+b.width/2+w||0,f[p++]=b.height/2*l(_)||0}}catch(S){v=!0,g=S}finally{try{d||null==y.return||y.return()}finally{if(v)throw g}}}},{key:"calculateInstancePickingColors",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.props,a=r.data,o=r.getPickingIndex,s=t.value,u=n*t.size,l=[],c=ot(a,n,i).iterable,h=!0,f=!1,p=void 0;try{for(var A,d=c[Symbol.iterator]();!(h=(A=d.next()).done);h=!0){var v=o(A.value);this.encodePickingColor(v,l),s[u++]=l[0],s[u++]=l[1],s[u++]=l[2]}}catch(g){f=!0,p=g}finally{try{h||null==d.return||d.return()}finally{if(f)throw p}}}}]),e}(xo);$o.layerName="MultiIconLayer",$o.defaultProps={getShiftInQueue:{type:"accessor",value:function(t){return t.shift||0}},getLengthOfQueue:{type:"accessor",value:function(t){return t.len||1}},getAnchorX:{type:"accessor",value:function(t){return t.anchorX||0}},getAnchorY:{type:"accessor",value:function(t){return t.anchorY||0}},getPixelOffset:{type:"accessor",value:[0,0]},getPickingIndex:{type:"accessor",value:function(t){return t.objectIndex}}};var ts=n("rxlC"),es=n.n(ts);var ns=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;Object(T.a)(this,t),this.limit=e,this.clear()}return Object(M.a)(t,[{key:"clear",value:function(){this._cache={},this._order=[]}},{key:"get",value:function(t){var e=this._cache[t];return e&&(this._deleteOrder(t),this._appendOrder(t)),e}},{key:"set",value:function(t,e){this._cache[t]?(this.delete(t),this._cache[t]=e,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=e,this._appendOrder(t))}},{key:"delete",value:function(t){this._cache[t]&&(this._deleteCache(t),this._deleteOrder(t))}},{key:"_deleteCache",value:function(t){delete this._cache[t]}},{key:"_deleteOrder",value:function(t){var e=this._order.findIndex(function(e){return e===t});e>=0&&this._order.splice(e,1)}},{key:"_appendOrder",value:function(t){this._order.push(t)}}]),t}();var is=function(){for(var t=[],e=32;e<128;e++)t.push(String.fromCharCode(e));return t}(),rs="Monaco, monospace",as="normal",os=64,ss=2,us=.25,ls=3,cs=new ns(3),hs=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function fs(t,e){for(var n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function ps(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="baseline",t.textAlign="left"}var As=function(){function t(e){Object(T.a)(this,t),this.gl=e,this.props={fontFamily:rs,fontWeight:as,characterSet:is,fontSize:os,buffer:ss,sdf:!1,cutoff:us,radius:ls},this._key=null,this._texture=new a.Texture2D(this.gl)}return Object(M.a)(t,[{key:"finalize",value:function(){this._texture.delete()}},{key:"setProps",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};hs.forEach(function(n){n in e&&(t.props[n]=e[n])});var n=this._key;this._key=this._getKey();var i=function(t,e){var n=cs.get(t);if(!n)return e;var i=[],r=n.mapping,a=Object.keys(r);a=new Set(a);var o=e;return o instanceof Array&&(o=new Set(o)),o.forEach(function(t){a.has(t)||i.push(t)}),i}(this._key,this.props.characterSet),r=cs.get(this._key);if(r&&0===i.length)this._key!==n&&this._updateTexture(r);else{var a=this._generateFontAtlas(this._key,i,r);this._updateTexture(a),cs.set(this._key,a)}}},{key:"_updateTexture",value:function(t){var e,n=t.data,i=t.width,r=t.height;this._texture.width===i&&this._texture.height===r||this._texture.resize({width:i,height:r}),this._texture.setImageData({data:n,width:i,height:r,parameters:(e={},Object(Kn.a)(e,10242,33071),Object(Kn.a)(e,10243,33071),Object(Kn.a)(e,37440,!0),e)}),this._texture.generateMipmap()}},{key:"_generateFontAtlas",value:function(t,e,n){var i=this.props,r=i.fontFamily,a=i.fontWeight,o=i.fontSize,s=i.buffer,u=i.sdf,l=i.radius,c=i.cutoff,h=n&&n.data;h||((h=document.createElement("canvas")).width=1024);var f=h.getContext("2d");ps(f,r,o,a);var p=function(t){var e=t.characterSet,n=t.getFontWidth,i=t.fontHeight,r=t.buffer,a=t.maxCanvasWidth,o=t.mapping,s=void 0===o?{}:o,u=t.xOffset,l=void 0===u?0:u,c=t.yOffset,h=void 0===c?0:c,f=0,p=l;Array.from(e).forEach(function(t,e){if(!s[t]){var o=n(t,e);p+o+2*r>a&&(p=0,f++),s[t]={x:p+r,y:h+f*(i+2*r)+r,width:o,height:i,mask:!0},p+=o+2*r}});var A,d=i+2*r;return{mapping:s,xOffset:p,yOffset:h+f*d,canvasHeight:(A=h+(f+1)*d,Math.pow(2,Math.ceil(Math.log2(A))))}}(Object.assign({getFontWidth:function(t){return f.measureText(t).width},fontHeight:1.2*o,buffer:s,characterSet:e,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),A=p.mapping,d=p.canvasHeight,v=p.xOffset,g=p.yOffset;if(h.height!==d){var m=f.getImageData(0,0,h.width,h.height);h.height=d,f.putImageData(m,0,0)}if(ps(f,r,o,a),u){var y=new es.a(o,s,l,c,r,a),_=f.getImageData(0,0,y.size,y.size),b=!0,x=!1,w=void 0;try{for(var S,k=e[Symbol.iterator]();!(b=(S=k.next()).done);b=!0){var O=S.value;fs(y.draw(O),_),f.putImageData(_,A[O].x-s,A[O].y-s)}}catch(L){x=!0,w=L}finally{try{b||null==k.return||k.return()}finally{if(x)throw w}}}else{var P=!0,E=!1,C=void 0;try{for(var T,M=e[Symbol.iterator]();!(P=(T=M.next()).done);P=!0){var j=T.value;f.fillText(j,A[j].x,A[j].y+.9*o)}}catch(L){E=!0,C=L}finally{try{P||null==M.return||M.return()}finally{if(E)throw C}}}return{xOffset:v,yOffset:g,mapping:A,data:h,width:h.width,height:h.height}}},{key:"_getKey",value:function(){var t=this.props,e=t.gl,n=t.fontFamily,i=t.fontWeight,r=t.fontSize,a=t.buffer,o=t.sdf,s=t.radius,u=t.cutoff;return o?"".concat(e," ").concat(n," ").concat(i," ").concat(r," ").concat(a," ").concat(s," ").concat(u):"".concat(e," ").concat(n," ").concat(i," ").concat(r," ").concat(a)}},{key:"texture",get:function(){return this._texture}},{key:"mapping",get:function(){var t=cs.get(this._key);return t&&t.mapping}},{key:"scale",get:function(){return 1.2}}]),t}(),ds={fontSize:os,buffer:ss,sdf:!1,radius:ls,cutoff:us},vs={start:1,middle:0,end:-1},gs={top:1,center:0,bottom:-1},ms=["fontSize","buffer","sdf","radius","cutoff"],ys={fp64:!1,billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,characterSet:is,fontFamily:rs,fontWeight:as,fontSettings:{},getText:{type:"accessor",value:function(t){return t.text}},getPosition:{type:"accessor",value:function(t){return t.position}},getColor:{type:"accessor",value:[0,0,0,255]},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]}},_s=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){this.state={fontAtlasManager:new As(this.context.gl)}}},{key:"updateState",value:function(t){var e=t.props,n=t.oldProps,i=t.changeFlags,r=this.fontChanged(n,e);r&&this.updateFontAtlas({oldProps:n,props:e}),(i.dataChanged||r||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this.transformStringToLetters()}},{key:"finalizeState",value:function(){Object(it.a)(Object(L.a)(e.prototype),"finalizeState",this).call(this),this.state.fontAtlasManager.finalize()}},{key:"updateFontAtlas",value:function(t){t.oldProps;var e=t.props,n=e.characterSet,i=e.fontSettings,r=e.fontFamily,a=e.fontWeight,o=this.state.fontAtlasManager;o.setProps(Object.assign({},ds,i,{characterSet:n,fontFamily:r,fontWeight:a}));var s=o.scale,u=o.texture,l=o.mapping;this.setState({scale:s,iconAtlas:u,iconMapping:l}),this.setNeedsRedraw(!0)}},{key:"fontChanged",value:function(t,e){if(t.fontFamily!==e.fontFamily||t.characterSet!==e.characterSet||t.fontWeight!==e.fontWeight)return!0;if(t.fontSettings===e.fontSettings)return!1;var n=t.fontSettings||{},i=e.fontSettings||{};return ms.some(function(t){return n[t]!==i[t]})}},{key:"getPickingInfo",value:function(t){var e=t.info;return Object.assign(e,{object:e.index>=0?this.props.data[e.index]:null})}},{key:"transformStringToLetters",value:function(){var t=this.props,e=t.data,n=t.getText,i=this.state.iconMapping,a=[],o=ot(e),s=o.iterable,u=o.objectInfo,l=!0,c=!1,h=void 0;try{for(var f,p=function(){var t=f.value;u.index++;var e=n(t,u);if(e){var o=Array.from(e),s=[0],l=0;o.forEach(function(n,o){var c={text:n,index:o,offsets:s,len:e.length,object:t,objectIndex:u.index},h=i[n];h?l+=h.width:(r.warn("Missing character: ".concat(n))(),l+=32),s.push(l),a.push(c)})}},A=s[Symbol.iterator]();!(l=(f=A.next()).done);l=!0)p()}catch(d){c=!0,h=d}finally{try{l||null==A.return||A.return()}finally{if(c)throw h}}this.setState({data:a})}},{key:"getLetterOffset",value:function(t){return t.offsets[t.index]}},{key:"getTextLength",value:function(t){return t.offsets[t.offsets.length-1]}},{key:"_getAccessor",value:function(t){return"function"==typeof t?function(e){return t(e.object)}:t}},{key:"getAnchorXFromTextAnchor",value:function(t){return function(e){var n="function"==typeof t?t(e.object):t;if(!vs.hasOwnProperty(n))throw new Error("Invalid text anchor parameter: ".concat(n));return vs[n]}}},{key:"getAnchorYFromAlignmentBaseline",value:function(t){return function(e){var n="function"==typeof t?t(e.object):t;if(!gs.hasOwnProperty(n))throw new Error("Invalid alignment baseline parameter: ".concat(n));return gs[n]}}},{key:"renderLayers",value:function(){var t=this,e=this.state,n=e.data,i=e.scale,r=e.iconAtlas,a=e.iconMapping,o=this.props,s=o.getPosition,u=o.getColor,l=o.getSize,c=o.getAngle,h=o.getTextAnchor,f=o.getAlignmentBaseline,p=o.getPixelOffset,A=o.fp64,d=o.billboard,v=o.sdf,g=o.sizeScale,m=o.sizeUnits,y=o.sizeMinPixels,_=o.sizeMaxPixels,b=o.transitions,x=o.updateTriggers;return new(this.getSubLayerClass("characters",$o))({sdf:v,iconAtlas:r,iconMapping:a,getPosition:function(t){return s(t.object)},getColor:this._getAccessor(u),getSize:this._getAccessor(l),getAngle:this._getAccessor(c),getAnchorX:this.getAnchorXFromTextAnchor(h),getAnchorY:this.getAnchorYFromAlignmentBaseline(f),getPixelOffset:this._getAccessor(p),fp64:A,billboard:d,sizeScale:g*i,sizeUnits:m,sizeMinPixels:y*i,sizeMaxPixels:_*i,transitions:b&&{getPosition:b.getPosition,getAngle:b.getAngle,getColor:b.getColor,getSize:b.getSize,getPixelOffset:x.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getPosition:x.getPosition,getAngle:x.getAngle,getColor:x.getColor,getSize:x.getSize,getPixelOffset:x.getPixelOffset,getAnchorX:x.getTextAnchor,getAnchorY:x.getAlignmentBaseline}}),{data:n,getIcon:function(t){return t.text},getShiftInQueue:function(e){return t.getLetterOffset(e)},getLengthOfQueue:function(e){return t.getTextLength(e)}})}}]),e}(yn);_s.layerName="TextLayer",_s.defaultProps=ys;var bs=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){return Object.assign({},Object(it.a)(Object(L.a)(e.prototype),"getShaders",this).call(this),{vs:"#define SHADER_NAME great-circle-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  if(abs(angularDist - PI) < 0.001) {\n    return (1.0 - t) * source + t * target;\n  }\n\n  float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n  float b = sin(t * angularDist) / sin(angularDist);\n  vec2 sin_source = sin(source);\n  vec2 cos_source = cos(source);\n  vec2 sin_target = sin(target);\n  vec2 cos_target = cos(target);\n\n  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n  float z = a * sin_source.y + b * sin_target.y;\n  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\n\nvoid main(void) {\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  \n  vec2 source = radians(instancePositions.xy);\n  vec2 target = radians(instancePositions.zw);\n  \n  float angularDist = getAngularDist(source, target);\n\n  vec3 currPos = vec3(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0);\n  vec3 nextPos = vec3(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0);\n\n  vec2 currPos64Low = mix(instancePositions64Low.xy, instancePositions64Low.zw, segmentRatio);\n  vec2 nextPos64Low = mix(instancePositions64Low.xy, instancePositions64Low.zw, nextSegmentRatio);\n\n  vec4 curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0));\n  vec4 next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.0;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",modules:["picking","project32"]})}}]),e}(Va);bs.layerName="GreatCircleLayer";var xs=n("0/m4");var ws=180/Math.PI,Ss=100;function ks(t){var e=function(t){var e=t.padEnd(16,"0");return String(parseInt(e,16))}(t),n=function(t){var e=t.substr(t.length-1);return 2*(t.length-1)-(0==(1&e))}(t);return function(t){for(var e,n,i,r,a,o,s=t.face,u=t.ij,l=t.level,c=[],h=[[0,0],[0,1],[1,1],[1,0],[0,0]],f=Math.max(1,Ss*Math.pow(2,-l)),p=0;p<4;p++)for(var A=h[p].slice(0),d=h[p+1],v=(d[0]-A[0])/f,g=(d[1]-A[1])/f,m=0;m<f;m++){A[0]+=v,A[1]+=g;var y=xs.S2.IJToST(u,l,A),_=xs.S2.STToUV(y),b=xs.S2.FaceUVToXYZ(s,_);c.push((e=b,n=void 0,i=void 0,r=void 0,a=void 0,o=void 0,n=Object(N.a)(e,3),i=n[0],r=n[1],a=n[2],o=Math.atan2(a,Math.sqrt(i*i+r*r)),[Math.atan2(r,i)*ws,o*ws]))}return c}(xs.S2.S2Cell.FromLatLng(xs.S2.idToLatLng(e),n))}var Os=Object.assign({getS2Token:{type:"accessor",value:function(t){return t.token}}},Go.defaultProps),Ps=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"renderLayers",value:function(){var t=this.props,e=t.data,n=t.getS2Token,i=this.props,r=i.elevationScale,a=i.extruded,o=i.wireframe,s=i.filled,u=i.stroked,l=i.lineWidthUnits,c=i.lineWidthScale,h=i.lineWidthMinPixels,f=i.lineWidthMaxPixels,p=i.lineJointRounded,A=i.lineMiterLimit,d=i.lineDashJustified,v=i.fp64,g=i.getElevation,m=i.getFillColor,y=i.getLineColor,_=i.getLineWidth,b=i.getLineDashArray,x=this.props,w=x.updateTriggers,S=x.material;return new(this.getSubLayerClass("cell",Go))({fp64:v,filled:s,wireframe:o,extruded:a,elevationScale:r,stroked:u,lineWidthUnits:l,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:f,lineJointRounded:p,lineMiterLimit:A,lineDashJustified:d,material:S,getElevation:g,getFillColor:m,getLineColor:y,getLineWidth:_,getLineDashArray:b},this.getSubLayerProps({id:"cell",updateTriggers:{getElevation:w.getElevation,getFillColor:w.getFillColor,getLineColor:w.getLineColor,getLineWidth:w.getLineWidth,getLineDashArray:w.getLineDashArray}}),{data:e,getPolygon:function(t){return ks(n(t))}})}}]),e}(yn);function Es(t,e,n){var i=t/Math.pow(2,n)*360-180,r=Math.PI-2*Math.PI*e/Math.pow(2,n);return[i,180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))]}Ps.layerName="S2Layer",Ps.defaultProps=Os;var Cs=function(){function t(e){var n=e.getTileData,i=e.x,r=e.y,a=e.z,o=e.onTileError;Object(T.a)(this,t),this.x=i,this.y=r,this.z=a,this.bbox=function(t,e,n){var i=Es(t,e,n),r=Object(N.a)(i,2),a=r[0],o=r[1],s=Es(t+1,e+1,n),u=Object(N.a)(s,2);return{west:a,north:o,east:u[0],south:u[1]}}(this.x,this.y,this.z),this.isVisible=!0,this.getTileData=n,this._data=null,this._isLoaded=!1,this._loader=this._loadData(),this.onTileError=o}return Object(M.a)(t,[{key:"_loadData",value:function(){var t=this,e=this.x,n=this.y,i=this.z,r=this.bbox;return this.getTileData?this.getTileData({x:e,y:n,z:i,bbox:r}).then(function(e){return t._data=e,t._isLoaded=!0,e}).catch(function(e){t._isLoaded=!0,t.onTileError(e)}):null}},{key:"isOverlapped",value:function(t){var e=this.x,n=this.y,i=this.z,r=Math.pow(2,t.z-i);return Math.floor(t.x/r)===e&&Math.floor(t.y/r)===n}},{key:"data",get:function(){return this._data?Promise.resolve(this._data):this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}}]),t}(),Ts=512;function Ms(t){return t/Ts}function js(t,e){var n=t.x,i=t.y,r=t.z,a=Math.pow(2,r-e);return{x:Math.floor(n/a),y:Math.floor(i/a),z:e}}var Ls=function(){function t(e){var n=e.getTileData,i=e.maxSize,r=e.maxZoom,a=e.minZoom,o=e.onTileError;Object(T.a)(this,t),this._getTileData=n,this._maxSize=i,this.onTileError=o,this._cache=new Map,r&&parseInt(r,10)===r&&(this._maxZoom=r),a&&parseInt(a,10)===a&&(this._minZoom=a)}return Object(M.a)(t,[{key:"finalize",value:function(){this._cache.clear()}},{key:"update",value:function(t,e){var n=this._cache,i=this._getTileData,r=this._maxSize,a=this._maxZoom,o=this._minZoom;this._markOldTiles();var s=function(t,e,n){var i=Math.floor(t.zoom);if(n&&i<n)return[];var r=function(t){var e=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])];return[e.reduce(function(t,e){return t<e[0]?t:e[0]},180),e.reduce(function(t,e){return t<e[1]?t:e[1]},90),e.reduce(function(t,e){return t>e[0]?t:e[0]},-180),e.reduce(function(t,e){return t>e[1]?t:e[1]},-90)]}(t=new t.constructor(Object.assign({},t,{zoom:i}))),a=Object(V.g)([r[0],r[3]],t.scale).map(Ms),o=Object(N.a)(a,2),s=o[0],u=o[1],l=Object(V.g)([r[2],r[1]],t.scale).map(Ms),c=Object(N.a)(l,2),h=c[0],f=c[1];s=Math.max(0,Math.floor(s)),h=Math.min(t.scale,Math.ceil(h)),u=Math.max(0,Math.floor(u)),f=Math.min(t.scale,Math.ceil(f));for(var p=[],A=s;A<h;A++)for(var d=u;d<f;d++)e&&i>e?p.push(js({x:A,y:d,z:i},e)):p.push({x:A,y:d,z:i});return p}(t,a,o);if(s&&0!==s.length){var u=new Set;n.forEach(function(t){s.some(function(e){return t.isOverlapped(e)})&&(t.isVisible=!0,u.add(t))});for(var l=0;l<s.length;l++){var c=s[l],h=c.x,f=c.y,p=c.z,A=this._getTile(h,f,p);A||(A=new Cs({getTileData:i,x:h,y:f,z:p,onTileError:this.onTileError}));var d=this._getTileId(h,f,p);n.set(d,A),u.add(A)}this._resizeCache(r||5*s.length),e(Array.from(u).sort(function(t,e){return t.z-e.z}))}else e(s)}},{key:"_resizeCache",value:function(t){var e=this._cache;if(e.size>t){var n=e[Symbol.iterator](),i=!0,r=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;if(e.size<=t)break;var l=u[0];u[1].isVisible||e.delete(l)}}catch(c){r=!0,a=c}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}}}},{key:"_markOldTiles",value:function(){this._cache.forEach(function(t){t.isVisible=!1})}},{key:"_getTile",value:function(t,e,n){var i=this._getTileId(t,e,n);return this._cache.get(i)}},{key:"_getTileId",value:function(t,e,n){return"".concat(n,"-").concat(t,"-").concat(e)}}]),t}(),Is={renderSubLayers:{type:"function",value:function(t){return new Jo(t)}},getTileData:{type:"function",value:function(t){t.x,t.y,t.z;return Promise.resolve(null)}},onViewportLoaded:{type:"function",value:function(){}},onTileError:{type:"function",value:function(t){return console.error(t)}},maxZoom:null,minZoom:0,maxCacheSize:null},zs=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){var t=this.props,e=t.maxZoom,n=t.minZoom,i=t.getTileData,r=t.onTileError;this.state={tiles:[],tileCache:new Ls({getTileData:i,maxZoom:e,minZoom:n,onTileError:r}),isLoaded:!1}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=this,n=t.props,i=(t.oldProps,t.context),r=t.changeFlags,a=n.onViewportLoaded,o=n.onTileError;if(r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getTileData)){var s=n.getTileData,u=n.maxZoom,l=n.minZoom,c=n.maxCacheSize;this.state.tileCache.finalize(),this.setState({tileCache:new Ls({getTileData:s,maxSize:c,maxZoom:u,minZoom:l,onTileError:o})})}if(r.viewportChanged){var h=i.viewport,f=this.getLayerZoomLevel();"DEFAULT-INITIAL-VIEWPORT"!==h.id&&this.state.tileCache.update(h,function(t){var n=t.filter(function(t){return t.z===f}),i=n.every(function(t){return t.isLoaded});e.setState({tiles:t,isLoaded:i}),i?a(n.filter(function(t){return t._data}).map(function(t){return t._data})):Promise.all(n.map(function(t){return t.data})).then(function(){e.setState({isLoaded:!0}),a(n.filter(function(t){return t._data}).map(function(t){return t._data}))})})}}},{key:"getPickingInfo",value:function(t){var e=t.info,n=t.sourceLayer;return e.sourceLayer=n,e.tile=n.props.tile,e}},{key:"getLayerZoomLevel",value:function(){var t=Math.floor(this.context.viewport.zoom),e=this.props,n=e.maxZoom,i=e.minZoom;return n&&parseInt(n,10)===n&&t>n?n:i&&parseInt(i,10)===i&&t<i?i:t}},{key:"renderLayers",value:function(){var t=this,e=this.props,n=e.renderSubLayers,i=e.visible,r=this.getLayerZoomLevel();return this.state.tiles.map(function(e){return n(Object.assign({},t.props,{id:"".concat(t.id,"-").concat(e.x,"-").concat(e.y,"-").concat(e.z),data:e.data,visible:i&&(!t.state.isLoaded||e.z===r),tile:e}))})}}]),e}(yn);zs.layerName="TileLayer",zs.defaultProps=Is;var Ds=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){var t=Object(it.a)(Object(L.a)(e.prototype),"getShaders",this).call(this);return t.inject={"vs:#decl":"uniform float trailLength;\nuniform bool isPath3D;\nattribute vec2 instanceTimestamps;\nvarying float vTime;\n","vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);":"vec2 timestamps = instanceTimestamps;\nif (!isPath3D) {\n  prevPosition.z = 0.0;\n  currPosition.z = 0.0;\n  nextPosition.z = 0.0;\n  timestamps.x = instanceStartPositions.z;\n  timestamps.y = instanceEndPositions.z;\n}\n","vs:#main-end":"float shiftZ = sin(timestamps.x) * 1e-4;\ngl_Position.z += shiftZ;\nvTime = timestamps.x + (timestamps.y - timestamps.x) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform float trailLength;\nuniform float currentTime;\nvarying float vTime;\n","fs:#main-start":"if(vTime > currentTime || vTime < currentTime - trailLength) {\n  discard;\n}\n","gl_FragColor = vColor;":"gl_FragColor.a *= 1.0 - (currentTime - vTime) / trailLength;"},t}},{key:"initializeState",value:function(t){Object(it.a)(Object(L.a)(e.prototype),"initializeState",this).call(this,t),this.getAttributeManager().addInstanced({instanceTimestamps:{size:2,update:this.calculateInstanceTimestamps}})}},{key:"draw",value:function(t){var n=this.props,i=n.trailLength,r=n.currentTime,a=n.getTimestamps;t.uniforms=Object.assign({},t.uniforms,{trailLength:i,currentTime:r,isPath3D:Boolean(a)}),Object(it.a)(Object(L.a)(e.prototype),"draw",this).call(this,t)}},{key:"calculateInstanceTimestamps",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.props,a=r.data,o=r.getTimestamps;if(!o)return t.constant=!0,void(t.value=new Float32Array(2));for(var s=this.state.pathTesselator,u=s.bufferLayout,l=s.instanceCount,c=new Float32Array(2*l),h=ot(a,n,i),f=h.iterable,p=h.objectInfo,A=0,d=0;d<n;d++)A+=2*u[d];var v=!0,g=!1,m=void 0;try{for(var y,_=f[Symbol.iterator]();!(v=(y=_.next()).done);v=!0){var b=y.value;p.index++;for(var x=u[p.index],w=o(b,p),S=0;S<x;S++)c[A++]=w[S],c[A++]=w[S+1]}}catch(k){g=!0,m=k}finally{try{v||null==_.return||_.return()}finally{if(g)throw m}}t.constant=!1,t.value=c}}]),e}(No);Ds.layerName="TripsLayer",Ds.defaultProps={trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:null}};var Bs=function(t){var e,n=void 0!==(t=t||{})?t:{},i={};for(e in n)n.hasOwnProperty(e)&&(i[e]=n[e]);n.arguments=[],n.thisProgram="./this.program",n.quit=function(t,e){throw e},n.preRun=[],n.postRun=[];var r="";document.currentScript&&(r=document.currentScript.src),r=0!==r.indexOf("blob:")?r.substr(0,r.lastIndexOf("/")+1):"",n.read=function(t){try{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText}catch(o){var n=G(t);if(n)return function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];i>255&&(i&=255),e.push(String.fromCharCode(i))}return e.join("")}(n);throw o}},n.readAsync=function(t,e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){if(200==i.status||0==i.status&&i.response)e(i.response);else{var r=G(t);r?e(r.buffer):n()}},i.onerror=n,i.send(null)},n.setWindowTitle=function(t){document.title=t};var a=n.print||("undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null),o=n.printErr||("undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||a);for(e in i)i.hasOwnProperty(e)&&(n[e]=i[e]);i=void 0;var s=0,u=function(){return s};var l=!1;function c(t){var e,i=n["_"+t];return e="Cannot call unknown function "+t+", make sure it is exported",i||et("Assertion failed: "+e),i}function h(t,e,n,i,r){var a={string:function(t){var e=0;if(null!=t&&0!==t){var n=1+(t.length<<2);(function(t,e,n){(function(t,e,n,i){if(!(i>0))return 0;for(var r=n,a=n+i-1,o=0;o<t.length;++o){var s=t.charCodeAt(o);if(s>=55296&&s<=57343){var u=t.charCodeAt(++o);s=65536+((1023&s)<<10)|1023&u}if(s<=127){if(n>=a)break;e[n++]=s}else if(s<=2047){if(n+1>=a)break;e[n++]=192|s>>6,e[n++]=128|63&s}else if(s<=65535){if(n+2>=a)break;e[n++]=224|s>>12,e[n++]=128|s>>6&63,e[n++]=128|63&s}else{if(n+3>=a)break;e[n++]=240|s>>18,e[n++]=128|s>>12&63,e[n++]=128|s>>6&63,e[n++]=128|63&s}}e[n]=0})(t,v,e,n)})(t,e=q(n),n)}return e},array:function(t){var e=q(t.length);return function(t,e){d.set(t,e)}(t,e),e}};var o=c(t),s=[],u=0;if(i)for(var l=0;l<i.length;l++){var h=a[n[l]];h?(0===u&&(u=X()),s[l]=h(i[l])):s[l]=i[l]}var f=o.apply(null,s);return f=function(t){return"string"===e?p(t):"boolean"===e?Boolean(t):t}(f),0!==u&&Z(u),f}var f="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function p(t,e){return t?function(t,e,n){for(var i=e+n,r=e;t[r]&&!(r>=i);)++r;if(r-e>16&&t.subarray&&f)return f.decode(t.subarray(e,r));for(var a="";e<r;){var o=t[e++];if(128&o){var s=63&t[e++];if(192!=(224&o)){var u=63&t[e++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&t[e++])<65536)a+=String.fromCharCode(o);else{var l=o-65536;a+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}(v,t,e):""}var A,d,v,g,m,y,_;"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");function b(t,e){return t%e>0&&(t+=e-t%e),t}function x(){n.HEAP8=d=new Int8Array(A),n.HEAP16=g=new Int16Array(A),n.HEAP32=m=new Int32Array(A),n.HEAPU8=v=new Uint8Array(A),n.HEAPU16=new Uint16Array(A),n.HEAPU32=new Uint32Array(A),n.HEAPF32=y=new Float32Array(A),n.HEAPF64=_=new Float64Array(A)}var w=n.TOTAL_MEMORY||33554432;function S(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var i=e.func;"number"==typeof i?void 0===e.arg?n.dynCall_v(i):n.dynCall_vi(i,e.arg):i(void 0===e.arg?null:e.arg)}else e()}}w<5242880&&o("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+w+"! (TOTAL_STACK=5242880)"),n.buffer?A=n.buffer:(A=new ArrayBuffer(w),n.buffer=A),x(),m[5888]=5266688;var k=[],O=[],P=[],E=[],C=!1;var T=Math.abs,M=Math.ceil,j=Math.floor,L=Math.min,I=0,z=null,D=null;n.preloadedImages={},n.preloadedAudios={};var B=null,R="data:application/octet-stream;base64,";function F(t){return String.prototype.startsWith?t.startsWith(R):0===t.indexOf(R)}B="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAABAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAQAAAAABAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAYWxnb3MuYwBwb2x5ZmlsbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";function N(){return w}function U(t){try{var e=new ArrayBuffer(t);if(e.byteLength!=t)return!1;new Int8Array(e).set(d)}catch(i){return!1}return n._emscripten_replace_memory(e),d=new Int8Array(e),g=new Int16Array(e),m=new Int32Array(e),v=new Uint8Array(e),new Uint16Array(e),new Uint32Array(e),y=new Float32Array(e),_=new Float64Array(e),A=e,e}var V="function"==typeof atob?atob:function(t){var e,n,i,r,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{e=s.indexOf(t.charAt(l++))<<2|(r=s.indexOf(t.charAt(l++)))>>4,n=(15&r)<<4|(a=s.indexOf(t.charAt(l++)))>>2,i=(3&a)<<6|(o=s.indexOf(t.charAt(l++))),u+=String.fromCharCode(e),64!==a&&(u+=String.fromCharCode(n)),64!==o&&(u+=String.fromCharCode(i))}while(l<t.length);return u};function G(t){if(F(t))return function(t){try{for(var e=V(t),n=new Uint8Array(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}catch(r){throw new Error("Converting base64 string to bytes failed.")}}(t.slice(R.length))}var W,H=function(t,e,n){var i=new t.Int8Array(n),r=new t.Int32Array(n),a=(new t.Uint8Array(n),new t.Float32Array(n),new t.Float64Array(n)),o=0|e.l,s=t.Math.floor,u=t.Math.abs,l=t.Math.sqrt,c=t.Math.pow,h=t.Math.cos,f=t.Math.sin,p=t.Math.tan,A=t.Math.acos,d=t.Math.asin,v=t.Math.atan,g=t.Math.atan2,m=t.Math.ceil,y=t.Math.imul,_=t.Math.clz32,b=e.b,x=e.c,w=e.d,S=e.e,k=e.f,O=e.g,P=e.h,E=e.i,C=23808;function T(t,e,n,i){var r,a,o;0|M(t|=0,e|=0,n|=0,i|=0,o=0|se(a=(r=1+(0|y(3*n|0,n+1|0))|0)<<2))?(ye(0|i,0,r<<3|0),ye(0|o,0,0|a),j(t,e,n,i,o,r,0),ue(o)):ue(o)}function M(t,e,n,i,a){t|=0,e|=0,n|=0,a|=0;var o,s=0,u=0,l=0,c=0,h=0,f=0,p=0,A=0;if(o=C,C=C+16|0,A=o,r[(s=i|=0)>>2]=t,r[s+4>>2]=e,(s=0!=(0|a))&&(r[a>>2]=0),0|Et(t,e))return C=o,0|(A=1);r[A>>2]=0;t:do{if((0|n)>=1)if(s)for(h=0,f=1,p=1,u=0,s=t;;){if(!(u|h)){if(0==(0|(s=0|L(s,e,4,A)))&0==(0|(e=0|x()))){s=2;break t}if(0|Et(s,e)){s=1;break t}}if(0==(0|(s=0|L(s,e,0|r[16+(h<<2)>>2],A)))&0==(0|(e=0|x()))){s=2;break t}if(r[(t=i+(p<<3)|0)>>2]=s,r[t+4>>2]=e,r[a+(p<<2)>>2]=f,t=(0|(u=u+1|0))==(0|f),c=6==(0|(l=h+1|0)),0|Et(s,e)){s=1;break t}if((0|(f=f+(c&t&1)|0))>(0|n)){s=0;break}h=t?c?0:l:h,p=p+1|0,u=t?0:u}else for(h=0,f=1,p=1,u=0,s=t;;){if(!(u|h)){if(0==(0|(s=0|L(s,e,4,A)))&0==(0|(e=0|x()))){s=2;break t}if(0|Et(s,e)){s=1;break t}}if(0==(0|(s=0|L(s,e,0|r[16+(h<<2)>>2],A)))&0==(0|(e=0|x()))){s=2;break t}if(r[(t=i+(p<<3)|0)>>2]=s,r[t+4>>2]=e,t=(0|(u=u+1|0))==(0|f),c=6==(0|(l=h+1|0)),0|Et(s,e)){s=1;break t}if((0|(f=f+(c&t&1)|0))>(0|n)){s=0;break}h=t?c?0:l:h,p=p+1|0,u=t?0:u}else s=0}while(0);return C=o,0|(A=s)}function j(t,e,n,i,a,o,s){n|=0,i|=0,a|=0,o|=0,s|=0;var u,l,c=0,h=0,f=0,p=0,A=0;if(l=C,C=C+16|0,u=l,0==(0|(t|=0))&0==(0|(e|=0)))C=l;else{if(c=0|Ae(0|t,0|e,0|o,((0|o)<0)<<31>>31|0),x(),!(0==(0|(A=0|r[(p=h=i+(c<<3)|0)>>2]))&0==(0|(p=0|r[p+4>>2]))|(f=(0|A)==(0|t)&(0|p)==(0|e))))do{f=(0|(p=0|r[(A=h=i+((c=(c+1|0)%(0|o)|0)<<3)|0)>>2]))==(0|t)&(0|(A=0|r[A+4>>2]))==(0|e)}while(!(0==(0|p)&0==(0|A)|f));c=a+(c<<2)|0,f&&(0|r[c>>2])<=(0|s)?C=l:(r[(A=h)>>2]=t,r[A+4>>2]=e,r[c>>2]=s,(0|s)>=(0|n)?C=l:(A=s+1|0,r[u>>2]=0,j(p=0|L(t,e,2,u),0|x(),n,i,a,o,A),r[u>>2]=0,j(p=0|L(t,e,3,u),0|x(),n,i,a,o,A),r[u>>2]=0,j(p=0|L(t,e,1,u),0|x(),n,i,a,o,A),r[u>>2]=0,j(p=0|L(t,e,5,u),0|x(),n,i,a,o,A),r[u>>2]=0,j(p=0|L(t,e,4,u),0|x(),n,i,a,o,A),r[u>>2]=0,j(p=0|L(t,e,6,u),0|x(),n,i,a,o,A),C=l))}}function L(t,e,n,i){t|=0,e|=0,n|=0;var a,o,s=0,u=0,l=0,c=0,h=0,f=0,p=0;if((0|r[(i|=0)>>2])>0){s=0;do{n=0|at(n),s=s+1|0}while((0|s)<(0|r[i>>2]))}a=0|de(0|t,0|e,45),x(),o=127&a,u=0|Ct(t,e),s=0|de(0|t,0|e,52),x(),s&=15;t:do{if(s)for(;;){if(f=0|de(0|t,0|e,0|(h=3*(15-s|0)|0)),x(),f&=7,p=0==(0|It(s)),s=s+-1|0,c=0|ve(7,0,0|h),e&=~(0|x()),t=(h=0|ve(0|r[(p?464:48)+(28*f|0)+(n<<2)>>2],0,0|h))|t&~c,e|=0|x(),!(n=0|r[(p?672:256)+(28*f|0)+(n<<2)>>2])){n=0;break t}if(!s){l=6;break}}else l=6}while(0);6==(0|l)&&(t|=f=0|ve(0|(p=0|r[880+(28*o|0)+(n<<2)>>2]),0,45),e=0|x()|-1040385&e,n=0|r[4304+(28*o|0)+(n<<2)>>2],127==(127&p|0)&&(p=0|ve(0|r[880+(28*o|0)+20>>2],0,45),e=0|x()|-1040385&e,n=0|r[4304+(28*o|0)+20>>2],t=0|Mt(p|t,e),e=0|x(),r[i>>2]=1+(0|r[i>>2]))),l=0|de(0|t,0|e,45),x(),l&=127;t:do{if(0|I(l)){e:do{if(1==(0|Ct(t,e))){if((0|o)!=(0|l)){if(0|R(l,0|r[7728+(28*o|0)>>2])){t=0|Lt(t,e),u=1,e=0|x();break}t=0|Mt(t,e),u=1,e=0|x();break}switch(0|u){case 5:t=0|Lt(t,e),e=0|x(),r[i>>2]=5+(0|r[i>>2]),u=0;break e;case 3:t=0|Mt(t,e),e=0|x(),r[i>>2]=1+(0|r[i>>2]),u=0;break e;default:return p=0,b(0|(f=0)),0|p}}else u=0}while(0);if((0|n)>0){s=0;do{t=0|Tt(t,e),e=0|x(),s=s+1|0}while((0|s)!=(0|n))}if((0|o)!=(0|l)){if(!(0|z(l))){if(0!=(0|u)|5!=(0|Ct(t,e)))break;r[i>>2]=1+(0|r[i>>2]);break}switch(127&a){case 8:case 118:break t}3!=(0|Ct(t,e))&&(r[i>>2]=1+(0|r[i>>2]))}}else if((0|n)>0){s=0;do{t=0|Mt(t,e),e=0|x(),s=s+1|0}while((0|s)!=(0|n))}}while(0);return r[i>>2]=((0|r[i>>2])+n|0)%6|0,p=t,b(0|(f=e)),0|p}function I(t){return 0|r[7728+(28*(t|=0)|0)+16>>2]}function z(t){return 4==(0|(t|=0))|117==(0|t)|0}function D(t){return 0|r[11152+(216*(0|r[(t|=0)>>2])|0)+(72*(0|r[t+4>>2])|0)+(24*(0|r[t+8>>2])|0)+(r[t+12>>2]<<3)>>2]}function B(t){return 0|r[11152+(216*(0|r[(t|=0)>>2])|0)+(72*(0|r[t+4>>2])|0)+(24*(0|r[t+8>>2])|0)+(r[t+12>>2]<<3)+4>>2]}function R(t,e){return e|=0,(0|r[7728+(28*(t|=0)|0)+20>>2])==(0|e)?0|(e=1):0|(e=(0|r[7728+(28*t|0)+24>>2])==(0|e))}function F(t,e){return 0|r[880+(28*(t|=0)|0)+((e|=0)<<2)>>2]}function N(t,e){return e|=0,(0|r[880+(28*(t|=0)|0)>>2])==(0|e)?0|(e=0):(0|r[880+(28*t|0)+4>>2])==(0|e)?0|(e=1):(0|r[880+(28*t|0)+8>>2])==(0|e)?0|(e=2):(0|r[880+(28*t|0)+12>>2])==(0|e)?0|(e=3):(0|r[880+(28*t|0)+16>>2])==(0|e)?0|(e=4):(0|r[880+(28*t|0)+20>>2])==(0|e)?0|(e=5):0|((0|r[880+(28*t|0)+24>>2])==(0|e)?6:7)}function U(t){return+a[(t|=0)+16>>3]<+a[t+24>>3]|0}function V(t,e){t|=0;var n,i,r=0;return(r=+a[(e|=0)>>3])>=+a[t+8>>3]&&r<=+a[t>>3]?(n=+a[t+16>>3],r=+a[t+24>>3],e=(i=+a[e+8>>3])>=r,t=i<=n&1,n<r?e&&(t=1):e||(t=0),0|(e=0!=(0|t))):0|(e=0)}function G(t,e){e|=0;var n,i,r,o,s,l,c,h,f=0,p=0;return n=C,C=C+224|0,r=n+200|0,i=n+32|0,s=n,h=(t|=0)+8|0,a[(o=n+16|0)>>3]=.5*(+a[t>>3]+ +a[h>>3]),f=+a[(l=t+16|0)>>3],f=+wt(.5*((p=+a[t+24>>3])+(f<p?f+6.283185307179586:f))),a[o+8>>3]=f,f=+a[t>>3],p=+u(+f),c=+a[h>>3],t=p>+u(+c),a[s>>3]=t?c:f,a[s+8>>3]=+a[l>>3],f=+St(o,s),Rt(t=0|zt(o,e),e=0|x(),r),Ft(t,e,i),e=~~+m(+f/(1.5*+St(r,i+8|0))),C=n,0|e}function W(t,e,n,i){e|=0,n|=0,i|=0,r[(t|=0)>>2]=e,r[t+4>>2]=n,r[t+8>>2]=i}function H(t,e){t|=0;var n,i,o,s,l=0,c=0,h=0,f=0,p=0,A=0,d=0;r[(s=(e|=0)+8|0)>>2]=0,i=+a[t>>3],f=+u(+i),o=+a[t+8>>3],f+=.5*(p=+u(+o)/.8660254037844386),f-=+(0|(l=~~f)),p-=+(0|(t=~~p));do{if(f<.5){if(f<.3333333333333333){if(r[e>>2]=l,p<.5*(f+1)){r[e+4>>2]=t;break}t=t+1|0,r[e+4>>2]=t;break}if(t=(1&!(p<(d=1-f)))+t|0,r[e+4>>2]=t,d<=p&p<2*f){l=l+1|0,r[e>>2]=l;break}r[e>>2]=l;break}if(!(f<.6666666666666666)){if(l=l+1|0,r[e>>2]=l,p<.5*f){r[e+4>>2]=t;break}t=t+1|0,r[e+4>>2]=t;break}if(p<1-f){if(r[e+4>>2]=t,2*f-1<p){r[e>>2]=l;break}}else t=t+1|0,r[e+4>>2]=t;l=l+1|0,r[e>>2]=l}while(0);do{if(i<0){if(1&t){l=~~(+(0|l)-(2*(+((A=0|he(0|l,((0|l)<0)<<31>>31|0,0|(A=(t+1|0)/2|0),((0|A)<0)<<31>>31|0))>>>0)+4294967296*+(0|x()))+1)),r[e>>2]=l;break}l=~~(+(0|l)-2*(+((A=0|he(0|l,((0|l)<0)<<31>>31|0,0|(A=(0|t)/2|0),((0|A)<0)<<31>>31|0))>>>0)+4294967296*+(0|x()))),r[e>>2]=l;break}}while(0);A=e+4|0,o<0&&(l=l-((1|t<<1)/2|0)|0,r[e>>2]=l,t=0-t|0,r[A>>2]=t),c=t-l|0,(0|l)<0?(h=0-l|0,r[A>>2]=c,r[s>>2]=h,r[e>>2]=0,t=c,l=0):h=0,(0|t)<0&&(l=l-t|0,r[e>>2]=l,h=h-t|0,r[s>>2]=h,r[A>>2]=0,t=0),n=l-h|0,c=t-h|0,(0|h)<0&&(r[e>>2]=n,r[A>>2]=c,r[s>>2]=0,t=c,l=n,h=0),(0|(c=(0|h)<(0|(c=(0|t)<(0|l)?t:l))?h:c))<=0||(r[e>>2]=l-c,r[A>>2]=t-c,r[s>>2]=h-c)}function q(t){var e,n=0,i=0,a=0,o=0,s=0;n=0|r[(t|=0)>>2],i=0|r[(e=t+4|0)>>2],(0|n)<0&&(i=i-n|0,r[e>>2]=i,r[(s=t+8|0)>>2]=(0|r[s>>2])-n,r[t>>2]=0,n=0),(0|i)<0?(n=n-i|0,r[t>>2]=n,o=(0|r[(s=t+8|0)>>2])-i|0,r[s>>2]=o,r[e>>2]=0,i=0):(s=o=t+8|0,o=0|r[o>>2]),(0|o)<0&&(n=n-o|0,r[t>>2]=n,i=i-o|0,r[e>>2]=i,r[s>>2]=0,o=0),(0|(a=(0|o)<(0|(a=(0|i)<(0|n)?i:n))?o:a))<=0||(r[t>>2]=n-a,r[e>>2]=i-a,r[s>>2]=o-a)}function Z(t,e){e|=0;var n,i;i=0|r[(t|=0)+8>>2],n=+((0|r[t+4>>2])-i|0),a[e>>3]=+((0|r[t>>2])-i|0)-.5*n,a[e+8>>3]=.8660254037844386*n}function X(t,e,n){t|=0,e|=0,r[(n|=0)>>2]=(0|r[e>>2])+(0|r[t>>2]),r[n+4>>2]=(0|r[e+4>>2])+(0|r[t+4>>2]),r[n+8>>2]=(0|r[e+8>>2])+(0|r[t+8>>2])}function Q(t,e,n){t|=0,e|=0,r[(n|=0)>>2]=(0|r[t>>2])-(0|r[e>>2]),r[n+4>>2]=(0|r[t+4>>2])-(0|r[e+4>>2]),r[n+8>>2]=(0|r[t+8>>2])-(0|r[e+8>>2])}function Y(t,e){e|=0;var n,i=0;i=0|y(0|r[(t|=0)>>2],e),r[t>>2]=i,n=0|y(0|r[(i=t+4|0)>>2],e),r[i>>2]=n,e=0|y(0|r[(t=t+8|0)>>2],e),r[t>>2]=e}function K(t){var e,n,i=0,a=0,o=0,s=0,u=0;u=(0|(n=0|r[(t|=0)>>2]))<0,t=(t=(a=(0|(s=((e=(0|(o=(0|r[t+4>>2])-(u?n:0)|0))<0)?0-o|0:0)+((0|r[t+8>>2])-(u?n:0))|0))<0)?0:s)-((o=(0|(a=(0|t)<(0|(a=(0|(i=(e?0:o)-(a?s:0)|0))<(0|(s=(u?0:n)-(e?o:0)-(a?s:0)|0))?i:s))?t:a))>0)?a:0)|0,i=i-(o?a:0)|0;t:do{switch(s-(o?a:0)|0){case 0:switch(0|i){case 0:return 0|(u=0==(0|t)?0:1==(0|t)?1:7);case 1:return 0|(u=0==(0|t)?2:1==(0|t)?3:7);default:break t}case 1:switch(0|i){case 0:return 0|(u=0==(0|t)?4:1==(0|t)?5:7);case 1:if(t)break t;return 0|(t=6);default:break t}}}while(0);return 0|(u=7)}function J(t){var e,n,i=0,a=0,o=0,s=0,u=0;a=0|r[(e=(t|=0)+8|0)>>2],o=0|ce(+((3*(i=(0|r[t>>2])-a|0)|0)-(a=(0|r[(n=t+4|0)>>2])-a|0)|0)/7),r[t>>2]=o,i=0|ce(+((a<<1)+i|0)/7),r[n>>2]=i,r[e>>2]=0,a=i-o|0,(0|o)<0?(u=0-o|0,r[n>>2]=a,r[e>>2]=u,r[t>>2]=0,i=a,o=0,a=u):a=0,(0|i)<0&&(o=o-i|0,r[t>>2]=o,a=a-i|0,r[e>>2]=a,r[n>>2]=0,i=0),u=o-a|0,s=i-a|0,(0|a)<0?(r[t>>2]=u,r[n>>2]=s,r[e>>2]=0,i=s,s=u,a=0):s=o,(0|(o=(0|a)<(0|(o=(0|i)<(0|s)?i:s))?a:o))<=0||(r[t>>2]=s-o,r[n>>2]=i-o,r[e>>2]=a-o)}function $(t){var e,n,i=0,a=0,o=0,s=0,u=0;a=0|r[(e=(t|=0)+8|0)>>2],o=0|ce(+(((i=(0|r[t>>2])-a|0)<<1)+(a=(0|r[(n=t+4|0)>>2])-a|0)|0)/7),r[t>>2]=o,i=0|ce(+((3*a|0)-i|0)/7),r[n>>2]=i,r[e>>2]=0,a=i-o|0,(0|o)<0?(u=0-o|0,r[n>>2]=a,r[e>>2]=u,r[t>>2]=0,i=a,o=0,a=u):a=0,(0|i)<0&&(o=o-i|0,r[t>>2]=o,a=a-i|0,r[e>>2]=a,r[n>>2]=0,i=0),u=o-a|0,s=i-a|0,(0|a)<0?(r[t>>2]=u,r[n>>2]=s,r[e>>2]=0,i=s,s=u,a=0):s=o,(0|(o=(0|a)<(0|(o=(0|i)<(0|s)?i:s))?a:o))<=0||(r[t>>2]=s-o,r[n>>2]=i-o,r[e>>2]=a-o)}function tt(t){var e,n,i,a=0,o=0,s=0,u=0;a=0|r[(t|=0)>>2],o=0|r[(n=t+4|0)>>2],s=0|r[(i=t+8|0)>>2],u=o+(3*a|0)|0,r[t>>2]=u,o=s+(3*o|0)|0,r[n>>2]=o,a=(3*s|0)+a|0,r[i>>2]=a,s=o-u|0,(0|u)<0?(a=a-u|0,r[n>>2]=s,r[i>>2]=a,r[t>>2]=0,o=s,s=0):s=u,(0|o)<0&&(s=s-o|0,r[t>>2]=s,a=a-o|0,r[i>>2]=a,r[n>>2]=0,o=0),e=s-a|0,u=o-a|0,(0|a)<0?(r[t>>2]=e,r[n>>2]=u,r[i>>2]=0,s=e,a=0):u=o,(0|(o=(0|a)<(0|(o=(0|u)<(0|s)?u:s))?a:o))<=0||(r[t>>2]=s-o,r[n>>2]=u-o,r[i>>2]=a-o)}function et(t){var e,n,i,a=0,o=0,s=0,u=0;u=0|r[(t|=0)>>2],s=(3*(a=0|r[(n=t+4|0)>>2])|0)+u|0,u=(o=0|r[(i=t+8|0)>>2])+(3*u|0)|0,r[t>>2]=u,r[n>>2]=s,a=(3*o|0)+a|0,r[i>>2]=a,o=s-u|0,(0|u)<0?(a=a-u|0,r[n>>2]=o,r[i>>2]=a,r[t>>2]=0,u=0):o=s,(0|o)<0&&(u=u-o|0,r[t>>2]=u,a=a-o|0,r[i>>2]=a,r[n>>2]=0,o=0),e=u-a|0,s=o-a|0,(0|a)<0?(r[t>>2]=e,r[n>>2]=s,r[i>>2]=0,u=e,a=0):s=o,(0|(o=(0|a)<(0|(o=(0|s)<(0|u)?s:u))?a:o))<=0||(r[t>>2]=u-o,r[n>>2]=s-o,r[i>>2]=a-o)}function nt(t,e){t|=0;var n,i,a,o=0,s=0,u=0;((e|=0)+-1|0)>>>0>=6||(u=(0|r[15472+(12*e|0)>>2])+(0|r[t>>2])|0,r[t>>2]=u,a=t+4|0,s=(0|r[15472+(12*e|0)+4>>2])+(0|r[a>>2])|0,r[a>>2]=s,i=t+8|0,e=(0|r[15472+(12*e|0)+8>>2])+(0|r[i>>2])|0,r[i>>2]=e,o=s-u|0,(0|u)<0?(e=e-u|0,r[a>>2]=o,r[i>>2]=e,r[t>>2]=0,s=0):(o=s,s=u),(0|o)<0&&(s=s-o|0,r[t>>2]=s,e=e-o|0,r[i>>2]=e,r[a>>2]=0,o=0),n=s-e|0,u=o-e|0,(0|e)<0?(r[t>>2]=n,r[a>>2]=u,r[i>>2]=0,s=n,e=0):u=o,(0|(o=(0|e)<(0|(o=(0|u)<(0|s)?u:s))?e:o))<=0||(r[t>>2]=s-o,r[a>>2]=u-o,r[i>>2]=e-o))}function it(t){var e,n,i,a=0,o=0,s=0,u=0;u=0|r[(t|=0)>>2],s=(a=0|r[(n=t+4|0)>>2])+u|0,u=(o=0|r[(i=t+8|0)>>2])+u|0,r[t>>2]=u,r[n>>2]=s,a=o+a|0,r[i>>2]=a,o=s-u|0,(0|u)<0?(a=a-u|0,r[n>>2]=o,r[i>>2]=a,r[t>>2]=0,s=0):(o=s,s=u),(0|o)<0&&(s=s-o|0,r[t>>2]=s,a=a-o|0,r[i>>2]=a,r[n>>2]=0,o=0),e=s-a|0,u=o-a|0,(0|a)<0?(r[t>>2]=e,r[n>>2]=u,r[i>>2]=0,s=e,a=0):u=o,(0|(o=(0|a)<(0|(o=(0|u)<(0|s)?u:s))?a:o))<=0||(r[t>>2]=s-o,r[n>>2]=u-o,r[i>>2]=a-o)}function rt(t){var e,n,i,a=0,o=0,s=0,u=0;a=0|r[(t|=0)>>2],s=0|r[(n=t+4|0)>>2],o=0|r[(i=t+8|0)>>2],u=s+a|0,r[t>>2]=u,s=o+s|0,r[n>>2]=s,a=o+a|0,r[i>>2]=a,o=s-u|0,(0|u)<0?(a=a-u|0,r[n>>2]=o,r[i>>2]=a,r[t>>2]=0,s=0):(o=s,s=u),(0|o)<0&&(s=s-o|0,r[t>>2]=s,a=a-o|0,r[i>>2]=a,r[n>>2]=0,o=0),e=s-a|0,u=o-a|0,(0|a)<0?(r[t>>2]=e,r[n>>2]=u,r[i>>2]=0,s=e,a=0):u=o,(0|(o=(0|a)<(0|(o=(0|u)<(0|s)?u:s))?a:o))<=0||(r[t>>2]=s-o,r[n>>2]=u-o,r[i>>2]=a-o)}function at(t){switch(0|(t|=0)){case 1:t=5;break;case 5:t=4;break;case 4:t=6;break;case 6:t=2;break;case 2:t=3;break;case 3:t=1}return 0|t}function ot(t){switch(0|(t|=0)){case 1:t=3;break;case 3:t=2;break;case 2:t=6;break;case 6:t=4;break;case 4:t=5;break;case 5:t=1}return 0|t}function st(t){var e,n,i,a=0,o=0,s=0,u=0;a=0|r[(t|=0)>>2],o=0|r[(n=t+4|0)>>2],s=0|r[(i=t+8|0)>>2],u=o+(a<<1)|0,r[t>>2]=u,o=s+(o<<1)|0,r[n>>2]=o,a=(s<<1)+a|0,r[i>>2]=a,s=o-u|0,(0|u)<0?(a=a-u|0,r[n>>2]=s,r[i>>2]=a,r[t>>2]=0,o=s,s=0):s=u,(0|o)<0&&(s=s-o|0,r[t>>2]=s,a=a-o|0,r[i>>2]=a,r[n>>2]=0,o=0),e=s-a|0,u=o-a|0,(0|a)<0?(r[t>>2]=e,r[n>>2]=u,r[i>>2]=0,s=e,a=0):u=o,(0|(o=(0|a)<(0|(o=(0|u)<(0|s)?u:s))?a:o))<=0||(r[t>>2]=s-o,r[n>>2]=u-o,r[i>>2]=a-o)}function ut(t){var e,n,i,a=0,o=0,s=0,u=0;u=0|r[(t|=0)>>2],s=((a=0|r[(n=t+4|0)>>2])<<1)+u|0,u=(o=0|r[(i=t+8|0)>>2])+(u<<1)|0,r[t>>2]=u,r[n>>2]=s,a=(o<<1)+a|0,r[i>>2]=a,o=s-u|0,(0|u)<0?(a=a-u|0,r[n>>2]=o,r[i>>2]=a,r[t>>2]=0,u=0):o=s,(0|o)<0&&(u=u-o|0,r[t>>2]=u,a=a-o|0,r[i>>2]=a,r[n>>2]=0,o=0),e=u-a|0,s=o-a|0,(0|a)<0?(r[t>>2]=e,r[n>>2]=s,r[i>>2]=0,u=e,a=0):s=o,(0|(o=(0|a)<(0|(o=(0|s)<(0|u)?s:u))?a:o))<=0||(r[t>>2]=u-o,r[n>>2]=s-o,r[i>>2]=a-o)}function lt(t,e){e|=0;var n,i,a,o=0,s=0,u=0;return a=(0|(i=(0|r[(t|=0)>>2])-(0|r[e>>2])|0))<0,n=(0|(s=(0|r[t+4>>2])-(0|r[e+4>>2])-(a?i:0)|0))<0,e=(e=(t=(0|(u=(a?0-i|0:0)+(0|r[t+8>>2])-(0|r[e+8>>2])+(n?0-s|0:0)|0))<0)?0:u)-((s=(0|(t=(0|e)<(0|(t=(0|(o=(n?0:s)-(t?u:0)|0))<(0|(u=(a?0:i)-(n?s:0)-(t?u:0)|0))?o:u))?e:t))>0)?t:0)|0,o=o-(s?t:0)|0,0|((0|(t=(0|(t=u-(s?t:0)|0))>-1?t:0-t|0))>(0|(e=(0|(o=(0|o)>-1?o:0-o|0))>(0|(e=(0|e)>-1?e:0-e|0))?o:e))?t:e)}function ct(t,e){e|=0;var n;n=0|r[(t|=0)+8>>2],r[e>>2]=(0|r[t>>2])-n,r[e+4>>2]=(0|r[t+4>>2])-n}function ht(t,e){e|=0;var n,i,a,o=0,s=0,u=0;s=0|r[(t|=0)>>2],r[e>>2]=s,t=0|r[t+4>>2],r[(i=e+4|0)>>2]=t,r[(a=e+8|0)>>2]=0,o=t-s|0,(0|s)<0?(t=0-s|0,r[i>>2]=o,r[a>>2]=t,r[e>>2]=0,s=0):(o=t,t=0),(0|o)<0&&(s=s-o|0,r[e>>2]=s,t=t-o|0,r[a>>2]=t,r[i>>2]=0,o=0),n=s-t|0,u=o-t|0,(0|t)<0?(r[e>>2]=n,r[i>>2]=u,r[a>>2]=0,o=u,u=n,t=0):u=s,(0|(s=(0|t)<(0|(s=(0|o)<(0|u)?o:u))?t:s))<=0||(r[e>>2]=u-s,r[i>>2]=o-s,r[a>>2]=t-s)}function ft(t){var e,n,i,a;n=(a=0|r[(e=(t|=0)+8|0)>>2])-(0|r[t>>2])|0,r[t>>2]=n,t=(0|r[(i=t+4|0)>>2])-a|0,r[i>>2]=t,r[e>>2]=0-(t+n)}function pt(t){var e,n,i=0,a=0,o=0,s=0,u=0;i=0-(a=0|r[(t|=0)>>2])|0,r[t>>2]=i,r[(e=t+8|0)>>2]=0,s=(o=0|r[(n=t+4|0)>>2])+a|0,(0|a)>0?(r[n>>2]=s,r[e>>2]=a,r[t>>2]=0,i=0,o=s):a=0,(0|o)<0?(u=i-o|0,r[t>>2]=u,a=a-o|0,r[e>>2]=a,r[n>>2]=0,s=u-a|0,i=0-a|0,(0|a)<0?(r[t>>2]=s,r[n>>2]=i,r[e>>2]=0,o=i,a=0):(o=0,s=u)):s=i,(0|(i=(0|a)<(0|(i=(0|o)<(0|s)?o:s))?a:i))<=0||(r[t>>2]=s-i,r[n>>2]=o-i,r[e>>2]=a-i)}function At(t,e,n,i){e|=0,n|=0,i|=0;var o,s=0,u=0,l=0,c=0;if(o=C,C=C+32|0,function(t,e){e|=0;var n=0,i=0,r=0;n=+a[(t|=0)>>3],i=+h(+n),n=+f(+n),a[e+16>>3]=n,n=+a[t+8>>3],r=i*+h(+n),a[e>>3]=r,n=i*+f(+n),a[e+8>>3]=n}(t|=0,u=o),r[n>>2]=0,s=+$t(15888,u),(l=+$t(15912,u))<s&&(r[n>>2]=1,s=l),(l=+$t(15936,u))<s&&(r[n>>2]=2,s=l),(l=+$t(15960,u))<s&&(r[n>>2]=3,s=l),(l=+$t(15984,u))<s&&(r[n>>2]=4,s=l),(l=+$t(16008,u))<s&&(r[n>>2]=5,s=l),(l=+$t(16032,u))<s&&(r[n>>2]=6,s=l),(l=+$t(16056,u))<s&&(r[n>>2]=7,s=l),(l=+$t(16080,u))<s&&(r[n>>2]=8,s=l),(l=+$t(16104,u))<s&&(r[n>>2]=9,s=l),(l=+$t(16128,u))<s&&(r[n>>2]=10,s=l),(l=+$t(16152,u))<s&&(r[n>>2]=11,s=l),(l=+$t(16176,u))<s&&(r[n>>2]=12,s=l),(l=+$t(16200,u))<s&&(r[n>>2]=13,s=l),(l=+$t(16224,u))<s&&(r[n>>2]=14,s=l),(l=+$t(16248,u))<s&&(r[n>>2]=15,s=l),(l=+$t(16272,u))<s&&(r[n>>2]=16,s=l),(l=+$t(16296,u))<s&&(r[n>>2]=17,s=l),(l=+$t(16320,u))<s&&(r[n>>2]=18,s=l),(l=+$t(16344,u))<s&&(r[n>>2]=19,s=l),(l=+A(+(1-.5*s)))<1e-16)return r[i>>2]=0,r[i+4>>2]=0,r[i+8>>2]=0,r[i+12>>2]=0,void(C=o);if(n=0|r[n>>2],s=+yt((s=+a[16368+(24*n|0)>>3])-+yt(+function(t,e){t|=0;var n=0,i=0,r=0,o=0,s=0;return o=+a[(e|=0)>>3],i=+h(+o),r=+a[e+8>>3]-+a[t+8>>3],s=i*+f(+r),n=+a[t>>3],+ +g(+s,+(+f(+o)*+h(+n)-+h(+r)*(i*+f(+n))))}(15568+(n<<4)|0,t))),c=0|It(e)?+yt(s+-.3334731722518321):s,s=+p(+l)/.381966011250105,(0|e)>0){u=0;do{s*=2.6457513110645907,u=u+1|0}while((0|u)!=(0|e))}l=+h(+c)*s,a[i>>3]=l,c=+f(+c)*s,a[i+8>>3]=c,C=o}function dt(t,e,n,i,o){e|=0,n|=0,i|=0,o|=0;var s=0,c=0;if((s=+function(t){var e=0,n=0;return n=+a[(t|=0)>>3],e=+a[t+8>>3],+ +l(+(n*n+e*e))}(t|=0))<1e-16)return e=15568+(e<<4)|0,r[o>>2]=r[e>>2],r[o+4>>2]=r[e+4>>2],r[o+8>>2]=r[e+8>>2],void(r[o+12>>2]=r[e+12>>2]);if(c=+g(+ +a[t+8>>3],+ +a[t>>3]),(0|n)>0){t=0;do{s/=2.6457513110645907,t=t+1|0}while((0|t)!=(0|n))}i?(s/=3,n=0==(0|It(n)),s=+v(.381966011250105*(n?s:s/2.6457513110645907))):(s=+v(.381966011250105*s),0|It(n)&&(c=+yt(c+.3334731722518321))),function(t,e,n,i){t|=0,e=+e,i|=0;var o=0,s=0,l=0,c=0;if((n=+n)<1e-16)return r[i>>2]=r[t>>2],r[i+4>>2]=r[t+4>>2],r[i+8>>2]=r[t+8>>2],void(r[i+12>>2]=r[t+12>>2]);s=e<0?e+6.283185307179586:e,s=e>=6.283185307179586?s+-6.283185307179586:s;do{if(!(s<1e-16)){if(o=+u(+(s+-3.141592653589793))<1e-16,e=+a[t>>3],o){e-=n,a[i>>3]=e,o=i;break}if(l=+h(+n),n=+f(+n),e=l*+f(+e)+ +h(+s)*(n*+h(+e)),e=+d(+((e=e>1?1:e)<-1?-1:e)),a[i>>3]=e,+u(+(e+-1.5707963267948966))<1e-16)return a[i>>3]=1.5707963267948966,void(a[i+8>>3]=0);if(+u(+(e+1.5707963267948966))<1e-16)return a[i>>3]=-1.5707963267948966,void(a[i+8>>3]=0);if(c=+h(+e),s=n*+f(+s)/c,n=+a[t>>3],e=(l-+f(+e)*+f(+n))/+h(+n)/c,l=s>1?1:s,(e=+a[t+8>>3]+ +g(+(e<-1?-1:e>1?1:l<-1?-1:l),+e))>3.141592653589793)do{e+=-6.283185307179586}while(e>3.141592653589793);if(e<-3.141592653589793)do{e+=6.283185307179586}while(e<-3.141592653589793);return void(a[i+8>>3]=e)}e=+a[t>>3]+n,a[i>>3]=e,o=i}while(0);if(+u(+(e+-1.5707963267948966))<1e-16)return a[o>>3]=1.5707963267948966,void(a[i+8>>3]=0);if(+u(+(e+1.5707963267948966))<1e-16)return a[o>>3]=-1.5707963267948966,void(a[i+8>>3]=0);if((e=+a[t+8>>3])>3.141592653589793)do{e+=-6.283185307179586}while(e>3.141592653589793);if(e<-3.141592653589793)do{e+=6.283185307179586}while(e<-3.141592653589793);a[i+8>>3]=e}(15568+(e<<4)|0,+yt(+a[16368+(24*e|0)>>3]-c),s,o)}function vt(t,e,n){e|=0,n|=0;var i,a;i=C,C=C+16|0,Z((t|=0)+4|0,a=i),dt(a,0|r[t>>2],e,0,n),C=i}function gt(t,e,n,i){n|=0,i|=0;var a,o,s,u,l,c,h=0,f=0,p=0,A=0,d=0;if(c=C,C=C+32|0,l=c+12|0,o=c,d=(t|=0)+4|0,A=0|r[17056+((e|=0)<<2)>>2],A=(u=0!=(0|i))?3*A|0:A,h=0|r[d>>2],a=0|r[(s=t+8|0)>>2],u){if((0|(h=a+h+(i=0|r[(f=t+12|0)>>2])|0))==(0|A))return C=c,0|(d=1);p=f}else h=a+h+(i=0|r[(p=t+12|0)>>2])|0;if((0|h)<=(0|A))return C=c,0|(d=0);do{if((0|i)>0){if(i=0|r[t>>2],(0|a)>0){f=18736+(80*i|0)+60|0,i=t;break}i=18736+(80*i|0)+40|0,n?(W(l,A,0,0),Q(d,l,o),rt(o),X(o,l,d),f=i,i=t):(f=i,i=t)}else f=18736+(80*(0|r[t>>2])|0)+20|0,i=t}while(0);if(r[i>>2]=r[f>>2],(0|r[(h=f+16|0)>>2])>0){i=0;do{it(d),i=i+1|0}while((0|i)<(0|r[h>>2]))}return t=f+4|0,r[l>>2]=r[t>>2],r[l+4>>2]=r[t+4>>2],r[l+8>>2]=r[t+8>>2],e=0|r[16976+(e<<2)>>2],Y(l,u?3*e|0:e),X(d,l,d),q(d),i=u&&((0|r[s>>2])+(0|r[d>>2])+(0|r[p>>2])|0)==(0|A)?1:2,C=c,0|(d=i)}function mt(t,e,n,i){t|=0,e|=0,i|=0;var o,s,u,l,c,h,f,p,A,d,v,g,m,y,_=0,b=0,x=0,S=0,k=0,O=0,P=0,E=0;if(y=C,C=C+384|0,x=y+176|0,S=y+96|0,d=y+360|0,v=y,g=y+344|0,m=y+328|0,c=y+312|0,h=y+296|0,f=y+280|0,p=y+264|0,A=y+248|0,0|(n|=0))return function(t,e,n){t|=0,e|=0,n|=0;var i,o,s,u,l,c,h,f,p,A,d,v,g,m,y,_,b,x,S=0,k=0,O=0,P=0,E=0,T=0,M=0,j=0,L=0;x=C,C=C+384|0,k=x+80|0,T=x+368|0,m=x,y=x+352|0,_=x+336|0,b=x+304|0,h=x+288|0,f=x+320|0,p=x+272|0,A=x+256|0,d=x+240|0,v=x+224|0,g=x+208|0,P=16848,E=60+(O=S=x+144|0)|0;do{r[O>>2]=r[P>>2],O=O+4|0,P=P+4|0}while((0|O)<(0|E));P=16912,E=(O=k)+60|0;do{r[O>>2]=r[P>>2],O=O+4|0,P=P+4|0}while((0|O)<(0|E));k=(M=0==(0|It(e)))?S:k,r[T>>2]=r[t>>2],r[T+4>>2]=r[t+4>>2],r[T+8>>2]=r[t+8>>2],r[T+12>>2]=r[t+12>>2],st(S=T+4|0),ut(S),0|It(e)?(et(S),M=e+1|0):M=e,r[m>>2]=r[T>>2],X(S,k,t=m+4|0),q(t),r[m+16>>2]=r[T>>2],X(S,k+12|0,t=m+20|0),q(t),r[m+32>>2]=r[T>>2],X(S,k+24|0,t=m+36|0),q(t),r[m+48>>2]=r[T>>2],X(S,k+36|0,t=m+52|0),q(t),r[m+64>>2]=r[T>>2],X(S,k+48|0,t=m+68|0),q(t),r[n>>2]=0,t=y+4|0,T=b+4|0,i=16976+(M<<2)|0,o=17056+(M<<2)|0,s=A+8|0,u=d+8|0,l=v+8|0,c=_+4|0,E=0;t:for(;;){if(P=m+(((E>>>0)%5|0)<<4)|0,r[_>>2]=r[P>>2],r[_+4>>2]=r[P+4>>2],r[_+8>>2]=r[P+8>>2],r[_+12>>2]=r[P+12>>2],2==(0|gt(_,M,0,1)))do{}while(2==(0|gt(_,M,0,1)));if(0!=(0|E)&0!=(0|It(e))){if(r[b>>2]=r[_>>2],r[b+4>>2]=r[_+4>>2],r[b+8>>2]=r[_+8>>2],r[b+12>>2]=r[_+12>>2],Z(t,h),k=0|r[b>>2],O=0|r[17136+(80*k|0)+(r[y>>2]<<2)>>2],r[b>>2]=r[18736+(80*k|0)+(20*O|0)>>2],(0|(P=0|r[18736+(80*k|0)+(20*O|0)+16>>2]))>0){S=0;do{it(T),S=S+1|0}while((0|S)<(0|P))}switch(P=18736+(80*k|0)+(20*O|0)+4|0,r[f>>2]=r[P>>2],r[f+4>>2]=r[P+4>>2],r[f+8>>2]=r[P+8>>2],Y(f,3*(0|r[i>>2])|0),X(T,f,T),q(T),Z(T,p),j=+(0|r[o>>2]),a[A>>3]=3*j,a[s>>3]=0,L=-1.5*j,a[d>>3]=L,a[u>>3]=2.598076211353316*j,a[v>>3]=L,a[l>>3]=-2.598076211353316*j,0|r[17136+(80*(0|r[b>>2])|0)+(r[_>>2]<<2)>>2]){case 1:S=d,k=A;break;case 3:S=v,k=d;break;case 2:S=A,k=v;break;default:S=14;break t}Kt(h,p,k,S,g),dt(g,0|r[b>>2],M,1,n+8+(r[n>>2]<<4)|0),r[n>>2]=1+(0|r[n>>2])}if(E>>>0<5&&(Z(c,b),dt(b,0|r[_>>2],M,1,n+8+(r[n>>2]<<4)|0),r[n>>2]=1+(0|r[n>>2])),r[y>>2]=r[_>>2],r[y+4>>2]=r[_+4>>2],r[y+8>>2]=r[_+8>>2],r[y+12>>2]=r[_+12>>2],(E=E+1|0)>>>0>=6){S=4;break}}4!=(0|S)?14==(0|S)&&w(22177,22224,630,22234):C=x}(t,e,i),void(C=y);_=20336,b=(n=x)+72|0;do{r[n>>2]=r[_>>2],n=n+4|0,_=_+4|0}while((0|n)<(0|b));_=20416,b=(n=S)+72|0;do{r[n>>2]=r[_>>2],n=n+4|0,_=_+4|0}while((0|n)<(0|b));_=(_=0==(0|It(e)))?x:S,r[d>>2]=r[t>>2],r[d+4>>2]=r[t+4>>2],r[d+8>>2]=r[t+8>>2],r[d+12>>2]=r[t+12>>2],st(n=d+4|0),ut(n),0|It(e)?(et(n),k=e+1|0):k=e,r[v>>2]=r[d>>2],X(n,_,t=v+4|0),q(t),r[v+16>>2]=r[d>>2],X(n,_+12|0,t=v+20|0),q(t),r[v+32>>2]=r[d>>2],X(n,_+24|0,t=v+36|0),q(t),r[v+48>>2]=r[d>>2],X(n,_+36|0,t=v+52|0),q(t),r[v+64>>2]=r[d>>2],X(n,_+48|0,t=v+68|0),q(t),r[v+80>>2]=r[d>>2],X(n,_+60|0,t=v+84|0),q(t),r[i>>2]=0,t=17056+(k<<2)|0,o=h+8|0,s=f+8|0,u=p+8|0,l=g+4|0,n=-1,x=0,S=0;t:for(;;){if(_=v+((b=(S>>>0)%6|0)<<4)|0,r[g>>2]=r[_>>2],r[g+4>>2]=r[_+4>>2],r[g+8>>2]=r[_+8>>2],r[g+12>>2]=r[_+12>>2],_=x,x=0|gt(g,k,0,1),0!=(0|S)&0!=(0|It(e))&&(1!=(0|_)&&(0|r[g>>2])!=(0|n))){switch(Z(v+((((b+5|0)>>>0)%6|0)<<4)+4|0,m),Z(v+(b<<4)+4|0,c),P=+(0|r[t>>2]),a[h>>3]=3*P,a[o>>3]=0,E=-1.5*P,a[f>>3]=E,a[s>>3]=2.598076211353316*P,a[p>>3]=E,a[u>>3]=-2.598076211353316*P,b=0|r[d>>2],0|r[17136+(80*b|0)+(((0|n)==(0|b)?0|r[g>>2]:n)<<2)>>2]){case 1:n=f,_=h;break;case 3:n=p,_=f;break;case 2:n=h,_=p;break;default:O=11;break t}Kt(m,c,_,n,A),0|Jt(m,A)||0|Jt(c,A)||(dt(A,0|r[d>>2],k,1,i+8+(r[i>>2]<<4)|0),r[i>>2]=1+(0|r[i>>2]))}if(S>>>0<6&&(Z(l,m),dt(m,0|r[g>>2],k,1,i+8+(r[i>>2]<<4)|0),r[i>>2]=1+(0|r[i>>2])),(S=S+1|0)>>>0>=7)break;n=0|r[g>>2]}11==(0|O)&&w(22260,22224,784,22305),C=y}function yt(t){var e;return e=(t=+t)<0?t+6.283185307179586:t,+(t>=6.283185307179586?e+-6.283185307179586:e)}function _t(t,e,n){return e|=0,n=+n,+u(+(+a[(t|=0)>>3]-+a[e>>3]))<n?0|(e=+u(+(+a[t+8>>3]-+a[e+8>>3]))<n):0|(e=0)}function bt(t,e){return e|=0,+u(+(+a[(t|=0)>>3]-+a[e>>3]))<1.7453292519943298e-11?0|(e=+u(+(+a[t+8>>3]-+a[e+8>>3]))<1.7453292519943298e-11):0|(e=0)}function xt(t){if(!((t=+t)>1.5707963267948966))return+t;do{t+=-3.141592653589793}while(t>1.5707963267948966);return+t}function wt(t){if((t=+t)>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(!(t<-3.141592653589793))return+t;do{t+=6.283185307179586}while(t<-3.141592653589793);return+t}function St(t,e){t|=0;var n=0,i=0,r=0;return i=+a[(e|=0)+8>>3],r=+a[t+8>>3],(n=+u(+(i-r)))>3.141592653589793&&(n=+u(+((i<0?i+6.283185307179586:i)-(r<0?r+6.283185307179586:r)))),i=1.5707963267948966-+a[t>>3],r=1.5707963267948966-+a[e>>3],r=+h(+i)*+h(+r)+ +h(+n)*(+f(+i)*+f(+r)),6371.007180918475*+A(+((r=r>1?1:r)<-1?-1:r))}function kt(t,e){var n=0,i=0,r=0,a=0,o=0,s=0;if(!(!0&134217728==(2013265920&(e|=0)|0)))return 0|(e=0);if(o=0|de(0|(t|=0),0|e,45),x(),(o&=127)>>>0>121)return 0|(e=0);n=0|de(0|t,0|e,52),x(),n&=15;do{if(0|n){for(r=1,i=0;;){if(a=0|de(0|t,0|e,3*(15-r|0)|0),x(),0!=(0|(a&=7))&(1^i)){if(1==(0|a)&0!=(0|I(o))){s=0,i=13;break}i=1}if(7==(0|a)){s=0,i=13;break}if(!(r>>>0<n>>>0)){i=9;break}r=r+1|0}if(9==(0|i)){if(15!=(0|n))break;return 0|(s=1)}if(13==(0|i))return 0|s}}while(0);for(;;){if(s=0|de(0|t,0|e,3*(14-n|0)|0),x(),!(7==(7&s|0)&!0)){s=0,i=13;break}if(!(n>>>0<14)){s=1,i=13;break}n=n+1|0}return 13==(0|i)?0|s:0}function Ot(t,e,n){n|=0;var i=0,r=0;if(i=0|de(0|(t|=0),0|(e|=0),52),x(),(0|(i&=15))>=(0|n)){if((0|i)!=(0|n))if(n>>>0<=15){if(t|=r=0|ve(0|n,0,52),e=0|x()|-15728641&e,(0|i)>(0|n))do{r=0|ve(7,0,3*(14-n|0)|0),n=n+1|0,t|=r,e=0|x()|e}while((0|n)<(0|i))}else e=0,t=0}else e=0,t=0;return b(0|e),0|t}function Pt(t,e,n,i){n|=0,i|=0;var a,o=0,s=0,u=0,l=0,c=0,h=0;if(u=0|de(0|(t|=0),0|(e|=0),52),x(),!((0|(u&=15))>(0|n))){if((0|u)==(0|n))return r[(n=i)>>2]=t,void(r[n+4>>2]=e);if(a=(0|(c=0|Zt(7,n-u|0)))/7|0,l=0|de(0|t,0|e,45),x(),0|I(127&l)){t:do{if(u)for(s=1;;){if(o=0|de(0|t,0|e,3*(15-s|0)|0),x(),0|(o&=7))break t;if(!(s>>>0<u>>>0)){o=0;break}s=s+1|0}else o=0}while(0);s=0==(0|o)}else s=0;if(h=0|ve(u+1|0,0,52),o=0|x()|-15728641&e,Pt(e=(h|t)&~(e=0|ve(7,0,0|(l=3*(14-u|0)|0))),u=o&~(0|x()),n,i),o=i+(a<<3)|0,!s)return Pt((h=0|ve(1,0,0|l))|e,0|x()|u,n,o),h=o+(a<<3)|0,Pt((c=0|ve(2,0,0|l))|e,0|x()|u,n,h),h=h+(a<<3)|0,Pt((c=0|ve(3,0,0|l))|e,0|x()|u,n,h),h=h+(a<<3)|0,Pt((c=0|ve(4,0,0|l))|e,0|x()|u,n,h),h=h+(a<<3)|0,Pt((c=0|ve(5,0,0|l))|e,0|x()|u,n,h),void Pt((c=0|ve(6,0,0|l))|e,0|x()|u,n,h+(a<<3)|0);s=o+(a<<3)|0,(0|c)>6&&(ye(0|o,0,(h=(s>>>0>(c=o+8|0)>>>0?s:c)+-1+(0-o)|0)+8&-8|0),o=c+(h>>>3<<3)|0),Pt((h=0|ve(2,0,0|l))|e,0|x()|u,n,o),h=o+(a<<3)|0,Pt((c=0|ve(3,0,0|l))|e,0|x()|u,n,h),h=h+(a<<3)|0,Pt((c=0|ve(4,0,0|l))|e,0|x()|u,n,h),h=h+(a<<3)|0,Pt((c=0|ve(5,0,0|l))|e,0|x()|u,n,h),Pt((c=0|ve(6,0,0|l))|e,0|x()|u,n,h+(a<<3)|0)}}function Et(t,e){var n=0,i=0,r=0;if(r=0|de(0|(t|=0),0|(e|=0),45),x(),!(0|I(127&r)))return 0|(r=0);r=0|de(0|t,0|e,52),x(),r&=15;t:do{if(r)for(i=1;;){if(n=0|de(0|t,0|e,3*(15-i|0)|0),x(),0|(n&=7))break t;if(!(i>>>0<r>>>0)){n=0;break}i=i+1|0}else n=0}while(0);return 0|(r=0==(0|n)&1)}function Ct(t,e){var n=0,i=0,r=0;if(r=0|de(0|(t|=0),0|(e|=0),52),x(),!(r&=15))return 0|(r=0);for(i=1;;){if(n=0|de(0|t,0|e,3*(15-i|0)|0),x(),0|(n&=7)){i=5;break}if(!(i>>>0<r>>>0)){n=0,i=5;break}i=i+1|0}return 5==(0|i)?0|n:0}function Tt(t,e){var n=0,i=0,r=0,a=0,o=0,s=0,u=0;if(u=0|de(0|(t|=0),0|(e|=0),52),x(),!(u&=15))return u=t,b(0|(s=e)),0|u;for(s=1,n=0;;){i=0|ve(7,0,0|(a=3*(15-s|0)|0)),r=0|x(),o=0|de(0|t,0|e,0|a),x(),t=(a=0|ve(0|at(7&o),0,0|a))|t&~i,e=(o=0|x())|e&~r;t:do{if(!n)if(0==(a&i|0)&0==(o&r|0))n=0;else if(i=0|de(0|t,0|e,52),x(),i&=15){n=1;e:for(;;){switch(o=0|de(0|t,0|e,3*(15-n|0)|0),x(),7&o){case 1:break e;case 0:break;default:n=1;break t}if(!(n>>>0<i>>>0)){n=1;break t}n=n+1|0}for(n=1;;){if(r=0|de(0|t,0|e,0|(o=3*(15-n|0)|0)),x(),a=0|ve(7,0,0|o),e&=~(0|x()),t=t&~a|(o=0|ve(0|at(7&r),0,0|o)),e=0|e|x(),!(n>>>0<i>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(s>>>0<u>>>0))break;s=s+1|0}return b(0|e),0|t}function Mt(t,e){var n=0,i=0,r=0,a=0,o=0;if(i=0|de(0|(t|=0),0|(e|=0),52),x(),!(i&=15))return i=t,b(0|(n=e)),0|i;for(n=1;o=0|de(0|t,0|e,0|(a=3*(15-n|0)|0)),x(),r=0|ve(7,0,0|a),e&=~(0|x()),t=(a=0|ve(0|at(7&o),0,0|a))|t&~r,e=0|x()|e,n>>>0<i>>>0;)n=n+1|0;return b(0|e),0|t}function jt(t,e){var n=0,i=0,r=0,a=0,o=0,s=0,u=0;if(u=0|de(0|(t|=0),0|(e|=0),52),x(),!(u&=15))return u=t,b(0|(s=e)),0|u;for(s=1,n=0;;){i=0|ve(7,0,0|(a=3*(15-s|0)|0)),r=0|x(),o=0|de(0|t,0|e,0|a),x(),t=(a=0|ve(0|ot(7&o),0,0|a))|t&~i,e=(o=0|x())|e&~r;t:do{if(!n)if(0==(a&i|0)&0==(o&r|0))n=0;else if(i=0|de(0|t,0|e,52),x(),i&=15){n=1;e:for(;;){switch(o=0|de(0|t,0|e,3*(15-n|0)|0),x(),7&o){case 1:break e;case 0:break;default:n=1;break t}if(!(n>>>0<i>>>0)){n=1;break t}n=n+1|0}for(n=1;;){if(a=0|ve(7,0,0|(r=3*(15-n|0)|0)),o=e&~(0|x()),e=0|de(0|t,0|e,0|r),x(),t=t&~a|(e=0|ve(0|ot(7&e),0,0|r)),e=0|o|x(),!(n>>>0<i>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(s>>>0<u>>>0))break;s=s+1|0}return b(0|e),0|t}function Lt(t,e){var n=0,i=0,r=0,a=0,o=0;if(i=0|de(0|(t|=0),0|(e|=0),52),x(),!(i&=15))return i=t,b(0|(n=e)),0|i;for(n=1;a=0|ve(7,0,0|(o=3*(15-n|0)|0)),r=e&~(0|x()),e=0|de(0|t,0|e,0|o),x(),t=(e=0|ve(0|ot(7&e),0,0|o))|t&~a,e=0|x()|r,n>>>0<i>>>0;)n=n+1|0;return b(0|e),0|t}function It(t){return 0|(0|(t|=0))%2}function zt(t,e){t|=0;var n,i;return i=C,C=C+16|0,n=i,(e|=0)>>>0<=15&&2146435072!=(2146435072&r[t+4>>2]|0)&&2146435072!=(2146435072&r[t+8+4>>2]|0)?(!function(t,e,n){var i,r;i=C,C=C+16|0,At(t|=0,e|=0,n|=0,r=i),H(r,n+4|0),C=i}(t,e,n),e=0|function(t,e){t|=0;var n,i=0,a=0,o=0,s=0,u=0,l=0,c=0,h=0;if(n=C,C=C+64|0,l=n+40|0,a=n+24|0,o=n+12|0,s=n,ve(0|(e|=0),0,52),i=134225919|x(),!e)return(0|r[t+4>>2])>2?(l=0,b(0|(u=0)),C=n,0|l):(0|r[t+8>>2])>2?(l=0,b(0|(u=0)),C=n,0|l):(0|r[t+12>>2])>2?(l=0,b(0|(u=0)),C=n,0|l):(ve(0|D(t),0,45),u=0|x()|i,l=-1,b(0|u),C=n,0|l);if(r[l>>2]=r[t>>2],r[l+4>>2]=r[t+4>>2],r[l+8>>2]=r[t+8>>2],r[l+12>>2]=r[t+12>>2],u=l+4|0,(0|e)>0)for(t=-1;r[a>>2]=r[u>>2],r[a+4>>2]=r[u+4>>2],r[a+8>>2]=r[u+8>>2],1&e?(J(u),r[o>>2]=r[u>>2],r[o+4>>2]=r[u+4>>2],r[o+8>>2]=r[u+8>>2],tt(o)):($(u),r[o>>2]=r[u>>2],r[o+4>>2]=r[u+4>>2],r[o+8>>2]=r[u+8>>2],et(o)),Q(a,o,s),q(s),c=0|ve(7,0,0|(h=3*(15-e|0)|0)),i&=~(0|x()),t=(h=0|ve(0|K(s),0,0|h))|t&~c,i=0|x()|i,(0|e)>1;)e=e+-1|0;else t=-1;t:do{if((0|r[u>>2])<=2&&(0|r[l+8>>2])<=2&&(0|r[l+12>>2])<=2){if(e=0|ve(0|(a=0|D(l)),0,45),e|=t,t=0|x()|-1040385&i,s=0|B(l),!(0|I(a))){if((0|s)<=0)break;for(o=0;;){if(a=0|de(0|e,0|t,52),x(),a&=15)for(i=1;l=0|de(0|e,0|t,0|(h=3*(15-i|0)|0)),x(),c=0|ve(7,0,0|h),t&=~(0|x()),e=e&~c|(h=0|ve(0|at(7&l),0,0|h)),t=0|t|x(),i>>>0<a>>>0;)i=i+1|0;if((0|(o=o+1|0))==(0|s))break t}}o=0|de(0|e,0|t,52),x(),o&=15;e:do{if(o){i=1;n:for(;;){switch(h=0|de(0|e,0|t,3*(15-i|0)|0),x(),7&h){case 1:break n;case 0:break;default:break e}if(!(i>>>0<o>>>0))break e;i=i+1|0}if(0|R(a,0|r[l>>2]))for(i=1;c=0|ve(7,0,0|(l=3*(15-i|0)|0)),h=t&~(0|x()),t=0|de(0|e,0|t,0|l),x(),e=e&~c|(t=0|ve(0|ot(7&t),0,0|l)),t=0|h|x(),i>>>0<o>>>0;)i=i+1|0;else for(i=1;l=0|de(0|e,0|t,0|(h=3*(15-i|0)|0)),x(),c=0|ve(7,0,0|h),t&=~(0|x()),e=e&~c|(h=0|ve(0|at(7&l),0,0|h)),t=0|t|x(),i>>>0<o>>>0;)i=i+1|0}}while(0);if((0|s)>0){i=0;do{e=0|Tt(e,t),t=0|x(),i=i+1|0}while((0|i)!=(0|s))}}else e=0,t=0}while(0);return h=e,b(0|(c=t)),C=n,0|h}(n,e),t=0|x()):(t=0,e=0),b(0|t),C=i,0|e}function Dt(t,e,n){var i,a=0,o=0,s=0;if(i=(n|=0)+4|0,o=0|de(0|(t|=0),0|(e|=0),52),x(),o&=15,s=0|de(0|t,0|e,45),x(),a=0==(0|o),0|I(127&s)){if(a)return 0|(s=1);a=1}else{if(a)return 0|(s=0);a=0==(0|r[i>>2])&&0==(0|r[n+8>>2])?0!=(0|r[n+12>>2])&1:1}for(n=1;1&n?tt(i):et(i),s=0|de(0|t,0|e,3*(15-n|0)|0),x(),nt(i,7&s),n>>>0<o>>>0;)n=n+1|0;return 0|a}function Bt(t,e,n){n|=0;var i,a,o=0,s=0,u=0,l=0,c=0,h=0;a=C,C=C+16|0,i=a,h=0|de(0|(t|=0),0|(e|=0),45),x(),h&=127;t:do{if(0!=(0|I(h))&&(u=0|de(0|t,0|e,52),x(),0!=(0|(u&=15)))){o=1;e:for(;;){switch(c=0|de(0|t,0|e,3*(15-o|0)|0),x(),7&c){case 5:break e;case 0:break;default:o=e;break t}if(!(o>>>0<u>>>0)){o=e;break t}o=o+1|0}for(s=1,o=e;l=0|ve(7,0,0|(e=3*(15-s|0)|0)),c=o&~(0|x()),o=0|de(0|t,0|o,0|e),x(),t=t&~l|(o=0|ve(0|ot(7&o),0,0|e)),o=0|c|x(),s>>>0<u>>>0;)s=s+1|0}else o=e}while(0);if(c=7728+(28*h|0)|0,r[n>>2]=r[c>>2],r[n+4>>2]=r[c+4>>2],r[n+8>>2]=r[c+8>>2],r[n+12>>2]=r[c+12>>2],0|Dt(t,o,n)){if(l=n+4|0,r[i>>2]=r[l>>2],r[i+4>>2]=r[l+4>>2],r[i+8>>2]=r[l+8>>2],u=0|de(0|t,0|o,52),x(),c=15&u,1&u?(et(l),u=c+1|0):u=c,0|I(h)){t:do{if(c)for(e=1;;){if(s=0|de(0|t,0|o,3*(15-e|0)|0),x(),0|(s&=7)){o=s;break t}if(!(e>>>0<c>>>0)){o=0;break}e=e+1|0}else o=0}while(0);o=4==(0|o)&1}else o=0;if(0|gt(n,u,o,0)){if(0|I(h))do{}while(0!=(0|gt(n,u,0,0)));(0|u)!=(0|c)&&$(l)}else(0|u)!=(0|c)&&(r[l>>2]=r[i>>2],r[l+4>>2]=r[i+4>>2],r[l+8>>2]=r[i+8>>2]);C=a}else C=a}function Rt(t,e,n){n|=0;var i,r;i=C,C=C+16|0,Bt(t|=0,e|=0,r=i),e=0|de(0|t,0|e,52),x(),vt(r,15&e,n),C=i}function Ft(t,e,n){n|=0;var i,r,a=0,o=0,s=0;if(r=C,C=C+16|0,Bt(t|=0,e|=0,i=r),s=0|de(0|t,0|e,52),x(),s&=15,o=0|de(0|t,0|e,45),x(),!(0|I(127&o)))return mt(i,s,e=0,n),void(C=r);t:do{if(s)for(o=1;;){if(a=0|de(0|t,0|e,3*(15-o|0)|0),x(),0|(a&=7))break t;if(!(o>>>0<s>>>0)){a=0;break}o=o+1|0}else a=0}while(0);mt(i,s,e=0==(0|a)&1,n),C=r}function Nt(t,e,n,i){var a,o=0,s=0,u=0,l=0,c=0;if(a=C,C=C+64|0,u=a,(0|(t|=0))==(0|(n|=0))&(0|(e|=0))==(0|(i|=0))|!1|134217728!=(2013265920&e|0)|!1|134217728!=(2013265920&i|0))return C=a,0|(u=0);if(o=0|de(0|t,0|e,52),x(),o&=15,s=0|de(0|n,0|i,52),x(),(0|o)!=(15&s|0))return C=a,0|(u=0);if(s=o+-1|0,o>>>0>1&&(c=0|Ot(t,e,s),l=0|x(),(0|c)==(0|(s=0|Ot(n,i,s)))&(0|l)==(0|x()))){if(o=0|de(0|t,0|e,0|(s=3*(15^o)|0)),x(),o&=7,s=0|de(0|n,0|i,0|s),x(),0==(0|o)|0==(0|(s&=7)))return C=a,0|(c=1);if((0|r[21136+(o<<2)>>2])==(0|s))return C=a,0|(c=1);if((0|r[21168+(o<<2)>>2])==(0|s))return C=a,0|(c=1)}s=(o=u)+56|0;do{r[o>>2]=0,o=o+4|0}while((0|o)<(0|s));return T(t,e,1,u),o=(0|r[(c=u)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=u+8|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=u+16|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=u+24|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=u+32|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=u+40|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)?1:1&((0|r[(o=u+48|0)>>2])==(0|n)?(0|r[o+4>>2])==(0|i):0),C=a,0|(c=o)}function Ut(t){t|=0;var e,n,i=0;return(e=0|le(1,12))||w(22394,22349,46,22407),0|(i=0|r[(n=t+4|0)>>2])?(r[(i=i+8|0)>>2]=e,r[n>>2]=e,0|e):(0|r[t>>2]&&w(22424,22349,58,22447),r[(i=t)>>2]=e,r[n>>2]=e,0|e)}function Vt(t,e){t|=0,e|=0;var n,i;return(i=0|se(24))||w(22461,22349,75,22475),r[i>>2]=r[e>>2],r[i+4>>2]=r[e+4>>2],r[i+8>>2]=r[e+8>>2],r[i+12>>2]=r[e+12>>2],r[i+16>>2]=0,0|(n=0|r[(e=t+4|0)>>2])?(r[n+16>>2]=i,r[e>>2]=i,0|i):(0|r[t>>2]&&w(22490,22349,79,22475),r[t>>2]=i,r[e>>2]=i,0|i)}function Gt(t){var e,n,i=0,o=0,s=0,l=0,c=0,h=0,f=0,p=0,A=0,d=0,v=0,g=0,m=0,y=0,_=0,b=0,x=0,S=0,k=0,O=0,P=0,E=0,C=0,T=0,M=0,j=0,L=0,I=0,z=0,D=0;if(0|r[(l=(t|=0)+8|0)>>2])return 0|(D=1);if(!(s=0|r[t>>2]))return 0|(D=0);i=s,o=0;do{o=o+1|0,i=0|r[i+8>>2]}while(0!=(0|i));if(o>>>0<2)return 0|(D=0);(n=0|se(o<<2))||w(22510,22349,312,22529),(e=0|se(o<<5))||w(22551,22349,316,22529),r[t>>2]=0,r[(E=t+4|0)>>2]=0,r[l>>2]=0,o=0,I=0,P=0,v=0;t:for(;;){if(d=0|r[s>>2]){c=0,h=d;do{if(p=+a[h+8>>3],i=h,h=0|r[h+16>>2],f=+a[(l=(A=0==(0|h))?d:h)+8>>3],+u(+(p-f))>3.141592653589793){D=14;break}c+=(f-p)*(+a[i>>3]+ +a[l>>3])}while(!A);if(14==(0|D)){D=0,c=0,i=d;do{O=+a[i+8>>3],j=0|r[(L=i+16|0)>>2],k=+a[(j=0==(0|j)?d:j)+8>>3],c+=(+a[i>>3]+ +a[j>>3])*((k<0?k+6.283185307179586:k)-(O<0?O+6.283185307179586:O)),i=0|r[(0==(0|i)?s:L)>>2]}while(0!=(0|i))}c>0?(r[n+(I<<2)>>2]=s,I=I+1|0,l=P,i=v):D=19}else D=19;if(19==(0|D)){D=0;do{if(!o){if(v){l=E,h=v+8|0,i=s,o=t;break}if(0|r[t>>2]){D=27;break t}l=E,h=t,i=s,o=t;break}if(0|r[(i=o+8|0)>>2]){D=21;break t}if(!(o=0|le(1,12))){D=23;break t}r[i>>2]=o,l=o+4|0,h=o,i=v}while(0);if(r[h>>2]=s,r[l>>2]=s,h=e+(P<<5)|0,A=0|r[s>>2]){for(a[(d=e+(P<<5)+8|0)>>3]=1.7976931348623157e308,a[(v=e+(P<<5)+24|0)>>3]=1.7976931348623157e308,a[h>>3]=-1.7976931348623157e308,a[(g=e+(P<<5)+16|0)>>3]=-1.7976931348623157e308,x=1.7976931348623157e308,S=-1.7976931348623157e308,l=0,m=A,p=1.7976931348623157e308,_=1.7976931348623157e308,b=-1.7976931348623157e308,f=-1.7976931348623157e308;c=+a[m>>3],O=+a[m+8>>3],m=0|r[m+16>>2],k=+a[((y=0==(0|m))?A:m)+8>>3],c<p&&(a[d>>3]=c,p=c),O<_&&(a[v>>3]=O,_=O),c>b?a[h>>3]=c:c=b,O>f&&(a[g>>3]=O,f=O),x=O>0&O<x?O:x,S=O<0&O>S?O:S,l|=+u(+(O-k))>3.141592653589793,!y;)b=c;l&&(a[g>>3]=S,a[v>>3]=x)}else r[h>>2]=0,r[h+4>>2]=0,r[h+8>>2]=0,r[h+12>>2]=0,r[h+16>>2]=0,r[h+20>>2]=0,r[h+24>>2]=0,r[h+28>>2]=0;l=P+1|0}if(s=0|r[(L=s+8|0)>>2],r[L>>2]=0,!s){D=45;break}P=l,v=i}if(21==(0|D))w(22327,22349,32,22361);else if(23==(0|D))w(22381,22349,34,22361);else if(27==(0|D))w(22424,22349,58,22447);else if(45==(0|D)){t:do{if((0|I)>0){for(L=0==(0|l),M=l<<2,j=0==(0|t),T=0,i=0;;){if(C=0|r[n+(T<<2)>>2],L)D=73;else{if(!(P=0|se(M))){D=50;break}if(!(E=0|se(M))){D=52;break}e:do{if(j)o=0;else{for(l=0,o=0,h=t;s=e+(l<<5)|0,0|Wt(0|r[h>>2],s,0|r[C>>2])?(r[P+(o<<2)>>2]=h,r[E+(o<<2)>>2]=s,y=o+1|0):y=o,h=0|r[h+8>>2];)l=l+1|0,o=y;if((0|y)>0)if(s=0|r[P>>2],1==(0|y))o=s;else for(g=0,m=-1,o=s,v=s;;){for(A=0|r[v>>2],s=0,h=0;d=(0|(l=0|r[r[P+(h<<2)>>2]>>2]))==(0|A)?s:s+(1&(0|Wt(l,0|r[E+(h<<2)>>2],0|r[A>>2])))|0,(0|(h=h+1|0))!=(0|y);)s=d;if(o=(l=(0|d)>(0|m))?v:o,(0|(s=g+1|0))==(0|y))break e;g=s,m=l?d:m,v=0|r[P+(s<<2)>>2]}else o=0}}while(0);if(ue(P),ue(E),o){if(s=0|r[(l=o+4|0)>>2])o=s+8|0;else if(0|r[o>>2]){D=70;break}r[o>>2]=C,r[l>>2]=C}else D=73}if(73==(0|D)){if(D=0,0|(i=0|r[C>>2]))do{E=i,i=0|r[i+16>>2],ue(E)}while(0!=(0|i));ue(C),i=2}if((0|(T=T+1|0))>=(0|I)){z=i;break t}}50==(0|D)?w(22566,22349,246,22585):52==(0|D)?w(22604,22349,248,22585):70==(0|D)&&w(22424,22349,58,22447)}else z=0}while(0);return ue(n),ue(e),0|(D=z)}return 0}function Wt(t,e,n){t|=0;var i,o=0,s=0,u=0,l=0,c=0,h=0,f=0;if(!(0|V(e|=0,n|=0)))return 0|(t=0);if(e=0|U(e),i=+a[n>>3],o=e&(o=+a[n+8>>3])<0?o+6.283185307179586:o,!(t=0|r[t>>2]))return 0|(t=0);if(e){e=0,n=t;t:for(;;){for(;l=+a[n>>3],h=+a[n+8>>3],f=0|r[(n=n+16|0)>>2],u=+a[(f=0==(0|f)?t:f)>>3],s=+a[f+8>>3],l>u?(c=l,l=h):(c=u,u=l,l=s,s=h),i<u|i>c;)if(!(n=0|r[n>>2])){n=22;break t}if(o=(l=l<0?l+6.283185307179586:l)==o|(h=s<0?s+6.283185307179586:s)==o?o+-2.220446049250313e-16:o,((h+=(i-u)/(c-u)*(l-h))<0?h+6.283185307179586:h)>o&&(e^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|e}else{e=0,n=t;t:for(;;){for(;l=+a[n>>3],h=+a[n+8>>3],f=0|r[(n=n+16|0)>>2],u=+a[(f=0==(0|f)?t:f)>>3],s=+a[f+8>>3],l>u?(c=l,l=h):(c=u,u=l,l=s,s=h),i<u|i>c;)if(!(n=0|r[n>>2])){n=22;break t}if(s+(i-u)/(c-u)*(l-s)>(o=l==o|s==o?o+-2.220446049250313e-16:o)&&(e^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|e}return 0}function Ht(t,e,n,a,o){n|=0,a|=0,o|=0;var s,u,l,c,h=0,f=0,p=0,A=0,d=0,v=0,g=0,m=0,y=0,_=0;if(c=C,C=C+32|0,_=c+16|0,l=c,h=0|de(0|(t|=0),0|(e|=0),52),x(),h&=15,g=0|de(0|n,0|a,52),x(),(0|h)!=(15&g|0))return C=c,0|(_=1);if(d=0|de(0|t,0|e,45),x(),d&=127,v=0|de(0|n,0|a,45),x(),g=(0|d)!=(0|(v&=127))){if(7==(0|(p=0|N(d,v))))return C=c,0|(_=2);7==(0|(A=0|N(v,d)))?w(22628,22652,147,22662):(m=p,f=A)}else m=0,f=0;s=0|I(d),u=0|I(v),r[_>>2]=0,r[_+4>>2]=0,r[_+8>>2]=0,r[_+12>>2]=0;do{if(m){if(p=(0|(v=0|r[4304+(28*d|0)+(m<<2)>>2]))>0,u)if(p){d=0,A=n,p=a;do{A=0|jt(A,p),p=0|x(),1==(0|(f=0|ot(f)))&&(f=0|ot(1)),d=d+1|0}while((0|d)!=(0|v));v=f,d=A,A=p}else v=f,d=n,A=a;else if(p){d=0,A=n,p=a;do{A=0|Lt(A,p),p=0|x(),f=0|ot(f),d=d+1|0}while((0|d)!=(0|v));v=f,d=A,A=p}else v=f,d=n,A=a;if(Dt(d,A,_),g||w(22675,22652,177,22662),(p=0!=(0|s))&(f=0!=(0|u))&&w(22702,22652,178,22662),p){if(f=0|Ct(t,e),0|i[22096+(7*f|0)+m>>0]){h=3;break}if(0|i[22032+(7*f|0)+m>>0]){h=3;break}d=A=0|r[21200+(28*f|0)+(m<<2)>>2],y=30}else if(f){if(f=0|Ct(d,A),0|It(h)&&0|i[22096+(7*f|0)+v>>0]){h=4;break}if(0==(0|It(h))&&0|i[22032+(7*f|0)+v>>0]){h=4;break}d=0,A=0|r[21200+(28*v|0)+(f<<2)>>2],y=30}else f=0;if(30==(0|y))if((0|A)<=-1&&w(22733,22652,215,22662),(0|d)<=-1&&w(22756,22652,216,22662),(0|A)>0){p=_+4|0,f=0;do{rt(p),f=f+1|0}while((0|f)!=(0|A));f=d}else f=d;if(r[l>>2]=0,r[l+4>>2]=0,r[l+8>>2]=0,nt(l,m),0|h)for(;0|It(h)?tt(l):et(l),(0|h)>1;)h=h+-1|0;if((0|f)>0){h=0;do{rt(l),h=h+1|0}while((0|h)!=(0|f))}X(y=_+4|0,l,y),q(y),y=55}else if(Dt(n,a,_),0!=(0|s)&0!=(0|u))if((0|v)!=(0|d)&&w(22780,22652,246,22662),f=0|Ct(t,e),h=0|Ct(n,a),0==(0|i[22096+(7*f|0)+h>>0])&&0==(0|i[22032+(7*f|0)+h>>0]))if((0|(f=0|r[21200+(28*f|0)+(h<<2)>>2]))>0){p=_+4|0,h=0;do{rt(p),h=h+1|0}while((0|h)!=(0|f));y=55}else y=55;else h=5;else y=55}while(0);return 55==(0|y)&&(h=_+4|0,r[o>>2]=r[h>>2],r[o+4>>2]=r[h+4>>2],r[o+8>>2]=r[h+8>>2],h=0),C=c,0|(_=h)}function qt(t,e,n,i){n|=0,i|=0;var a,o,s=0,u=0,l=0,c=0,h=0,f=0,p=0,A=0,d=0,v=0,g=0,m=0,y=0;if(o=C,C=C+48|0,l=o+36|0,c=o+24|0,h=o+12|0,f=o,u=0|de(0|(t|=0),0|(e|=0),52),x(),u&=15,A=0|de(0|t,0|e,45),x(),a=0|I(A&=127),ve(0|u,0,52),g=134225919|x(),r[(v=i)>>2]=-1,r[v+4>>2]=g,!u)return(0|r[n>>2])>1?(C=o,0|(g=1)):127==(0|(s=0|F(A,0|K(n))))?(C=o,0|(g=1)):(d=0|ve(0|s,0,45),v=0|x(),v=-1040385&r[(A=i)+4>>2]|v,r[(g=i)>>2]=r[A>>2]|d,r[g+4>>2]=v,C=o,0|(g=0));for(r[l>>2]=r[n>>2],r[l+4>>2]=r[n+4>>2],r[l+8>>2]=r[n+8>>2];r[c>>2]=r[l>>2],r[c+4>>2]=r[l+4>>2],r[c+8>>2]=r[l+8>>2],0|It(u)?(J(l),r[h>>2]=r[l>>2],r[h+4>>2]=r[l+4>>2],r[h+8>>2]=r[l+8>>2],tt(h)):($(l),r[h>>2]=r[l>>2],r[h+4>>2]=r[l+4>>2],r[h+8>>2]=r[l+8>>2],et(h)),Q(c,h,f),q(f),m=0|r[(v=i)>>2],v=0|r[v+4>>2],n=0|ve(7,0,0|(y=3*(15-u|0)|0)),v&=~(0|x()),y=0|ve(0|K(f),0,0|y),v=0|x()|v,r[(g=i)>>2]=y|m&~n,r[g+4>>2]=v,(0|u)>1;)u=u+-1|0;t:do{if((0|r[l>>2])<=1&&(0|r[l+4>>2])<=1&&(0|r[l+8>>2])<=1){f=127==(0|(c=0|F(A,u=0|K(l))))?0:0|I(c);e:do{if(u){if(a){if(l=21408+(28*(0|Ct(t,e))|0)+(u<<2)|0,(0|(l=0|r[l>>2]))>0){n=0;do{u=0|at(u),n=n+1|0}while((0|n)!=(0|l))}if(1==(0|u)){s=3;break t}127==(0|(n=0|F(A,u)))&&w(22807,22652,380,22837),0|I(n)?w(22850,22652,381,22837):(d=l,p=u,s=n)}else d=0,p=u,s=c;if((0|(h=0|r[4304+(28*A|0)+(p<<2)>>2]))<=-1&&w(22881,22652,388,22837),!f){if((0|d)<=-1&&w(22733,22652,421,22837),0|d){u=0,n=0|r[(l=i)>>2],l=0|r[l+4>>2];do{n=0|Mt(n,l),l=0|x(),r[(y=i)>>2]=n,r[y+4>>2]=l,u=u+1|0}while((0|u)<(0|d))}if((0|h)<=0){u=52;break}for(u=0,n=0|r[(l=i)>>2],l=0|r[l+4>>2];;)if(n=0|Mt(n,l),l=0|x(),r[(y=i)>>2]=n,r[y+4>>2]=l,(0|(u=u+1|0))==(0|h)){u=52;break e}}if(7==(0|(c=0|N(s,A)))&&w(22628,22652,397,22837),n=0|r[(u=i)>>2],u=0|r[u+4>>2],(0|h)>0){l=0;do{n=0|Mt(n,u),u=0|x(),r[(y=i)>>2]=n,r[y+4>>2]=u,l=l+1|0}while((0|l)!=(0|h))}if(n=0|Ct(n,u),y=0|z(s),(0|(n=0|r[(y?21824:21616)+(28*c|0)+(n<<2)>>2]))<=-1&&w(22733,22652,416,22837),n){u=0,l=0|r[(c=i)>>2],c=0|r[c+4>>2];do{l=0|Tt(l,c),c=0|x(),r[(y=i)>>2]=l,r[y+4>>2]=c,u=u+1|0}while((0|u)<(0|n));u=52}else u=52}else if(0!=(0|a)&0!=(0|f))if(u=21408+(28*(y=0|Ct(t,e))|0)+((0|Ct(0|r[(u=i)>>2],0|r[u+4>>2]))<<2)|0,(0|(u=0|r[u>>2]))<=-1&&w(22904,22652,437,22837),u){s=0,n=0|r[(l=i)>>2],l=0|r[l+4>>2];do{n=0|Mt(n,l),l=0|x(),r[(y=i)>>2]=n,r[y+4>>2]=l,s=s+1|0}while((0|s)<(0|u));s=c,u=52}else s=c,u=53;else s=c,u=52}while(0);if(52==(0|u)&&f&&(u=53),53==(0|u)&&1==(0|Ct(0|r[(y=i)>>2],0|r[y+4>>2]))){s=4;break}g=0|r[(y=i)>>2],y=-1040385&r[y+4>>2],m=0|ve(0|s,0,45),y=0|y|x(),r[(s=i)>>2]=g|m,r[s+4>>2]=y,s=0}else s=2}while(0);return C=o,0|(y=s)}function Zt(t,e){var n=0;if(!(e|=0))return 0|(n=1);n=t|=0,t=1;do{t=0|y(0==(1&e|0)?1:n,t),e>>=1,n=0|y(n,n)}while(0!=(0|e));return 0|t}function Xt(t,e,n){t|=0;var i,o,s=0,u=0,l=0,c=0,h=0,f=0,p=0,A=0;if(!(0|V(e|=0,n|=0)))return 0|(A=0);if(e=0|U(e),o=+a[n>>3],s=e&(s=+a[n+8>>3])<0?s+6.283185307179586:s,(0|(A=0|r[t>>2]))<=0)return 0|(A=0);if(i=0|r[t+4>>2],e){e=0,n=-1,t=0;t:for(;;){for(p=t;c=+a[i+(p<<4)>>3],f=+a[i+(p<<4)+8>>3],l=+a[i+((t=(n+2|0)%(0|A)|0)<<4)>>3],u=+a[i+(t<<4)+8>>3],c>l?(h=c,c=f):(h=l,l=c,c=u,u=f),o<l|o>h;){if(!((0|(n=p+1|0))<(0|A))){n=22;break t}t=p,p=n,n=t}if(s=(c=c<0?c+6.283185307179586:c)==s|(f=u<0?u+6.283185307179586:u)==s?s+-2.220446049250313e-16:s,((f+=(o-l)/(h-l)*(c-f))<0?f+6.283185307179586:f)>s&&(e^=1),(0|(t=p+1|0))>=(0|A)){n=22;break}n=p}if(22==(0|n))return 0|e}else{e=0,n=-1,t=0;t:for(;;){for(p=t;c=+a[i+(p<<4)>>3],f=+a[i+(p<<4)+8>>3],l=+a[i+((t=(n+2|0)%(0|A)|0)<<4)>>3],u=+a[i+(t<<4)+8>>3],c>l?(h=c,c=f):(h=l,l=c,c=u,u=f),o<l|o>h;){if(!((0|(n=p+1|0))<(0|A))){n=22;break t}t=p,p=n,n=t}if(u+(o-l)/(h-l)*(c-u)>(s=c==s|u==s?s+-2.220446049250313e-16:s)&&(e^=1),(0|(t=p+1|0))>=(0|A)){n=22;break}n=p}if(22==(0|n))return 0|e}return 0}function Qt(t,e){e|=0;var n,i,o,s,l,c=0,h=0,f=0,p=0,A=0,d=0,v=0,g=0,m=0,y=0,_=0,b=0;if(!(i=0|r[(t|=0)>>2]))return r[e>>2]=0,r[e+4>>2]=0,r[e+8>>2]=0,r[e+12>>2]=0,r[e+16>>2]=0,r[e+20>>2]=0,r[e+24>>2]=0,void(r[e+28>>2]=0);if(a[(o=e+8|0)>>3]=1.7976931348623157e308,a[(s=e+24|0)>>3]=1.7976931348623157e308,a[e>>3]=-1.7976931348623157e308,a[(l=e+16|0)>>3]=-1.7976931348623157e308,!((0|i)<=0)){for(n=0|r[t+4>>2],g=1.7976931348623157e308,m=-1.7976931348623157e308,y=0,t=-1,p=1.7976931348623157e308,A=1.7976931348623157e308,v=-1.7976931348623157e308,h=-1.7976931348623157e308,_=0;c=+a[n+(_<<4)>>3],d=+a[n+(_<<4)+8>>3],f=+a[n+(((0|(t=t+2|0))==(0|i)?0:t)<<4)+8>>3],c<p&&(a[o>>3]=c,p=c),d<A&&(a[s>>3]=d,A=d),c>v?a[e>>3]=c:c=v,d>h&&(a[l>>3]=d,h=d),g=d>0&d<g?d:g,m=d<0&d>m?d:m,y|=+u(+(d-f))>3.141592653589793,(0|(t=_+1|0))!=(0|i);)b=_,v=c,_=t,t=b;y&&(a[l>>3]=m,a[s>>3]=g)}}function Yt(t,e,n){var i=0,a=0,o=0;if(!(0|Xt(t|=0,e|=0,n|=0)))return 0|(a=0);if((0|r[(a=t+8|0)>>2])<=0)return 0|(a=1);for(i=t+12|0,t=0;;){if(o=t,t=t+1|0,0|Xt((0|r[i>>2])+(o<<3)|0,e+(t<<5)|0,n)){t=0,i=6;break}if((0|t)>=(0|r[a>>2])){t=1,i=6;break}}return 6==(0|i)?0|t:0}function Kt(t,e,n,i,r){e|=0,n|=0,i|=0,r|=0;var o,s,u,l,c,h,f,p=0;l=+a[(t|=0)>>3],u=+a[e>>3]-l,s=+a[t+8>>3],o=+a[e+8>>3]-s,h=+a[n>>3],p=((p=+a[i>>3]-h)*(s-(f=+a[n+8>>3]))-(l-h)*(c=+a[i+8>>3]-f))/(u*c-o*p),a[r>>3]=l+u*p,a[r+8>>3]=s+o*p}function Jt(t,e){return e|=0,+a[(t|=0)>>3]!=+a[e>>3]?0|(e=0):0|(e=+a[t+8>>3]==+a[e+8>>3])}function $t(t,e){e|=0;var n,i,r;return+((r=+a[(t|=0)>>3]-+a[e>>3])*r+(i=+a[t+8>>3]-+a[e+8>>3])*i+(n=+a[t+16>>3]-+a[e+16>>3])*n)}function te(t,e,n){t|=0,n|=0;var i=0;(0|(e|=0))>0?(i=0|le(e,4),r[t>>2]=i,i||w(22933,22956,37,22970)):r[t>>2]=0,r[t+4>>2]=e,r[t+8>>2]=0,r[t+12>>2]=n}function ee(t){var e,n,i,o=0,s=0,l=0,h=0;e=(t|=0)+4|0,n=t+12|0,i=t+8|0;t:for(;;){for(s=0|r[e>>2],o=0;;){if((0|o)>=(0|s))break t;if(l=0|r[t>>2],h=0|r[l+(o<<2)>>2])break;o=o+1|0}o=l+(~~(+u(+ +c(10,+ +(15-(0|r[n>>2])|0))*(+a[h>>3]+ +a[h+8>>3]))%+(0|s))>>>0<<2)|0,s=0|r[o>>2];e:do{if(0|s){if(l=h+32|0,(0|s)==(0|h))r[o>>2]=r[l>>2];else{if(!(o=0|r[(s=s+32|0)>>2]))break;for(;(0|o)!=(0|h);)if(!(o=0|r[(s=o+32|0)>>2]))break e;r[s>>2]=r[l>>2]}ue(h),r[i>>2]=(0|r[i>>2])-1}}while(0)}ue(0|r[t>>2])}function ne(t){var e,n=0,i=0;for(e=0|r[(t|=0)+4>>2],i=0;;){if((0|i)>=(0|e)){n=0,i=4;break}if(n=0|r[(0|r[t>>2])+(i<<2)>>2]){i=4;break}i=i+1|0}return 4==(0|i)?0|n:0}function ie(t,e){e|=0;var n=0,i=0,o=0,s=0;if(n=~~(+u(+ +c(10,+ +(15-(0|r[(t|=0)+12>>2])|0))*(+a[e>>3]+ +a[e+8>>3]))%+(0|r[t+4>>2]))>>>0,n=(0|r[t>>2])+(n<<2)|0,!(i=0|r[n>>2]))return 0|(s=1);s=e+32|0;do{if((0|i)!=(0|e)){if(!(n=0|r[i+32>>2]))return 0|(s=1);for(o=n;;){if((0|o)==(0|e)){o=8;break}if(!(n=0|r[o+32>>2])){n=1,o=10;break}i=o,o=n}if(8==(0|o)){r[i+32>>2]=r[s>>2];break}if(10==(0|o))return 0|n}else r[n>>2]=r[s>>2]}while(0);return ue(e),r[(s=t+8|0)>>2]=(0|r[s>>2])-1,0|(s=0)}function re(t,e,n){t|=0,e|=0,n|=0;var i,o=0,s=0,l=0;(i=0|se(40))||w(22986,22956,95,22999),r[i>>2]=r[e>>2],r[i+4>>2]=r[e+4>>2],r[i+8>>2]=r[e+8>>2],r[i+12>>2]=r[e+12>>2],r[(s=i+16|0)>>2]=r[n>>2],r[s+4>>2]=r[n+4>>2],r[s+8>>2]=r[n+8>>2],r[s+12>>2]=r[n+12>>2],r[i+32>>2]=0,s=~~(+u(+ +c(10,+ +(15-(0|r[t+12>>2])|0))*(+a[e>>3]+ +a[e+8>>3]))%+(0|r[t+4>>2]))>>>0,s=(0|r[t>>2])+(s<<2)|0,o=0|r[s>>2];do{if(o){for(;!(0|bt(o,e)&&0|bt(o+16|0,n));)if(s=0|r[o+32>>2],!(0|r[(o=0==(0|s)?o:s)+32>>2])){l=10;break}if(10==(0|l)){r[o+32>>2]=i;break}return ue(i),0|(l=o)}r[s>>2]=i}while(0);return r[(l=t+8|0)>>2]=1+(0|r[l>>2]),0|(l=i)}function ae(t,e,n){e|=0,n|=0;var i=0,o=0;if(o=~~(+u(+ +c(10,+ +(15-(0|r[(t|=0)+12>>2])|0))*(+a[e>>3]+ +a[e+8>>3]))%+(0|r[t+4>>2]))>>>0,!(o=0|r[(0|r[t>>2])+(o<<2)>>2]))return 0|(n=0);if(!n){for(t=o;;){if(0|bt(t,e)){i=10;break}if(!(t=0|r[t+32>>2])){t=0,i=10;break}}if(10==(0|i))return 0|t}for(t=o;;){if(0|bt(t,e)&&0|bt(t+16|0,n)){i=10;break}if(!(t=0|r[t+32>>2])){t=0,i=10;break}}return 10==(0|i)?0|t:0}function oe(t,e){e|=0;var n=0;if(n=~~(+u(+ +c(10,+ +(15-(0|r[(t|=0)+12>>2])|0))*(+a[e>>3]+ +a[e+8>>3]))%+(0|r[t+4>>2]))>>>0,!(t=0|r[(0|r[t>>2])+(n<<2)>>2]))return 0|(n=0);for(;;){if(0|bt(t,e)){e=5;break}if(!(t=0|r[t+32>>2])){t=0,e=5;break}}return 5==(0|e)?0|t:0}function se(t){t|=0;var e,n=0,i=0,a=0,o=0,s=0,u=0,l=0,c=0,h=0,f=0,p=0,A=0,d=0,v=0,g=0,m=0,y=0,_=0,b=0,x=0;e=C,C=C+16|0,A=e;do{if(t>>>0<245){if(t=(h=t>>>0<11?16:t+11&-8)>>>3,3&(i=(p=0|r[5756])>>>t)|0)return a=0|r[(i=(t=23064+((n=(1&i^1)+t|0)<<1<<2)|0)+8|0)>>2],(0|(s=0|r[(o=a+8|0)>>2]))==(0|t)?r[5756]=p&~(1<<n):(r[s+12>>2]=t,r[i>>2]=s),x=n<<3,r[a+4>>2]=3|x,r[(x=a+x+4|0)>>2]=1|r[x>>2],C=e,0|(x=o);if(h>>>0>(f=0|r[5758])>>>0){if(0|i)return n=((n=i<<t&((n=2<<t)|0-n))&0-n)-1|0,s=0|r[(t=(n=23064+((a=((i=(n>>>=l=n>>>12&16)>>>5&8)|l|(s=(n>>>=i)>>>2&4)|(t=(n>>>=s)>>>1&2)|(a=(n>>>=t)>>>1&1))+(n>>>a)|0)<<1<<2)|0)+8|0)>>2],(0|(i=0|r[(l=s+8|0)>>2]))==(0|n)?(t=p&~(1<<a),r[5756]=t):(r[i+12>>2]=n,r[t>>2]=i,t=p),u=(x=a<<3)-h|0,r[s+4>>2]=3|h,r[(o=s+h|0)+4>>2]=1|u,r[s+x>>2]=u,0|f&&(a=0|r[5761],i=23064+((n=f>>>3)<<1<<2)|0,t&(n=1<<n)?n=0|r[(t=i+8|0)>>2]:(r[5756]=t|n,n=i,t=i+8|0),r[t>>2]=a,r[n+12>>2]=a,r[a+8>>2]=n,r[a+12>>2]=i),r[5758]=u,r[5761]=o,C=e,0|(x=l);if(s=0|r[5757]){for(i=(s&0-s)-1|0,i=c=0|r[23328+(((a=(i>>>=o=i>>>12&16)>>>5&8)|o|(u=(i>>>=a)>>>2&4)|(l=(i>>>=u)>>>1&2)|(c=(i>>>=l)>>>1&1))+(i>>>c)<<2)>>2],l=c,c=(-8&r[c+4>>2])-h|0;(t=0|r[i+16>>2])||(t=0|r[i+20>>2]);)i=t,l=(o=(u=(-8&r[t+4>>2])-h|0)>>>0<c>>>0)?t:l,c=o?u:c;if((u=l+h|0)>>>0>l>>>0){o=0|r[l+24>>2],n=0|r[l+12>>2];do{if((0|n)==(0|l)){if(!(n=0|r[(t=l+20|0)>>2])&&!(n=0|r[(t=l+16|0)>>2])){i=0;break}for(;;)if(i=0|r[(a=n+20|0)>>2])n=i,t=a;else{if(!(i=0|r[(a=n+16|0)>>2]))break;n=i,t=a}r[t>>2]=0,i=n}else i=0|r[l+8>>2],r[i+12>>2]=n,r[n+8>>2]=i,i=n}while(0);do{if(0|o){if(n=0|r[l+28>>2],(0|l)==(0|r[(t=23328+(n<<2)|0)>>2])){if(r[t>>2]=i,!i){r[5757]=s&~(1<<n);break}}else if(r[((0|r[(x=o+16|0)>>2])==(0|l)?x:o+20|0)>>2]=i,!i)break;r[i+24>>2]=o,0|(n=0|r[l+16>>2])&&(r[i+16>>2]=n,r[n+24>>2]=i),0|(n=0|r[l+20>>2])&&(r[i+20>>2]=n,r[n+24>>2]=i)}}while(0);return c>>>0<16?(x=c+h|0,r[l+4>>2]=3|x,r[(x=l+x+4|0)>>2]=1|r[x>>2]):(r[l+4>>2]=3|h,r[u+4>>2]=1|c,r[u+c>>2]=c,0|f&&(a=0|r[5761],i=23064+((n=f>>>3)<<1<<2)|0,(n=1<<n)&p?n=0|r[(t=i+8|0)>>2]:(r[5756]=n|p,n=i,t=i+8|0),r[t>>2]=a,r[n+12>>2]=a,r[a+8>>2]=n,r[a+12>>2]=i),r[5758]=c,r[5761]=u),C=e,0|(x=l+8|0)}p=h}else p=h}else p=h}else if(t>>>0<=4294967231)if(h=-8&(t=t+11|0),a=0|r[5757]){o=0-h|0,c=(t>>>=8)?h>>>0>16777215?31:h>>>((c=14-((l=((g=t<<(p=(t+1048320|0)>>>16&8))+520192|0)>>>16&4)|p|(c=((g<<=l)+245760|0)>>>16&2))+(g<<c>>>15)|0)+7|0)&1|c<<1:0,i=0|r[23328+(c<<2)>>2];t:do{if(i)for(t=0,l=h<<(31==(0|c)?0:25-(c>>>1)|0),s=0;;){if((u=(-8&r[i+4>>2])-h|0)>>>0<o>>>0){if(!u){t=i,o=0,g=65;break t}t=i,o=u}if(s=0==(0|(g=0|r[i+20>>2]))|(0|g)==(0|(i=0|r[i+16+(l>>>31<<2)>>2]))?s:g,!i){i=s,g=61;break}l<<=1}else i=0,t=0,g=61}while(0);if(61==(0|g)){if(0==(0|i)&0==(0|t)){if(!(t=((t=2<<c)|0-t)&a)){p=h;break}p=(t&0-t)-1|0,t=0,i=0|r[23328+(((s=(p>>>=u=p>>>12&16)>>>5&8)|u|(l=(p>>>=s)>>>2&4)|(c=(p>>>=l)>>>1&2)|(i=(p>>>=c)>>>1&1))+(p>>>i)<<2)>>2]}i?g=65:(l=t,u=o)}if(65==(0|g))for(s=i;;){if(o=(i=(p=(-8&r[s+4>>2])-h|0)>>>0<o>>>0)?p:o,t=i?s:t,(i=0|r[s+16>>2])||(i=0|r[s+20>>2]),!i){l=t,u=o;break}s=i}if(0!=(0|l)&&u>>>0<((0|r[5758])-h|0)>>>0&&(f=l+h|0)>>>0>l>>>0){s=0|r[l+24>>2],n=0|r[l+12>>2];do{if((0|n)==(0|l)){if(!(n=0|r[(t=l+20|0)>>2])&&!(n=0|r[(t=l+16|0)>>2])){n=0;break}for(;;)if(i=0|r[(o=n+20|0)>>2])n=i,t=o;else{if(!(i=0|r[(o=n+16|0)>>2]))break;n=i,t=o}r[t>>2]=0}else x=0|r[l+8>>2],r[x+12>>2]=n,r[n+8>>2]=x}while(0);do{if(s){if(t=0|r[l+28>>2],(0|l)==(0|r[(i=23328+(t<<2)|0)>>2])){if(r[i>>2]=n,!n){a&=~(1<<t),r[5757]=a;break}}else if(r[((0|r[(x=s+16|0)>>2])==(0|l)?x:s+20|0)>>2]=n,!n)break;r[n+24>>2]=s,0|(t=0|r[l+16>>2])&&(r[n+16>>2]=t,r[t+24>>2]=n),(t=0|r[l+20>>2])&&(r[n+20>>2]=t,r[t+24>>2]=n)}}while(0);t:do{if(u>>>0<16)x=u+h|0,r[l+4>>2]=3|x,r[(x=l+x+4|0)>>2]=1|r[x>>2];else{if(r[l+4>>2]=3|h,r[f+4>>2]=1|u,r[f+u>>2]=u,n=u>>>3,u>>>0<256){i=23064+(n<<1<<2)|0,(t=0|r[5756])&(n=1<<n)?n=0|r[(t=i+8|0)>>2]:(r[5756]=t|n,n=i,t=i+8|0),r[t>>2]=f,r[n+12>>2]=f,r[f+8>>2]=n,r[f+12>>2]=i;break}if(n=23328+((i=(n=u>>>8)?u>>>0>16777215?31:u>>>((i=14-((_=((x=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(i=((x<<=_)+245760|0)>>>16&2))+(x<<i>>>15)|0)+7|0)&1|i<<1:0)<<2)|0,r[f+28>>2]=i,r[(t=f+16|0)+4>>2]=0,r[t>>2]=0,!(a&(t=1<<i))){r[5757]=a|t,r[n>>2]=f,r[f+24>>2]=n,r[f+12>>2]=f,r[f+8>>2]=f;break}n=0|r[n>>2];e:do{if((-8&r[n+4>>2]|0)!=(0|u)){for(a=u<<(31==(0|i)?0:25-(i>>>1)|0);t=0|r[(i=n+16+(a>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|u)){n=t;break e}a<<=1,n=t}r[i>>2]=f,r[f+24>>2]=n,r[f+12>>2]=f,r[f+8>>2]=f;break t}}while(0);x=0|r[(b=n+8|0)>>2],r[x+12>>2]=f,r[b>>2]=f,r[f+8>>2]=x,r[f+12>>2]=n,r[f+24>>2]=0}}while(0);return C=e,0|(x=l+8|0)}p=h}else p=h;else p=-1}while(0);if((i=0|r[5758])>>>0>=p>>>0)return n=i-p|0,t=0|r[5761],n>>>0>15?(x=t+p|0,r[5761]=x,r[5758]=n,r[x+4>>2]=1|n,r[t+i>>2]=n,r[t+4>>2]=3|p):(r[5758]=0,r[5761]=0,r[t+4>>2]=3|i,r[(x=t+i+4|0)>>2]=1|r[x>>2]),C=e,0|(x=t+8|0);if((u=0|r[5759])>>>0>p>>>0)return _=u-p|0,r[5759]=_,b=(x=0|r[5762])+p|0,r[5762]=b,r[b+4>>2]=1|_,r[x+4>>2]=3|p,C=e,0|(x=x+8|0);if(0|r[5874]?t=0|r[5876]:(r[5876]=4096,r[5875]=4096,r[5877]=-1,r[5878]=-1,r[5879]=0,r[5867]=0,r[5874]=-16&A^1431655768,t=4096),l=p+48|0,(h=(s=t+(c=p+47|0)|0)&(o=0-t|0))>>>0<=p>>>0)return C=e,0|(x=0);if(0|(t=0|r[5866])&&(A=(f=0|r[5864])+h|0)>>>0<=f>>>0|A>>>0>t>>>0)return C=e,0|(x=0);t:do{if(4&r[5867])n=0,g=143;else{i=0|r[5762];e:do{if(i){for(a=23472;!((A=0|r[a>>2])>>>0<=i>>>0&&(A+(0|r[a+4>>2])|0)>>>0>i>>>0);){if(!(t=0|r[a+8>>2])){g=128;break e}a=t}if((n=s-u&o)>>>0<2147483647)if((0|(t=0|be(0|n)))==((0|r[a>>2])+(0|r[a+4>>2])|0)){if(-1!=(0|t)){u=n,s=t,g=145;break t}}else a=t,g=136;else n=0}else g=128}while(0);do{if(128==(0|g))if(-1!=(0|(i=0|be(0)))&&(n=i,v=(n=(0==((v=(d=0|r[5875])+-1|0)&n|0)?0:(v+n&0-d)-n|0)+h|0)+(d=0|r[5864])|0,n>>>0>p>>>0&n>>>0<2147483647)){if(0|(A=0|r[5866])&&v>>>0<=d>>>0|v>>>0>A>>>0){n=0;break}if((0|(t=0|be(0|n)))==(0|i)){u=n,s=i,g=145;break t}a=t,g=136}else n=0}while(0);do{if(136==(0|g)){if(i=0-n|0,!(l>>>0>n>>>0&n>>>0<2147483647&-1!=(0|a))){if(-1==(0|a)){n=0;break}u=n,s=a,g=145;break t}if((t=c-n+(t=0|r[5876])&0-t)>>>0>=2147483647){u=n,s=a,g=145;break t}if(-1==(0|be(0|t))){be(0|i),n=0;break}u=t+n|0,s=a,g=145;break t}}while(0);r[5867]=4|r[5867],g=143}}while(0);if(143==(0|g)&&h>>>0<2147483647&&!(-1==(0|(_=0|be(0|h)))|1^(y=(m=(v=0|be(0))-_|0)>>>0>(p+40|0)>>>0)|_>>>0<v>>>0&-1!=(0|_)&-1!=(0|v)^1)&&(u=y?m:n,s=_,g=145),145==(0|g)){n=(0|r[5864])+u|0,r[5864]=n,n>>>0>(0|r[5865])>>>0&&(r[5865]=n),c=0|r[5762];t:do{if(c){for(n=23472;;){if((0|s)==((t=0|r[n>>2])+(i=0|r[n+4>>2])|0)){g=154;break}if(!(a=0|r[n+8>>2]))break;n=a}if(154==(0|g)&&(b=n+4|0,0==(8&r[n+12>>2]|0))&&s>>>0>c>>>0&t>>>0<=c>>>0){r[b>>2]=i+u,b=c+(_=0==(7&(_=c+8|0)|0)?0:0-_&7)|0,_=(x=(0|r[5759])+u|0)-_|0,r[5762]=b,r[5759]=_,r[b+4>>2]=1|_,r[c+x+4>>2]=40,r[5763]=r[5878];break}for(s>>>0<(0|r[5760])>>>0&&(r[5760]=s),i=s+u|0,n=23472;;){if((0|r[n>>2])==(0|i)){g=162;break}if(!(t=0|r[n+8>>2]))break;n=t}if(162==(0|g)&&0==(8&r[n+12>>2]|0)){r[n>>2]=s,r[(f=n+4|0)>>2]=(0|r[f>>2])+u,h=(f=s+(0==(7&(f=s+8|0)|0)?0:0-f&7)|0)+p|0,l=(n=i+(0==(7&(n=i+8|0)|0)?0:0-n&7)|0)-f-p|0,r[f+4>>2]=3|p;e:do{if((0|c)==(0|n))x=(0|r[5759])+l|0,r[5759]=x,r[5762]=h,r[h+4>>2]=1|x;else{if((0|r[5761])==(0|n)){x=(0|r[5758])+l|0,r[5758]=x,r[5761]=h,r[h+4>>2]=1|x,r[h+x>>2]=x;break}if(1==(3&(t=0|r[n+4>>2])|0)){u=-8&t,a=t>>>3;n:do{if(t>>>0<256){if(t=0|r[n+8>>2],(0|(i=0|r[n+12>>2]))==(0|t)){r[5756]=r[5756]&~(1<<a);break}r[t+12>>2]=i,r[i+8>>2]=t;break}s=0|r[n+24>>2],t=0|r[n+12>>2];do{if((0|t)==(0|n)){if(t=0|r[(a=(i=n+16|0)+4|0)>>2])i=a;else if(!(t=0|r[i>>2])){t=0;break}for(;;)if(a=0|r[(o=t+20|0)>>2])t=a,i=o;else{if(!(a=0|r[(o=t+16|0)>>2]))break;t=a,i=o}r[i>>2]=0}else x=0|r[n+8>>2],r[x+12>>2]=t,r[t+8>>2]=x}while(0);if(!s)break;a=23328+((i=0|r[n+28>>2])<<2)|0;do{if((0|r[a>>2])==(0|n)){if(r[a>>2]=t,0|t)break;r[5757]=r[5757]&~(1<<i);break n}if(r[((0|r[(x=s+16|0)>>2])==(0|n)?x:s+20|0)>>2]=t,!t)break n}while(0);if(r[t+24>>2]=s,0|(a=0|r[(i=n+16|0)>>2])&&(r[t+16>>2]=a,r[a+24>>2]=t),!(i=0|r[i+4>>2]))break;r[t+20>>2]=i,r[i+24>>2]=t}while(0);n=n+u|0,o=u+l|0}else o=l;if(r[(n=n+4|0)>>2]=-2&r[n>>2],r[h+4>>2]=1|o,r[h+o>>2]=o,n=o>>>3,o>>>0<256){i=23064+(n<<1<<2)|0,(t=0|r[5756])&(n=1<<n)?n=0|r[(t=i+8|0)>>2]:(r[5756]=t|n,n=i,t=i+8|0),r[t>>2]=h,r[n+12>>2]=h,r[h+8>>2]=n,r[h+12>>2]=i;break}n=o>>>8;do{if(n){if(o>>>0>16777215){a=31;break}a=o>>>((a=14-((_=((x=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(a=((x<<=_)+245760|0)>>>16&2))+(x<<a>>>15)|0)+7|0)&1|a<<1}else a=0}while(0);if(n=23328+(a<<2)|0,r[h+28>>2]=a,r[(t=h+16|0)+4>>2]=0,r[t>>2]=0,!((t=0|r[5757])&(i=1<<a))){r[5757]=t|i,r[n>>2]=h,r[h+24>>2]=n,r[h+12>>2]=h,r[h+8>>2]=h;break}n=0|r[n>>2];n:do{if((-8&r[n+4>>2]|0)!=(0|o)){for(a=o<<(31==(0|a)?0:25-(a>>>1)|0);t=0|r[(i=n+16+(a>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|o)){n=t;break n}a<<=1,n=t}r[i>>2]=h,r[h+24>>2]=n,r[h+12>>2]=h,r[h+8>>2]=h;break e}}while(0);x=0|r[(b=n+8|0)>>2],r[x+12>>2]=h,r[b>>2]=h,r[h+8>>2]=x,r[h+12>>2]=n,r[h+24>>2]=0}}while(0);return C=e,0|(x=f+8|0)}for(n=23472;!((t=0|r[n>>2])>>>0<=c>>>0&&(x=t+(0|r[n+4>>2])|0)>>>0>c>>>0);)n=0|r[n+8>>2];n=(t=(t=(o=x+-47|0)+(0==(7&(t=o+8|0)|0)?0:0-t&7)|0)>>>0<(o=c+16|0)>>>0?c:t)+8|0,b=s+(_=0==(7&(_=s+8|0)|0)?0:0-_&7)|0,_=(i=u+-40|0)-_|0,r[5762]=b,r[5759]=_,r[b+4>>2]=1|_,r[s+i+4>>2]=40,r[5763]=r[5878],r[(i=t+4|0)>>2]=27,r[n>>2]=r[5868],r[n+4>>2]=r[5869],r[n+8>>2]=r[5870],r[n+12>>2]=r[5871],r[5868]=s,r[5869]=u,r[5871]=0,r[5870]=n,n=t+24|0;do{b=n,r[(n=n+4|0)>>2]=7}while((b+8|0)>>>0<x>>>0);if((0|t)!=(0|c)){if(s=t-c|0,r[i>>2]=-2&r[i>>2],r[c+4>>2]=1|s,r[t>>2]=s,n=s>>>3,s>>>0<256){i=23064+(n<<1<<2)|0,(t=0|r[5756])&(n=1<<n)?n=0|r[(t=i+8|0)>>2]:(r[5756]=t|n,n=i,t=i+8|0),r[t>>2]=c,r[n+12>>2]=c,r[c+8>>2]=n,r[c+12>>2]=i;break}if(i=23328+((a=(n=s>>>8)?s>>>0>16777215?31:s>>>((a=14-((_=((x=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(a=((x<<=_)+245760|0)>>>16&2))+(x<<a>>>15)|0)+7|0)&1|a<<1:0)<<2)|0,r[c+28>>2]=a,r[c+20>>2]=0,r[o>>2]=0,!((n=0|r[5757])&(t=1<<a))){r[5757]=n|t,r[i>>2]=c,r[c+24>>2]=i,r[c+12>>2]=c,r[c+8>>2]=c;break}n=0|r[i>>2];e:do{if((-8&r[n+4>>2]|0)!=(0|s)){for(a=s<<(31==(0|a)?0:25-(a>>>1)|0);t=0|r[(i=n+16+(a>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|s)){n=t;break e}a<<=1,n=t}r[i>>2]=c,r[c+24>>2]=n,r[c+12>>2]=c,r[c+8>>2]=c;break t}}while(0);x=0|r[(b=n+8|0)>>2],r[x+12>>2]=c,r[b>>2]=c,r[c+8>>2]=x,r[c+12>>2]=n,r[c+24>>2]=0}}else 0==(0|(x=0|r[5760]))|s>>>0<x>>>0&&(r[5760]=s),r[5868]=s,r[5869]=u,r[5871]=0,r[5765]=r[5874],r[5764]=-1,r[5769]=23064,r[5768]=23064,r[5771]=23072,r[5770]=23072,r[5773]=23080,r[5772]=23080,r[5775]=23088,r[5774]=23088,r[5777]=23096,r[5776]=23096,r[5779]=23104,r[5778]=23104,r[5781]=23112,r[5780]=23112,r[5783]=23120,r[5782]=23120,r[5785]=23128,r[5784]=23128,r[5787]=23136,r[5786]=23136,r[5789]=23144,r[5788]=23144,r[5791]=23152,r[5790]=23152,r[5793]=23160,r[5792]=23160,r[5795]=23168,r[5794]=23168,r[5797]=23176,r[5796]=23176,r[5799]=23184,r[5798]=23184,r[5801]=23192,r[5800]=23192,r[5803]=23200,r[5802]=23200,r[5805]=23208,r[5804]=23208,r[5807]=23216,r[5806]=23216,r[5809]=23224,r[5808]=23224,r[5811]=23232,r[5810]=23232,r[5813]=23240,r[5812]=23240,r[5815]=23248,r[5814]=23248,r[5817]=23256,r[5816]=23256,r[5819]=23264,r[5818]=23264,r[5821]=23272,r[5820]=23272,r[5823]=23280,r[5822]=23280,r[5825]=23288,r[5824]=23288,r[5827]=23296,r[5826]=23296,r[5829]=23304,r[5828]=23304,r[5831]=23312,r[5830]=23312,b=s+(_=0==(7&(_=s+8|0)|0)?0:0-_&7)|0,_=(x=u+-40|0)-_|0,r[5762]=b,r[5759]=_,r[b+4>>2]=1|_,r[s+x+4>>2]=40,r[5763]=r[5878]}while(0);if((n=0|r[5759])>>>0>p>>>0)return _=n-p|0,r[5759]=_,b=(x=0|r[5762])+p|0,r[5762]=b,r[b+4>>2]=1|_,r[x+4>>2]=3|p,C=e,0|(x=x+8|0)}return r[(x=23520)>>2]=12,C=e,0|(x=0)}function ue(t){var e=0,n=0,i=0,a=0,o=0,s=0,u=0,l=0;if(t|=0){n=t+-8|0,a=0|r[5760],l=n+(e=-8&(t=0|r[t+-4>>2]))|0;do{if(1&t)u=n,s=n;else{if(i=0|r[n>>2],!(3&t))return;if(o=i+e|0,(s=n+(0-i)|0)>>>0<a>>>0)return;if((0|r[5761])==(0|s)){if(3!=(3&(e=0|r[(t=l+4|0)>>2])|0)){u=s,e=o;break}return r[5758]=o,r[t>>2]=-2&e,r[s+4>>2]=1|o,void(r[s+o>>2]=o)}if(n=i>>>3,i>>>0<256){if(t=0|r[s+8>>2],(0|(e=0|r[s+12>>2]))==(0|t)){r[5756]=r[5756]&~(1<<n),u=s,e=o;break}r[t+12>>2]=e,r[e+8>>2]=t,u=s,e=o;break}a=0|r[s+24>>2],t=0|r[s+12>>2];do{if((0|t)==(0|s)){if(t=0|r[(n=(e=s+16|0)+4|0)>>2])e=n;else if(!(t=0|r[e>>2])){t=0;break}for(;;)if(n=0|r[(i=t+20|0)>>2])t=n,e=i;else{if(!(n=0|r[(i=t+16|0)>>2]))break;t=n,e=i}r[e>>2]=0}else u=0|r[s+8>>2],r[u+12>>2]=t,r[t+8>>2]=u}while(0);if(a){if(e=0|r[s+28>>2],(0|r[(n=23328+(e<<2)|0)>>2])==(0|s)){if(r[n>>2]=t,!t){r[5757]=r[5757]&~(1<<e),u=s,e=o;break}}else if(r[((0|r[(u=a+16|0)>>2])==(0|s)?u:a+20|0)>>2]=t,!t){u=s,e=o;break}r[t+24>>2]=a,0|(n=0|r[(e=s+16|0)>>2])&&(r[t+16>>2]=n,r[n+24>>2]=t),(e=0|r[e+4>>2])?(r[t+20>>2]=e,r[e+24>>2]=t,u=s,e=o):(u=s,e=o)}else u=s,e=o}}while(0);if(!(s>>>0>=l>>>0)&&1&(i=0|r[(t=l+4|0)>>2])){if(2&i)r[t>>2]=-2&i,r[u+4>>2]=1|e,r[s+e>>2]=e,a=e;else{if((0|r[5762])==(0|l)){if(l=(0|r[5759])+e|0,r[5759]=l,r[5762]=u,r[u+4>>2]=1|l,(0|u)!=(0|r[5761]))return;return r[5761]=0,void(r[5758]=0)}if((0|r[5761])==(0|l))return l=(0|r[5758])+e|0,r[5758]=l,r[5761]=s,r[u+4>>2]=1|l,void(r[s+l>>2]=l);a=(-8&i)+e|0,n=i>>>3;do{if(i>>>0<256){if(e=0|r[l+8>>2],(0|(t=0|r[l+12>>2]))==(0|e)){r[5756]=r[5756]&~(1<<n);break}r[e+12>>2]=t,r[t+8>>2]=e;break}o=0|r[l+24>>2],t=0|r[l+12>>2];do{if((0|t)==(0|l)){if(t=0|r[(n=(e=l+16|0)+4|0)>>2])e=n;else if(!(t=0|r[e>>2])){n=0;break}for(;;)if(n=0|r[(i=t+20|0)>>2])t=n,e=i;else{if(!(n=0|r[(i=t+16|0)>>2]))break;t=n,e=i}r[e>>2]=0,n=t}else n=0|r[l+8>>2],r[n+12>>2]=t,r[t+8>>2]=n,n=t}while(0);if(0|o){if(t=0|r[l+28>>2],(0|r[(e=23328+(t<<2)|0)>>2])==(0|l)){if(r[e>>2]=n,!n){r[5757]=r[5757]&~(1<<t);break}}else if(r[((0|r[(i=o+16|0)>>2])==(0|l)?i:o+20|0)>>2]=n,!n)break;r[n+24>>2]=o,0|(e=0|r[(t=l+16|0)>>2])&&(r[n+16>>2]=e,r[e+24>>2]=n),0|(t=0|r[t+4>>2])&&(r[n+20>>2]=t,r[t+24>>2]=n)}}while(0);if(r[u+4>>2]=1|a,r[s+a>>2]=a,(0|u)==(0|r[5761]))return void(r[5758]=a)}if(t=a>>>3,a>>>0<256)return n=23064+(t<<1<<2)|0,(e=0|r[5756])&(t=1<<t)?t=0|r[(e=n+8|0)>>2]:(r[5756]=e|t,t=n,e=n+8|0),r[e>>2]=u,r[t+12>>2]=u,r[u+8>>2]=t,void(r[u+12>>2]=n);t=23328+((i=(t=a>>>8)?a>>>0>16777215?31:a>>>((i=14-((o=((l=t<<(s=(t+1048320|0)>>>16&8))+520192|0)>>>16&4)|s|(i=((l<<=o)+245760|0)>>>16&2))+(l<<i>>>15)|0)+7|0)&1|i<<1:0)<<2)|0,r[u+28>>2]=i,r[u+20>>2]=0,r[u+16>>2]=0,e=0|r[5757],n=1<<i;t:do{if(e&n){t=0|r[t>>2];e:do{if((-8&r[t+4>>2]|0)!=(0|a)){for(i=a<<(31==(0|i)?0:25-(i>>>1)|0);e=0|r[(n=t+16+(i>>>31<<2)|0)>>2];){if((-8&r[e+4>>2]|0)==(0|a)){t=e;break e}i<<=1,t=e}r[n>>2]=u,r[u+24>>2]=t,r[u+12>>2]=u,r[u+8>>2]=u;break t}}while(0);l=0|r[(s=t+8|0)>>2],r[l+12>>2]=u,r[s>>2]=u,r[u+8>>2]=l,r[u+12>>2]=t,r[u+24>>2]=0}else r[5757]=e|n,r[t>>2]=u,r[u+24>>2]=t,r[u+12>>2]=u,r[u+8>>2]=u}while(0);if(l=(0|r[5764])-1|0,r[5764]=l,!(0|l)){for(t=23480;t=0|r[t>>2];)t=t+8|0;r[5764]=-1}}}}function le(t,e){e|=0;var n=0;return(t|=0)?(n=0|y(e,t),(e|t)>>>0>65535&&(n=(0|(n>>>0)/(t>>>0))==(0|e)?n:-1)):n=0,(t=0|se(n))&&3&r[t+-4>>2]?(ye(0|t,0,0|n),0|t):0|t}function ce(t){return 0|~~+function(t){return+ +_e(+(t=+t))}(t=+t)}function he(t,e,n,i){return 0|(b(0|(i=(e|=0)-(i|=0)-((n|=0)>>>0>(t|=0)>>>0|0)>>>0)),t-n>>>0|0)}function fe(t){return 0|((t|=0)?31-(0|_(t^t-1))|0:32)}function pe(t,e,n,i,a){a|=0;var o=0,s=0,u=0,l=0,c=0,h=0,f=0,p=0,A=0,d=0;if(h=t|=0,s=n|=0,u=p=i|=0,!(c=l=e|=0))return o=0!=(0|a),u?o?(r[a>>2]=0|t,r[a+4>>2]=0&e,a=0,0|(b(0|(p=0)),a)):(a=0,0|(b(0|(p=0)),a)):(o&&(r[a>>2]=(h>>>0)%(s>>>0),r[a+4>>2]=0),a=(h>>>0)/(s>>>0)>>>0,0|(b(0|(p=0)),a));o=0==(0|u);do{if(s){if(!o){if((o=(0|_(0|u))-(0|_(0|c))|0)>>>0<=31){s=f=o+1|0,t=h>>>(f>>>0)&(e=o-31>>31)|c<<(u=31-o|0),e&=c>>>(f>>>0),o=0,u=h<<u;break}return a?(r[a>>2]=0|t,r[a+4>>2]=l|0&e,a=0,0|(b(0|(p=0)),a)):(a=0,0|(b(0|(p=0)),a))}if((o=s-1|0)&s|0){s=u=33+(0|_(0|s))-(0|_(0|c))|0,t=(f=32-u|0)-1>>31&c>>>((A=u-32|0)>>>0)|(c<<f|h>>>(u>>>0))&(e=A>>31),e&=c>>>(u>>>0),o=h<<(d=64-u|0)&(l=f>>31),u=(c<<d|h>>>(A>>>0))&l|h<<f&u-33>>31;break}return 0|a&&(r[a>>2]=o&h,r[a+4>>2]=0),1==(0|s)?(d=0|t,0|(b(0|(A=l|0&e)),d)):(A=c>>>((d=0|fe(0|s))>>>0)|0,d=c<<32-d|h>>>(d>>>0)|0,0|(b(0|A),d))}if(o)return 0|a&&(r[a>>2]=(c>>>0)%(s>>>0),r[a+4>>2]=0),d=(c>>>0)/(s>>>0)>>>0,0|(b(0|(A=0)),d);if(!h)return 0|a&&(r[a>>2]=0,r[a+4>>2]=(c>>>0)%(u>>>0)),d=(c>>>0)/(u>>>0)>>>0,0|(b(0|(A=0)),d);if(!((o=u-1|0)&u))return 0|a&&(r[a>>2]=0|t,r[a+4>>2]=o&c|0&e),A=0,d=c>>>((0|fe(0|u))>>>0),0|(b(0|A),d);if((o=(0|_(0|u))-(0|_(0|c))|0)>>>0<=30){s=e=o+1|0,t=c<<(u=31-o|0)|h>>>(e>>>0),e=c>>>(e>>>0),o=0,u=h<<u;break}return a?(r[a>>2]=0|t,r[a+4>>2]=l|0&e,d=0,0|(b(0|(A=0)),d)):(d=0,0|(b(0|(A=0)),d))}while(0);if(s){c=0|function(t,e,n,i){return 0|(b((e|=0)+(i|=0)+((n=(t|=0)+(n|=0)>>>0)>>>0<t>>>0|0)>>>0|0),0|n)}(0|(f=0|n),0|(h=p|0&i),-1,-1),n=0|x(),l=u,u=0;do{i=l,l=o>>>31|l<<1,o=u|o<<1,he(0|c,0|n,0|(i=t<<1|i>>>31|0),0|(p=t>>>31|e<<1|0)),u=1&(A=(d=0|x())>>31|((0|d)<0?-1:0)<<1),t=0|he(0|i,0|p,A&f|0,(((0|d)<0?-1:0)>>31|((0|d)<0?-1:0)<<1)&h|0),e=0|x(),s=s-1|0}while(0!=(0|s));c=l,l=0}else c=u,l=0,u=0;return s=0,0|a&&(r[a>>2]=t,r[a+4>>2]=e),d=-2&(o<<1|0)|u,0|(b(0|(A=(0|o)>>>31|(c|s)<<1|0&(s<<1|o>>>31)|l)),d)}function Ae(t,e,n,i){var a,o;return o=C,C=C+16|0,pe(t|=0,e|=0,n|=0,i|=0,a=0|o),C=o,0|(b(0|r[a+4>>2]),0|r[a>>2])}function de(t,e,n){return t|=0,e|=0,(0|(n|=0))<32?(b(e>>>n|0),t>>>n|(e&(1<<n)-1)<<32-n):(b(0),e>>>n-32|0)}function ve(t,e,n){return t|=0,e|=0,(0|(n|=0))<32?(b(e<<n|(t&(1<<n)-1<<32-n)>>>32-n|0),t<<n):(b(t<<n-32|0),0)}function ge(t){return(t=+t)>=0?+s(t+.5):+m(t-.5)}function me(t,e,n){t|=0,e|=0;var a,o,s=0;if((0|(n|=0))>=8192)return O(0|t,0|e,0|n),0|t;if(o=0|t,a=t+n|0,(3&t)==(3&e)){for(;3&t;){if(!n)return 0|o;i[t>>0]=0|i[e>>0],t=t+1|0,e=e+1|0,n=n-1|0}for(s=(n=-4&a|0)-64|0;(0|t)<=(0|s);)r[t>>2]=r[e>>2],r[t+4>>2]=r[e+4>>2],r[t+8>>2]=r[e+8>>2],r[t+12>>2]=r[e+12>>2],r[t+16>>2]=r[e+16>>2],r[t+20>>2]=r[e+20>>2],r[t+24>>2]=r[e+24>>2],r[t+28>>2]=r[e+28>>2],r[t+32>>2]=r[e+32>>2],r[t+36>>2]=r[e+36>>2],r[t+40>>2]=r[e+40>>2],r[t+44>>2]=r[e+44>>2],r[t+48>>2]=r[e+48>>2],r[t+52>>2]=r[e+52>>2],r[t+56>>2]=r[e+56>>2],r[t+60>>2]=r[e+60>>2],t=t+64|0,e=e+64|0;for(;(0|t)<(0|n);)r[t>>2]=r[e>>2],t=t+4|0,e=e+4|0}else for(n=a-4|0;(0|t)<(0|n);)i[t>>0]=0|i[e>>0],i[t+1>>0]=0|i[e+1>>0],i[t+2>>0]=0|i[e+2>>0],i[t+3>>0]=0|i[e+3>>0],t=t+4|0,e=e+4|0;for(;(0|t)<(0|a);)i[t>>0]=0|i[e>>0],t=t+1|0,e=e+1|0;return 0|o}function ye(t,e,n){e|=0;var a,o=0,s=0,u=0;if(a=(t|=0)+(n|=0)|0,e&=255,(0|n)>=67){for(;3&t;)i[t>>0]=e,t=t+1|0;for(u=e|e<<8|e<<16|e<<24,s=(o=-4&a|0)-64|0;(0|t)<=(0|s);)r[t>>2]=u,r[t+4>>2]=u,r[t+8>>2]=u,r[t+12>>2]=u,r[t+16>>2]=u,r[t+20>>2]=u,r[t+24>>2]=u,r[t+28>>2]=u,r[t+32>>2]=u,r[t+36>>2]=u,r[t+40>>2]=u,r[t+44>>2]=u,r[t+48>>2]=u,r[t+52>>2]=u,r[t+56>>2]=u,r[t+60>>2]=u,t=t+64|0;for(;(0|t)<(0|o);)r[t>>2]=u,t=t+4|0}for(;(0|t)<(0|a);)i[t>>0]=e,t=t+1|0;return a-n|0}function _e(t){return(t=+t)>=0?+s(t+.5):+m(t-.5)}function be(t){var e,n;return(0|(t|=0))>0&(0|(e=(n=0|r[o>>2])+t|0))<(0|n)|(0|e)<0?(E(0|e),S(12),-1):(0|e)>(0|k())&&0==(0|P(0|e))?(S(12),-1):(r[o>>2]=e,0|n)}return{___uremdi3:Ae,_bitshift64Lshr:de,_bitshift64Shl:ve,_calloc:le,_compact:function(t,e,n){e|=0,n|=0;var i,a=0,o=0,s=0,u=0,l=0,c=0,h=0,f=0,p=0,A=0,d=0,v=0,g=0,m=0,y=0,_=0,b=0,w=0,S=0;if(a=0|r[(o=t|=0)>>2],!0&0==(15728640&(o=0|r[o+4>>2])|0)){if((0|n)<=0)return 0|(S=0);if(r[(S=e)>>2]=a,r[S+4>>2]=o,1==(0|n))return 0|(S=0);a=1;do{w=0|r[4+(b=t+(a<<3)|0)>>2],r[(S=e+(a<<3)|0)>>2]=r[b>>2],r[S+4>>2]=w,a=a+1|0}while((0|a)!=(0|n));return 0|(a=0)}me(0|(w=0|se(b=n<<3)),0|t,0|b),i=0|le(n,8);t:do{if(0|n){a=n;e:for(;;){y=0|de(0|(f=0|r[(u=w)>>2]),0|(u=0|r[u+4>>2]),52),x(),_=(y&=15)-1|0,m=(0|a)>0;n:do{if(m){if(g=((0|a)<0)<<31>>31,d=0|ve(0|_,0,52),v=0|x(),_>>>0>15)for(o=0,t=f,n=u;;){if(!(0==(0|t)&0==(0|n))){if(s=0|de(0|t,0|n,52),x(),l=(0|(s&=15))<(0|_),s=(0|s)==(0|_),n=0|Ae(0|(h=l?0:s?t:0),0|(t=l?0:s?n:0),0|a,0|g),x(),0==(0|(c=0|r[(l=s=i+(n<<3)|0)>>2]))&0==(0|(l=0|r[l+4>>2])))n=h;else for(d=0,A=n,p=c,n=h,c=s;;){if((0|d)>(0|a)){S=33;break e}if((0|p)==(0|n)&(-117440513&l|0)==(0|t)){if(s=0|de(0|p,0|l,56),x(),7==(0|(s&=7))){S=38;break e}v=0|ve(s+1|0,0,56),t=0|x()|-117440513&t,r[c>>2]=0,r[c+4>>2]=0,c=A,n|=v}else c=(A+1|0)%(0|a)|0;if(0==(0|(p=0|r[(l=s=i+(c<<3)|0)>>2]))&0==(0|(l=0|r[l+4>>2])))break;d=d+1|0,A=c,c=s}r[(v=s)>>2]=n,r[v+4>>2]=t}if((0|(o=o+1|0))>=(0|a))break n;t=0|r[(n=w+(o<<3)|0)>>2],n=0|r[n+4>>2]}for(o=0,t=f,n=u;;){if(!(0==(0|t)&0==(0|n))){if(l=0|de(0|t,0|n,52),x(),(0|(l&=15))>=(0|_)){if((0|l)!=(0|_)&&(t|=d,n=-15728641&n|v,l>>>0>=y>>>0)){s=_;do{A=0|ve(7,0,3*(14-s|0)|0),s=s+1|0,t|=A,n=0|x()|n}while(s>>>0<l>>>0)}}else t=0,n=0;if(l=0|Ae(0|t,0|n,0|a,0|g),x(),!(0==(0|(h=0|r[(c=s=i+(l<<3)|0)>>2]))&0==(0|(c=0|r[c+4>>2]))))for(A=0,p=h,h=s;;){if((0|A)>(0|a)){S=33;break e}if((0|p)==(0|t)&(-117440513&c|0)==(0|n)){if(s=0|de(0|p,0|c,56),x(),7==(0|(s&=7))){S=38;break e}p=0|ve(s+1|0,0,56),n=0|x()|-117440513&n,r[h>>2]=0,r[h+4>>2]=0,t|=p}else l=(l+1|0)%(0|a)|0;if(0==(0|(p=0|r[(c=s=i+(l<<3)|0)>>2]))&0==(0|(c=0|r[c+4>>2])))break;A=A+1|0,h=s}r[(A=s)>>2]=t,r[A+4>>2]=n}if((0|(o=o+1|0))>=(0|a))break n;t=0|r[(n=w+(o<<3)|0)>>2],n=0|r[n+4>>2]}}}while(0);if((a+5|0)>>>0<11){S=84;break}g=0|se(((0|a)/6|0)<<3);n:do{if(m){d=0,A=0;do{if(!(0==(0|(o=0|r[(t=l=i+(d<<3)|0)>>2]))&0==(0|(t=0|r[t+4>>2])))){c=0|de(0|o,0|t,56),x(),n=1+(c&=7)|0,h=-117440513&t,v=0|de(0|o,0|t,45),x();i:do{if(0|I(127&v)){if(p=0|de(0|o,0|t,52),x(),0|(p&=15))for(s=1;;){if(!(0==(o&(v=0|ve(7,0,3*(15-s|0)|0))|0)&0==(h&(0|x())|0)))break i;if(!(s>>>0<p>>>0))break;s=s+1|0}o|=t=0|ve(0|n,0,56),t=0|x()|h,r[(n=l)>>2]=o,r[n+4>>2]=t,n=c+2|0}}while(0);7==(0|n)&&(r[(v=g+(A<<3)|0)>>2]=o,r[v+4>>2]=-117440513&t,A=A+1|0)}d=d+1|0}while((0|d)!=(0|a));if(m){if(v=((0|a)<0)<<31>>31,p=0|ve(0|_,0,52),d=0|x(),_>>>0>15)for(t=0,o=0;;){do{if(!(0==(0|f)&0==(0|u))){for(c=0|de(0|f,0|u,52),x(),s=(0|(c&=15))<(0|_),c=(0|c)==(0|_),s=0|Ae(0|(l=s?0:c?f:0),0|(c=s?0:c?u:0),0|a,0|v),x(),n=0;;){if((0|n)>(0|a)){S=83;break e}if((-117440513&(h=0|r[4+(y=i+(s<<3)|0)>>2])|0)==(0|c)&&(0|r[y>>2])==(0|l)){S=55;break}if((0|r[(y=i+((s=(s+1|0)%(0|a)|0)<<3)|0)>>2])==(0|l)&&(0|r[y+4>>2])==(0|c))break;n=n+1|0}if(55==(0|S)&&(S=0,!0&100663296==(117440512&h|0)))break;r[(y=e+(o<<3)|0)>>2]=f,r[y+4>>2]=u,o=o+1|0}}while(0);if((0|(t=t+1|0))>=(0|a)){a=A;break n}f=0|r[(u=w+(t<<3)|0)>>2],u=0|r[u+4>>2]}for(t=0,o=0;;){do{if(!(0==(0|f)&0==(0|u))){if(c=0|de(0|f,0|u,52),x(),(0|(c&=15))>=(0|_))if((0|c)!=(0|_))if(n=f|p,s=-15728641&u|d,c>>>0<y>>>0)c=s;else{l=_;do{m=0|ve(7,0,3*(14-l|0)|0),l=l+1|0,n|=m,s=0|x()|s}while(l>>>0<c>>>0);c=s}else n=f,c=u;else n=0,c=0;for(l=0|Ae(0|n,0|c,0|a,0|v),x(),s=0;;){if((0|s)>(0|a)){S=83;break e}if((-117440513&(h=0|r[4+(m=i+(l<<3)|0)>>2])|0)==(0|c)&&(0|r[m>>2])==(0|n)){S=78;break}if((0|r[(m=i+((l=(l+1|0)%(0|a)|0)<<3)|0)>>2])==(0|n)&&(0|r[m+4>>2])==(0|c))break;s=s+1|0}if(78==(0|S)&&(S=0,!0&100663296==(117440512&h|0)))break;r[(m=e+(o<<3)|0)>>2]=f,r[m+4>>2]=u,o=o+1|0}}while(0);if((0|(t=t+1|0))>=(0|a)){a=A;break n}f=0|r[(u=w+(t<<3)|0)>>2],u=0|r[u+4>>2]}}else o=0,a=A}else o=0,a=0}while(0);if(ye(0|i,0,0|b),me(0|w,0|g,a<<3|0),ue(g),!a)break t;e=e+(o<<3)|0}if(33==(0|S))return ue(w),ue(i),0|(S=-1);if(38==(0|S))return ue(w),ue(i),0|(S=-2);if(83==(0|S))return ue(g),ue(w),ue(i),0|(S=-1);if(84==(0|S)){me(0|e,0|w,a<<3|0);break}}}while(0);return ue(w),ue(i),0|(S=0)},_destroyLinkedPolygon:function(t){var e=0,n=0,i=0,a=0;if(t|=0)for(i=1;;){if(0|(e=0|r[t>>2]))do{if(0|(n=0|r[e>>2]))do{a=n,n=0|r[n+16>>2],ue(a)}while(0!=(0|n));a=e,e=0|r[e+8>>2],ue(a)}while(0!=(0|e));if(e=t,t=0|r[t+8>>2],i||ue(e),!t)break;i=0}},_edgeLengthKm:function(t){return+ +a[20752+((t|=0)<<3)>>3]},_edgeLengthM:function(t){return+ +a[20880+((t|=0)<<3)>>3]},_emscripten_replace_memory:function(t){return i=new Int8Array(t),new Uint8Array(t),r=new Int32Array(t),new Float32Array(t),a=new Float64Array(t),n=t,!0},_experimentalH3ToLocalIj:function(t,e,n,i,r){var a,o;return r|=0,o=C,C=C+16|0,(t=0|Ht(t|=0,e|=0,n|=0,i|=0,a=o))||(ct(a,r),t=0),C=o,0|t},_experimentalLocalIjToH3:function(t,e,n,i){var r,a;return t|=0,e|=0,i|=0,r=C,C=C+16|0,ht(n|=0,a=r),i=0|qt(t,e,a,i),C=r,0|i},_free:ue,_geoToH3:zt,_getDestinationH3IndexFromUnidirectionalEdge:function(t,e){t|=0;var n,i,a=0;return n=C,C=C+16|0,a=n,!0&268435456==(2013265920&(e|=0)|0)?(i=0|de(0|t,0|e,56),x(),r[a>>2]=0,a=0|L(t,-2130706433&e|134217728,7&i,a),e=0|x(),b(0|e),C=n,0|a):(a=0,b(0|(e=0)),C=n,0|a)},_getH3IndexesFromUnidirectionalEdge:function(t,e,n){t|=0;var i,a,o,s,u=0;o=C,C=C+16|0,i=o,s=!0&268435456==(2013265920&(e|=0)|0),a=-2130706433&e|134217728,r[(u=n|=0)>>2]=s?t:0,r[u+4>>2]=s?a:0,s?(e=0|de(0|t,0|e,56),x(),r[i>>2]=0,t=0|L(t,a,7&e,i),e=0|x()):(t=0,e=0),r[(u=n+8|0)>>2]=t,r[u+4>>2]=e,C=o},_getH3UnidirectionalEdge:function(t,e,n,i){var a,o,s=0,u=0;if(o=C,C=C+16|0,a=o,!(0|Nt(t|=0,e|=0,n|=0,i|=0)))return s=0,b(0|(t=0)),C=o,0|s;if(s=-2130706433&e,r[a>>2]=0,(0|(u=0|L(t,e,1,a)))==(0|n)&(0|x())==(0|i))e=0,n=16777216;else if(r[a>>2]=0,(0|(u=0|L(t,e,2,a)))==(0|n)&(0|x())==(0|i))e=0,n=33554432;else if(r[a>>2]=0,(0|(u=0|L(t,e,3,a)))==(0|n)&(0|x())==(0|i))e=0,n=50331648;else if(r[a>>2]=0,(0|(u=0|L(t,e,4,a)))==(0|n)&(0|x())==(0|i))e=0,n=67108864;else if(r[a>>2]=0,(0|(u=0|L(t,e,5,a)))==(0|n)&(0|x())==(0|i))e=0,n=83886080;else{if(r[a>>2]=0,!((0|(u=0|L(t,e,6,a)))==(0|n)&(0|x())==(0|i)))return u=0,b(0|(s=0)),C=o,0|u;e=0,n=100663296}return u=t|e,b(0|(s=s|n|268435456)),C=o,0|u},_getH3UnidirectionalEdgeBoundary:function(t,e,n){t|=0,e|=0,n|=0;var i,a,o=0,s=0,u=0,l=0,c=0,h=0;if(a=C,C=C+368|0,s=a+352|0,c=a+16|0,h=a,ye(0|(i=a+184|0),0,168),ye(0|c,0,168),r[h>>2]=0,r[h+4>>2]=0,r[h+8>>2]=0,r[h+12>>2]=0,o=-2130706433&e|134217728,Ft((l=!0&268435456==(2013265920&e|0))?t:0,l?o:0,i),l?(e=0|de(0|t,0|e,56),x(),r[s>>2]=0,t=0|L(t,o,7&e,s),e=0|x()):(t=0,e=0),Ft(t,e,c),(0|r[i>>2])<=0)return h=0,r[n>>2]=h,void(C=a);l=i+24|0,t=0,e=0,u=0;do{s=i+8+(u<<4)|0;t:do{if((0|r[c>>2])>0){for(o=0;!(0|_t(s,c+8+(o<<4)|0,1e-6));)if((0|(o=o+1|0))>=(0|r[c>>2]))break t;e:do{if(!u){if((0|r[c>>2])>0){o=0;do{if(0|_t(l,c+8+(o<<4)|0,1e-6))break e;o=o+1|0}while((0|o)<(0|r[c>>2]))}r[h>>2]=r[s>>2],r[h+4>>2]=r[s+4>>2],r[h+8>>2]=r[s+8>>2],r[h+12>>2]=r[s+12>>2],e=1;break t}}while(0);r[(o=n+8+(t<<4)|0)>>2]=r[s>>2],r[o+4>>2]=r[s+4>>2],r[o+8>>2]=r[s+8>>2],r[o+12>>2]=r[s+12>>2],t=t+1|0}}while(0);u=u+1|0}while((0|u)<(0|r[i>>2]));if(!e)return h=t,r[n>>2]=h,void(C=a);r[(c=n+8+(t<<4)|0)>>2]=r[h>>2],r[c+4>>2]=r[h+4>>2],r[c+8>>2]=r[h+8>>2],r[c+12>>2]=r[h+12>>2],h=t+1|0,r[n>>2]=h,C=a},_getH3UnidirectionalEdgesFromHexagon:function(t,e,n){n|=0;var i,a=0;i=0==(0|Et(t|=0,e|=0)),e&=-2130706433,r[(a=n)>>2]=i?t:0,r[a+4>>2]=i?285212672|e:0,r[(a=n+8|0)>>2]=t,r[a+4>>2]=301989888|e,r[(a=n+16|0)>>2]=t,r[a+4>>2]=318767104|e,r[(a=n+24|0)>>2]=t,r[a+4>>2]=335544320|e,r[(a=n+32|0)>>2]=t,r[a+4>>2]=352321536|e,r[(n=n+40|0)>>2]=t,r[n+4>>2]=369098752|e},_getOriginH3IndexFromUnidirectionalEdge:function(t,e){var n;return t|=0,b(0|((n=!0&268435456==(2013265920&(e|=0)|0))?-2130706433&e|134217728:0)),0|(n?t:0)},_getRes0Indexes:function(t){t|=0;var e=0,n=0,i=0;e=0;do{ve(0|e,0,45),i=134225919|x(),r[(n=t+(e<<3)|0)>>2]=-1,r[n+4>>2]=i,e=e+1|0}while(122!=(0|e))},_h3Distance:function(t,e,n,i){var r,a,o;return n|=0,i|=0,o=C,C=C+32|0,a=o,t=0==(0|Ht(t|=0,e|=0,t,e,r=o+12|0))&&0==(0|Ht(t,e,n,i,a))?0|lt(r,a):-1,C=o,0|t},_h3GetBaseCell:function(t,e){return e=0|de(0|(t|=0),0|(e|=0),45),x(),127&e|0},_h3IndexesAreNeighbors:Nt,_h3IsPentagon:Et,_h3IsResClassIII:function(t,e){return e=0|de(0|(t|=0),0|(e|=0),52),x(),1&e|0},_h3IsValid:kt,_h3Line:function(t,e,n,i,a){n|=0,i|=0,a|=0;var o,s=0,l=0,c=0,h=0,f=0,p=0,A=0,d=0,v=0,g=0,m=0,y=0,_=0,b=0,x=0,w=0,S=0;if(o=C,C=C+48|0,l=o+12|0,w=o,0==(0|Ht(t|=0,e|=0,t,e,s=o+24|0))&&0==(0|Ht(t,e,n,i,l))){if((0|(x=0|lt(s,l)))<0)return C=o,0|(w=x);for(r[s>>2]=0,r[s+4>>2]=0,r[s+8>>2]=0,r[l>>2]=0,r[l+4>>2]=0,r[l+8>>2]=0,Ht(t,e,t,e,s),Ht(t,e,n,i,l),ft(s),ft(l),x?(v=+(0|x),b=s,n=p=0|r[s>>2],i=A=0|r[(y=s+4|0)>>2],s=d=0|r[(_=s+8|0)>>2],g=+((0|r[l>>2])-p|0)/v,m=+((0|r[l+4>>2])-A|0)/v,v=+((0|r[l+8>>2])-d|0)/v):(y=i=s+4|0,_=d=s+8|0,b=s,n=0|r[s>>2],i=0|r[i>>2],s=0|r[d>>2],g=0,m=0,v=0),r[w>>2]=n,r[(d=w+4|0)>>2]=i,r[(A=w+8|0)>>2]=s,p=0;;){S=g*(h=+(0|p))+ +(0|n),c=m*h+ +(0|r[y>>2]),h=v*h+ +(0|r[_>>2]),i=~~+ge(+S),l=~~+ge(+c),n=~~+ge(+h),S=+u(+(+(0|i)-S)),c=+u(+(+(0|l)-c)),h=+u(+(+(0|n)-h));do{if(!(S>c&S>h)){if(f=0-i|0,c>h){s=f-n|0;break}s=l,n=f-l|0;break}i=0-(l+n)|0,s=l}while(0);if(r[w>>2]=i,r[d>>2]=s,r[A>>2]=n,pt(w),qt(t,e,w,a+(p<<3)|0),(0|p)==(0|x))break;p=p+1|0,n=0|r[b>>2]}return C=o,0|(w=0)}return C=o,0|(w=-1)},_h3LineSize:function(t,e,n,i){var r,a,o;return n|=0,i|=0,o=C,C=C+32|0,a=o,t=0==(0|Ht(t|=0,e|=0,t,e,r=o+12|0))&&0==(0|Ht(t,e,n,i,a))?0|lt(r,a):-1,C=o,(t>>>31^1)+t|0},_h3SetToLinkedGeo:function(t,e,n){n|=0;var i,a,o,s=0;if(o=C,C=C+32|0,i=o,function(t,e,n){t|=0,n|=0;var i,a,o=0,s=0,u=0,l=0,c=0;if(a=C,C=C+176|0,i=a,(0|(e|=0))<1)return te(n,0,0),void(C=a);l=0|de(0|r[(l=t)>>2],0|r[l+4>>2],52),x(),te(n,(0|e)>6?e:6,15&l),l=0;do{if(Ft(0|r[(o=t+(l<<3)|0)>>2],0|r[o+4>>2],i),(0|(o=0|r[i>>2]))>0){c=0;do{u=i+8+(c<<4)|0,(s=0|ae(n,o=i+8+(((0|(c=c+1|0))%(0|o)|0)<<4)|0,u))?ie(n,s):re(n,u,o),o=0|r[i>>2]}while((0|c)<(0|o))}l=l+1|0}while((0|l)!=(0|e));C=a}(t|=0,e|=0,a=o+16|0),r[n>>2]=0,r[n+4>>2]=0,r[n+8>>2]=0,!(t=0|ne(a)))return Gt(n),ee(a),void(C=o);do{e=0|Ut(n);do{Vt(e,t),s=t+16|0,r[i>>2]=r[s>>2],r[i+4>>2]=r[s+4>>2],r[i+8>>2]=r[s+8>>2],r[i+12>>2]=r[s+12>>2],ie(a,t),t=0|oe(a,i)}while(0!=(0|t));t=0|ne(a)}while(0!=(0|t));Gt(n),ee(a),C=o},_h3ToChildren:Pt,_h3ToGeo:Rt,_h3ToGeoBoundary:Ft,_h3ToParent:Ot,_h3UnidirectionalEdgeIsValid:function(t,e){var n=0;if(!(!0&268435456==(2013265920&(e|=0)|0)))return 0|(n=0);switch(n=0|de(0|(t|=0),0|e,56),x(),7&n){case 0:case 7:return 0|(n=0)}return!0&16777216==(117440512&e|0)&0!=(0|Et(t,n=-2130706433&e|134217728))?0|(n=0):0|(n=0|kt(t,n))},_hexAreaKm2:function(t){return+ +a[20496+((t|=0)<<3)>>3]},_hexAreaM2:function(t){return+ +a[20624+((t|=0)<<3)>>3]},_hexRing:function(t,e,n,i){t|=0,e|=0,i|=0;var a,o=0,s=0,u=0,l=0,c=0,h=0,f=0;if(a=C,C=C+16|0,f=a,!(n|=0))return r[(f=i)>>2]=t,r[f+4>>2]=e,C=a,0|(f=0);r[f>>2]=0;t:do{if(0|Et(t,e))t=1;else{if(s=(0|n)>0){o=0,h=t;do{if(0==(0|(h=0|L(h,e,4,f)))&0==(0|(e=0|x()))){t=2;break t}if(o=o+1|0,0|Et(h,e)){t=1;break t}}while((0|o)<(0|n));if(r[(c=i)>>2]=h,r[c+4>>2]=e,c=n+-1|0,s){s=0,u=1,o=h,t=e;do{if(0==(0|(o=0|L(o,t,2,f)))&0==(0|(t=0|x()))){t=2;break t}if(r[(l=i+(u<<3)|0)>>2]=o,r[l+4>>2]=t,u=u+1|0,0|Et(o,t)){t=1;break t}s=s+1|0}while((0|s)<(0|n));l=0,s=u;do{if(0==(0|(o=0|L(o,t,3,f)))&0==(0|(t=0|x()))){t=2;break t}if(r[(u=i+(s<<3)|0)>>2]=o,r[u+4>>2]=t,s=s+1|0,0|Et(o,t)){t=1;break t}l=l+1|0}while((0|l)<(0|n));u=0;do{if(0==(0|(o=0|L(o,t,1,f)))&0==(0|(t=0|x()))){t=2;break t}if(r[(l=i+(s<<3)|0)>>2]=o,r[l+4>>2]=t,s=s+1|0,0|Et(o,t)){t=1;break t}u=u+1|0}while((0|u)<(0|n));u=0;do{if(0==(0|(o=0|L(o,t,5,f)))&0==(0|(t=0|x()))){t=2;break t}if(r[(l=i+(s<<3)|0)>>2]=o,r[l+4>>2]=t,s=s+1|0,0|Et(o,t)){t=1;break t}u=u+1|0}while((0|u)<(0|n));u=0;do{if(0==(0|(o=0|L(o,t,4,f)))&0==(0|(t=0|x()))){t=2;break t}if(r[(l=i+(s<<3)|0)>>2]=o,r[l+4>>2]=t,s=s+1|0,0|Et(o,t)){t=1;break t}u=u+1|0}while((0|u)<(0|n));for(u=0;;){if(0==(0|(o=0|L(o,t,6,f)))&0==(0|(t=0|x()))){t=2;break t}if((0|u)!=(0|c)){if(r[(l=i+(s<<3)|0)>>2]=o,r[l+4>>2]=t,0|Et(o,t)){t=1;break t}s=s+1|0}if((0|(u=u+1|0))>=(0|n)){u=h,s=e;break}}}else u=h,o=h,s=e,t=e}else r[(u=i)>>2]=t,r[u+4>>2]=e,u=t,o=t,s=e,t=e;t=1&((0|u)!=(0|o)|(0|s)!=(0|t))}}while(0);return C=a,0|(f=t)},_i64Subtract:he,_kRing:T,_kRingDistances:function(t,e,n,i,r){var a;t|=0,e|=0,i|=0,r|=0,a=1+(0|y(3*(n|=0)|0,n+1|0))|0,0|M(t,e,n,i,r)&&(ye(0|i,0,a<<3|0),ye(0|r,0,a<<2|0),j(t,e,n,i,r,a,0))},_llvm_round_f64:ge,_malloc:se,_maxH3ToChildrenSize:function(t,e,n){return n|=0,t=0|de(0|(t|=0),0|(e|=0),52),x(),(0|(t&=15))>(0|n)?0|(n=0):0|(n=0|Zt(7,n-t|0))},_maxKringSize:function(t){return 1+(0|y(3*(t|=0)|0,t+1|0))|0},_maxPolyfillSize:function(t,e){var n,i;return e|=0,n=C,C=C+32|0,Qt(t|=0,i=n),e=0|G(i,e),e=1+(0|y(3*e|0,e+1|0))|0,C=n,0|e},_maxUncompactSize:function(t,e,n){t|=0,n|=0;var i=0,a=0,o=0,s=0;if((0|(e|=0))<=0)return 0|(n=0);i=0,s=0;t:for(;;){o=0|r[(a=t+(s<<3)|0)>>2],a=0|r[a+4>>2];do{if(!(0==(0|o)&0==(0|a))){if(a=0|de(0|o,0|a,52),x(),(0|(a&=15))>(0|n)){i=-1,a=9;break t}if((0|a)==(0|n)){i=i+1|0;break}i=(0|Zt(7,n-a|0))+i|0;break}}while(0);if((0|(s=s+1|0))>=(0|e)){a=9;break}}return 9==(0|a)?0|i:0},_memcpy:me,_memset:ye,_numHexagons:function(t){var e;return t=0|r[(e=21008+((t|=0)<<3)|0)>>2],b(0|r[e+4>>2]),0|t},_polyfill:function(t,e,n){e|=0,n|=0;var i,o,s,l,c=0,h=0,f=0,p=0,A=0,d=0;if(l=C,C=C+32|0,c=l+16|0,o=l,(s=0|se(32+(r[8+(t|=0)>>2]<<5)|0))||w(22551,22160,672,22168),function(t,e){e|=0;var n=0,i=0,o=0,s=0,l=0,c=0,h=0,f=0,p=0,A=0,d=0,v=0,g=0,m=0,y=0,_=0,b=0,x=0,w=0,S=0,k=0,O=0;if(g=0|r[(t|=0)>>2]){if(a[(m=e+8|0)>>3]=1.7976931348623157e308,a[(y=e+24|0)>>3]=1.7976931348623157e308,a[e>>3]=-1.7976931348623157e308,a[(_=e+16|0)>>3]=-1.7976931348623157e308,(0|g)>0){for(o=0|r[t+4>>2],d=1.7976931348623157e308,v=-1.7976931348623157e308,i=0,n=-1,h=1.7976931348623157e308,f=1.7976931348623157e308,A=-1.7976931348623157e308,l=-1.7976931348623157e308,b=0;s=+a[o+(b<<4)>>3],p=+a[o+(b<<4)+8>>3],c=+a[o+(((0|(k=n+2|0))==(0|g)?0:k)<<4)+8>>3],s<h&&(a[m>>3]=s,h=s),p<f&&(a[y>>3]=p,f=p),s>A?a[e>>3]=s:s=A,p>l&&(a[_>>3]=p,l=p),d=p>0&p<d?p:d,v=p<0&p>v?p:v,i|=+u(+(p-c))>3.141592653589793,(0|(n=b+1|0))!=(0|g);)k=b,A=s,b=n,n=k;i&&(a[_>>3]=v,a[y>>3]=d)}}else r[e>>2]=0,r[e+4>>2]=0,r[e+8>>2]=0,r[e+12>>2]=0,r[e+16>>2]=0,r[e+20>>2]=0,r[e+24>>2]=0,r[e+28>>2]=0;if(!((0|(n=0|r[(k=t+8|0)>>2]))<=0)){S=t+12|0,w=0;do{if(o=0|r[S>>2],i=w,y=e+((w=w+1|0)<<5)|0,_=0|r[o+(i<<3)>>2]){if(a[(b=e+(w<<5)+8|0)>>3]=1.7976931348623157e308,a[(t=e+(w<<5)+24|0)>>3]=1.7976931348623157e308,a[y>>3]=-1.7976931348623157e308,a[(x=e+(w<<5)+16|0)>>3]=-1.7976931348623157e308,(0|_)>0){for(g=0|r[o+(i<<3)+4>>2],d=1.7976931348623157e308,v=-1.7976931348623157e308,o=0,i=-1,m=0,h=1.7976931348623157e308,f=1.7976931348623157e308,p=-1.7976931348623157e308,l=-1.7976931348623157e308;s=+a[g+(m<<4)>>3],A=+a[g+(m<<4)+8>>3],c=+a[g+(((0|(i=i+2|0))==(0|_)?0:i)<<4)+8>>3],s<h&&(a[b>>3]=s,h=s),A<f&&(a[t>>3]=A,f=A),s>p?a[y>>3]=s:s=p,A>l&&(a[x>>3]=A,l=A),d=A>0&A<d?A:d,v=A<0&A>v?A:v,o|=+u(+(A-c))>3.141592653589793,(0|(i=m+1|0))!=(0|_);)O=m,m=i,p=s,i=O;o&&(a[x>>3]=v,a[t>>3]=d)}}else r[y>>2]=0,r[y+4>>2]=0,r[y+8>>2]=0,r[y+12>>2]=0,r[y+16>>2]=0,r[y+20>>2]=0,r[y+24>>2]=0,r[y+28>>2]=0,n=0|r[k>>2]}while((0|w)<(0|n))}}(t,s),p=0|G(s,e),i=1+(A=0|y(3*p|0,p+1|0))|0,function(t,e){t|=0;var n=0,i=0;a[(e|=0)>>3]=.5*(+a[t>>3]+ +a[t+8>>3]),n=+a[t+16>>3],i=+a[t+24>>3],n=+wt(.5*(i+(n<i?n+6.283185307179586:n))),a[e+8>>3]=n}(s,c),0|M(e=0|zt(c,e),c=0|x(),p,n,f=0|se(h=i<<2))&&(ye(0|n,0,i<<3|0),ye(0|f,0,0|h),j(e,c,p,n,f,i,0)),ue(f),(0|A)<0)return ue(s),void(C=l);c=o+8|0,e=0;do{0==(0|(f=0|r[(p=h=n+(e<<3)|0)>>2]))&0==(0|(p=0|r[p+4>>2]))||(Rt(f,p,o),d=+xt(+a[o>>3]),a[o>>3]=d,d=+wt(+a[c>>3]),a[c>>3]=d,0|Yt(t,s,o))||(r[(A=h)>>2]=0,r[A+4>>2]=0),e=e+1|0}while((0|e)!=(0|i));ue(s),C=l},_res0IndexCount:function(){return 122},_round:_e,_sbrk:be,_sizeOfCoordIJ:function(){return 8},_sizeOfGeoBoundary:function(){return 168},_sizeOfGeoCoord:function(){return 16},_sizeOfGeoPolygon:function(){return 16},_sizeOfGeofence:function(){return 8},_sizeOfH3Index:function(){return 8},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompact:function(t,e,n,i,a){t|=0,n|=0,i|=0,a|=0;var o=0,s=0,u=0,l=0,c=0,h=0;if((0|(e|=0))<=0)return 0|(a=0);o=0,h=0;t:for(;;){if((0|o)>=(0|i)){o=-1,s=11;break}s=0|r[(u=c=t+(h<<3)|0)>>2],u=0|r[u+4>>2];do{if(!(0==(0|s)&0==(0|u))){if(l=0|de(0|s,0|u,52),x(),(0|(l&=15))>(0|a)){o=-2,s=11;break t}if((0|l)==(0|a)){r[(c=n+(o<<3)|0)>>2]=s,r[c+4>>2]=u,o=o+1|0;break}if((0|(s=(0|Zt(7,a-l|0))+o|0))>(0|i)){o=-1,s=11;break t}Pt(0|r[c>>2],0|r[c+4>>2],a,n+(o<<3)|0),o=s}}while(0);if((0|(h=h+1|0))>=(0|e)){o=0,s=11;break}}return 11==(0|s)?0|o:0},establishStackSpace:function(t,e){C=t|=0},stackAlloc:function(t){var e;return e=C,C=15+(C=C+(t|=0)|0)&-16,0|e},stackRestore:function(t){C=t|=0},stackSave:function(){return 0|C}}}({Math:Math,Int8Array:Int8Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Float32Array:Float32Array,Float64Array:Float64Array},{a:et,b:function(t){s=t},c:u,d:function(t,e,n,i){et("Assertion failed: "+p(t)+", at: "+[e?p(e):"unknown filename",n,i?p(i):"unknown function"])},e:function(t){return n.___errno_location&&(m[n.___errno_location()>>2]=t),t},f:N,g:function(t,e,n){v.set(v.subarray(e,e+n),t)},h:function(t){var e=N();if(t>2130706432)return!1;for(var i=Math.max(e,16777216);i<t;)i=i<=536870912?b(2*i,16777216):Math.min(b((3*i+2147483648)/4,16777216),2130706432);var r,a=U(i);return!(!a||a.byteLength!=i||(r=a,n.buffer=A=r,x(),w=i,0))},i:function(t){et("OOM")},j:U,k:23792,l:23552},A),q=(n.___uremdi3=H.___uremdi3,n._bitshift64Lshr=H._bitshift64Lshr,n._bitshift64Shl=H._bitshift64Shl,n._calloc=H._calloc,n._compact=H._compact,n._destroyLinkedPolygon=H._destroyLinkedPolygon,n._edgeLengthKm=H._edgeLengthKm,n._edgeLengthM=H._edgeLengthM,n._emscripten_replace_memory=H._emscripten_replace_memory,n._experimentalH3ToLocalIj=H._experimentalH3ToLocalIj,n._experimentalLocalIjToH3=H._experimentalLocalIjToH3,n._free=H._free,n._geoToH3=H._geoToH3,n._getDestinationH3IndexFromUnidirectionalEdge=H._getDestinationH3IndexFromUnidirectionalEdge,n._getH3IndexesFromUnidirectionalEdge=H._getH3IndexesFromUnidirectionalEdge,n._getH3UnidirectionalEdge=H._getH3UnidirectionalEdge,n._getH3UnidirectionalEdgeBoundary=H._getH3UnidirectionalEdgeBoundary,n._getH3UnidirectionalEdgesFromHexagon=H._getH3UnidirectionalEdgesFromHexagon,n._getOriginH3IndexFromUnidirectionalEdge=H._getOriginH3IndexFromUnidirectionalEdge,n._getRes0Indexes=H._getRes0Indexes,n._h3Distance=H._h3Distance,n._h3GetBaseCell=H._h3GetBaseCell,n._h3IndexesAreNeighbors=H._h3IndexesAreNeighbors,n._h3IsPentagon=H._h3IsPentagon,n._h3IsResClassIII=H._h3IsResClassIII,n._h3IsValid=H._h3IsValid,n._h3Line=H._h3Line,n._h3LineSize=H._h3LineSize,n._h3SetToLinkedGeo=H._h3SetToLinkedGeo,n._h3ToChildren=H._h3ToChildren,n._h3ToGeo=H._h3ToGeo,n._h3ToGeoBoundary=H._h3ToGeoBoundary,n._h3ToParent=H._h3ToParent,n._h3UnidirectionalEdgeIsValid=H._h3UnidirectionalEdgeIsValid,n._hexAreaKm2=H._hexAreaKm2,n._hexAreaM2=H._hexAreaM2,n._hexRing=H._hexRing,n._i64Subtract=H._i64Subtract,n._kRing=H._kRing,n._kRingDistances=H._kRingDistances,n._llvm_round_f64=H._llvm_round_f64,n._malloc=H._malloc,n._maxH3ToChildrenSize=H._maxH3ToChildrenSize,n._maxKringSize=H._maxKringSize,n._maxPolyfillSize=H._maxPolyfillSize,n._maxUncompactSize=H._maxUncompactSize,n._memcpy=H._memcpy,n._memset=H._memset,n._numHexagons=H._numHexagons,n._polyfill=H._polyfill,n._res0IndexCount=H._res0IndexCount,n._round=H._round,n._sbrk=H._sbrk,n._sizeOfCoordIJ=H._sizeOfCoordIJ,n._sizeOfGeoBoundary=H._sizeOfGeoBoundary,n._sizeOfGeoCoord=H._sizeOfGeoCoord,n._sizeOfGeoPolygon=H._sizeOfGeoPolygon,n._sizeOfGeofence=H._sizeOfGeofence,n._sizeOfH3Index=H._sizeOfH3Index,n._sizeOfLinkedGeoPolygon=H._sizeOfLinkedGeoPolygon,n._uncompact=H._uncompact,n.establishStackSpace=H.establishStackSpace,n.stackAlloc=H.stackAlloc),Z=n.stackRestore=H.stackRestore,X=n.stackSave=H.stackSave;if(n.asm=H,n.cwrap=function(t,e,n,i){var r=(n=n||[]).every(function(t){return"number"===t});return"string"!==e&&r&&!i?c(t):function(){return h(t,e,n,arguments)}},n.setValue=function(t,e,n,i){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":d[t>>0]=e;break;case"i16":g[t>>1]=e;break;case"i32":m[t>>2]=e;break;case"i64":tempI64=[e>>>0,(tempDouble=e,+T(tempDouble)>=1?tempDouble>0?(0|L(+j(tempDouble/4294967296),4294967295))>>>0:~~+M((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],m[t>>2]=tempI64[0],m[t+4>>2]=tempI64[1];break;case"float":y[t>>2]=e;break;case"double":_[t>>3]=e;break;default:et("invalid type for setValue: "+n)}},n.getValue=function(t,e,n){switch("*"===(e=e||"i8").charAt(e.length-1)&&(e="i32"),e){case"i1":case"i8":return d[t>>0];case"i16":return g[t>>1];case"i32":case"i64":return m[t>>2];case"float":return y[t>>2];case"double":return _[t>>3];default:et("invalid type for getValue: "+e)}return null},n.getTempRet0=u,B){F(B)||(W=B,B=n.locateFile?n.locateFile(W,r):r+W),I++,n.monitorRunDependencies&&n.monitorRunDependencies(I);var Q=function(t){t.byteLength&&(t=new Uint8Array(t)),v.set(t,8),n.memoryInitializerRequest&&delete n.memoryInitializerRequest.response,function(t){if(I--,n.monitorRunDependencies&&n.monitorRunDependencies(I),0==I&&(null!==z&&(clearInterval(z),z=null),D)){var e=D;D=null,e()}}()},Y=function(){n.readAsync(B,Q,function(){throw"could not load memory initializer "+B})},K=G(B);if(K)Q(K.buffer);else if(n.memoryInitializerRequest){var J=function(){var t=n.memoryInitializerRequest,e=t.response;if(200!==t.status&&0!==t.status){var i=G(n.memoryInitializerRequestURL);if(!i)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+t.status+", retrying "+B),void Y();e=i.buffer}Q(e)};n.memoryInitializerRequest.response?setTimeout(J,0):n.memoryInitializerRequest.addEventListener("load",J)}else Y()}function $(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function tt(t){function e(){n.calledRun||(n.calledRun=!0,l||(C||(C=!0,S(O)),S(P),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)t=n.postRun.shift(),E.unshift(t);var t;S(E)}()))}t=t||n.arguments,I>0||(!function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)t=n.preRun.shift(),k.unshift(t);var t;S(k)}(),I>0||n.calledRun||(n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),e()},1)):e()))}function et(t){throw n.onAbort&&n.onAbort(t),void 0!==t?(a(t),o(t),t=JSON.stringify(t)):t="",l=!0,"abort("+t+"). Build with -s ASSERTIONS=1 for more info."}if($.prototype=new Error,$.prototype.constructor=$,D=function t(){n.calledRun||tt(),n.calledRun||(D=t)},n.run=tt,n.abort=et,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return n.noExitRuntime=!0,tt(),t}("object"==typeof Bs?Bs:{}),Rs="number",Fs={};[["sizeOfH3Index",Rs],["sizeOfGeoCoord",Rs],["sizeOfGeoBoundary",Rs],["sizeOfGeoPolygon",Rs],["sizeOfGeofence",Rs],["sizeOfLinkedGeoPolygon",Rs],["sizeOfCoordIJ",Rs],["h3IsValid","number",["number","number"]],["geoToH3","number",[Rs,Rs,"number"]],["h3ToGeo",null,["number","number",Rs]],["h3ToGeoBoundary",null,["number","number",Rs]],["maxKringSize",Rs,[Rs]],["kRing",null,["number","number",Rs,Rs]],["kRingDistances",null,["number","number",Rs,Rs,Rs]],["hexRing",null,["number","number",Rs,Rs]],["maxPolyfillSize",Rs,[Rs,"number"]],["polyfill",null,[Rs,"number",Rs]],["h3SetToLinkedGeo",null,[Rs,Rs,Rs]],["destroyLinkedPolygon",null,[Rs]],["compact",Rs,[Rs,Rs,Rs]],["uncompact",Rs,[Rs,Rs,Rs,Rs,"number"]],["maxUncompactSize",Rs,[Rs,Rs,"number"]],["h3IsPentagon","number",["number","number"]],["h3IsResClassIII","number",["number","number"]],["h3GetBaseCell",Rs,["number","number"]],["h3ToParent","number",["number","number","number"]],["h3ToChildren",null,["number","number","number",Rs]],["maxH3ToChildrenSize",Rs,["number","number","number"]],["h3IndexesAreNeighbors","number",["number","number","number","number"]],["getH3UnidirectionalEdge","number",["number","number","number","number"]],["getOriginH3IndexFromUnidirectionalEdge","number",["number","number"]],["getDestinationH3IndexFromUnidirectionalEdge","number",["number","number"]],["h3UnidirectionalEdgeIsValid","number",["number","number"]],["getH3IndexesFromUnidirectionalEdge",null,["number","number",Rs]],["getH3UnidirectionalEdgesFromHexagon",null,["number","number",Rs]],["getH3UnidirectionalEdgeBoundary",null,["number","number",Rs]],["h3Distance",Rs,["number","number","number","number"]],["h3Line",Rs,["number","number","number","number",Rs]],["h3LineSize",Rs,["number","number","number","number"]],["experimentalH3ToLocalIj",Rs,["number","number","number","number",Rs]],["experimentalLocalIjToH3",Rs,["number","number",Rs,Rs]],["hexAreaM2",Rs,["number"]],["hexAreaKm2",Rs,["number"]],["edgeLengthM",Rs,["number"]],["edgeLengthKm",Rs,["number"]],["numHexagons",Rs,["number"]],["getRes0Indexes",null,[Rs]],["res0IndexCount",Rs]].forEach(function(t){Fs[t[0]]=Bs.cwrap.apply(Bs,t)});var Ns=16,Us=4,Vs=4,Gs=8,Ws=Fs.sizeOfH3Index(),Hs=Fs.sizeOfGeoCoord(),qs=Fs.sizeOfGeoBoundary(),Zs=(Fs.sizeOfGeoPolygon(),Fs.sizeOfGeofence(),Fs.sizeOfLinkedGeoPolygon()),Xs=(Fs.sizeOfCoordIJ(),{m:"m",km:"km",m2:"m2",km2:"km2"});function Qs(t){if("number"!=typeof t||t<0||t>15||Math.floor(t)!==t)throw new Error("Invalid resolution: "+t)}function Ys(t){if("string"!=typeof t)return[0,0];var e=parseInt(t.substring(0,t.length-8),Ns);return[parseInt(t.substring(t.length-8),Ns),e]}function Ks(t){if(t>=0)return t.toString(Ns);var e=$s(8,(t&=2147483647).toString(Ns));return e=(parseInt(e[0],Ns)+8).toString(Ns)+e.substring(1)}function Js(t,e){return Ks(e)+$s(8,Ks(t))}function $s(t,e){for(var n=t-e.length,i="",r=0;r<n;r++)i+="0";return i+=e}function tu(t){return[t,Bs.getTempRet0()]}function eu(t){var e=tu(t),n=e[0],i=e[1];return i?Js(n,i):null}function nu(t,e,n){Bs.HEAPU32.set(Ys(t),e/Us+2*n)}function iu(t,e){for(var n=e.length,i=0;i<n;i++)nu(e[i],t,i)}function ru(t){return 180*Bs.getValue(t,"double")/Math.PI}function au(t){return[ru(t),ru(t+Gs)]}function ou(t){return[ru(t+Gs),ru(t)]}function su(t,e,n){for(var i=Bs.getValue(t,"i32"),r=t+Gs,a=[],o=e?ou:au,s=0;s<2*i;s+=2)a.push(o(r+Gs*s));return n&&a.push(a[0]),a}function uu(t){var e=Ys(t),n=e[0],i=e[1];return Boolean(Fs.h3IsPentagon(n,i))}function lu(t){var e=Bs._malloc(Hs),n=Ys(t),i=n[0],r=n[1];Fs.h3ToGeo(i,r,e);var a=au(e);return Bs._free(e),a}function cu(t,e){if(!t||!t.length)return[];var n=t.length,i=Bs._calloc(n,Ws);iu(i,t);var r=Bs._calloc(Zs),a=r;Fs.h3SetToLinkedGeo(i,n,r);var o=function(t,e){for(var n,i,r,a,o=[],s=e?ou:au;t;){for(o.push(n=[]),i=Bs.getValue(t,"i8*");i;){for(n.push(r=[]),a=Bs.getValue(i,"i8*");a;)r.push(s(a)),a=Bs.getValue(a+2*Gs,"i8*");e&&r.push(r[0]),i=Bs.getValue(i+2*Vs,"i8*")}t=Bs.getValue(t+2*Vs,"i8*")}return o}(r,e);return Fs.destroyLinkedPolygon(a),Bs._free(a),Bs._free(i),o}function hu(t,e){switch(Qs(t),e){case Xs.m:return Fs.edgeLengthM(t);case Xs.km:return Fs.edgeLengthKm(t);default:throw new Error("Unknown unit: "+e)}}function fu(t){return t*Math.PI/180}var pu=Object.assign({getHexagons:{type:"accessor",value:function(t){return t.hexagons}}},Go.defaultProps),Au=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"updateState",value:function(t){var e=t.props,n=(t.oldProps,t.changeFlags);if(n.dataChanged||n.updateTriggers&&n.updateTriggers.getHexagons){var i=e.data,r=e.getHexagons,a=[],o=ot(i),s=o.iterable,u=o.objectInfo,l=!0,c=!1,h=void 0;try{for(var f,p=s[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var A=f.value;u.index++;var d=cu(r(A,u),!0),v=!0,g=!1,m=void 0;try{for(var y,_=d[Symbol.iterator]();!(v=(y=_.next()).done);v=!0){var b=y.value;a.push({polygon:b,_obj:A,_idx:u.index})}}catch(x){g=!0,m=x}finally{try{v||null==_.return||_.return()}finally{if(g)throw m}}}}catch(x){c=!0,h=x}finally{try{l||null==p.return||p.return()}finally{if(c)throw h}}this.setState({polygons:a})}}},{key:"getPickingInfo",value:function(t){var e=t.info;return Object.assign(e,{object:e.object&&e.object._obj,index:e.object&&e.object._idx})}},{key:"getSubLayerAccessor",value:function(t){return"function"!=typeof t?t:function(e,n){return t(e._obj,n)}}},{key:"renderLayers",value:function(){var t=this.props,e=t.elevationScale,n=t.extruded,i=t.wireframe,r=t.filled,a=t.stroked,o=t.lineWidthScale,s=t.lineWidthMinPixels,u=t.lineWidthMaxPixels,l=t.lineJointRounded,c=t.lineMiterLimit,h=t.lineDashJustified,f=t.fp64,p=t.material,A=t.getFillColor,d=t.getLineColor,v=t.getLineWidth,g=t.getLineDashArray,m=t.getElevation,y=t.updateTriggers;return new(this.getSubLayerClass("cluster-region",Go))({fp64:f,filled:r,wireframe:i,extruded:n,elevationScale:e,stroked:a,lineWidthScale:o,lineWidthMinPixels:s,lineWidthMaxPixels:u,lineJointRounded:l,lineMiterLimit:c,lineDashJustified:h,material:p,getFillColor:this.getSubLayerAccessor(A),getLineColor:this.getSubLayerAccessor(d),getLineWidth:this.getSubLayerAccessor(v),getLineDashArray:this.getSubLayerAccessor(g),getElevation:this.getSubLayerAccessor(m)},this.getSubLayerProps({id:"cluster-region",updateTriggers:y}),{data:this.state.polygons,getPolygon:function(t){return t.polygon}})}}]),e}(yn);Au.defaultProps=pu,Au.layerName="H3ClusterLayer";function du(t,e){e=void 0===e?t[0][0]:e;var n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=s[0]-e;u>180?s[0]-=360:u<-180&&(s[0]+=360)}}catch(l){i=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}function vu(t,e,n){var i=lu(t(e,n)),r=Object(N.a)(i,2),a=r[0];return[r[1],a]}function gu(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=function(t,e){var n=Bs._malloc(qs),i=Ys(t),r=i[0],a=i[1];Fs.h3ToGeoBoundary(r,a,n);var o=su(n,e,e);return Bs._free(n),o}(t,!0);return 1!==e?function(t,e,n){var i=lu(t),r=Object(N.a)(i,2),a=r[0],o=r[1],s=e.length;du(e,o);for(var u=e[0]===e[s-1]?s-1:s,l=0;l<u;l++)e[l][0]=Object(ce.g)(o,e[l][0],n),e[l][1]=Object(ce.g)(a,e[l][1],n)}(t,n,e):du(n),n}var mu=Object.assign({},Go.defaultProps,{highPrecision:!1,coverage:{type:"number",min:0,max:1,value:1},getHexagon:{type:"accessor",value:function(t){return t.hexagon}},extruded:!0,getColor:null}),yu=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"shouldUpdateState",value:function(t){var e=t.changeFlags;return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}},{key:"updateState",value:function(t){var e,n=t.props,i=(t.oldProps,t.changeFlags);if(i.dataChanged||i.updateTriggers&&i.updateTriggers.getHexagon){var r=-1,a=!1,o=ot(n.data),s=o.iterable,u=o.objectInfo,l=!0,c=!1,h=void 0;try{for(var f,p=s[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var A=f.value;u.index++;var d=n.getHexagon(A,u);if(r=r<0?"string"!=typeof(e=d)?-1:parseInt(e.charAt(1),Ns):r,uu(d)){a=!0;break}}}catch(v){c=!0,h=v}finally{try{l||null==p.return||p.return()}finally{if(c)throw h}}this.setState({resolution:r,edgeLengthKM:r>=0?hu(r,Xs.km):0,hasPentagon:a,vertices:null})}this._updateVertices(this.context.viewport)}},{key:"_shouldUseHighPrecision",value:function(){var t=this.state,e=t.resolution,n=t.hasPentagon;return this.props.highPrecision||n||e>=0&&e<=5}},{key:"_updateVertices",value:function(t){if(!this._shouldUseHighPrecision()){var e=this.state,n=e.resolution,i=e.edgeLengthKM,r=e.centerHex;if(!(n<0)){var a=function(t,e,n){var i=Bs._malloc(Hs);Bs.HEAPF64.set([t,e].map(fu),i/Gs);var r=eu(Fs.geoToH3(i,n));return Bs._free(i),r}(t.latitude,t.longitude,n);if(!(r===a||r&&(o=r,s=a,u=Ys(o),l=u[0],c=u[1],h=Ys(s),f=h[0],p=h[1],Fs.h3Distance(l,c,f,p)*i<10))){var o,s,u,l,c,h,f,p,A=t.distanceScales.pixelsPerMeter,d=gu(a),v=lu(a),g=Object(N.a)(v,2),m=g[0],y=g[1],_=t.projectFlat([y,m]),b=Object(N.a)(_,2),x=b[0],w=b[1];d=d.map(function(e){var n=t.projectFlat(e);return n[0]=(n[0]-x)/A[0],n[1]=(n[1]-w)/A[1],n}),this.setState({centerHex:a,vertices:d})}}}}},{key:"renderLayers",value:function(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}},{key:"_getForwardProps",value:function(){var t=this.props,e=t.elevationScale,n=t.fp64,i=t.material,r=t.coverage,a=t.extruded,o=t.wireframe,s=t.stroked,u=t.filled,l=t.lineWidthUnits,c=t.lineWidthScale,h=t.lineWidthMinPixels,f=t.lineWidthMaxPixels,p=t.getColor,A=t.getFillColor,d=t.getElevation,v=t.getLineColor,g=t.getLineWidth,m=t.updateTriggers;return{elevationScale:e,fp64:n,extruded:a,coverage:r,wireframe:o,stroked:s,filled:u,lineWidthUnits:l,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:f,material:i,getElevation:d,getFillColor:p||A,getLineColor:v,getLineWidth:g,updateTriggers:{getFillColor:m.getColor||m.getFillColor,getElevation:m.getElevation,getLineColor:m.getLineColor,getLineWidth:m.getLineWidth}}}},{key:"_renderPolygonLayer",value:function(){var t=this.props,e=t.data,n=t.getHexagon,i=t.updateTriggers,r=t.coverage,a=this.getSubLayerClass("hexagon-cell-hifi",Go),o=this._getForwardProps();return o.updateTriggers.getPolygon=function(t,e){return null==t?e:"object"===Object(It.a)(t)?Object.assign({},t,{coverage:e}):{getHexagon:t,coverage:e}}(i.getHexagon,r),new a(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:e,getPolygon:function(t,e){return gu(n(t,e),r)}})}},{key:"_renderColumnLayer",value:function(){var t=this.props,e=t.data,n=t.getHexagon,i=t.updateTriggers,r=this.getSubLayerClass("hexagon-cell",Ti),a=this._getForwardProps();return a.updateTriggers.getPosition=i.getHexagon,new r(a,this.getSubLayerProps({id:"hexagon-cell",updateTriggers:a.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:vu.bind(null,n)})}}]),e}(yn);yu.defaultProps=mu,yu.layerName="H3HexagonLayer";var _u=function(t){return"undefined"!=typeof window&&t instanceof window.Response||t.arrayBuffer&&t.text&&t.json},bu=function(t){return function(t){return"undefined"!=typeof File&&t instanceof File}(t)||function(t){return"undefined"!=typeof Blob&&t instanceof Blob}(t)},xu="",wu={};function Su(t){for(var e in wu)if(t.startsWith(e)){var n=wu[e];return t.replace(e,n)}return t+=xu}var ku=n("5a1V"),Ou=function(){function t(e){Object(T.a)(this,t),this._fileOrBlob=e,this.bodyUsed=!1}return Object(M.a)(t,[{key:"url",value:function(){return this._fileOrBlob.name||""}},{key:"arrayBuffer",value:function(){var t=Object(Ha.a)(Wa.a.mark(function t(){var e,n,i;return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._getFileReader(),n=e.reader,i=e.promise,n.readAsArrayBuffer(this._fileOrBlob),t.abrupt("return",i);case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"text",value:function(){var t=Object(Ha.a)(Wa.a.mark(function t(){var e,n,i;return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._getFileReader(),n=e.reader,i=e.promise,n.readAsText(this._fileOrBlob),t.abrupt("return",i);case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"json",value:function(){var t=Object(Ha.a)(Wa.a.mark(function t(){var e;return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.text();case 2:return e=t.sent,t.abrupt("return",JSON.parse(e));case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_getFileReader",value:function(){var t;Object(ku.a)(!this.bodyUsed),this.bodyUsed=!0;var e=new Promise(function(e,n){try{(t=new FileReader).onerror=function(t){return n(new Error(t))},t.onabort=function(){return n(new Error("Read aborted."))},t.onload=function(){return e(t.result)}}catch(i){n(i)}});return{reader:t,promise:e}}},{key:"headers",get:function(){return new Headers({"Content-Length":this._fileOrBlob.size,"Content-Type":this._fileOrBlob.type})}}]),t}();function Pu(t,e){return Promise.resolve(new Ou(t,e))}function Eu(t,e){return Cu.apply(this,arguments)}function Cu(){return(Cu=Object(Ha.a)(Wa.a.mark(function t(e,n){return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!bu(e)){t.next=2;break}return t.abrupt("return",Pu(e,n));case 2:return e=Su(e),t.abrupt("return",fetch(e,n));case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Tu(t){return!!t&&(Array.isArray(t)&&(t=t[0]),t.parseTextSync||t.parseSync||t.parse||t.loadAndParse||t.parseStream||t.parseInBatches||t.worker)}function Mu(t){var e;return Object(ku.a)(Tu(t)),Array.isArray(t)&&(e=(t=t[0])[1],t=Object(Si.a)({},t,{options:Object(Si.a)({},t.options,{options:e})})),t.extension&&(t.extensions=t.extensions||[t.extension],delete t.extension),Array.isArray(t.extensions)||(t.extensions=[t.extensions]),Object(ku.a)(t.extensions&&t.extensions.length>0&&t.extensions[0]),t.parseTextSync&&(t.text=!0),t.text||(t.binary=!0),t}var ju=function(){function t(){Object(T.a)(this,t)}return Object(M.a)(t,[{key:"log",value:function(){}},{key:"info",value:function(){}},{key:"warn",value:function(){}},{key:"error",value:function(){}}]),t}();function Lu(t,e){return null===(t=Object.assign({},e&&e.DEFAULT_OPTIONS,e&&e.defaultOptions,e&&e.options,t,{dataType:"arraybuffer"})).log&&(t.log=new ju),"log"in t||(t.log=console),t}var Iu=/[^.]+$/;function zu(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=t.match(Iu);if(i&&i[0]){var r=function(t,e){e=e.toLowerCase();var n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;Mu(s);var u=!0,l=!1,c=void 0;try{for(var h,f=s.extensions[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;if(p.toLowerCase()===e)return s}}catch(A){l=!0,c=A}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}}}catch(A){i=!0,r=A}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return null}(n,i[0]);if(r)return r}var a=function(t,e){var n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(s.testText&&s.testText(e))return s}}catch(u){i=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return null}(n,e);return a||null}var Du={};function Bu(){return Object.values(Du)}var Ru=n("Wb0s"),Fu=new Map;function Nu(t,e,n){var i=function(t){var e=Fu.get(t);if(!e){var n=new Blob([t],{type:"application/javascript"});e=URL.createObjectURL(n),Fu.set(t,e)}return new Worker(e)}(t);n=function(t){null!==(t=Object.assign({},t)).log&&delete t.log;return t}(n);var r=function(t,e){return new Promise(function(n,r){i.onmessage=function(t){switch(t.data.type){case"done":n(t.data.result),i.terminate();break;case"error":r(new Error(t.data.message))}};var a=Object(Ru.a)(t);i.postMessage({arraybuffer:a,opts:e},[a])})};return e?r(e,n):r}function Uu(t){this.wrapped=t}function Vu(t){var e,n;function i(e,n){try{var a=t[e](n),o=a.value,s=o instanceof Uu;Promise.resolve(s?o.wrapped:o).then(function(t){s?i("next",t):r(a.done?"return":"normal",t)},function(t){i("throw",t)})}catch(u){r("throw",u)}}function r(t,r){switch(t){case"return":e.resolve({value:r,done:!0});break;case"throw":e.reject(r);break;default:e.resolve({value:r,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(t,r){return new Promise(function(a,o){var s={key:t,arg:r,resolve:a,reject:o,next:null};n?n=n.next=s:(e=n=s,i(t,r))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(Vu.prototype[Symbol.asyncIterator]=function(){return this}),Vu.prototype.next=function(t){return this._invoke("next",t)},Vu.prototype.throw=function(t){return this._invoke("throw",t)},Vu.prototype.return=function(t){return this._invoke("return",t)};n("23rh");var Gu="Cannot convert supplied data type";function Wu(t){return _u(t)?t.url:null}function Hu(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){var n=t.buffer||t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}throw new Error(Gu)}function qu(t,e){return Zu.apply(this,arguments)}function Zu(){return(Zu=Object(Ha.a)(Wa.a.mark(function t(e,n){var i;return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:if(e=t.sent,i=e instanceof ArrayBuffer||ArrayBuffer.isView(e),"string"!=typeof e&&!i){t.next=6;break}return t.abrupt("return",Hu(e,n));case 6:if(!bu(e)){t.next=10;break}return t.next=9,Pu(e);case 9:e=t.sent;case 10:if(!_u(e)){t.next=19;break}if(!n.binary){t.next=17;break}return t.next=14,e.arrayBuffer();case 14:t.t0=t.sent,t.next=18;break;case 17:t.t0=e.text();case 18:return t.abrupt("return",t.t0);case 19:throw new Error(Gu);case 20:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Xu(t,e,n,i){return Qu.apply(this,arguments)}function Qu(){return(Qu=Object(Ha.a)(Wa.a.mark(function t(e,n,i,r){return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=r||Wu(e),t.next=3,qu(e,n);case 3:if(e=t.sent,!n.parseTextSync||"string"!=typeof e){t.next=7;break}return i.dataType="text",t.abrupt("return",n.parseTextSync(e,i,r,n));case 7:if(!n.parseSync){t.next=9;break}return t.abrupt("return",n.parseSync(e,i,r,n));case 9:if(!n.parse){t.next=13;break}return t.next=12,n.parse(e,i,r,n);case 12:return t.abrupt("return",t.sent);case 13:if(!n.worker){t.next=17;break}return t.next=16,Nu(n.worker,e,i);case 16:return t.abrupt("return",t.sent);case 17:return t.abrupt("return",Object(ku.a)(!1));case 18:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Yu(t,e,n,i){return Ku.apply(this,arguments)}function Ku(){return(Ku=Object(Ha.a)(Wa.a.mark(function t(e,n,i,r){var a,o;return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(n)||Tu(n)||(r=i,i=n,n=null),a=bu(r)?r.name:r,n=n||Bu(),o=Array.isArray(n)?zu(a,e,n):n){t.next=6;break}return t.abrupt("return",null);case 6:return Mu(o),i=Lu(i,o),t.next=10,Xu(e,o,i,a);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}},t)}))).apply(this,arguments)}function Ju(t,e,n){return $u.apply(this,arguments)}function $u(){return($u=Object(Ha.a)(Wa.a.mark(function t(e,n,i){var r,a,o;return Wa.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(n)||Tu(n)||(i=n,n=null),r=bu(e)?e.name:e,n=n||Bu(),a=Array.isArray(n)?zu(r,null,n):n,i=Lu(i,a),!a||!a.loadAndParse){t.next=9;break}return t.next=8,a.loadAndParse(e,i);case 8:return t.abrupt("return",t.sent);case 9:if(!bu(o=e)&&"string"!=typeof o){t.next=14;break}return t.next=13,Eu(e,i);case 13:o=t.sent;case 14:return t.abrupt("return",Yu(o,n,i,r));case 15:case"end":return t.stop()}},t)}))).apply(this,arguments)}var tl=Math.PI/180,el=new Float32Array(16),nl=new Float32Array(12);function il(t,e,n){var i=e[0]*tl,r=e[1]*tl,a=e[2]*tl,o=Math.sin(a),s=Math.sin(i),u=Math.sin(r),l=Math.cos(a),c=Math.cos(i),h=Math.cos(r),f=n[0],p=n[1],A=n[2];t[0]=f*h*c,t[1]=f*u*c,t[2]=f*-s,t[3]=p*(-u*l+h*s*o),t[4]=p*(h*l+u*s*o),t[5]=p*c*o,t[6]=A*(u*o+h*s*l),t[7]=A*(-h*o+u*s*l),t[8]=A*c*l}function rl(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}var al={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,stride:48,offset:0},instanceModelMatrix__LOCATION_1:{size:3,stride:48,offset:12},instanceModelMatrix__LOCATION_2:{size:3,stride:48,offset:24},instanceTranslation:{size:3,stride:48,offset:36}},update:function(t,e){var n=e.startRow,i=e.endRow,r=this.props,a=r.data,o=r.getOrientation,s=r.getScale,u=r.getTranslation,l=r.getTransformMatrix,c=Array.isArray(l),h=c&&16===l.length,f=Array.isArray(s),p=Array.isArray(o),A=Array.isArray(u),d=h||!c&&Boolean(l(a[0]));t.constant=d?h:p&&f&&A;var v=t.value;if(t.constant){var g;if(d)el.set(l),g=rl(el);else il(g=nl,o,s),g.set(u,9);t.value=new Float32Array(g)}else{var m=n*t.size,y=ot(a,n,i),_=y.iterable,b=y.objectInfo,x=!0,w=!1,S=void 0;try{for(var k,O=_[Symbol.iterator]();!(x=(k=O.next()).done);x=!0){var P=k.value;b.index++;var E=void 0;if(d)el.set(h?l:l(P,b)),E=rl(el);else il(E=nl,p?o:o(P,b),f?s:s(P,b)),E.set(A?u:u(P,b),9);v[m++]=E[0],v[m++]=E[1],v[m++]=E[2],v[m++]=E[3],v[m++]=E[4],v[m++]=E[5],v[m++]=E[6],v[m++]=E[7],v[m++]=E[8],v[m++]=E[9],v[m++]=E[10],v[m++]=E[11]}}catch(C){w=!0,S=C}finally{try{x||null==O.return||O.return()}finally{if(w)throw S}}}}},ol=a.fp64.fp64LowPart;function sl(t,e,n){return e instanceof a.Texture2D?e:new a.Texture2D(t,Object.assign({data:e},n))}function ul(t){!function(t,e){if(!t)throw new Error("deck.gl: ".concat(e))}(t.positions||t.POSITION,'SimpleMeshLayer requires "postions" or "POSITION" attribute in mesh property.')}function ll(t){if(t.attributes)return ul(t.attributes),t instanceof a.Geometry?t:new a.Geometry(t);if(t.positions||t.POSITION)return ul(t),new a.Geometry({attributes:t});throw Error("Invalid mesh")}var cl=new a.PhongMaterial,hl={fetch:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){return"mesh"===e.propName?Ju(t):fetch(t).then(function(t){return t.json()})}),mesh:{value:null,type:"object",async:!0},texture:null,sizeScale:{type:"number",value:1,min:0},parameters:{depthTest:!0,depthFunc:515},fp64:!1,wireframe:!1,material:cl,getPosition:{type:"accessor",value:function(t){return t.position}},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]}},fl=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"getShaders",value:function(){var t=this.use64bitProjection()?"project64":"project32",e=Object(a.isWebGL2)(this.context.gl);return{vs:e?"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec2 instancePositions64xy;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\n  pos = project_size(pos);\n\n  vTexCoord = texCoords;\n  cameraPosition = project_uCameraPosition;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  vColor = instanceColors;\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xy, pos, position_commonspace);\n\n  picking_setPickingColor(instancePickingColors);\n}\n":"\n#define SHADER_NAME simple-mesh-layer-vs\n\n// Scale the model\nuniform float sizeScale;\n\n// Primitive attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec2 texCoords;\n\n// Instance attributes\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xy;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute mat3 instanceModelMatrix;\nattribute vec3 instanceTranslation;\n\n// Outputs to fragment shader\nvarying vec2 vTexCoord;\nvarying vec3 cameraPosition;\nvarying vec3 normals_commonspace;\nvarying vec4 position_commonspace;\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\n  pos = project_size(pos);\n\n  vTexCoord = texCoords;\n  cameraPosition = project_uCameraPosition;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  vColor = instanceColors;\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xy, pos, position_commonspace);\n\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:e?"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform vec4 color;\nuniform bool flatShading;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec3 normal;\n  if (flatShading) {\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor / 255.;\n  vec3 lightColor = lighting_getLightColor(color.rgb * 255., cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor / 255., color.a);\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n}\n":"\n#define SHADER_NAME simple-mesh-layer-fs\n\n// Note(Tarek): headless-gl supports derivatives, but doesn't report it via getExtension. Awesome!\n#ifdef DERIVATIVES\n#define FLAT_SHADE_NORMAL normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)))\n#else\n#define FLAT_SHADE_NORMAL vec3(0.0, 0.0, 1.0)\n#endif\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform vec4 color;\nuniform bool flatShading;\n\nvarying vec2 vTexCoord;\nvarying vec3 cameraPosition;\nvarying vec3 normals_commonspace;\nvarying vec4 position_commonspace;\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec3 normal;\n  if (flatShading) {\n    normal = FLAT_SHADE_NORMAL;\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture2D(sampler, vTexCoord) : vColor / 255.;\n  vec3 lightColor = lighting_getLightColor(color.rgb * 255., cameraPosition, position_commonspace.xyz, normal);\n  gl_FragColor = vec4(lightColor / 255., color.a);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[t,"phong-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,size:3,accessor:"getPosition"},instancePositions64xy:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceColors:{transition:!0,size:4,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:al}),this.setState({emptyTexture:new a.Texture2D(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}},{key:"updateState",value:function(t){var n=t.props,i=t.oldProps,r=t.changeFlags;if(Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:r}),n.mesh!==i.mesh||n.fp64!==i.fp64){if(this.state.model&&this.state.model.delete(),n.mesh){this.setState({model:this.getModel(n.mesh)});var a=n.mesh.attributes||n.mesh;this.setState({hasNormals:Boolean(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==i.texture&&this.setTexture(n.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}},{key:"finalizeState",value:function(){Object(it.a)(Object(L.a)(e.prototype),"finalizeState",this).call(this),this.state.emptyTexture.delete(),this.state.texture&&this.state.texture.delete()}},{key:"draw",value:function(t){var e=t.uniforms;if(this.state.model){var n=this.props.sizeScale;this.state.model.draw({uniforms:Object.assign({},e,{sizeScale:n,flatShade:!this.state.hasNormals})})}}},{key:"getModel",value:function(t){var e=new a.Model(this.context.gl,Object.assign({},this.getShaders(),{id:this.props.id,geometry:ll(t),isInstanced:!0,shaderCache:this.context.shaderCache}));return this.state.texture?e.setUniforms({sampler:this.state.texture,hasTexture:1}):e.setUniforms({sampler:this.state.emptyTexture,hasTexture:0}),e}},{key:"setTexture",value:function(t){var e=this,n=this.context.gl,i=this.state.emptyTexture;this.state.texture&&this.state.texture.delete(),t?function(t,e,n){return"string"==typeof e?no(e).then(function(e){return sl(t,e,n)}).catch(function(t){throw new Error("Could not load texture from ".concat(e,": ").concat(t))}):new Promise(function(i){return i(sl(t,e,n))})}(n,t).then(function(t){e.setState({texture:t}),e.state.model&&e.state.model.setUniforms({sampler:e.state.texture,hasTexture:1})}):(this.setState({texture:null}),this.state.model&&this.state.model.setUniforms({sampler:i,hasTexture:0}))}},{key:"calculateInstancePositions64xyLow",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.use64bitPositions();if(t.constant=!r,r){var a=this.props,o=a.data,s=a.getPosition,u=t.value,l=n*t.size,c=ot(o,n,i),h=c.iterable,f=c.objectInfo,p=!0,A=!1,d=void 0;try{for(var v,g=h[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var m=v.value;f.index++;var y=s(m,f);u[l++]=ol(y[0]),u[l++]=ol(y[1])}}catch(_){A=!0,d=_}finally{try{p||null==g.return||g.return()}finally{if(A)throw d}}}else t.value=new Float32Array(2)}}]),e}(ue);fl.layerName="SimpleMeshLayer",fl.defaultProps=hl;var pl=a.fp64.fp64LowPart,Al=[255,255,255,255],dl={scenegraph:{type:"object",value:null,async:!0},fetch:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){var n=e.propName,i=e.layer;return"scenegraph"===n?Ju(t,i.getLoadOptions()):fetch(t).then(function(t){return t.json()})}),getScene:function(t){return t&&t.scenes?t.scenes[0]:t},getAnimator:function(t){return t&&t.animator},sizeScale:{type:"number",value:1,min:0},getPosition:{type:"accessor",value:function(t){return t.position}},getColor:{type:"accessor",value:Al},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]}},vl=function(t){function e(){return Object(T.a)(this,e),Object(j.a)(this,Object(L.a)(e).apply(this,arguments))}return Object(I.a)(e,t),Object(M.a)(e,[{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,accessor:"getPosition",transition:!0},instancePositions64xy:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceColors:{size:4,accessor:"getColor",defaultValue:Al,transition:!0},instanceModelMatrix:al})}},{key:"calculateInstancePositions64xyLow",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.use64bitPositions();if(t.constant=!r,r){var a=this.props,o=a.data,s=a.getPosition,u=t.value,l=n*t.size,c=ot(o,n,i),h=c.iterable,f=c.objectInfo,p=!0,A=!1,d=void 0;try{for(var v,g=h[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var m=v.value;f.index++;var y=s(m,f);u[l++]=pl(y[0]),u[l++]=pl(y[1])}}catch(_){A=!0,d=_}finally{try{p||null==g.return||g.return()}finally{if(A)throw d}}}else t.value=new Float32Array(2)}},{key:"updateState",value:function(t){Object(it.a)(Object(L.a)(e.prototype),"updateState",this).call(this,t);var n=t.props,i=t.oldProps;if(n.scenegraph!==i.scenegraph){var r=n.getScene(n.scenegraph),o=n.getAnimator(n.scenegraph);r instanceof a.ScenegraphNode?(this._deleteScenegraph(),this._applyAllAttributes(r),this._applyAnimationsProp(r,o,n._animations),this.setState({scenegraph:r,animator:o})):null!==r&&a.log.warn("invalid scenegraph:",r)()}else n._animations!==i._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,n._animations)}},{key:"finalizeState",value:function(){this._deleteScenegraph()}},{key:"_applyAllAttributes",value:function(t){var e=this;if(this.state.attributesAvailable){var n=this.getAttributeManager().getAttributes();t.traverse(function(t){e._setModelAttributes(t.model,n)})}}},{key:"_applyAnimationsProp",value:function(t,e,n){if(t&&e&&n){var i=e.getAnimations();Object.keys(n).forEach(function(t){var e=n[t];if("*"===t)i.forEach(function(t){Object.assign(t,e)});else if(Number.isFinite(Number(t))){var r=Number(t);r>=0&&r<i.length?Object.assign(i[r],e):a.log.warn("animation ".concat(t," not found"))()}else{var o=i.find(function(e){return e.name===t});o?Object.assign(o,e):a.log.warn("animation ".concat(t," not found"))()}})}}},{key:"_deleteScenegraph",value:function(){var t=this.state.scenegraph;t instanceof a.ScenegraphNode&&t.delete()}},{key:"addVersionToShader",value:function(t){return Object(a.isWebGL2)(this.context.gl)?"#version 300 es\n".concat(t):t}},{key:"getLoadOptions",value:function(){var t=["project32","picking"],e=this.props,n=e._lighting,i=e._imageBasedLightingEnvironment;"pbr"===n&&t.push(a.pbr);var r=null;return i&&(r="function"==typeof i?i({gl:this.context.gl,layer:this}):i),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:r,modelOptions:{vs:this.addVersionToShader("#if (__VERSION__ < 300)\n  #define _attribute attribute\n  #define _varying varying\n#else\n  #define _attribute in\n#define _varying out\n#endif\n_attribute vec3 instancePositions;\n_attribute vec2 instancePositions64xy;\n_attribute vec4 instanceColors;\n_attribute vec3 instancePickingColors;\n_attribute mat3 instanceModelMatrix;\n_attribute vec3 instanceTranslation;\nuniform float sizeScale;\nuniform mat4 sceneModelMatrix;\n_attribute vec4 POSITION;\n\n#ifdef HAS_UV\n  _attribute vec2 TEXCOORD_0;\n#endif\n\n#ifdef MODULE_PBR\n  #ifdef HAS_NORMALS\n    _attribute vec4 NORMAL;\n  #endif\n#endif\n#ifndef MODULE_PBR\n  _varying vec4 vColor;\n\n  #ifdef HAS_UV\n    _varying vec2 vTEXCOORD_0;\n  #endif\n#endif\nvoid main(void) {\n  #if defined(HAS_UV) && !defined(MODULE_PBR)\n    vTEXCOORD_0 = TEXCOORD_0;\n  #endif\n\n  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale + instanceTranslation;\n  pos = project_size(pos);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xy, pos, position_commonspace);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = position_commonspace.xyz;\n\n    #ifdef HAS_NORMALS\n      pbr_vNormal = project_normal(instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz);\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = TEXCOORD_0;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n  #else\n    vColor = instanceColors / 255.0;\n  #endif\n\n  picking_setPickingColor(instancePickingColors);\n}\n"),fs:this.addVersionToShader("#if (__VERSION__ < 300)\n  #define _varying varying\n  #define _texture2D texture2D\n  #define fragmentColor gl_FragColor\n#else\n  #define _varying in\n  #define _texture2D texture\n  out vec4 fragmentColor;\n#endif\n#ifndef MODULE_PBR\n  _varying vec4 vColor;\n\n  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n    _varying vec2 vTEXCOORD_0;\n    uniform sampler2D u_BaseColorSampler;\n  #endif\n#endif\n\nvoid main(void) {\n  #ifdef MODULE_PBR\n    fragmentColor = pbr_filterColor(vec4(0));\n  #else\n    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n      fragmentColor = vColor * _texture2D(u_BaseColorSampler, vTEXCOORD_0);\n    #else\n      fragmentColor = vColor;\n    #endif\n  #endif\n\n  fragmentColor = picking_filterPickingColor(fragmentColor);\n}\n"),modules:t,isInstanced:!0},useTangents:!1}}},{key:"updateAttributes",value:function(t){var n=this;if(Object(it.a)(Object(L.a)(e.prototype),"updateAttributes",this).call(this,t),this.setState({attributesAvailable:!0}),this.state.scenegraph){var i=this.getAttributeManager().getChangedAttributes({clearChangedFlags:!0});this.state.scenegraph.traverse(function(t){n._setModelAttributes(t.model,i)})}}},{key:"draw",value:function(t){var e=t.moduleParameters,n=void 0===e?null:e,i=t.parameters,r=void 0===i?{}:i,a=t.context;if(this.state.scenegraph){this.props._animations&&this.state.animator&&this.state.animator.animate(a.animationProps.time);var o=this.props.sizeScale,s=this.getNumInstances();this.state.scenegraph.traverse(function(t,e){var i=e.worldMatrix;t.model.setInstanceCount(s),t.updateModuleSettings(n),t.draw({parameters:r,uniforms:{sizeScale:o,sceneModelMatrix:i,u_Camera:t.model.program.uniforms.project_uCameraPosition}})})}}}]),e}(ue);vl.layerName="ScenegraphLayer",vl.defaultProps=dl;var gl=n("q1tI"),ml=n.n(gl),yl=n("17x9"),_l=n.n(yl);function bl(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}function xl(t){return t?"function"==typeof t?Object(gl.createElement)(Se,{},t):Array.isArray(t)?t.map(xl):(bl(t.type,Se),t):t}function wl(t){var e=t.children,n=t.layers,i=t.views,r=[],a=[],o={};return ml.a.Children.forEach(xl(e),function(t){if(t){var e=t.type;if(bl(e,ue)){var n=function(t,e){var n={},i=t.defaultProps||{};for(var r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}(e,t.props);a.push(n)}else r.push(t);if(e!==Se&&bl(e,Se)&&t.props.id){var i=new e(t.props);o[i.id]=i}}}),Object.keys(o).length>0&&(Array.isArray(i)?i.forEach(function(t){o[t.id]=t}):i&&(o[i.id]=i),i=Object.values(o)),{layers:n=a.length>0?[].concat(a,Object(tt.a)(n)):n,children:r,views:i}}function Sl(t){var e=t.children,n=(t.viewports,t.deck),i=t.ContextProvider,a=(n||{}).viewManager;if(!a||!a.views.length)return[];var o=a.views[0].id;return e.map(function(t,e){t.props.viewportId&&r.removed("viewportId","<View>")(),t.props.viewId&&r.removed("viewId","<View>")();var s=o,u=t;bl(t.type,Se)&&(s=t.props.id||o,u=t.props.children);var l=u&&u.props&&u.props.style,c=a.getViewport(s),h=a.getViewState(s);if(!c)return null;var f=c.x,p=c.y,A=c.width,d=c.height;u=function t(e,n){return e?"function"==typeof e?e(n):Array.isArray(e)?e.map(function(e){return t(e,n)}):Object(gl.cloneElement)(e,n):e}(u,{x:f,y:p,width:A,height:d,viewport:c,viewState:h});var v={position:"absolute",zIndex:l&&l.zIndex,pointerEvents:"none",left:f,top:p,width:A,height:d},g="view-child-".concat(s,"-").concat(e);if(i){var m={viewport:c,container:n.canvas.offsetParent,eventManager:n.eventManager,onViewStateChange:n._onViewStateChange};u=Object(gl.createElement)(i,{value:m},u)}return Object(gl.createElement)("div",{key:g,id:g,style:v},u)})}var kl=Zn.memoize,Ol=mn.getPropTypes(_l.a),Pl=mn.defaultProps,El=function(t){function e(t){var n;return Object(T.a)(this,e),(n=Object(j.a)(this,Object(L.a)(e).call(this,t))).viewports=null,n.children=null,n._needsRedraw=null,n.pickObject=n.pickObject.bind(Object(Oe.a)(Object(Oe.a)(n))),n.pickMultipleObjects=n.pickMultipleObjects.bind(Object(Oe.a)(Object(Oe.a)(n))),n.pickObjects=n.pickObjects.bind(Object(Oe.a)(Object(Oe.a)(n))),n._extractJSXLayers=kl(wl),n._positionChildrenUnderViews=kl(Sl),n}return Object(I.a)(e,t),Object(M.a)(e,[{key:"componentDidMount",value:function(){var t=this.props.Deck||mn;this.deck=this.deck||new t(Object.assign({},this.props,{canvas:this.deckCanvas,_customRender:this._customRender.bind(this)})),this._updateFromProps(this.props)}},{key:"shouldComponentUpdate",value:function(t){this._updateFromProps(t);var e=this.children!==this._parseJSX(t).children,n=this.deck.viewManager&&this.deck.viewManager.needsRedraw();return e&&!n}},{key:"componentDidUpdate",value:function(){this._redrawDeck()}},{key:"componentWillUnmount",value:function(){this.deck.finalize()}},{key:"pickObject",value:function(t){var e=t.x,n=t.y,i=t.radius,r=void 0===i?0:i,a=t.layerIds,o=void 0===a?null:a;return this.deck.pickObject({x:e,y:n,radius:r,layerIds:o})}},{key:"pickMultipleObjects",value:function(t){var e=t.x,n=t.y,i=t.radius,r=void 0===i?0:i,a=t.layerIds,o=void 0===a?null:a,s=t.depth,u=void 0===s?10:s;return this.deck.pickMultipleObjects({x:e,y:n,radius:r,layerIds:o,depth:u})}},{key:"pickObjects",value:function(t){var e=t.x,n=t.y,i=t.width,r=void 0===i?1:i,a=t.height,o=void 0===a?1:a,s=t.layerIds,u=void 0===s?null:s;return this.deck.pickObjects({x:e,y:n,width:r,height:o,layerIds:u})}},{key:"_redrawDeck",value:function(){this._needsRedraw&&(this.deck._drawLayers(this._needsRedraw),this._needsRedraw=null)}},{key:"_customRender",value:function(t){this._needsRedraw=t,this.deck.viewManager.getViewports()!==this.viewports?this.forceUpdate():this._redrawDeck()}},{key:"_parseJSX",value:function(t){return this._extractJSXLayers({layers:t.layers,views:t.views,children:t.children})}},{key:"_updateFromProps",value:function(t){var e=this._parseJSX(t),n=e.layers,i=e.views,r=Object.assign({},t,{layers:n,views:i});this.deck.setProps(r)}},{key:"render",value:function(){var t=this,e=(this.deck||{}).viewManager;this.viewports=e&&e.getViewports(),this.children=this._parseJSX(this.props).children;var n=this._positionChildrenUnderViews({children:this.children,viewports:this.viewports,deck:this.deck,ContextProvider:this.props.ContextProvider}),i=Object.assign({},{position:"absolute",left:0,top:0},this.props.style),r=Object(gl.createElement)("canvas",{ref:function(e){return t.deckCanvas=e},key:"deck-canvas",id:this.props.id,style:i});return Object(gl.createElement)("div",{id:"deckgl-wrapper"},[n,r])}}]),e}(ml.a.Component);El.propTypes=Ol,El.defaultProps=Pl,n.d(e,"experimental",function(){return Cl}),n.d(e,"COORDINATE_SYSTEM",function(){return h}),n.d(e,"Deck",function(){return mn}),n.d(e,"Layer",function(){return ue}),n.d(e,"CompositeLayer",function(){return yn}),n.d(e,"View",function(){return Se}),n.d(e,"MapView",function(){return nn}),n.d(e,"FirstPersonView",function(){return wn}),n.d(e,"ThirdPersonView",function(){return Sn}),n.d(e,"OrbitView",function(){return In}),n.d(e,"PerspectiveView",function(){return Dn}),n.d(e,"OrthographicView",function(){return Vn}),n.d(e,"Viewport",function(){return ve}),n.d(e,"WebMercatorViewport",function(){return Ce}),n.d(e,"Controller",function(){return Ge}),n.d(e,"MapController",function(){return en}),n.d(e,"AttributeManager",function(){return Pt}),n.d(e,"project",function(){return S}),n.d(e,"project64",function(){return E}),n.d(e,"LayerManager",function(){return ye}),n.d(e,"DeckRenderer",function(){return ln}),n.d(e,"log",function(){return r}),n.d(e,"_OrbitController",function(){return Tn}),n.d(e,"_FirstPersonController",function(){return xn}),n.d(e,"TRANSITION_EVENTS",function(){return Ie}),n.d(e,"LinearInterpolator",function(){return je}),n.d(e,"FlyToInterpolator",function(){return Hn}),n.d(e,"Effect",function(){return D}),n.d(e,"LightingEffect",function(){return F}),n.d(e,"PostProcessEffect",function(){return Y}),n.d(e,"AmbientLight",function(){return a.AmbientLight}),n.d(e,"PointLight",function(){return q}),n.d(e,"DirectionalLight",function(){return z}),n.d(e,"ArcLayer",function(){return Va}),n.d(e,"BitmapLayer",function(){return lo}),n.d(e,"IconLayer",function(){return xo}),n.d(e,"LineLayer",function(){return nr}),n.d(e,"PointCloudLayer",function(){return Eo}),n.d(e,"ScatterplotLayer",function(){return jo}),n.d(e,"GridCellLayer",function(){return Mi}),n.d(e,"ColumnLayer",function(){return Ti}),n.d(e,"PathLayer",function(){return No}),n.d(e,"PolygonLayer",function(){return Go}),n.d(e,"SolidPolygonLayer",function(){return Or}),n.d(e,"GeoJsonLayer",function(){return Jo}),n.d(e,"TextLayer",function(){return _s}),n.d(e,"ScreenGridLayer",function(){return wi}),n.d(e,"CPUGridLayer",function(){return Gi}),n.d(e,"HexagonLayer",function(){return $i}),n.d(e,"ContourLayer",function(){return Ea}),n.d(e,"GridLayer",function(){return Da}),n.d(e,"GPUGridLayer",function(){return Ia}),n.d(e,"GreatCircleLayer",function(){return bs}),n.d(e,"S2Layer",function(){return Ps}),n.d(e,"H3ClusterLayer",function(){return Au}),n.d(e,"H3HexagonLayer",function(){return yu}),n.d(e,"TileLayer",function(){return zs}),n.d(e,"TripsLayer",function(){return Ds}),n.d(e,"SimpleMeshLayer",function(){return fl}),n.d(e,"ScenegraphLayer",function(){return vl}),n.d(e,"default",function(){return El}),n.d(e,"DeckGL",function(){return El});var Cl={},Tl=Zn.count,Ml=Zn.flattenVertices,jl=Zn.fillArray,Ll=Ba.BinSorter,Il=Ba.linearScale,zl=Ba.getLinearScale,Dl=Ba.quantizeScale,Bl=Ba.getQuantizeScale,Rl=Ba.defaultColorRange;Object.assign(Cl,{BinSorter:Ll,linearScale:Il,getLinearScale:zl,quantizeScale:Dl,getQuantizeScale:Bl,defaultColorRange:Rl,count:Tl,flattenVertices:Ml,fillArray:jl})},eqkD:function(t,e,n){"use strict";(function(t,i){n.d(e,"a",function(){return o});var r=n("U8pU"),a=("object"!==(void 0===t?"undefined":Object(r.a)(t))||String(t),{self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==i&&i}),o=a.global||a.self||a.window}).call(this,n("8oxB"),n("3r9c"))},foSv:function(t,e,n){"use strict";function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}n.d(e,"a",function(){return i})},g9fj:function(t,e,n){"use strict";var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("s4An");var l=n("RHh3");function c(t){var e="function"==typeof Map?new Map:void 0;return(c=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return Object(l.a)(t,arguments,Object(o.a)(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object(u.a)(i,t)})(t)}var h=n("qjXE");n.d(e,"a",function(){return f});var f=function(t){function e(){return Object(i.a)(this,e),Object(a.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(s.a)(e,t),Object(r.a)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this).check()}},{key:"copy",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t[e];return this.check()}},{key:"set",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=(t<0||arguments.length<=t?void 0:arguments[t])||0;return this.check()}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}},{key:"toString",value:function(){return this.formatString(h.c)}},{key:"formatString",value:function(t){for(var e="",n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+Object(h.f)(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Object(h.e)(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"inverse",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=1/this[t];return this.check()}},{key:"lerp",value:function(t,e,n){void 0===n&&(n=e,e=t,t=this);for(var i=0;i<this.ELEMENTS;++i){var r=t[i];this[i]=r+n*(e[i]-r)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"check",value:function(){if(h.c.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){return this.scale(t)}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}}]),e}(c(Array))},gVfD:function(t,e,n){"use strict";var i,r,a=n("rePB"),o=n("9Hqq"),s=function(t){return l(t)?void 0:0},u=(i={},Object(a.a)(i,3074,function(t){return l(t)?void 0:36064}),Object(a.a)(i,35723,function(t){return l(t)?void 0:4352}),Object(a.a)(i,35977,s),Object(a.a)(i,32937,s),Object(a.a)(i,36795,function(t,e){var n=l(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0}),Object(a.a)(i,37445,function(t,e){var n=t.getExtension("WEBGL_debug_renderer_info");return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)}),Object(a.a)(i,37446,function(t,e){var n=t.getExtension("WEBGL_debug_renderer_info");return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)}),Object(a.a)(i,34047,function(t,e){var n=t.luma.extensions.EXT_texture_filter_anisotropic;return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}),Object(a.a)(i,32883,s),Object(a.a)(i,35071,s),Object(a.a)(i,37447,s),Object(a.a)(i,36063,function(t,e){if(!l(t)){var n=t.getExtension("WEBGL_draw_buffers");return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}}),Object(a.a)(i,35379,s),Object(a.a)(i,35374,s),Object(a.a)(i,35377,s),Object(a.a)(i,34852,function(t){if(!l(t)){var e=t.getExtension("WEBGL_draw_buffers");return e?e.MAX_DRAW_BUFFERS_WEBGL:0}}),Object(a.a)(i,36203,function(t){return t.getExtension("OES_element_index")?2147483647:65535}),Object(a.a)(i,33001,function(t){return t.getExtension("OES_element_index")?16777216:65535}),Object(a.a)(i,33e3,function(t){return 16777216}),Object(a.a)(i,37157,s),Object(a.a)(i,35373,s),Object(a.a)(i,35657,s),Object(a.a)(i,36183,s),Object(a.a)(i,37137,s),Object(a.a)(i,34045,s),Object(a.a)(i,35978,s),Object(a.a)(i,35979,s),Object(a.a)(i,35968,s),Object(a.a)(i,35376,s),Object(a.a)(i,35375,s),Object(a.a)(i,35659,s),Object(a.a)(i,37154,s),Object(a.a)(i,35371,s),Object(a.a)(i,35658,s),Object(a.a)(i,35076,s),Object(a.a)(i,35077,s),Object(a.a)(i,35380,s),i);function l(t){return Boolean(t&&2===t._version)}n.d(e,"b",function(){return h}),n.d(e,"a",function(){return f});function c(t){return Boolean(t&&2===t._version)}var h=(r={},Object(a.a)(r,"OES_vertex_array_object",{meta:{suffix:"OES"},createVertexArray:function(){Object(o.a)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),Object(a.a)(r,"ANGLE_instanced_arrays",{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(t,e){Object(o.a)(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),Object(a.a)(r,"WEBGL_draw_buffers",{meta:{suffix:"WEBGL"},drawBuffers:function(){Object(o.a)(!1)}}),Object(a.a)(r,"EXT_disjoint_timer_query",{meta:{suffix:"EXT"},createQuery:function(){Object(o.a)(!1)},deleteQuery:function(){Object(o.a)(!1)},beginQuery:function(){Object(o.a)(!1)},endQuery:function(){},getQuery:function(t,e){return this.getQueryObject(t,e)},getQueryParameter:function(t,e){return this.getQueryObject(t,e)},getQueryObject:function(){}}),r),f={readBuffer:function(t,e,n){c(t)&&e(n)},getVertexAttrib:function(t,e,n,i){var r,a=function(t,e){return{webgl2:c(t),ext:t.getExtension(e)}}(t,"ANGLE_instanced_arrays"),o=a.webgl2,s=a.ext;switch(i){case 35069:r=!!o&&void 0;break;case 35070:r=o||s?void 0:0}return void 0!==r?r:e(n,i)},getProgramParameter:function(t,e,n,i){if(!c(t))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return e(n,i)},getInternalformatParameter:function(t,e,n,i,r){if(!c(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter:function(t,e,n,i){switch(i){case 34046:var r=t.luma.extensions.EXT_texture_filter_anisotropic;i=r&&r.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(n,i)},getParameter:function(t,e,n){var i=u[n],r="function"==typeof i?i(t,e,n):i;return void 0!==r?r:e(n)},hint:function(t,e,n,i){return e(n,i)}}},h6m0:function(t,e,n){"use strict";n.d(e,"a",function(){return h});var i=n("1OyB"),r=n("vuIU"),a=n("md7G"),o=n("foSv"),s=n("Ji7U"),u=n("g9fj"),l=n("qjXE"),c=function(t,e){if(!t)throw new Error(e)},h=function(t){function e(){return Object(i.a)(this,e),Object(a.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(s.a)(e,t),Object(r.a)(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n){var i=this[n]-t[n];e+=i*i}return Object(l.a)(e)}},{key:"dot",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return Object(l.a)(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0;i<e.length;i++)for(var r=e[i],a=0;a<this.ELEMENTS;++a)this[a]+=r[a];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0;i<e.length;i++)for(var r=e[i],a=0;a<this.ELEMENTS;++a)this[a]-=r[a];return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0;i<e.length;i++)for(var r=e[i],a=0;a<this.ELEMENTS;++a)this[a]*=r[a];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0;i<e.length;i++)for(var r=e[i],a=0;a<this.ELEMENTS;++a)this[a]/=r[a];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"scaleAndAdd",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=this[n]*e+t[n];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return c(t>=0&&t<this.ELEMENTS,"index is out of range"),Object(l.a)(this[t])}},{key:"setComponent",value:function(t,e){return c(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Object(l.a)(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Object(l.a)(t)}}]),e}(u.a)},"i/Ws":function(t,e,n){"use strict";var i=n("KI45");Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return r.default}});var r=i(n("Rt0e"))},iTDY:function(t,e,n){"use strict";(function(t){n.d(e,"c",function(){return r}),n.d(e,"d",function(){return a}),n.d(e,"b",function(){return o}),n.d(e,"a",function(){return s});var i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},r=i.self||i.window||i.global,a=i.window||i.self||i.global,o=i.global||i.self||i.window,s=i.document||{}}).call(this,n("3r9c"))},jYz7:function(t,e,n){"use strict";(function(t){var i=n("q1tI");function r(e){var n;n="undefined"!=typeof window?window:"undefined"!=typeof self?self:t;var i,r,a="undefined"!=typeof document&&document.attachEvent;if(!a){var o=(r=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||function(t){return n.setTimeout(t,20)},function(t){return r(t)}),s=(i=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.clearTimeout,function(t){return i(t)}),u=function(t){var e=t.__resizeTriggers__,n=e.firstElementChild,i=e.lastElementChild,r=n.firstElementChild;i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight,r.style.width=n.offsetWidth+1+"px",r.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},l=function(t){if(!(t.target.className.indexOf("contract-trigger")<0&&t.target.className.indexOf("expand-trigger")<0)){var e=this;u(this),this.__resizeRAF__&&s(this.__resizeRAF__),this.__resizeRAF__=o(function(){(function(t){return t.offsetWidth!=t.__resizeLast__.width||t.offsetHeight!=t.__resizeLast__.height})(e)&&(e.__resizeLast__.width=e.offsetWidth,e.__resizeLast__.height=e.offsetHeight,e.__resizeListeners__.forEach(function(n){n.call(e,t)}))})}},c=!1,h="",f="animationstart",p="Webkit Moz O ms".split(" "),A="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),d=document.createElement("fakeelement");if(void 0!==d.style.animationName&&(c=!0),!1===c)for(var v=0;v<p.length;v++)if(void 0!==d.style[p[v]+"AnimationName"]){h="-"+p[v].toLowerCase()+"-",f=A[v],c=!0;break}var g="resizeanim",m="@"+h+"keyframes "+g+" { from { opacity: 0; } to { opacity: 0; } } ",y=h+"animation: 1ms "+g+"; "}return{addResizeListener:function(t,i){if(a)t.attachEvent("onresize",i);else{if(!t.__resizeTriggers__){var r=t.ownerDocument,o=n.getComputedStyle(t);o&&"static"==o.position&&(t.style.position="relative"),function(t){if(!t.getElementById("detectElementResize")){var n=(m||"")+".resize-triggers { "+(y||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',i=t.head||t.getElementsByTagName("head")[0],r=t.createElement("style");r.id="detectElementResize",r.type="text/css",null!=e&&r.setAttribute("nonce",e),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(t.createTextNode(n)),i.appendChild(r)}}(r),t.__resizeLast__={},t.__resizeListeners__=[],(t.__resizeTriggers__=r.createElement("div")).className="resize-triggers",t.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',t.appendChild(t.__resizeTriggers__),u(t),t.addEventListener("scroll",l,!0),f&&(t.__resizeTriggers__.__animationListener__=function(e){e.animationName==g&&u(t)},t.__resizeTriggers__.addEventListener(f,t.__resizeTriggers__.__animationListener__))}t.__resizeListeners__.push(i)}},removeResizeListener:function(t,e){if(a)t.detachEvent("onresize",e);else if(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),!t.__resizeListeners__.length){t.removeEventListener("scroll",l,!0),t.__resizeTriggers__.__animationListener__&&(t.__resizeTriggers__.removeEventListener(f,t.__resizeTriggers__.__animationListener__),t.__resizeTriggers__.__animationListener__=null);try{t.__resizeTriggers__=!t.removeChild(t.__resizeTriggers__)}catch(n){}}}}}var a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},l=function(t){function e(){var t,n,i;a(this,e);for(var r=arguments.length,o=Array(r),s=0;s<r;s++)o[s]=arguments[s];return n=i=u(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),i.state={height:i.props.defaultHeight||0,width:i.props.defaultWidth||0},i._onResize=function(){var t=i.props,e=t.disableHeight,n=t.disableWidth,r=t.onResize;if(i._parentNode){var a=i._parentNode.offsetHeight||0,o=i._parentNode.offsetWidth||0,s=window.getComputedStyle(i._parentNode)||{},u=parseInt(s.paddingLeft,10)||0,l=parseInt(s.paddingRight,10)||0,c=parseInt(s.paddingTop,10)||0,h=parseInt(s.paddingBottom,10)||0,f=a-c-h,p=o-u-l;(!e&&i.state.height!==f||!n&&i.state.width!==p)&&(i.setState({height:a-c-h,width:o-u-l}),r({height:a,width:o}))}},i._setRef=function(t){i._autoSizer=t},u(i,n)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i["PureComponent"]),o(e,[{key:"componentDidMount",value:function(){var t=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=r(t),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var t=this.props,e=t.children,n=t.className,r=t.disableHeight,a=t.disableWidth,o=t.style,u=this.state,l=u.height,c=u.width,h={overflow:"visible"},f={},p=!1;return r||(0===l&&(p=!0),h.height=0,f.height=l),a||(0===c&&(p=!0),h.width=0,f.width=c),Object(i.createElement)("div",{className:n,ref:this._setRef,style:s({},h,o)},!p&&e(f))}}]),e}();l.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}},e.a=l}).call(this,n("3r9c"))},kLp3:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r="undefined"!=typeof window&&window.addEventListener,a=new Map,o=function(){return r&&window.__SEER_INITIALIZED__},s=function(t,e){var n=a.get(t),i=Date.now();return!!(n&&i-n<e)||(a.set(t,i),!1)},u=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r&&o()){var n=new Set,a=JSON.stringify(e,function(t){return function(e,n){if(!n||"object"!==(void 0===n?"undefined":i(n))||!t.has(n))return t.add(n),Object.prototype.toString.call(n).slice(8,-1).includes("Array")?Array.prototype.slice.call(n,0,20):n}}(n));try{window.postMessage({type:t,payload:a,source:"seer-agent"},"*")}catch(u){if(s("seer-log",2e3))return;console.log(u)}}},l=new Map,c=function(t){if(t&&t.data&&"seer-core"===t.data.source){var e=t.data,n=e.type,i=e.payload,r=l.get(n);r&&r.forEach(function(t){return t(i)})}},h=function(){r&&!window.__SEER_LISTENER__&&(window.addEventListener("message",c),window.__SEER_LISTENER__=!0)};e.default={send:u,throttle:s,isReady:o,list:function(t,e){return u("LIST",{key:t,data:e})},listItem:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u("LIST_ITEM",{key:t,itemKey:e,data:n})},updateItem:function(t,e,n,i){return u("UPDATE_ITEM",{key:t,itemKey:e,path:n,data:i})},multiUpdate:function(t,e,n){return u("MULTI_UPDATE_ITEM",{key:t,itemKey:e,array:n})},deleteItem:function(t,e){return u("DELETE_ITEM",{key:t,itemKey:e})},addLog:function(t,e,n){return u("ADD_LOG",{key:t,itemKey:e,msg:n})},listeners:l,listenFor:function(t,e){if(r){if(!t||!e)throw new Error("Please provide a type and callback");l.has(t)||l.set(t,[]),window.__SEER_LISTENER__||h(),l.get(t).push(e)}},removeListener:function(t){l.forEach(function(e,n){l.set(n,e.filter(function(e){return e!==t}))})},init:h,clean:function(){r&&window.__SEER_LISTENER__&&(window.removeEventListener("message",c),delete window.__SEER_LISTENER__)}}},"kVK+":function(t,e){e.read=function(t,e,n,i,r){var a,o,s=8*r-i-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?r-1:0,f=n?-1:1,p=t[e+h];for(h+=f,a=p&(1<<-c)-1,p>>=-c,c+=s;c>0;a=256*a+t[e+h],h+=f,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+t[e+h],h+=f,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),a-=l}return(p?-1:1)*o*Math.pow(2,a-i)},e.write=function(t,e,n,i,r,a){var o,s,u,l=8*a-r-1,c=(1<<l)-1,h=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:a-1,A=i?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(e*u-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[n+p]=255&s,p+=A,s/=256,r-=8);for(o=o<<r|s,l+=r;l>0;t[n+p]=255&o,p+=A,o/=256,l-=8);t[n+p-A]|=128*d}},lQOs:function(t,e,n){"use strict";var i=n("ODXe"),r=n("rePB"),a=n("rMhL"),o=n("P0Fk");var s=n("uzDn"),u=7936,l=7937,c=7938,h=35724,f={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},p={};Object.keys(f).forEach(function(t){p[t]=t});var A={};function d(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=f[e];if(Object(s.a)(i,e),!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="undefined"!=typeof window&&window.navigator||{},n=t.userAgent||e.userAgent||"",i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r}(n))return!0;if(e in A)return A[e];var r=i[0],a=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(a,"\nvoid main(void) {}"),u=t.createShader(35633);t.shaderSource(u,o),t.compileShader(u);var l=t.getShaderParameter(u,35713);return t.deleteShader(u),A[e]=l,l}function v(t,e){var n=f[e];Object(s.a)(n,e);var i=function(t){return Boolean(t&&2===t._version)}(t)&&n[1]||n[0],r="string"==typeof i?Boolean(t.getExtension(i)):i;return Object(s.a)(!1===r||!0===r),r}function g(t,e){return(e=Array.isArray(e)?e:[e]).every(function(e){return v(t,e)})}function m(t){switch(function(t){var e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||u),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||l);return{gpuVendor:function(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(n,i),vendor:n,renderer:i,version:t.getParameter(c),shadingLanguageVersion:t.getParameter(h)}}(t).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}var y,_,b=n("rpxL");n.d(e,"c",function(){return O}),n.d(e,"b",function(){return P}),n.d(e,"a",function(){return E});var x=(y={},Object(r.a)(y,a.b,"vertex"),Object(r.a)(y,a.a,"fragment"),y),w=(_={},Object(r.a)(_,a.b,{}),Object(r.a)(_,a.a,{}),_),S={},k="precision highp float;\n\n";function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(t=t.trim()).split(":"),r=Object(i.a)(n,2),a=r[0],o=r[1],s=t.replace(/\(.+/,"");w[a][s]=Object.assign(e,{signature:o})}function P(t,e){var n=e.hook,i=e.injection,r=e.order,a=void 0===r?0:r,o=n.slice(0,2);S[t]=S[t]||{},S[t][o]=S[t][o]||{},Object(s.a)(!S[t][o][n],"Module injection already created"),S[t][o][n]={injection:i,order:a}}function E(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.vs,i=e.fs,r=Object(o.c)(e.modules||[]);return{gl:t,vs:C(t,Object.assign({},e,{source:n,type:a.b,modules:r})),fs:C(t,Object.assign({},e,{source:i,type:a.a,modules:r})),getUniforms:T(r),modules:M(r)}}function C(t,e){var n=e.id,i=e.source,r=e.type,o=e.modules,u=void 0===o?[]:o,l=e.defines,c=void 0===l?{}:l,h=e.inject,f=void 0===h?{}:h,A=e.prologue,v=void 0===A||A,y=e.log;Object(s.a)("string"==typeof i,"shader source must be a string");var _=r===a.b,O=i.split("\n"),P=100,E="",C=i;0===O[0].indexOf("#version ")&&(P=300,E=O[0],C=O.slice(1).join("\n"));var T={};u.forEach(function(t){Object.assign(T,t.getDefines())}),Object.assign(T,c);var M=v?"".concat(E,"\n").concat(function(t){var e=t.id,n=t.source,i=t.type;return e&&"string"==typeof e&&-1===n.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(e,"_").concat(x[i],"\n\n"):""}({id:n,source:i,type:r}),"\n").concat(function(t){var e=t.type;return"\n#define SHADER_TYPE_".concat(x[e].toUpperCase(),"\n")}({type:r}),"\n").concat(m(t),"\n").concat(function(t,e,n){var i="#if (__VERSION__ > 120)\n\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return g(t,p.GLSL_FRAG_DEPTH)&&(i+="// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),g(t,p.GLSL_DERIVATIVES)&&d(t,p.GLSL_DERIVATIVES)&&(i+="// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define DERIVATIVES\n#endif\n"),g(t,p.GLSL_FRAG_DATA)&&d(t,p.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define DRAW_BUFFERS\n#endif\n"),g(t,p.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n# define TEXTURE_LOD\n#define texture2DLod texture2DLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define textureCubeLod textureCubeLodEXT\n#define texture2DGrad texture2DGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define textureCubeGrad textureCubeGradEXT\n#endif\n"),i}(t),"\n").concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,n="";for(var i in t){0===e&&(n+="\n// APPLICATION DEFINES\n"),e++;var r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],"\n"))}0===e&&(n+="\n");return n}(T),"\n").concat(_?"":k,"\n"):"".concat(E,"\n"),j=!1,L={},I={};for(var z in f){var D="string"==typeof f[z]?{injection:f[z],order:0}:f[z];z.match(/^(v|f)s:/)?"#"===z[3]?I[z]=[D]:L[z]=[D]:I[z]=[D]}var B=!0,R=!1,F=void 0;try{for(var N,U=u[Symbol.iterator]();!(B=(N=U.next()).done);B=!0){var V=N.value;switch(V.name){case"inject":j=!0;break;default:if(V.checkDeprecations(C,y),M+=V.getModuleSource(r,P),S[V.name]){var G=S[V.name][r];for(var W in G)W.match(/^(v|f)s:#/)?(I[W]=I[W]||[],I[W].push(G[W])):(L[W]=L[W]||[],L[W].push(G[W]))}}}}catch(H){R=!0,F=H}finally{try{B||null==U.return||U.return()}finally{if(R)throw F}}return M+=function(t,e){var n="",i=w[t];for(var r in i){var a=i[r];if(n+="void ".concat(a.signature," {\n"),a.header&&(n+="  ".concat(a.header)),e[r]){var o=e[r];o.sort(function(t,e){return t.order-e.order});var s=!0,u=!1,l=void 0;try{for(var c,h=o[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var f=c.value;n+="  ".concat(f.injection,"\n")}}catch(H){u=!0,l=H}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}a.footer&&(n+="  ".concat(a.footer)),n+="}\n"}return n}(r,L),M+=C,M=Object(b.b)(M,r,I,j)}function T(t){return function(e){var n={},i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value.getUniforms(e,n);Object.assign(n,u)}}catch(l){r=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}}function M(t){var e={},n=!0,i=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value,l=Object(o.a)(u);e[u]=l}}catch(c){i=!0,r=c}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}return e}},laYx:function(t,e,n){"use strict";var i=n("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(n("q1tI")),a=(0,i(n("8/g6")).default)(r.default.createElement(r.default.Fragment,null,r.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),r.default.createElement("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM5 4.99h3C8 6.65 6.66 8 5 8V4.99zM5 12v-2c2.76 0 5-2.25 5-5.01h2C12 8.86 8.87 12 5 12zm0 6l3.5-4.5 2.5 3.01L14.5 12l4.5 6H5z"})),"Satellite");e.default=a},ls82:function(t,e,n){var i=function(t){"use strict";var e,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(t,e,n,i){var r=e&&e.prototype instanceof d?e:d,a=Object.create(r.prototype),o=new P(i||[]);return a._invoke=function(t,e,n){var i=c;return function(r,a){if(i===f)throw new Error("Generator is already running");if(i===p){if("throw"===r)throw a;return C()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=S(o,n);if(s){if(s===A)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===c)throw i=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var u=l(t,e,n);if("normal"===u.type){if(i=n.done?p:h,u.arg===A)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=p,n.method="throw",n.arg=u.arg)}}}(t,n,o),a}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(i){return{type:"throw",arg:i}}}t.wrap=u;var c="suspendedStart",h="suspendedYield",f="executing",p="completed",A={};function d(){}function v(){}function g(){}var m={};m[a]=function(){return this};var y=Object.getPrototypeOf,_=y&&y(y(E([])));_&&_!==n&&i.call(_,a)&&(m=_);var b=g.prototype=d.prototype=Object.create(m);function x(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function w(t){var e;this._invoke=function(n,r){function a(){return new Promise(function(e,a){!function e(n,r,a,o){var s=l(t[n],t,r);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,a,o)},function(t){e("throw",t,a,o)}):Promise.resolve(c).then(function(t){u.value=t,a(u)},function(t){return e("throw",t,a,o)})}o(s.arg)}(n,r,e,a)})}return e=e?e.then(a,a):a()}}function S(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var r=l(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,A;var a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,A):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function E(t){if(t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:C}}function C(){return{value:e,done:!0}}return v.prototype=b.constructor=g,g.constructor=v,g[s]=v.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},x(w.prototype),w.prototype[o]=function(){return this},t.AsyncIterator=w,t.async=function(e,n,i,r){var a=new w(u(e,n,i,r));return t.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},x(b),b[s]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=E,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,A):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),A},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),A}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;O(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:E(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),A}},t}(t.exports);try{regeneratorRuntime=i}catch(r){Function("r","regeneratorRuntime = r")(i)}},md7G:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var i=n("U8pU"),r=n("JX7q");function a(t,e){return!e||"object"!==Object(i.a)(e)&&"function"!=typeof e?Object(r.a)(t):e}},"n+fv":function(t,e,n){"use strict";n.d(e,"c",function(){return r}),n.d(e,"d",function(){return o}),n.d(e,"b",function(){return u}),n.d(e,"i",function(){return l}),n.d(e,"e",function(){return c}),n.d(e,"f",function(){return h}),n.d(e,"g",function(){return f}),n.d(e,"a",function(){return p}),n.d(e,"h",function(){return v});var i=n("yU0y");function r(t){var e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function a(t,e,n){var r=new i.a(3);return r[0]=t,r[1]=e,r[2]=n,r}function o(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function s(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function u(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],u=n[2];return t[0]=r*u-a*s,t[1]=a*o-i*u,t[2]=i*s-r*o,t}function l(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,t}function c(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function h(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function f(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function p(t,e){var n=a(t[0],t[1],t[2]),i=a(e[0],e[1],e[2]);s(n,n),s(i,i);var r=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}var A,d,v=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t};A=new i.a(3),i.a!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),d=A},o0o1:function(t,e,n){t.exports=n("ls82")},qBB9:function(t,e,n){"use strict";var i=n("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(n("q1tI")),a=(0,i(n("8/g6")).default)(r.default.createElement(r.default.Fragment,null,r.default.createElement("path",{d:"M12 2l-5.5 9h11z"}),r.default.createElement("circle",{cx:"17.5",cy:"17.5",r:"4.5"}),r.default.createElement("path",{d:"M3 13.5h8v8H3z"}),r.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"})),"Category");e.default=a},qjXE:function(t,e,n){"use strict";n.d(e,"c",function(){return i}),n.d(e,"a",function(){return r}),n.d(e,"f",function(){return o}),n.d(e,"h",function(){return l}),n.d(e,"d",function(){return c}),n.d(e,"b",function(){return h}),n.d(e,"g",function(){return f}),n.d(e,"e",function(){return p});var i={};function r(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function a(t){return Math.round(t/i.EPSILON)*i.EPSILON}function o(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,n=void 0===e?i.precision||4:e;return t=a(t),parseFloat(t.toPrecision(n))}function s(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function u(t,e){if(s(t)){for(var n=(r=t).clone?r.clone():new Array(r),i=0;i<n.length;++i)n[i]=e(n[i],i,n);return n}var r;return e(t)}function l(t){return u(t,function(t){return t/180*Math.PI})}function c(t){return u(t,function(t){return 180*t/Math.PI})}function h(t,e,n){return u(t,function(t){return Math.max(e,Math.min(n,t))})}function f(t,e,n){return s(t)?t.map(function(t,i){return f(t,e[i],n)}):n*e+(1-n)*t}function p(t,e){if(s(t)&&s(e)){if(t===e)return!0;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!p(t[n],e[n]))return!1;return!0}return Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}i.EPSILON=1e-12,i.debug=!0,i.precision=4,i.printTypes=!1,i.printDegrees=!1,i.printRowMajor=!0},rMhL:function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return r});var i="vs",r="fs"},rePB:function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",function(){return i})},rpxL:function(t,e,n){"use strict";var i,r=n("rePB"),a=n("rMhL"),o=n("uzDn");n.d(e,"b",function(){return h}),n.d(e,"a",function(){return f});var s=(i={},Object(r.a)(i,a.b,"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"),Object(r.a)(i,a.a,"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"),i),u=/void main\s*\([^)]*\)\s*\{\n?/,l=/}\n?[^{}]*$/,c=[];function h(t,e,n,i){var r=e===a.b,o=function(e){var i=n[e];i.sort(function(t,e){return t.order-e.order}),c.length=i.length;for(var a=0,o=i.length;a<o;++a)c[a]=i[a].injection;var s="".concat(c.join("\n"),"\n");switch(e){case"vs:#decl":r&&(t=t.replace(u,function(t){return"".concat(s,"\n").concat(t)}));break;case"vs:#main-start":r&&(t=t.replace(u,function(t){return t+s}));break;case"vs:#main-end":r&&(t=t.replace(l,function(t){return s+t}));break;case"fs:#decl":r||(t=t.replace(u,function(t){return"".concat(s,"\n").concat(t)}));break;case"fs:#main-start":r||(t=t.replace(u,function(t){return t+s}));break;case"fs:#main-end":r||(t=t.replace(l,function(t){return s+t}));break;default:t=t.replace(e,function(t){return t+s})}};for(var h in n)o(h);return i&&(t=t.replace("}s*$",function(t){return t+s[e]})),t}function f(t){var e={};return Object(o.a)(Array.isArray(t)&&t.length>1),t.forEach(function(t){for(var n in t)e[n]=e[n]?"".concat(e[n],"\n").concat(t[n]):t[n]}),e}},rxlC:function(t,e,n){"use strict";t.exports=r,t.exports.default=r;var i=1e20;function r(t,e,n,i,r,a){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=a||"normal",this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function a(t,e,n,i,r,a,s){for(var u=0;u<e;u++){for(var l=0;l<n;l++)i[l]=t[l*e+u];for(o(i,r,a,s,n),l=0;l<n;l++)t[l*e+u]=r[l]}for(l=0;l<n;l++){for(u=0;u<e;u++)i[u]=t[l*e+u];for(o(i,r,a,s,e),u=0;u<e;u++)t[l*e+u]=Math.sqrt(r[u])}}function o(t,e,n,r,a){n[0]=0,r[0]=-i,r[1]=+i;for(var o=1,s=0;o<a;o++){for(var u=(t[o]+o*o-(t[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);u<=r[s];)s--,u=(t[o]+o*o-(t[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);n[++s]=o,r[s]=u,r[s+1]=+i}for(o=0,s=0;o<a;o++){for(;r[s+1]<o;)s++;e[o]=(o-n[s])*(o-n[s])+t[n[s]]}}r.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var o=e.data[4*r+3]/255;this.gridOuter[r]=1===o?0:0===o?i:Math.pow(Math.max(0,.5-o),2),this.gridInner[r]=1===o?i:0===o?0:Math.pow(Math.max(0,o-.5),2)}for(a(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),a(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++){var s=this.gridOuter[r]-this.gridInner[r];n[r]=Math.max(0,Math.min(255,Math.round(255-255*(s/this.radius+this.cutoff))))}return n}},s4An:function(t,e,n){"use strict";function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}n.d(e,"a",function(){return i})},"t+rZ":function(t,e,n){"use strict";n.d(e,"e",function(){return o}),n.d(e,"f",function(){return s}),n.d(e,"b",function(){return u}),n.d(e,"c",function(){return l}),n.d(e,"d",function(){return c}),n.d(e,"a",function(){return h});var i=n("LhmN"),r=n("1eIE"),a=n("7Kp1");function o(t,e,n){var r=i.c[e],o=r?r(t,Number(e)):t.getParameter(Number(e)),s=i.d[e];return Object(a.a)("function"==typeof s),s(t,n,Number(e)),o}function s(t,e){var n={};for(var r in e){var a=Number(r),o=i.d[r];o&&("string"==typeof o?n[o]=!0:o(t,e[r],a))}var s=t.state&&t.state.cache;if(s){var u=Object.assign({},s,e);for(var l in n){(0,i.a[l])(t,u)}}}function u(t,e){var n=i.c[e];return n?n(t,Number(e)):t.getParameter(Number(e))}function l(t,e){e=e||i.b;var n=Array.isArray(e)?e:Object.keys(e),r={},a=!0,o=!1,s=void 0;try{for(var l,c=n[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var h=l.value;r[h]=u(t,h)}}catch(f){o=!0,s=f}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}return r}function c(t){s(t,Object.assign({},i.b,{}))}function h(t){var e=l(i.b),n={};for(var a in i.b)Object(r.a)(e[a],i.b[a])||(n[a]=e[a]);return n}},tjlA:function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var i=n("H7XF"),r=n("kVK+"),a=n("49sm");function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return l(this,t,e,n)}function l(t,e,n,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,i){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,n):new Uint8Array(e,n,i);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=f(t,e);return t}(t,e,n,i):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|A(e,n),r=(t=s(t,i)).write(e,n);r!==i&&(t=t.slice(0,r));return t}(t,e,n):function(t,e){if(u.isBuffer(e)){var n=0|p(e.length);return 0===(t=s(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(i=e.length)!=i?s(t,0):f(t,e);if("Buffer"===e.type&&a(e.data))return f(t,e.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(c(e),t=s(t,e<0?0:0|p(e)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function f(t,e){var n=e.length<0?0:0|p(e.length);t=s(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function p(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function A(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return N(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return U(t).length;default:if(i)return N(t).length;e=(""+e).toLowerCase(),i=!0}}function d(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function v(t,e,n,i,r){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(r)return-1;n=t.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof e&&(e=u.from(e,i)),u.isBuffer(e))return 0===e.length?-1:g(t,e,n,i,r);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):g(t,[e],n,i,r);throw new TypeError("val must be string, number or Buffer")}function g(t,e,n,i,r){var a,o=1,s=t.length,u=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;o=2,s/=2,u/=2,n/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(r){var c=-1;for(a=n;a<s;a++)if(l(t,a)===l(e,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===u)return c*o}else-1!==c&&(a-=a-c),c=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var h=!0,f=0;f<u;f++)if(l(t,a+f)!==l(e,f)){h=!1;break}if(h)return a}return-1}function m(t,e,n,i){n=Number(n)||0;var r=t.length-n;i?(i=Number(i))>r&&(i=r):i=r;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var o=0;o<i;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[n+o]=s}return o}function y(t,e,n,i){return V(N(e,t.length-n),t,n,i)}function _(t,e,n,i){return V(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,i)}function b(t,e,n,i){return _(t,e,n,i)}function x(t,e,n,i){return V(U(e),t,n,i)}function w(t,e,n,i){return V(function(t,e){for(var n,i,r,a=[],o=0;o<t.length&&!((e-=2)<0);++o)n=t.charCodeAt(o),i=n>>8,r=n%256,a.push(r),a.push(i);return a}(e,t.length-n),t,n,i)}function S(t,e,n){return 0===e&&n===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,n))}function k(t,e,n){n=Math.min(t.length,n);for(var i=[],r=e;r<n;){var a,o,s,u,l=t[r],c=null,h=l>239?4:l>223?3:l>191?2:1;if(r+h<=n)switch(h){case 1:l<128&&(c=l);break;case 2:128==(192&(a=t[r+1]))&&(u=(31&l)<<6|63&a)>127&&(c=u);break;case 3:a=t[r+1],o=t[r+2],128==(192&a)&&128==(192&o)&&(u=(15&l)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:a=t[r+1],o=t[r+2],s=t[r+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,h=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),r+=h}return function(t){var e=t.length;if(e<=O)return String.fromCharCode.apply(String,t);var n="",i=0;for(;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=O));return n}(i)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}(),e.kMaxLength=o(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,n){return l(null,t,e,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,n){return function(t,e,n,i){return c(e),e<=0?s(t,e):void 0!==n?"string"==typeof i?s(t,e).fill(n,i):s(t,e).fill(n):s(t,e)}(null,t,e,n)},u.allocUnsafe=function(t){return h(null,t)},u.allocUnsafeSlow=function(t){return h(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,i=e.length,r=0,a=Math.min(n,i);r<a;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:i<n?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var i=u.allocUnsafe(e),r=0;for(n=0;n<t.length;++n){var o=t[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},u.byteLength=A,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?k(this,0,t):function(t,e,n){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return C(this,e,n);case"utf8":case"utf-8":return k(this,e,n);case"ascii":return P(this,e,n);case"latin1":case"binary":return E(this,e,n);case"base64":return S(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,n);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,n,i,r){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),e<0||n>t.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&e>=n)return 0;if(i>=r)return-1;if(e>=n)return 1;if(this===t)return 0;for(var a=(r>>>=0)-(i>>>=0),o=(n>>>=0)-(e>>>=0),s=Math.min(a,o),l=this.slice(i,r),c=t.slice(e,n),h=0;h<s;++h)if(l[h]!==c[h]){a=l[h],o=c[h];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},u.prototype.indexOf=function(t,e,n){return v(this,t,e,n,!0)},u.prototype.lastIndexOf=function(t,e,n){return v(this,t,e,n,!1)},u.prototype.write=function(t,e,n,i){if(void 0===e)i="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)i=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-e;if((void 0===n||n>r)&&(n=r),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return m(this,t,e,n);case"utf8":case"utf-8":return y(this,t,e,n);case"ascii":return _(this,t,e,n);case"latin1":case"binary":return b(this,t,e,n);case"base64":return x(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,t,e,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var O=4096;function P(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(127&t[r]);return i}function E(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(t[r]);return i}function C(t,e,n){var i=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>i)&&(n=i);for(var r="",a=e;a<n;++a)r+=F(t[a]);return r}function T(t,e,n){for(var i=t.slice(e,n),r="",a=0;a<i.length;a+=2)r+=String.fromCharCode(i[a]+256*i[a+1]);return r}function M(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function j(t,e,n,i,r,a){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<a)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function L(t,e,n,i){e<0&&(e=65535+e+1);for(var r=0,a=Math.min(t.length-n,2);r<a;++r)t[n+r]=(e&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function I(t,e,n,i){e<0&&(e=4294967295+e+1);for(var r=0,a=Math.min(t.length-n,4);r<a;++r)t[n+r]=e>>>8*(i?r:3-r)&255}function z(t,e,n,i,r,a){if(n+i>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(t,e,n,i,a){return a||z(t,0,n,4),r.write(t,e,n,i,23,4),n+4}function B(t,e,n,i,a){return a||z(t,0,n,8),r.write(t,e,n,i,52,8),n+8}u.prototype.slice=function(t,e){var n,i=this.length;if((t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=u.prototype;else{var r=e-t;n=new u(r,void 0);for(var a=0;a<r;++a)n[a]=this[a+t]}return n},u.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||M(t,e,this.length);for(var i=this[t],r=1,a=0;++a<e&&(r*=256);)i+=this[t+a]*r;return i},u.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||M(t,e,this.length);for(var i=this[t+--e],r=1;e>0&&(r*=256);)i+=this[t+--e]*r;return i},u.prototype.readUInt8=function(t,e){return e||M(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||M(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||M(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||M(t,e,this.length);for(var i=this[t],r=1,a=0;++a<e&&(r*=256);)i+=this[t+a]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*e)),i},u.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||M(t,e,this.length);for(var i=e,r=1,a=this[t+--i];i>0&&(r*=256);)a+=this[t+--i]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*e)),a},u.prototype.readInt8=function(t,e){return e||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||M(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(t,e){e||M(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(t,e){return e||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||M(t,4,this.length),r.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||M(t,4,this.length),r.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||M(t,8,this.length),r.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||M(t,8,this.length),r.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,n,i){(t=+t,e|=0,n|=0,i)||j(this,t,e,n,Math.pow(2,8*n)-1,0);var r=1,a=0;for(this[e]=255&t;++a<n&&(r*=256);)this[e+a]=t/r&255;return e+n},u.prototype.writeUIntBE=function(t,e,n,i){(t=+t,e|=0,n|=0,i)||j(this,t,e,n,Math.pow(2,8*n)-1,0);var r=n-1,a=1;for(this[e+r]=255&t;--r>=0&&(a*=256);)this[e+r]=t/a&255;return e+n},u.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):I(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);j(this,t,e,n,r-1,-r)}var a=0,o=1,s=0;for(this[e]=255&t;++a<n&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+n},u.prototype.writeIntBE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);j(this,t,e,n,r-1,-r)}var a=n-1,o=1,s=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+n},u.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):I(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||j(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,n){return D(this,t,e,!0,n)},u.prototype.writeFloatBE=function(t,e,n){return D(this,t,e,!1,n)},u.prototype.writeDoubleLE=function(t,e,n){return B(this,t,e,!0,n)},u.prototype.writeDoubleBE=function(t,e,n){return B(this,t,e,!1,n)},u.prototype.copy=function(t,e,n,i){if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var r,a=i-n;if(this===t&&n<e&&e<i)for(r=a-1;r>=0;--r)t[r+e]=this[r+n];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)t[r+e]=this[r+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+a),e);return a},u.prototype.fill=function(t,e,n,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var a;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(a=e;a<n;++a)this[a]=t;else{var o=u.isBuffer(t)?t:N(new u(t,i).toString()),s=o.length;for(a=0;a<n-e;++a)this[a+e]=o[a%s]}return this};var R=/[^+\/0-9A-Za-z-_]/g;function F(t){return t<16?"0"+t.toString(16):t.toString(16)}function N(t,e){var n;e=e||1/0;for(var i=t.length,r=null,a=[],o=0;o<i;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(o+1===i){(e-=3)>-1&&a.push(239,191,189);continue}r=n;continue}if(n<56320){(e-=3)>-1&&a.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(e-=3)>-1&&a.push(239,191,189);if(r=null,n<128){if((e-=1)<0)break;a.push(n)}else if(n<2048){if((e-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function U(t){return i.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(R,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function V(t,e,n,i){for(var r=0;r<i&&!(r+n>=e.length||r>=t.length);++r)e[r+n]=t[r];return r}}).call(this,n("3r9c"))},uTBh:function(t,e,n){"use strict";n.r(e);var i=n("1OyB"),r=n("vuIU"),a=n("IIwk"),o=n("iTDY"),s=new(n("d3wX").a)({id:"luma"}).enable(),u=n("JOTL"),l=(n("eUbh"),new(function(){function t(){Object(i.a)(this,t),this.stats=new Map}return Object(r.a)(t,[{key:"get",value:function(t){return this.stats.has(t)||this.stats.set(t,new u.a({id:t})),this.stats.get(t)}}]),t}()));if(o.b.luma&&"7.1.0"!==o.b.luma.VERSION)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(o.b.luma.VERSION," vs ").concat("7.1.0"));o.b.luma||(a.a&&s.log(1,"luma.gl ".concat("7.1.0"," - ").concat("set luma.log.priority=1 (or higher) to trace rendering"))(),o.b.luma=o.b.luma||{VERSION:"7.1.0",version:"7.1.0",log:s,stats:l,globals:{modules:{},nodeIO:{}}});o.b.luma;var c=n("t+rZ"),h=n("ODXe"),f=n("KQm4");function p(t){return Array.isArray(t)||ArrayBuffer.isView(t)}var A={framebuffer:function(t,e){var n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:function(t,e){return e?t.enable(3042):t.disable(3042)},blendColor:function(t,e){return t.blendColor.apply(t,Object(f.a)(e))},blendEquation:function(t,e){e=p(e)?e:[e,e],t.blendEquationSeparate.apply(t,Object(f.a)(e))},blendFunc:function(t,e){e=p(e)&&2===e.length?[].concat(Object(f.a)(e),Object(f.a)(e)):e,t.blendFuncSeparate.apply(t,Object(f.a)(e))},clearColor:function(t,e){return t.clearColor.apply(t,Object(f.a)(e))},clearDepth:function(t,e){return t.clearDepth(e)},clearStencil:function(t,e){return t.clearStencil(e)},colorMask:function(t,e){return t.colorMask.apply(t,Object(f.a)(e))},cull:function(t,e){return e?t.enable(2884):t.disable(2884)},cullFace:function(t,e){return t.cullFace(e)},depthTest:function(t,e){return e?t.enable(2929):t.disable(2929)},depthFunc:function(t,e){return t.depthFunc(e)},depthMask:function(t,e){return t.depthMask(e)},depthRange:function(t,e){return t.depthRange.apply(t,Object(f.a)(e))},dither:function(t,e){return e?t.enable(3024):t.disable(3024)},derivativeHint:function(t,e){t.hint(35723,e)},frontFace:function(t,e){return t.frontFace(e)},mipmapHint:function(t,e){return t.hint(33170,e)},lineWidth:function(t,e){return t.lineWidth(e)},polygonOffsetFill:function(t,e){return e?t.enable(32823):t.disable(32823)},polygonOffset:function(t,e){return t.polygonOffset.apply(t,Object(f.a)(e))},sampleCoverage:function(t,e){return t.sampleCoverage.apply(t,Object(f.a)(e))},scissorTest:function(t,e){return e?t.enable(3089):t.disable(3089)},scissor:function(t,e){return t.scissor.apply(t,Object(f.a)(e))},stencilTest:function(t,e){return e?t.enable(2960):t.disable(2960)},stencilMask:function(t,e){var n=e=p(e)?e:[e,e],i=Object(h.a)(n,2),r=i[0],a=i[1];t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,a)},stencilFunc:function(t,e){var n=e=p(e)&&3===e.length?[].concat(Object(f.a)(e),Object(f.a)(e)):e,i=Object(h.a)(n,6),r=i[0],a=i[1],o=i[2],s=i[3],u=i[4],l=i[5];t.stencilFuncSeparate(1028,r,a,o),t.stencilFuncSeparate(1029,s,u,l)},stencilOp:function(t,e){var n=e=p(e)&&3===e.length?[].concat(Object(f.a)(e),Object(f.a)(e)):e,i=Object(h.a)(n,6),r=i[0],a=i[1],o=i[2],s=i[3],u=i[4],l=i[5];t.stencilOpSeparate(1028,r,a,o),t.stencilOpSeparate(1029,s,u,l)},viewport:function(t,e){return t.viewport.apply(t,Object(f.a)(e))}};function d(t,e){for(var n in Object(c.f)(t,e),e){var i=A[n];i&&i(t,e[n],n)}}var v=n("U//q"),g=n("7Kp1");function m(t,e,n){if(Object(g.b)(e))return n(t);var i,r=e.nocatch,a=void 0===r||r;if(Object(g.a)(!e.frameBuffer),Object(v.c)(t),d(t,e),a)i=n(t),Object(v.b)(t);else try{i=n(t)}finally{Object(v.b)(t)}return i}var y=n("FWU8"),_=n("vpQ4"),b="Failed to create WebGL context in Node.js, headless gl not available",x="Failed to create WebGL context in Node.js, headless gl returned null";function w(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}var S={};function k(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";S[t]=S[t]||1;var e=S[t]++;return"".concat(t,"-").concat(e)}function O(t){return w("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)}function P(t){var e=!0;for(var n in t){e=!1;break}return e}function E(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.isInteger,i=void 0!==n&&n;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e){for(var n=e.maxElts,i=void 0===n?16:n,r=e.size,a=void 0===r?1:r,o="[",s=0;s<t.length&&s<i;++s)s>0&&(o+=",".concat(s%a==0?" ":"")),o+=E(t[s],e);var u=t.length>i?"...":"]";return"".concat(o).concat(u)}(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return i?"0":"0.";if(i)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function C(t,e,n,i){var r="See luma.gl ".concat(n," Upgrade Guide at http://uber.github.io/luma.gl/#/documentation/overview/upgrade-guide"),a=Object.getPrototypeOf(t);i.forEach(function(t){a.methodName||(a[t]=function(){throw s.removed("Calling removed method ".concat(e,".").concat(t,": "),r)(),new Error(t)})})}function T(t,e,n){var i=n.removedProps,r=void 0===i?{}:i,a=n.deprecatedProps,o=void 0===a?{}:a,u=n.replacedProps,l=void 0===u?{}:u;for(var c in r)if(c in e){var h=r[c]?"".concat(t,".").concat(r[c]):"N/A";s.removed("".concat(t,".").concat(c),h)()}for(var f in o)if(f in e){var p=o[f];s.deprecated("".concat(t,".").concat(f),"".concat(t,".").concat(p))()}var A=null;for(var d in l)if(d in e){var v=l[d];s.deprecated("".concat(t,".").concat(d),"".concat(t,".").concat(v))(),(A=A||Object.assign({},e))[v]=e[d],delete A[d]}return A||e}var M,j=a.a&&"undefined"!=typeof document,L=j&&"complete"===document.readyState;function I(){return M||(M=j?new Promise(function(t,e){if(j&&"complete"===document.readyState)return L=!0,void t(document);window.onload=function(){L=!0,t(document)}}):Promise.resolve({})),M}function z(t){var e,n=t.canvas,i=t.width,r=t.height,a=t.onError,o=void 0===a?function(){}:a;return"string"==typeof n?(L||o("createGLContext called on canvas '".concat(n,"' before page was loaded")),e=document.getElementById(n)):e=n||function(t){var e=t.width,n=void 0===e?800:e,i=t.height,r=void 0===i?600:i,a=t.id,o=void 0===a?"gl-canvas":a,s=t.insert,u=void 0===s||s,l=document.createElement("canvas");if(l.id=o,l.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",l.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",u){var c=document.body;c.insertBefore(l,c.firstChild)}return l}({id:"lumagl-canvas",width:i,height:r,onError:o}),e}function D(t){var e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info");return{vendor:i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936)||e,renderer:i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937)||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}var B="Invalid WebGLRenderingContext",R="Requires WebGL2";function F(t){return Boolean(t&&Number.isFinite(t._version))}function N(t){return Boolean(t&&2===t._version)}function U(t){w(F(t),B)}function V(t){w(N(t),R)}function G(t){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function W(t){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var H="Failed to deduce GL constant from typed array";function q(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(H)}}function Z(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,n=void 0===e||e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function X(t){for(var e=t.data,n=t.width,i=t.height,r=Math.round(n/2),a=Math.round(i/2),o=new Uint8Array(r*a*4),s=0;s<a;s++)for(var u=0;u<r;u++)for(var l=0;l<4;l++)o[4*(s*r+u)+l]=e[4*(2*s*n+2*u)+l];return{data:o,width:r,height:a}}function Q(t,e){if("string"!=typeof e)return e;var n=Number(e);if(!isNaN(n))return n;var i=t[e=e.replace(/^.*\./,"")];return w(void 0!==i,"Accessing undefined constant GL.".concat(e)),i}function Y(t,e){for(var n in e=Number(e),t)if(t[n]===e)return"GL.".concat(n);return String(e)}var K,J,$,tt=n("rePB"),et=n("md7G"),nt=n("foSv"),it=n("JX7q"),rt=n("Ji7U"),at="Resource subclass must define virtual methods",ot=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),U(e);var r=n.id,a=n.userData,o=void 0===a?{}:a;this.gl=e,this.id=r||k(this.constructor.name),this.userData=o,this._bound=!1,this._handle=n.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}return Object(r.a)(t,[{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.id,")")}},{key:"delete",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).deleteChildren,e=void 0!==t&&t,n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(function(t){t.delete()}),this}},{key:"bind",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof e?(this._bindHandle(e),this):(this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t)}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(t=Q(this.gl,t));var n=(this.constructor.PARAMETERS||{})[t];if(n){var i=N(this.gl);if(!((!("webgl2"in n)||i)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){var r=n.webgl1,a="webgl2"in n?n.webgl2:n.webgl1;return i?a:r}}return this._getParameter(t,e)}},{key:"getParameters",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},n=e.parameters,i=e.keys,r=this.constructor.PARAMETERS||{},a=N(this.gl),o={},s=n||Object.keys(r),u=!0,l=!1,c=void 0;try{for(var h,f=s[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value,A=r[p];if(A&&(!("webgl2"in A)||a)&&(!("extension"in A)||this.gl.getExtension(A.extension))){var d=i?Y(this.gl,p):p;o[d]=this.getParameter(p,t),i&&"GLenum"===A.type&&(o[d]=Y(this.gl,o[d]))}}}catch(v){l=!0,c=v}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}return o}},{key:"setParameter",value:function(t,e){w(t=Q(this.gl,t));var n=(this.constructor.PARAMETERS||{})[t];if(n){var i=N(this.gl);if(!((!("webgl2"in n)||i)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(e=Q(e))}return this._setParameter(t,e),this}},{key:"setParameters",value:function(t){for(var e in t)this.setParameter(e,t[e]);return this}},{key:"stubRemovedMethods",value:function(t,e,n){return C(this,t,e,n)}},{key:"initialize",value:function(t){}},{key:"_createHandle",value:function(){throw new Error(at)}},{key:"_deleteHandle",value:function(){throw new Error(at)}},{key:"_bindHandle",value:function(){throw new Error(at)}},{key:"_getOptsFromHandle",value:function(){throw new Error(at)}},{key:"_getParameter",value:function(t,e){throw new Error(at)}},{key:"_setParameter",value:function(t,e){throw new Error(at)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_addStats",value:function(){var t=this.constructor.name,e=l.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}},{key:"_removeStats",value:function(){var t=this.constructor.name;l.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}},{key:"_trackAllocatedMemory",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.constructor.name,n=l.get("Memory Usage");n.get("GPU Memory").addCount(t),n.get("".concat(e," Memory")).addCount(t),this.byteLength=t}},{key:"_trackDeallocatedMemory",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.constructor.name,e=l.get("Memory Usage");e.get("GPU Memory").subtractCount(this.byteLength),e.get("".concat(t," Memory")).subtractCount(this.byteLength),this.byteLength=0}},{key:"handle",get:function(){return this._handle}}]),t}(),st=n("RHh3"),ut={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},lt={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},ct=function(){function t(){var e=this;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];r.forEach(function(t){return e._assign(t)}),Object.freeze(this)}return Object(r.a)(t,null,[{key:"getBytesPerElement",value:function(t){return Z(t.type||5126).BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(t){return w(t.size),Z(t.type||5126).BYTES_PER_ELEMENT*t.size}},{key:"resolve",value:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Object(st.a)(t,[ut].concat(n))}}]),Object(r.a)(t,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"_assign",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0!==(t=T("Accessor",t,lt)).type&&(this.type=t.type,5124!==t.type&&5125!==t.type||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&("boolean"==typeof index?this.index=t.index?1:0:this.index=t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}},{key:"BYTES_PER_ELEMENT",get:function(){return t.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return t.getBytesPerVertex(this)}}]),t}(),ht={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},ft={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:ht},pt={removedProps:ht},At=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,r))).stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),n.target=r.target||(n.gl.webgl2?36662:34962),n.initialize(r),Object.seal(Object(it.a)(n)),n}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"getElementCount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/ct.getBytesPerElement(t))}},{key:"getVertexCount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/ct.getBytesPerVertex(t))}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=T("Buffer",t,ft),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data):this._setByteLength(t.byteLength||0),this}},{key:"setProps",value:function(t){return"accessor"in(t=T("Buffer",t,pt))&&this.setAccessor(t.accessor),this}},{key:"setAccessor",value:function(t){return delete(t=Object.assign({},t)).buffer,this.accessor=new ct(t),this}},{key:"reallocate",value:function(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}},{key:"setData",value:function(t){return this.initialize(t)}},{key:"subData",value:function(t){ArrayBuffer.isView(t)&&(t={data:t});var e=t,n=e.data,i=e.offset,r=void 0===i?0:i,a=e.srcOffset,o=void 0===a?0:a,s=t.byteLength||t.length;w(n);var u=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(u,this.handle),0!==o||void 0!==s?(V(this.gl),this.gl.bufferSubData(this.target,r,n,o,s)):this.gl.bufferSubData(u,r,n),this.gl.bindBuffer(u,null),this.debugData=null,this._inferType(n),this}},{key:"copyData",value:function(t){var e=t.sourceBuffer,n=t.readOffset,i=void 0===n?0:n,r=t.writeOffset,a=void 0===r?0:r,o=t.size,s=this.gl;return V(s),s.bindBuffer(36662,e.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,i,a,o),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.dstData,n=void 0===e?null:e,i=t.srcByteOffset,r=void 0===i?0:i,a=t.dstOffset,o=void 0===a?0:a,s=t.length,u=void 0===s?0:s;V(this.gl);var l,c,h=Z(this.accessor.type||5126,{clamped:!1}),f=this._getAvailableElementCount(r),p=o;n?l=(c=n.length)-p:c=p+(l=Math.min(f,u||f));var A=Math.min(f,l);return w((u=u||A)<=A),n=n||new h(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,r,n,o,u),this.gl.bindBuffer(36662,null),n}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,n=void 0===e?this.target:e,i=t.index,r=void 0===i?this.accessor&&this.accessor.index:i,a=t.offset,o=void 0===a?0:a,s=t.size;return 35345===n||35982===n?void 0!==s?this.gl.bindBufferRange(n,r,this.handle,o,s):(w(0===o),this.gl.bindBufferBase(n,r,this.handle)):this.gl.bindBuffer(n,this.handle),this}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,n=void 0===e?this.target:e,i=t.index,r=void 0===i?this.accessor&&this.accessor.index:i;return 35345===n||35982===n?this.gl.bindBufferBase(n,r,null):this.gl.bindBuffer(n,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:10}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_setData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;w(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();var n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,e),this.gl.bindBuffer(n,null),this.usage=e,this.debugData=t.slice(0,10),this.bytesUsed=t.byteLength,this._trackAllocatedMemory(t.byteLength);var i=q(t);return w(i),this.setAccessor(new ct(this.accessor,{type:i})),this}},{key:"_setByteLength",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;w(t>=0),this._trackDeallocatedMemory();var n=t;0===t&&(n=new Float32Array(0));var i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(t){var e=t/Z(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}},{key:"_inferType",value:function(t){this.accessor.type||this.setAccessor(new ct(this.accessor,{type:q(t)}))}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_getParameter",value:function(t){this.gl.bindBuffer(this.target,this.handle);var e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}},{key:"setByteLength",value:function(t){return s.deprecated("setByteLength","reallocate")(),this.reallocate(t)}},{key:"updateAccessor",value:function(t){return s.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ct(this.accessor,t),this}},{key:"type",get:function(){return s.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}},{key:"bytes",get:function(){return s.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}}]),e}(ot),dt=(K={},Object(tt.a)(K,6407,{dataFormat:6407,types:[5121,33635]}),Object(tt.a)(K,6408,{dataFormat:6408,types:[5121,32819,32820]}),Object(tt.a)(K,6406,{dataFormat:6406,types:[5121]}),Object(tt.a)(K,6409,{dataFormat:6409,types:[5121]}),Object(tt.a)(K,6410,{dataFormat:6410,types:[5121]}),Object(tt.a)(K,33326,{dataFormat:6403,types:[5126],gl2:!0}),Object(tt.a)(K,33328,{dataFormat:33319,types:[5126],gl2:!0}),Object(tt.a)(K,34837,{dataFormat:6407,types:[5126],gl2:!0}),Object(tt.a)(K,34836,{dataFormat:6408,types:[5126],gl2:!0}),K),vt=(J={},Object(tt.a)(J,6403,1),Object(tt.a)(J,36244,1),Object(tt.a)(J,33319,2),Object(tt.a)(J,33320,2),Object(tt.a)(J,6407,3),Object(tt.a)(J,36248,3),Object(tt.a)(J,6408,4),Object(tt.a)(J,36249,4),Object(tt.a)(J,6402,1),Object(tt.a)(J,34041,1),Object(tt.a)(J,6406,1),Object(tt.a)(J,6409,1),Object(tt.a)(J,6410,2),J),gt=($={},Object(tt.a)($,5126,4),Object(tt.a)($,5125,4),Object(tt.a)($,5124,4),Object(tt.a)($,5123,2),Object(tt.a)($,5122,2),Object(tt.a)($,5131,2),Object(tt.a)($,5120,1),Object(tt.a)($,5121,1),$);var mt=[9729,9728],yt=function(t){function e(t,n){var r;Object(i.a)(this,e);var a=n.id,o=void 0===a?k("texture"):a,s=n.handle,u=n.target;return(r=Object(et.a)(this,Object(nt.a)(e).call(this,t,{id:o,handle:s}))).target=u,r.hasFloatTexture=t.getExtension("OES_texture_float"),r.textureUnit=void 0,r.loaded=!1,r.width=void 0,r.height=void 0,r.depth=void 0,r.format=void 0,r.type=void 0,r.dataFormat=void 0,r.border=void 0,r.textureUnit=void 0,r.mipmaps=void 0,r}return Object(rt.a)(e,t),Object(r.a)(e,null,[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.format,i=e.linearFiltering,r=!0;return n&&(r=(r=r&&function(t,e){var n=dt[e];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;var i=N(t)&&n.gl2||n.gl1;return"string"==typeof i?t.getExtension(i):i}(t,n))&&(!i||function(t,e){var n=dt[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}(t,n))),r}}]),Object(r.a)(e,[{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(function(n){return t.initialize(Object.assign({},e,{pixels:n,data:n}))}),this;var i=e.pixels,r=void 0===i?null:i,a=e.format,o=void 0===a?6408:a,u=e.type,l=void 0===u?5121:u,c=e.border,h=void 0===c?0:c,f=e.recreate,p=void 0!==f&&f,A=e.parameters,d=void 0===A?{}:A,v=e.pixelStore,g=void 0===v?{}:v,m=e.textureUnit,y=void 0===m?void 0:m,_=e.unpackFlipY,b=void 0===_||_,x=e.mipmaps,w=void 0===x||x;n||(n=r);var S=e.width,k=e.height,O=e.dataFormat,P=e.depth,E=void 0===P?0:P,C=this._deduceParameters({format:o,type:l,dataFormat:O,compressed:!1,data:n,width:S,height:k});S=C.width,k=C.height,O=C.dataFormat,this.width=S,this.height=k,this.depth=E,this.format=o,this.type=l,this.dataFormat=O,this.border=h,this.textureUnit=y,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle));var T=Object(tt.a)({},37440,b),M=Object.assign({},T,g);return w&&this._isNPOT()&&(s.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),w=!1,this._updateForNPOT(d)),this.mipmaps=w,this.setImageData({data:n,width:S,height:k,depth:E,format:o,type:l,dataFormat:O,border:h,mipmaps:w,parameters:M}),w&&this.generateMipmap(),this.setParameters(d),p&&(this.data=n),this}},{key:"resize",value:function(t){var e=t.width,n=t.height;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:!1}):this}},{key:"generateMipmap",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindTexture(this.target,this.handle),m(this.gl,e,function(){t.gl.generateMipmap(t.target)}),this.gl.bindTexture(this.target,null),this}},{key:"setImageData",value:function(t){this._trackDeallocatedMemory("Texture");var e=t.target,n=void 0===e?this.target:e,i=t.pixels,r=void 0===i?null:i,a=t.level,o=void 0===a?0:a,s=t.format,u=void 0===s?this.format:s,l=t.border,c=void 0===l?this.border:l,h=t.offset,f=void 0===h?0:h,p=t.parameters,A=void 0===p?{}:p,d=t.data,v=void 0===d?null:d,g=t.type,y=void 0===g?this.type:g,_=t.width,b=void 0===_?this.width:_,x=t.height,S=void 0===x?this.height:x,k=t.dataFormat,O=void 0===k?this.dataFormat:k,P=t.compressed,E=void 0!==P&&P;v||(v=r);var C=this._deduceParameters({format:u,type:y,dataFormat:O,compressed:E,data:v,width:b,height:S});y=C.type,O=C.dataFormat,E=C.compressed,b=C.width,S=C.height;var T=this.gl;T.bindTexture(this.target,this.handle);var M,j=this._getDataType({data:v,compressed:E});if(v=j.data,M=j.dataType,m(this.gl,A,function(){switch(M){case"null":T.texImage2D(n,o,u,b,S,c,O,y,v);break;case"typed-array":T.texImage2D(n,o,u,b,S,c,O,y,v,f);break;case"buffer":V(T),T.bindBuffer(35052,v.handle||v),T.texImage2D(n,o,u,b,S,c,O,y,f),T.bindBuffer(35052,null);break;case"browser-object":N(T)?T.texImage2D(n,o,u,b,S,c,O,y,v):T.texImage2D(n,o,u,O,y,v);break;case"compressed":T.compressedTexImage2D(n,o,u,b,S,c,v);break;default:w(!1,"Unknown image data type")}}),v&&v.byteLength)this._trackAllocatedMemory(v.byteLength,"Texture");else{var L=vt[this.dataFormat]||4,I=gt[this.type]||1;this._trackAllocatedMemory(this.width*this.height*L*I,"Texture")}return this.loaded=!0,this}},{key:"setSubImageData",value:function(t){var e=this,n=t.target,i=void 0===n?this.target:n,r=t.pixels,a=void 0===r?null:r,o=t.data,s=void 0===o?null:o,u=t.x,l=void 0===u?0:u,c=t.y,h=void 0===c?0:c,f=t.width,p=void 0===f?this.width:f,A=t.height,d=void 0===A?this.height:A,v=t.level,g=void 0===v?0:v,_=t.format,b=void 0===_?this.format:_,x=t.type,S=void 0===x?this.type:x,k=t.dataFormat,O=void 0===k?this.dataFormat:k,P=t.compressed,E=void 0!==P&&P,C=t.offset,T=void 0===C?0:C,M=t.border,j=(void 0===M&&this.border,t.parameters),L=void 0===j?{}:j,I=this._deduceParameters({format:b,type:S,dataFormat:O,compressed:E,data:s,width:p,height:d});if(S=I.type,O=I.dataFormat,E=I.compressed,p=I.width,d=I.height,w(0===this.depth,"texSubImage not supported for 3D textures"),s||(s=a),s&&s.data){var z=s;s=z.data,p=z.shape[0],d=z.shape[1]}s instanceof At&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),m(this.gl,L,function(){E?e.gl.compressedTexSubImage2D(i,g,l,h,p,d,b,s):null===s?e.gl.texSubImage2D(i,g,l,h,p,d,O,S,null):ArrayBuffer.isView(s)?e.gl.texSubImage2D(i,g,l,h,p,d,O,S,s,T):s instanceof y.b?(V(e.gl),e.gl.bindBuffer(35052,s),e.gl.texSubImage2D(i,g,l,h,p,d,O,S,T),e.gl.bindBuffer(35052,null)):N(e.gl)?e.gl.texSubImage2D(i,g,l,h,p,d,O,S,s):e.gl.texSubImage2D(i,g,l,h,O,S,s)}),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return s.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,e=this.gl;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,e=this.gl;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}},{key:"_getDataType",value:function(t){var e=t.data,n=t.compressed;return void 0!==n&&n?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof At?{data:e.handle,dataType:"buffer"}:e instanceof y.b?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(t){var e=t.format,n=t.data,i=t.width,r=t.height,a=t.dataFormat,o=t.type,s=t.compressed,u=dt[e];a=a||u&&u.dataFormat,o=o||u&&u.types[0],s=s||u&&u.compressed;var l=this._deduceImageSize(n,i,r);return{dataFormat:a,type:o,compressed:s,width:i=l.width,height:r=l.height,format:e,data:n}}},{key:"_deduceImageSize",value:function(t,e,n){var i;return w(i="undefined"!=typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement?{width:t.width,height:t.height}:"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:n}:{width:e>=0?e:1,height:n>=0?n:1},"Could not deduced texture size"),w(void 0===e||i.width===e,"Deduced texture width does not match supplied width"),w(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}},{key:"_setParameter",value:function(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:w(!1);break;default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return!N(this.gl)&&(!(!this.width||!this.height)&&(!O(this.width)||!O(this.height)))}},{key:"_updateForNPOT",value:function(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(t,e){if(this._isNPOT())switch(t){case 10241:-1===mt.indexOf(e)&&(e=9729);break;case 10242:case 10243:33071!==e&&(e=33071)}return e}}]),e}(ot),_t="";function bt(t){_t=t}function xt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w("string"==typeof t),t=_t+t;var n=e.dataType||"text";return fetch(t,e).then(function(t){return t[n]()})}function wt(t,e){return w("string"==typeof t),t=_t+t,new Promise(function(n,i){try{var r=new Image;r.onload=function(){return n(r)},r.onerror=function(){return i(new Error("Could not load image ".concat(t,".")))},r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(a){i(a)}})}var St=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),U(t),(r instanceof Promise||"string"==typeof r)&&(r={data:r}),"string"==typeof r.data&&(r=Object.assign({},r,{data:wt(r.data)})),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({},r,{target:3553})))).initialize(r),Object.seal(Object(it.a)(n)),n}return Object(rt.a)(e,t),Object(r.a)(e,null,[{key:"isSupported",value:function(t,e){return yt.isSupported(t,e)}}]),e}(yt),kt=n("o0o1"),Ot=n.n(kt),Pt=n("HaE+"),Et=[34069,34070,34071,34072,34073,34074],Ct=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),U(t),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({},r,{target:34067})))).initialize(r),Object.seal(Object(it.a)(n)),n}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.mipmaps,i=void 0===n||n,r=e.parameters,a=void 0===r?{}:r;this.opts=e,this.setCubeMapImageData(e).then(function(){t.loaded=!0,i&&t.generateMipmap(e),t.setParameters(a)})}},{key:"subImage",value:function(t){var e=t.face,n=t.data,i=t.x,r=void 0===i?0:i,a=t.y,o=void 0===a?0:a,s=t.mipmapLevel,u=void 0===s?0:s;return this._subImage({target:e,data:n,x:r,y:o,mipmapLevel:u})}},{key:"setCubeMapImageData",value:function(){var t=Object(Pt.a)(Ot.a.mark(function t(e){var n,i,r,a,o,u,l,c,h,f,p,A,d,v=this;return Ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.width,i=e.height,r=e.pixels,a=e.data,o=e.border,u=void 0===o?0:o,l=e.format,c=void 0===l?6408:l,h=e.type,f=void 0===h?5121:h,p=this.gl,A=r||a,t.next=5,Promise.all(Et.map(function(t){var e=A[t];return Promise.all(Array.isArray(e)?e:[e])}));case 5:d=t.sent,this.bind(),Et.forEach(function(t,e){d[e].length>1&&!1!==v.opts.mipmaps&&s.warn("".concat(v.id," has mipmap and multiple LODs."))(),d[e].forEach(function(e,r){n&&i?p.texImage2D(t,r,c,n,i,u,c,f,e):p.texImage2D(t,r,c,c,f,e)})}),this.unbind();case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"setImageDataForFace",value:function(t){var e=this,n=t.face,i=t.width,r=t.height,a=t.pixels,o=t.data,s=t.border,u=void 0===s?0:s,l=t.format,c=void 0===l?6408:l,h=t.type,f=void 0===h?5121:h,p=this.gl,A=a||o;return this.bind(),A instanceof Promise?A.then(function(i){return e.setImageDataForFace(Object.assign({},t,{face:n,data:i,pixels:i}))}):this.width||this.height?p.texImage2D(n,0,c,i,r,u,c,f,A):p.texImage2D(n,0,c,c,f,A),this}}]),e}(yt);Ct.FACES=Et;var Tt,Mt=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),V(t),r=Object.assign({depth:1},r,{target:32879,unpackFlipY:!1}),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,r))).initialize(r),Object.seal(Object(it.a)(n)),n}return Object(rt.a)(e,t),Object(r.a)(e,null,[{key:"isSupported",value:function(t){return N(t)}}]),Object(r.a)(e,[{key:"setImageData",value:function(t){var e=this,n=t.level,i=void 0===n?0:n,r=t.dataFormat,a=void 0===r?6408:r,o=t.width,s=t.height,u=t.depth,l=void 0===u?1:u,c=t.border,h=void 0===c?0:c,f=t.format,p=t.type,A=void 0===p?5121:p,d=t.offset,v=void 0===d?0:d,g=t.data,y=t.parameters,_=void 0===y?{}:y;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),m(this.gl,_,function(){ArrayBuffer.isView(g)&&e.gl.texImage3D(e.target,i,a,o,s,l,h,f,A,g),g instanceof At&&(e.gl.bindBuffer(35052,g.handle),e.gl.texImage3D(e.target,i,a,o,s,l,h,f,A,v))}),g&&g.byteLength)this._trackAllocatedMemory(g.byteLength,"Texture");else{var b=vt[this.dataFormat]||4,x=gt[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*b*x,"Texture")}return this.loaded=!0,this}}]),e}(yt),jt="EXT_color_buffer_float",Lt=(Tt={},Object(tt.a)(Tt,33189,{bpp:2}),Object(tt.a)(Tt,33190,{gl2:!0,bpp:3}),Object(tt.a)(Tt,36012,{gl2:!0,bpp:4}),Object(tt.a)(Tt,36168,{bpp:1}),Object(tt.a)(Tt,34041,{bpp:4}),Object(tt.a)(Tt,35056,{gl2:!0,bpp:4}),Object(tt.a)(Tt,36013,{gl2:!0,bpp:5}),Object(tt.a)(Tt,32854,{bpp:2}),Object(tt.a)(Tt,36194,{bpp:2}),Object(tt.a)(Tt,32855,{bpp:2}),Object(tt.a)(Tt,33321,{gl2:!0,bpp:1}),Object(tt.a)(Tt,33330,{gl2:!0,bpp:1}),Object(tt.a)(Tt,33329,{gl2:!0,bpp:1}),Object(tt.a)(Tt,33332,{gl2:!0,bpp:2}),Object(tt.a)(Tt,33331,{gl2:!0,bpp:2}),Object(tt.a)(Tt,33334,{gl2:!0,bpp:4}),Object(tt.a)(Tt,33333,{gl2:!0,bpp:4}),Object(tt.a)(Tt,33323,{gl2:!0,bpp:2}),Object(tt.a)(Tt,33336,{gl2:!0,bpp:2}),Object(tt.a)(Tt,33335,{gl2:!0,bpp:2}),Object(tt.a)(Tt,33338,{gl2:!0,bpp:4}),Object(tt.a)(Tt,33337,{gl2:!0,bpp:4}),Object(tt.a)(Tt,33340,{gl2:!0,bpp:8}),Object(tt.a)(Tt,33339,{gl2:!0,bpp:8}),Object(tt.a)(Tt,32849,{gl2:!0,bpp:3}),Object(tt.a)(Tt,32856,{gl2:!0,bpp:4}),Object(tt.a)(Tt,32857,{gl2:!0,bpp:4}),Object(tt.a)(Tt,36220,{gl2:!0,bpp:4}),Object(tt.a)(Tt,36238,{gl2:!0,bpp:4}),Object(tt.a)(Tt,36975,{gl2:!0,bpp:4}),Object(tt.a)(Tt,36214,{gl2:!0,bpp:8}),Object(tt.a)(Tt,36232,{gl2:!0,bpp:8}),Object(tt.a)(Tt,36226,{gl2:!0,bpp:16}),Object(tt.a)(Tt,36208,{gl2:!0,bpp:16}),Object(tt.a)(Tt,33325,{gl2:jt,bpp:2}),Object(tt.a)(Tt,33327,{gl2:jt,bpp:4}),Object(tt.a)(Tt,34842,{gl2:jt,bpp:8}),Object(tt.a)(Tt,33326,{gl2:jt,bpp:4}),Object(tt.a)(Tt,33328,{gl2:jt,bpp:8}),Object(tt.a)(Tt,34836,{gl2:jt,bpp:16}),Object(tt.a)(Tt,35898,{gl2:jt,bpp:4}),Tt);var It,zt=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,r))).initialize(r),Object.seal(Object(it.a)(n)),n}return Object(rt.a)(e,t),Object(r.a)(e,null,[{key:"isSupported",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).format;return!e||function(t,e,n){var i=n[e];if(!i)return!1;var r=N(t)&&i.gl2||i.gl1;return"string"==typeof r?t.getExtension(r):r}(t,e,Lt)}},{key:"getSamplesForFormat",value:function(t,e){var n=e.format;return t.getInternalformatParameter(36161,n,32937)}}]),Object(r.a)(e,[{key:"initialize",value:function(t){var e=t.format,n=t.width,i=void 0===n?1:n,r=t.height,a=void 0===r?1:r,o=t.samples,s=void 0===o?0:o;return w(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==s&&N(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,i,a):this.gl.renderbufferStorage(36161,e,i,a),this.format=e,this.width=i,this.height=a,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Lt[this.format].bpp),this}},{key:"resize",value:function(t){var e=t.width,n=t.height;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_bindHandle",value:function(t){this.gl.bindRenderbuffer(36161,t)}},{key:"_syncHandle",value:function(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}]),e}(ot),Dt=256,Bt=1024,Rt=16384,Ft=6144,Nt=6145,Ut=6146,Vt=34041,Gt="clear: bad arguments";function Wt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.framebuffer,i=void 0===n?null:n,r=e.color,a=void 0===r?null:r,o=e.depth,s=void 0===o?null:o,u=e.stencil,l=void 0===u?null:u,c={};i&&(c.framebuffer=i);var h=0;a&&(h|=Rt,!0!==a&&(c.clearColor=a)),s&&(h|=Dt,!0!==s&&(c.clearDepth=s)),l&&(h|=Bt,!0!==s&&(c.clearStencil=s)),w(0!==h,Gt),m(t,c,function(){t.clear(h)})}function Ht(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.framebuffer,i=void 0===n?null:n,r=e.buffer,a=void 0===r?Ft:r,o=e.drawBuffer,s=void 0===o?0:o,u=e.value,l=void 0===u?[0,0,0,0]:u;V(t),m(t,{framebuffer:i},function(){switch(a){case Ft:switch(l.constructor){case Int32Array:t.clearBufferiv(a,s,l);break;case Uint32Array:t.clearBufferuiv(a,s,l);break;case Float32Array:default:t.clearBufferfv(a,s,l)}break;case Nt:t.clearBufferfv(Nt,0,[l]);break;case Ut:t.clearBufferiv(Ut,0,[l]);break;case Vt:var e=Object(h.a)(l,2),n=e[0],i=e[1];t.clearBufferfi(Vt,0,n,i);break;default:w(!1,Gt)}})}function qt(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return w(!1),0}}function Zt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.sourceX,i=void 0===n?0:n,r=e.sourceY,a=void 0===r?0:r,o=e.sourceFormat,s=void 0===o?6408:o,u=e.sourceAttachment,l=void 0===u?36064:u,c=e.target,h=void 0===c?null:c,f=e.sourceWidth,p=e.sourceHeight,A=e.sourceType,d=$t(t),v=d.framebuffer,g=d.deleteFramebuffer;w(v);var m=v.gl,y=v.handle,_=v.attachments;f=f||v.width,p=p||v.height,36064===l&&null===y&&(l=1028),w(_[l]),h=function(t,e,n,i,r){if(t)return t;var a=Z(e=e||5121,{clamped:!1}),o=qt(n);return new a(i*r*o)}(h,A=A||_[l].type,s,f,p),A=A||q(h);var b=m.bindFramebuffer(36160,y);return m.readPixels(i,a,f,p,s,A,h),m.bindFramebuffer(36160,b||null),g&&v.delete(),h}function Xt(t,e){var n=e.sourceX,i=void 0===n?0:n,r=e.sourceY,a=void 0===r?0:r,o=e.sourceFormat,s=void 0===o?6408:o,u=e.target,l=void 0===u?null:u,c=e.targetByteOffset,h=void 0===c?0:c,f=e.sourceWidth,p=e.sourceHeight,A=e.sourceType,d=$t(t),v=d.framebuffer,g=d.deleteFramebuffer;w(v);var y=v.gl;if(f=f||v.width,p=p||v.height,V(y),A=A||(l?l.type:5121),!l){var _=qt(s),b=function(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return w(!1),0}}(A);l=new At(y,{byteLength:h+f*p*_*b,accessor:{type:A,size:_}})}return l.bind({target:35051}),m(y,{framebuffer:v},function(){y.readPixels(i,a,f,p,s,A,h)}),l.unbind({target:35051}),g&&v.delete(),l}function Qt(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.sourceAttachment,i=void 0===n?36064:n,r=e.targetMaxHeight,a=void 0===r?Number.MAX_SAFE_INTEGER:r,o=Zt(t,{sourceAttachment:i}),s=t.width,u=t.height;u>a;){var l=X({data:o,width:s,height:u});o=l.data,s=l.width,u=l.height}!function(t){var e=t.data,n=t.width,i=t.height,r=t.bytesPerPixel,a=void 0===r?4:r,o=t.temp,s=n*a;o=o||new Uint8Array(s);for(var u=0;u<i/2;++u){var l=u*s,c=(i-u-1)*s;o.set(e.subarray(l,l+s)),e.copyWithin(l,c,c+s),e.set(o,c)}}({data:o,width:s,height:u});var c=document.createElement("canvas");c.width=s,c.height=u;var h=c.getContext("2d"),f=h.createImageData(s,u);return f.data.set(o),h.putImageData(f,0,0),c.toDataURL()}function Yt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.sourceAttachment,i=void 0===n?36064:n,r=e.targetImage,a=void 0===r?null:r,o=Qt(t,{sourceAttachment:i});return(a=a||new Image).src=o,a}function Kt(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.sourceX,r=void 0===i?0:i,a=n.sourceY,o=void 0===a?0:a,s=n.targetX,u=n.targetY,l=n.targetZ,c=n.targetMipmaplevel,h=void 0===c?0:c,f=n.targetInternalFormat,p=void 0===f?6408:f,A=n.width,d=n.height,v=$t(t),g=v.framebuffer,m=v.deleteFramebuffer;w(g);var y=g.gl,_=g.handle,b=void 0!==s||void 0!==u||void 0!==l;s=s||0,u=u||0,l=l||0;var x=y.bindFramebuffer(36160,_);w(e);var S=null;if(e instanceof yt&&(S=e,A=Number.isFinite(A)?A:S.width,d=Number.isFinite(d)?d:S.height,S.bind(0),e=S.target),b)switch(e){case 3553:case 34067:y.copyTexSubImage2D(e,h,s,u,r,o,A,d);break;case 35866:case 32879:y.copyTexSubImage3D(e,h,s,u,l,r,o,A,d)}else y.copyTexImage2D(e,h,p,r,o,A,d,0);return S&&S.unbind(),y.bindFramebuffer(36160,x||null),m&&g.delete(),S}function Jt(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.sourceAttachment,r=void 0===i?36064:i,a=n.sourceX0,o=void 0===a?0:a,u=n.sourceY0,l=void 0===u?0:u,c=n.sourceX1,h=n.sourceY1,f=n.targetX0,p=void 0===f?0:f,A=n.targetY0,d=void 0===A?0:A,v=n.targetX1,g=n.targetY1,m=n.color,y=void 0===m||m,_=n.depth,b=void 0!==_&&_,x=n.stencil,S=void 0!==x&&x,k=n.mask,O=void 0===k?0:k,P=n.filter,E=void 0===P?9728:P,C=$t(t),T=C.framebuffer,M=C.deleteFramebuffer,j=$t(e),L=j.framebuffer,I=j.deleteFramebuffer;w(T),w(L);var z=L.gl,D=L.handle,B=L.width,R=L.height,F=L.readBuffer;V(z),T.handle||36064!==r||(r=1028),y&&(O|=16384),b&&(O|=256),S&&(O|=1024),(M||I)&&1280&O&&(O=16384,s.warn("Blitting from or into a Texture object, forcing mask to GL.COLOR_BUFFER_BIT")()),w(O),c=void 0===c?T.width:c,h=void 0===h?T.height:h,v=void 0===v?B:v,g=void 0===g?R:g;var N=z.bindFramebuffer(36009,D),U=z.bindFramebuffer(36008,T.handle);return z.readBuffer(r),z.blitFramebuffer(o,l,c,h,p,d,v,g,O,E),z.readBuffer(F),z.bindFramebuffer(36008,U||null),z.bindFramebuffer(36009,N||null),M&&T.delete(),I&&L.delete(),L}function $t(t){return t instanceof pe?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:(e=t,i=e.gl,r=e.width,a=e.height,o=e.id,s=new pe(i,Object.assign({},n,{id:"framebuffer-for-".concat(o),width:r,height:a,attachments:Object(tt.a)({},36064,e)})),s),deleteFramebuffer:!0};var e,n,i,r,a,o,s}var te,ee=(It={},Object(tt.a)(It,33902,{gl1:new Float32Array([1,1])}),Object(tt.a)(It,33901,{gl1:new Float32Array([1,1])}),Object(tt.a)(It,3379,{gl1:64,gl2:2048}),Object(tt.a)(It,34076,{gl1:16}),Object(tt.a)(It,34930,{gl1:8}),Object(tt.a)(It,35661,{gl1:8}),Object(tt.a)(It,35660,{gl1:0}),Object(tt.a)(It,34024,{gl1:1}),Object(tt.a)(It,36348,{gl1:8}),Object(tt.a)(It,34921,{gl1:8}),Object(tt.a)(It,36347,{gl1:128}),Object(tt.a)(It,36349,{gl1:16}),Object(tt.a)(It,3386,{gl1:new Int32Array([0,0])}),Object(tt.a)(It,32883,{gl1:0,gl2:256}),Object(tt.a)(It,35071,{gl1:0,gl2:256}),Object(tt.a)(It,37447,{gl1:0,gl2:0}),Object(tt.a)(It,36063,{gl1:0,gl2:4}),Object(tt.a)(It,35379,{gl1:0,gl2:0}),Object(tt.a)(It,35374,{gl1:0,gl2:0}),Object(tt.a)(It,35377,{gl1:0,gl2:0}),Object(tt.a)(It,34852,{gl1:0,gl2:4}),Object(tt.a)(It,36203,{gl1:0,gl2:0}),Object(tt.a)(It,33001,{gl1:0,gl2:0}),Object(tt.a)(It,33e3,{gl1:0,gl2:0}),Object(tt.a)(It,37157,{gl1:0,gl2:0}),Object(tt.a)(It,35373,{gl1:0,gl2:0}),Object(tt.a)(It,35657,{gl1:0,gl2:0}),Object(tt.a)(It,36183,{gl1:0,gl2:0}),Object(tt.a)(It,37137,{gl1:0,gl2:0}),Object(tt.a)(It,34045,{gl1:0,gl2:0}),Object(tt.a)(It,35978,{gl1:0,gl2:0}),Object(tt.a)(It,35979,{gl1:0,gl2:0}),Object(tt.a)(It,35968,{gl1:0,gl2:0}),Object(tt.a)(It,35376,{gl1:0,gl2:0}),Object(tt.a)(It,35375,{gl1:0,gl2:0}),Object(tt.a)(It,35659,{gl1:0,gl2:0}),Object(tt.a)(It,37154,{gl1:0,gl2:0}),Object(tt.a)(It,35371,{gl1:0,gl2:0}),Object(tt.a)(It,35658,{gl1:0,gl2:0}),Object(tt.a)(It,35076,{gl1:0,gl2:-8,negative:!0}),Object(tt.a)(It,35077,{gl1:0,gl2:7}),Object(tt.a)(It,35380,{gl1:0,gl2:0}),It);function ne(t){if(t.luma=t.luma||{},!t.luma.limits){t.luma.limits={},t.luma.webgl1MinLimits={},t.luma.webgl2MinLimits={};var e=N(t);for(var n in ee){var i=ee[n],r=i.gl1,a="gl2"in i?i.gl2:i.gl1,o=e?a:r,s="gl2"in i&&!e||"extension"in i&&!t.getExtension(i.extension)?o:t.getParameter(n);t.luma.limits[n]=s,t.luma.webgl1MinLimits[n]=r,t.luma.webgl2MinLimits[n]=a}}return t.luma.limits}function ie(t){t.luma=t.luma||{};var e,n=D(t);t.luma.info||(t.luma.info=(e={},Object(tt.a)(e,37445,n.vendor),Object(tt.a)(e,37446,n.renderer),Object(tt.a)(e,7936,n.vendorMasked),Object(tt.a)(e,7937,n.rendererMasked),Object(tt.a)(e,7938,n.version),Object(tt.a)(e,35724,n.shadingLanguageVersion),e));return t.luma.info}function re(t){return Object.assign(D(t),{limits:ne(t),info:ie(t),webgl1MinLimits:t.luma.webgl1MinLimits,webgl2MinLimits:t.luma.webgl2MinLimits})}var ae={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"},oe=(te={},Object(tt.a)(te,ae.WEBGL2,[function(t){return N(t)}]),Object(tt.a)(te,ae.VERTEX_ARRAY_OBJECT,["OES_vertex_array_object",!0]),Object(tt.a)(te,ae.TIMER_QUERY,["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"]),Object(tt.a)(te,ae.INSTANCED_RENDERING,["ANGLE_instanced_arrays",!0]),Object(tt.a)(te,ae.MULTIPLE_RENDER_TARGETS,["WEBGL_draw_buffers",!0]),Object(tt.a)(te,ae.ELEMENT_INDEX_UINT32,["OES_element_index_uint",!0]),Object(tt.a)(te,ae.BLEND_EQUATION_MINMAX,["EXT_blend_minmax",!0]),Object(tt.a)(te,ae.COLOR_ENCODING_SRGB,["EXT_sRGB",!0]),Object(tt.a)(te,ae.TEXTURE_DEPTH,["WEBGL_depth_texture",!0]),Object(tt.a)(te,ae.TEXTURE_FLOAT,["OES_texture_float",!0]),Object(tt.a)(te,ae.TEXTURE_HALF_FLOAT,["OES_texture_half_float",!0]),Object(tt.a)(te,ae.TEXTURE_FILTER_LINEAR_FLOAT,["OES_texture_float_linear"]),Object(tt.a)(te,ae.TEXTURE_FILTER_LINEAR_HALF_FLOAT,["OES_texture_half_float_linear"]),Object(tt.a)(te,ae.TEXTURE_FILTER_ANISOTROPIC,["EXT_texture_filter_anisotropic"]),Object(tt.a)(te,ae.COLOR_ATTACHMENT_RGBA32F,["WEBGL_color_buffer_float","EXT_color_buffer_float"]),Object(tt.a)(te,ae.COLOR_ATTACHMENT_FLOAT,[!1,"EXT_color_buffer_float"]),Object(tt.a)(te,ae.COLOR_ATTACHMENT_HALF_FLOAT,[!1,"EXT_color_buffer_half_float"]),Object(tt.a)(te,ae.GLSL_FRAG_DATA,["WEBGL_draw_buffers",!0]),Object(tt.a)(te,ae.GLSL_FRAG_DEPTH,["EXT_frag_depth",!0]),Object(tt.a)(te,ae.GLSL_DERIVATIVES,["OES_standard_derivatives",!0]),Object(tt.a)(te,ae.GLSL_TEXTURE_LOD,["EXT_shader_texture_lod",!0]),te);function se(t,e){return ue(t,e)}function ue(t,e){return(e=Array.isArray(e)?e:[e]).every(function(e){return ce(t,e)})}function le(t){if(t.luma=t.luma||{},!t.luma.caps)for(var e in t.luma.caps={},t.luma.caps.webgl2=N(t),oe)t.luma.caps[e]=ce(t,e);return t.luma.caps}function ce(t,e){var n=oe[e];w(n,e);var i,r=N(t)&&n[1]||n[0];if("function"==typeof r)i=r(t);else if(Array.isArray(r)){i=!0;var a=!0,o=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;i=i&&Boolean(t.getExtension(c))}}catch(h){o=!0,s=h}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}}else"string"==typeof r?i=Boolean(t.getExtension(r)):"boolean"==typeof r?i=r:w(!1);return i}var he={};function fe(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=oe[e];if(w(i,e),!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="undefined"!=typeof window&&window.navigator||{},n=t.userAgent||e.userAgent||"",i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r}(n))return!0;if(e in he)return he[e];var r=i[0],a="#extension GL_".concat(r," : enable\nvoid main(void) {}"),o=t.createShader(35633);t.shaderSource(o,a),t.compileShader(o);var s=t.getShaderParameter(o,35713);return t.deleteShader(o),he[e]=s,s}var pe=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,r))).width=null,n.height=null,n.attachments={},n.readBuffer=36064,n.drawBuffers=[36064],n.initialize(r),Object.seal(Object(it.a)(n)),n}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"MAX_COLOR_ATTACHMENTS",get:function(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}}],[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.colorBufferFloat,i=e.colorBufferHalfFloat;return n&&t.getExtension(N(t)?"EXT_color_buffer_float":"WEBGL.color_buffer_float"),i&&t.getExtension(N(t)?"EXT_color_buffer_float":"EXT_color_buffer_half_float")}},{key:"getDefaultFramebuffer",value:function(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new e(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}}]),Object(r.a)(e,[{key:"initialize",value:function(t){var e=t.width,n=void 0===e?1:e,i=t.height,r=void 0===i?1:i,a=t.attachments,o=void 0===a?null:a,s=t.color,u=void 0===s||s,l=t.depth,c=void 0===l||l,h=t.stencil,f=void 0!==h&&h,p=t.check,A=void 0===p||p,d=t.readBuffer,v=t.drawBuffers;if(w(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,o)for(var g in o){var m=o[g];(Array.isArray(m)?m[0]:m).resize({width:n,height:r})}else o=this._createDefaultAttachments(u,c,f,n,r);this.update({clearAttachments:!0,attachments:o,readBuffer:d,drawBuffers:v}),o&&A&&this.checkStatus()}},{key:"update",value:function(t){var e=t.attachments,n=void 0===e?{}:e,i=t.readBuffer,r=t.drawBuffers,a=t.clearAttachments,o=void 0!==a&&a,s=t.resizeAttachments,u=void 0===s||s;this.attach(n,{clearAttachments:o,resizeAttachments:u});var l=this.gl,c=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),l.bindFramebuffer(36160,c||null),this}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,n=t.height;if(null===this.handle)return w(void 0===e&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;for(var i in void 0===e&&(e=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&s.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n))(),this.attachments)this.attachments[i].resize({width:e,height:n});return this.width=e,this.height=n,this}},{key:"attach",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.clearAttachments,r=void 0!==i&&i,a=n.resizeAttachments,o=void 0===a||a,s={};r&&Object.keys(this.attachments).forEach(function(t){s[t]=null}),Object.assign(s,t);var u=this.gl.bindFramebuffer(36160,this.handle);for(var l in s){w(void 0!==l,"Misspelled framebuffer binding point?");var c=Number(l),f=s[c],p=f;if(p)if(p instanceof zt)this._attachRenderbuffer({attachment:c,renderbuffer:p});else if(Array.isArray(f)){var A=Object(h.a)(f,3),d=A[0],v=A[1],g=void 0===v?0:v,m=A[2],y=void 0===m?0:m;p=d,this._attachTexture({attachment:c,texture:d,layer:g,level:y})}else this._attachTexture({attachment:c,texture:p,layer:0,level:0});else this._unattach(c);o&&p&&p.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,u||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(function(t){return!e.attachments[t]}).forEach(function(t){delete e.attachments[t]})}},{key:"checkStatus",value:function(){var t=this.gl,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);if(t.bindFramebuffer(36160,e||null),36053!==n)throw new Error(function(t){return(pe.STATUS||{})[t]||"Framebuffer error ".concat(t)}(n));return this}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.color,n=t.depth,i=t.stencil,r=t.drawBuffers,a=void 0===r?[]:r,o=this.gl.bindFramebuffer(36160,this.handle);return(e||n||i)&&Wt(this.gl,{color:e,depth:n,stencil:i}),a.forEach(function(t,e){Ht({drawBuffer:e,value:t})}),this.gl.bindFramebuffer(36160,o||null),this}},{key:"readPixels",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return s.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}},{key:"readPixelsToBuffer",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return s.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}},{key:"copyToDataUrl",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return s.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}},{key:"copyToImage",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return s.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}},{key:"copyToTexture",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return s.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"blit",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return s.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}},{key:"invalidate",value:function(t){var e=t.attachments,n=void 0===e?[]:e,i=t.x,r=void 0===i?0:i,a=t.y,o=void 0===a?0:a,s=t.width,u=t.height,l=this.gl;V(l);var c=l.bindFramebuffer(36008,this.handle);return 0===r&&0===o&&void 0===s&&void 0===u?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,r,o,s,u),l.bindFramebuffer(36008,c),this}},{key:"getAttachmentParameter",value:function(t,e,n){var i=this._getAttachmentParameterFallback(e);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=Y(this.gl,i)),i}},{key:"getAttachmentParameters",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],i={},r=!0,a=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value;i[e?Y(this.gl,l):l]=this.getAttachmentParameter(t,l,e)}}catch(c){a=!0,o=c}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return i}},{key:"getParameters",value:function(){for(var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e={},n=0,i=Object.keys(this.attachments);n<i.length;n++){var r=i[n],a=Number(r);e[t?Y(this.gl,a):a]=this.getAttachmentParameters(a,t)}return e}},{key:"show",value:function(){return"undefined"!=typeof window&&window.open(Qt(this),"luma-debug-texture"),this}},{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t>s.priority||"undefined"==typeof window)return this;e=e||"Framebuffer ".concat(this.id);var n=Qt(this,{maxHeight:100});return s.image({priority:t,message:e,image:n},e)(),this}},{key:"bind",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,e=void 0===t?36160:t;return this.gl.bindFramebuffer(e,this.handle),this}},{key:"unbind",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,e=void 0===t?36160:t;return this.gl.bindFramebuffer(e,null),this}},{key:"_createDefaultAttachments",value:function(t,e,n,i,r){var a,o=null;t&&((o=o||{})[36064]=new St(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:r,mipmaps:!1,parameters:(a={},Object(tt.a)(a,10241,9728),Object(tt.a)(a,10240,9728),Object(tt.a)(a,10242,33071),Object(tt.a)(a,10243,33071),a)}));return e&&n?(o=o||{})[33306]=new zt(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}):e?(o=o||{})[36096]=new zt(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:r}):n&&w(!1),o}},{key:"_unattach",value:function(t){var e=this.attachments[t];e&&(e instanceof zt?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}},{key:"_attachRenderbuffer",value:function(t){var e=t.attachment,n=void 0===e?36064:e,i=t.renderbuffer;this.gl.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}},{key:"_attachTexture",value:function(t){var e=t.attachment,n=void 0===e?36064:e,i=t.texture,r=t.layer,a=t.level,o=this.gl;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,i.target,a,r);break;case 34067:var s=function(t){return t<34069?t+34069:t}(r);o.framebufferTexture2D(36160,n,s,i.handle,a);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,a);break;default:w(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[n]=i}},{key:"_setReadBuffer",value:function(t){var e=this.gl;N(e)?e.readBuffer(t):w(36064===t||1029===t,"Multiple render targets not supported"),this.readBuffer=t}},{key:"_setDrawBuffers",value:function(t){var e=this.gl;if(N(e))e.drawBuffers(t);else{var n=e.getExtension("WEBGL.draw_buffers");n?n.drawBuffersWEBGL(t):w(1===t.length&&(36064===t[0]||1029===t[0]),"Multiple render targets not supported")}this.drawBuffers=t}},{key:"_getAttachmentParameterFallback",value:function(t){var e=le(this.gl);switch(t){case 36052:return e.webgl2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.webgl2?null:8;case 33297:return e.webgl2?null:5125;case 33296:return e.webgl2||e.EXT_sRGB?null:9729;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(t){return this.gl.bindFramebuffer(36160,t)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}}]),e}(ot);function Ae(t,e){w(t instanceof St||t instanceof Ct||t instanceof Mt);var n=t.constructor,i=t.gl,r=t.width,a=t.height,o=t.format,s=t.type,u=t.dataFormat,l=t.border,c=t.mipmaps;return new n(i,Object.assign({width:r,height:a,format:o,type:s,dataFormat:u,border:l,mipmaps:c},e))}pe.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];function de(t){return Boolean(t&&2===t._version)}var ve={webgl2:!0,webgl1:!0,throwOnFailure:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function ge(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(ve,{width:1,height:1},t)}function me(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e=Object.assign({},ve,e),i=n.width,r=n.height;function o(t){if(e.throwOnError)throw new Error(t);return null}a.a?t=function(t,e){var n=e.onError,i=void 0===n?function(t){return null}:n,r=function(t){return i("WebGL context: ".concat(t.statusMessage||"error"))};t.addEventListener("webglcontextcreationerror",r,!1);var a=e.webgl1,o=void 0===a||a,s=e.webgl2,u=void 0===s||s,l=null;return u&&(l=(l=l||t.getContext("webgl2",e))||t.getContext("experimental-webgl2",e)),o&&(l=(l=l||t.getContext("webgl",e))||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),l||i("Failed to create ".concat(u&&!o?"WebGL2":"WebGL"," context"))}(z({canvas:e.canvas,width:i,height:r,onError:o}),e):t=function(t){var e=t.width,n=t.height,i=t.webgl1,r=t.webgl2,a=t.onError;if(r&&!i)return a("headless-gl does not support WebGL2");if(!y.c)return a(b);var o=Object(y.c)(e,n,t);return o||a(x)}(Object(_.a)({},e,{width:i,height:r,onError:o}));return t?(function(t){var e=de(t)?"WebGL2":"WebGL1",n=D(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";s.once(1,"".concat(e).concat(r," context ").concat(i))()}(t=ye(t,e)),t):null}function ye(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t._instrumented)return t;t._version=t._version||function(t){if(void 0!==y.a&&t instanceof y.a)return 2;return 1}(t);var n=e=Object.assign({},ve,e),i=n.manageState,r=n.debug;return i&&Object(v.a)(t,{copyState:!1,log:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return s.log.apply(s,[1].concat(e))()}}),a.a&&r&&(o.b.makeDebugContext?(t=o.b.makeDebugContext(t,{debug:r}),s.priority=Math.max(s.priority,1)):s.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function _e(t){var e=t.getExtension("STACKGL_destroy_context");e&&e.destroy()}function be(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.canvas){var n=e.useDevicePixels&&window.devicePixelRatio||1,i="width"in e?e.width:t.canvas.clientWidth,r="height"in e?e.height:t.canvas.clientHeight;return t.canvas.width=i*n,void(t.canvas.height=r*n)}var a=t.getExtension("STACKGL_resize_drawingbuffer");a&&"width"in e&&"height"in e&&a.resize(e.width,e.height)}function xe(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed",n=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:e}var we=35632,Se=35633;function ke(t,e,n,i){for(var r=t.split(/\r?\n/),a={},o={},s=i||xe(e)||"(unnamed)",u="".concat(function(t){switch(t){case we:return"fragment";case Se:return"vertex";default:return"unknown type"}}(n)," shader ").concat(s),l=0;l<r.length;l++){var c=r[l];if(!(c.length<=1)){var h=c.split(":"),f=h[0],p=parseInt(h[2],10);if(isNaN(p))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));"WARNING"!==f?a[p]=c:o[p]=c}}var A=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ",i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map(function(t,i){var a=i+e,o=String(a).length,s=Pe(a,r-o);return s+n+t})}(e);return{shaderName:u,errors:Oe(a,A),warnings:Oe(o,A)}}function Oe(t,e){for(var n="",i=0;i<e.length;i++){var r=e[i];if((t[i+3]||t[i+2]||t[i+1])&&(n+="".concat(r,"\n"),t[i+1])){var a=t[i+1],o=a.split(":",3),s=o[0],u=parseInt(o[1],10)||0,l=a.substring(o.join(":").length+1).trim();n+=Pe("^^^ ".concat(s,": ").concat(l,"\n\n"),u)}}return n}function Pe(t,e){for(var n="",i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function Ee(t){var e=100,n=t.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){var i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}var Ce,Te,Me="Shader: GLSL source code must be a JavaScript string",je=function(t){function e(t,n){var r;Object(i.a)(this,e),U(t),w("string"==typeof n.source,Me);var a=xe(n.source,null)||n.id||k("unnamed ".concat(e.getTypeName(n.shaderType)));return(r=Object(et.a)(this,Object(nt.a)(e).call(this,t,{id:a}))).shaderType=n.shaderType,r.source=n.source,r.initialize(n),r}return Object(rt.a)(e,t),Object(r.a)(e,null,[{key:"getTypeName",value:function(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return w(!1),"unknown"}}}]),Object(r.a)(e,[{key:"initialize",value:function(t){var e=t.source,n=xe(e,null);n&&(this.id=k(n)),this._compile(e)}},{key:"getParameter",value:function(t){return this.gl.getShaderParameter(this.handle,t)}},{key:"toString",value:function(){return"".concat(e.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return xe(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var t=this.gl.getExtension("WEBGL.debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL.debug_shaders not implemented"}},{key:"_compile",value:function(){if(this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){var t=ke(this.gl.getShaderInfoLog(this.handle),this.source,this.shaderType,this.id),e=t.shaderName,n=t.errors,i=t.warnings;throw s.error("GLSL compilation errors in ".concat(e,"\n").concat(n))(),s.warn("GLSL compilation warnings in ".concat(e,"\n").concat(i))(),new Error("GLSL compilation errors in ".concat(e))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}]),e}(ot),Le=function(t){function e(t,n){return Object(i.a)(this,e),"string"==typeof n&&(n={source:n}),Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({},n,{shaderType:35633})))}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"_createHandle",value:function(){return this.gl.createShader(35633)}}]),e}(je),Ie=function(t){function e(t,n){return Object(i.a)(this,e),"string"==typeof n&&(n={source:n}),Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({},n,{shaderType:35632})))}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"_createHandle",value:function(){return this.gl.createShader(35632)}}]),e}(je),ze=n("ReuC"),De=(Ce={},Object(tt.a)(Ce,5126,function(t,e,n){return t.uniform1fv(e,Ve(n,1))}),Object(tt.a)(Ce,35664,function(t,e,n){return t.uniform2fv(e,Ve(n,2))}),Object(tt.a)(Ce,35665,function(t,e,n){return t.uniform3fv(e,Ve(n,3))}),Object(tt.a)(Ce,35666,function(t,e,n){return t.uniform4fv(e,Ve(n,4))}),Object(tt.a)(Ce,5124,function(t,e,n){return t.uniform1iv(e,Ge(n,1))}),Object(tt.a)(Ce,35667,function(t,e,n){return t.uniform2iv(e,Ge(n,2))}),Object(tt.a)(Ce,35668,function(t,e,n){return t.uniform3iv(e,Ge(n,3))}),Object(tt.a)(Ce,35669,function(t,e,n){return t.uniform4iv(e,Ge(n,4))}),Object(tt.a)(Ce,35670,function(t,e,n){return t.uniform1iv(e,Ge(n,1))}),Object(tt.a)(Ce,35671,function(t,e,n){return t.uniform2iv(e,Ge(n,2))}),Object(tt.a)(Ce,35672,function(t,e,n){return t.uniform3iv(e,Ge(n,3))}),Object(tt.a)(Ce,35673,function(t,e,n){return t.uniform4iv(e,Ge(n,4))}),Object(tt.a)(Ce,35674,function(t,e,n){return t.uniformMatrix2fv(e,!1,Ve(n,4))}),Object(tt.a)(Ce,35675,function(t,e,n){return t.uniformMatrix3fv(e,!1,Ve(n,9))}),Object(tt.a)(Ce,35676,function(t,e,n){return t.uniformMatrix4fv(e,!1,Ve(n,16))}),Object(tt.a)(Ce,35678,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,35680,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,5125,function(t,e,n){return t.uniform1uiv(e,We(n,1))}),Object(tt.a)(Ce,36294,function(t,e,n){return t.uniform2uiv(e,We(n,2))}),Object(tt.a)(Ce,36295,function(t,e,n){return t.uniform3uiv(e,We(n,3))}),Object(tt.a)(Ce,36296,function(t,e,n){return t.uniform4uiv(e,We(n,4))}),Object(tt.a)(Ce,35685,function(t,e,n){return t.uniformMatrix2x3fv(e,!1,Ve(n,6))}),Object(tt.a)(Ce,35686,function(t,e,n){return t.uniformMatrix2x4fv(e,!1,Ve(n,8))}),Object(tt.a)(Ce,35687,function(t,e,n){return t.uniformMatrix3x2fv(e,!1,Ve(n,6))}),Object(tt.a)(Ce,35688,function(t,e,n){return t.uniformMatrix3x4fv(e,!1,Ve(n,12))}),Object(tt.a)(Ce,35689,function(t,e,n){return t.uniformMatrix4x2fv(e,!1,Ve(n,8))}),Object(tt.a)(Ce,35690,function(t,e,n){return t.uniformMatrix4x3fv(e,!1,Ve(n,12))}),Object(tt.a)(Ce,35679,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,35682,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36289,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36292,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36293,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36298,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36299,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36300,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36303,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36306,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36307,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36308,function(t,e,n){return t.uniform1i(e,n)}),Object(tt.a)(Ce,36311,function(t,e,n){return t.uniform1i(e,n)}),Ce),Be={},Re={},Fe={},Ne=[0];function Ue(t,e,n,i){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(Ne[0]=t,t=Ne);var r=t.length;if(r%e&&s.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;var a=i[r];a||(a=new n(r),i[r]=a);for(var o=0;o<r;o++)a[o]=t[o];return a}function Ve(t,e){return Ue(t,e,Float32Array,Be)}function Ge(t,e){return Ue(t,e,Int32Array,Re)}function We(t,e){return Ue(t,e,Uint32Array,Fe)}function He(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};var e=t.match(/([^[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function qe(t,e,n){var i=De[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i.bind(null,t,e)}function Ze(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;for(var e=Math.min(t.length,16),n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}(t):!!isFinite(t)||(!0===t||!1===t||(t instanceof yt||(t instanceof zt||t instanceof pe&&Boolean(t.texture))))}function Xe(t,e){if(Array.isArray(t)||ArrayBuffer.isView(t)){if(!e)return!1;var n=t.length;if(e.length!==n)return!1;for(var i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return t===e}var Qe=5120,Ye=5121,Ke=5122,Je=5123,$e=0,tn=1,en=2,nn=3,rn=4,an=5,on=6,sn=5126,un=(Te={},Object(tt.a)(Te,sn,[sn,1,"float"]),Object(tt.a)(Te,35664,[sn,2,"vec2"]),Object(tt.a)(Te,35665,[sn,3,"vec3"]),Object(tt.a)(Te,35666,[sn,4,"vec4"]),Object(tt.a)(Te,5124,[5124,1,"int"]),Object(tt.a)(Te,35667,[5124,2,"ivec2"]),Object(tt.a)(Te,35668,[5124,3,"ivec3"]),Object(tt.a)(Te,35669,[5124,4,"ivec4"]),Object(tt.a)(Te,5125,[5125,1,"uint"]),Object(tt.a)(Te,36294,[5125,2,"uvec2"]),Object(tt.a)(Te,36295,[5125,3,"uvec3"]),Object(tt.a)(Te,36296,[5125,4,"uvec4"]),Object(tt.a)(Te,35670,[sn,1,"bool"]),Object(tt.a)(Te,35671,[sn,2,"bvec2"]),Object(tt.a)(Te,35672,[sn,3,"bvec3"]),Object(tt.a)(Te,35673,[sn,4,"bvec4"]),Object(tt.a)(Te,35674,[sn,8,"mat2"]),Object(tt.a)(Te,35685,[sn,8,"mat2x3"]),Object(tt.a)(Te,35686,[sn,8,"mat2x4"]),Object(tt.a)(Te,35675,[sn,12,"mat3"]),Object(tt.a)(Te,35687,[sn,12,"mat3x2"]),Object(tt.a)(Te,35688,[sn,12,"mat3x4"]),Object(tt.a)(Te,35676,[sn,16,"mat4"]),Object(tt.a)(Te,35689,[sn,16,"mat4x2"]),Object(tt.a)(Te,35690,[sn,16,"mat4x3"]),Te);function ln(t){switch(t){case $e:return $e;case tn:case nn:case en:return tn;case rn:case an:case on:return rn;default:return w(!1),0}}function cn(t){var e=un[t];if(!e)return null;var n=Object(h.a)(e,2);return{type:n[0],components:n[1]}}function hn(t,e){switch(t){case Qe:case Ye:case Ke:case Je:t=sn}for(var n in un){var i=Object(h.a)(un[n],3),r=i[0],a=i[1],o=i[2];if(r===t&&a===e)return{glType:n,name:o}}return null}var fn=function(){function t(e){Object(i.a)(this,t),this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}return Object(r.a)(t,[{key:"getAttributeInfo",value:function(t){var e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}},{key:"getAttributeLocation",value:function(t){var e=this.getAttributeInfo(t);return e?e.location:-1}},{key:"getAttributeAccessor",value:function(t){var e=this.getAttributeInfo(t);return e?e.accessor:null}},{key:"getVaryingInfo",value:function(t){var e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}},{key:"getVaryingIndex",value:function(t){var e=this.getVaryingInfo();return e?e.location:-1}},{key:"getVaryingAccessor",value:function(t){var e=this.getVaryingInfo();return e?e.accessor:null}},{key:"_readAttributesFromProgram",value:function(t){for(var e=t.gl,n=e.getProgramParameter(t.handle,35721),i=0;i<n;i++){var r=e.getActiveAttrib(t.handle,i),a=r.name,o=r.type,s=r.size,u=e.getAttribLocation(t.handle,a);u>=0&&this._addAttribute(u,a,o,s)}this.attributeInfos.sort(function(t,e){return t.location-e.location})}},{key:"_readVaryingsFromProgram",value:function(t){var e=t.gl;if(N(e)){for(var n=e.getProgramParameter(t.handle,35971),i=0;i<n;i++){var r=e.getTransformFeedbackVarying(t.handle,i),a=r.name,o=r.type,s=r.size;this._addVarying(i,a,o,s)}this.varyingInfos.sort(function(t,e){return t.location-e.location})}}},{key:"_addAttribute",value:function(t,e,n,i){var r=cn(n),a={type:r.type,size:i*r.components};this._inferProperties(t,e,a);var o={location:t,name:e,accessor:new ct(a)};this.attributeInfos.push(o),this.attributeInfosByLocation[t]=o,this.attributeInfosByName[o.name]=o}},{key:"_inferProperties",value:function(t,e,n){/instance/i.test(e)&&(n.divisor=1)}},{key:"_addVarying",value:function(t,e,n,i){var r=cn(n),a=r.type,o=r.components,s={location:t,name:e,accessor:new ct({type:a,size:i*o})};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}]),t}(),pn=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],An=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,r))).stubRemovedMethods("Program","v6.0",pn),n._isCached=!1,n.initialize(r),Object.seal(Object(it.a)(n)),n._setId(r.id),n}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vs,n=t.fs,i=t.varyings,r=t.bufferMode,a=void 0===r?35981:r;return this.vs="string"==typeof e?new Le(this.gl,{id:"".concat(t.id,"-vs"),source:e}):e,this.fs="string"==typeof n?new Ie(this.gl,{id:"".concat(t.id,"-fs"),source:n}):n,w(this.vs instanceof Le),w(this.fs instanceof Ie),this.uniforms={},i&&(V(this.gl),this.varyings=i,this.gl.transformFeedbackVaryings(this.handle,i,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new fn(this),this.setProps(t)}},{key:"delete",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:Object(ze.a)(Object(nt.a)(e.prototype),"delete",this).call(this,t)}},{key:"setProps",value:function(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}},{key:"draw",value:function(t){var e=this,n=t.logPriority,i=t.drawMode,r=void 0===i?4:i,a=t.vertexCount,o=t.offset,u=void 0===o?0:o,l=t.start,c=t.end,h=t.isIndexed,f=void 0!==h&&h,p=t.indexType,A=void 0===p?5123:p,d=t.isInstanced,v=void 0!==d&&d,g=t.instanceCount,y=void 0===g?0:g,_=t.vertexArray,b=void 0===_?null:_,x=t.transformFeedback,S=t.framebuffer,k=t.parameters,O=void 0===k?{}:k,P=t.uniforms,E=t.samplers;if((P||E)&&(s.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(P||{})),void 0!==n){var C=S?S.id:"default",T="mode=".concat(Y(this.gl,r)," verts=").concat(a," ")+"instances=".concat(y," indexType=").concat(Y(this.gl,A)," ")+"isInstanced=".concat(v," isIndexed=").concat(f," ")+"Framebuffer=".concat(C);s.log(n,T)()}return w(b),this.gl.useProgram(this.handle),!!this._areTexturesRenderable()&&(b.bindForDraw(a,y,function(){if(void 0!==S&&(O=Object.assign({},O,{framebuffer:S})),x){var t=ln(r);x.begin(t)}e._bindTextures(),m(e.gl,O,function(){f&&v?e.gl.drawElementsInstanced(r,a,A,u,y):f&&N(e.gl)&&!isNaN(l)&&!isNaN(c)?e.gl.drawRangeElements(r,l,c,a,A,u):f?e.gl.drawElements(r,a,A,u):v?e.gl.drawArraysInstanced(r,u,a,y):e.gl.drawArrays(r,u,a)}),x&&x.end()}),!0)}},{key:"setUniforms",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=!1,r={};for(var a in e)Xe(this.uniforms[a],e[a])||(i=!0,r[a]=e[a],this.uniforms[a]=(t=e[a],Array.isArray(t)||ArrayBuffer.isView(t)?t.slice():t));return i&&(n(),function(t,e,n){for(var i in t){var r=t[i];if((!n||Boolean(n[i]))&&!Ze(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}}(r,this.id,this._uniformSetters),this._setUniforms(r)),this}},{key:"reset",value:function(){}},{key:"_areTexturesRenderable",value:function(){var t=!0;for(var e in this.uniforms){var n=this._uniformSetters[e];if(n&&void 0!==n.textureIndex){var i=this.uniforms[e];if(i instanceof pe)i=i.texture;if(i instanceof yt)t=t&&i.loaded}}return t}},{key:"_bindTextures",value:function(){for(var t in this.uniforms){var e=this._uniformSetters[t];if(e&&void 0!==e.textureIndex){var n=this.uniforms[t];if(n instanceof pe&&(n=n.texture),n instanceof yt)n.bind(e.textureIndex)}}}},{key:"_setUniforms",value:function(t){for(var e in this.gl.useProgram(this.handle),t){var n=t[e],i=this._uniformSetters[e];if(i)if(n instanceof pe&&(n=n.texture),n instanceof yt){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);var r=n,a=i.textureIndex;r.bind(a),i(a)}else i(n)}return this}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(t){var e=this.gl.getAttachedShaders(t),n={},i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new Le({handle:u});break;case 35632:n.fs=new Ie({handle:u})}}}catch(l){r=!0,a=l}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}},{key:"_getParameter",value:function(t){return this.gl.getProgramParameter(this.handle,t)}},{key:"_setId",value:function(t){if(!t){var e=this._getName();this.id=k(e)}}},{key:"_getName",value:function(){var t=this.vs.getName()||this.fs.getName();return t=(t=t.replace(/shader/i,""))?"".concat(t,"-program"):"program"}},{key:"_compileAndLink",value:function(){var t=this.gl;if((t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),s.time(4,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),s.timeEnd(4,"linkProgram for ".concat(this._getName()))(),t.debug||s.priority>0)&&(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35714)))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)))}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var t=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var e=0;e<this._uniformCount;e++){var n=this.gl.getActiveUniform(this.handle,e),i=He(n.name),r=i.name,a=(i.isArray,t.getUniformLocation(this.handle,r));this._uniformSetters[r]=qe(t,a,n)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(t,e){return this.gl.getActiveUniforms(this.handle,t,e)}},{key:"getUniformBlockIndex",value:function(t){return this.gl.getUniformBlockIndex(this.handle,t)}},{key:"getActiveUniformBlockParameter",value:function(t,e){return this.gl.getActiveUniformBlockParameter(this.handle,t,e)}},{key:"uniformBlockBinding",value:function(t,e){this.gl.uniformBlockBinding(this.handle,t,e)}}]),e}(ot),dn=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,r))).target=null,n._queryPending=!1,n._pollingPromise=null,Object.seal(Object(it.a)(n)),n}return Object(rt.a)(e,t),Object(r.a)(e,null,[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=N(t),i=ue(t,ae.TIMER_QUERY),r=n||i,a=!0,o=!1,s=void 0;try{for(var u,l=e[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){switch(u.value){case"queries":r=r&&n;break;case"timers":r=r&&i;break;default:w(!1)}}}catch(c){o=!0,s=c}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return r}}]),Object(r.a)(e,[{key:"beginTimeElapsedQuery",value:function(){return this.begin(35007)}},{key:"beginOcclusionQuery",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).conservative,e=void 0!==t&&t;return this.begin(e?36202:35887)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(35976)}},{key:"begin",value:function(t){return this._queryPending?this:(this.target=t,this.gl.beginQuery(this.target,this.handle),this)}},{key:"end",value:function(){return this._queryPending?this:(this.target&&(this.gl.endQuery(this.target),this.target=null,this._queryPending=!0),this)}},{key:"isResultAvailable",value:function(){if(!this._queryPending)return!1;var t=this.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}},{key:"isTimerDisjoint",value:function(){return this.gl.getParameter(36795)}},{key:"getResult",value:function(){return this.gl.getQueryParameter(this.handle,34918)}},{key:"getTimerMilliseconds",value:function(){return this.getResult()/1e6}},{key:"createPoll",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;var n=0;return this._pollingPromise=new Promise(function(i,r){requestAnimationFrame(function a(){t.isResultAvailable()?(i(t.getResult()),t._pollingPromise=null):n++>e?(r("Timed out"),t._pollingPromise=null):requestAnimationFrame(a)})}),this._pollingPromise}},{key:"_createHandle",value:function(){return e.isSupported(this.gl)?this.gl.createQuery():null}},{key:"_deleteHandle",value:function(){this.gl.deleteQuery(this.handle)}}]),e}(ot),vn=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),V(t),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,r))).initialize(r),n.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(Object(it.a)(n)),n}return Object(rt.a)(e,t),Object(r.a)(e,null,[{key:"isSupported",value:function(t){return N(t)}}]),Object(r.a)(e,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,P(this.buffers)||this.bind(function(){return t._unbindBuffers()}),this.setProps(e),this}},{key:"setProps",value:function(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}},{key:"setBuffers",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind(function(){for(var n in e)t.setBuffer(n,e[n])}),this}},{key:"setBuffer",value:function(t,e){var n=this,i=this._getVaryingIndex(t),r=this._getBufferParams(e),a=r.buffer,o=r.byteSize,u=r.byteOffset;return i<0?(this.unused[t]=a,s.warn(function(){return"".concat(n.id," unused varying buffer ").concat(t)})(),this):(this.buffers[i]=e,this.bindOnUse||this._bindBuffer(i,a,u,o),this)}},{key:"begin",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(t){var e,n,i;return t instanceof At==!1?(i=t.buffer,n=t.byteSize,e=t.byteOffset):i=t,void 0===e&&void 0===n||(e=e||0,n=n||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:n}}},{key:"_getVaryingInfo",value:function(t){return this.configuration&&this.configuration.getVaryingInfo(t)}},{key:"_getVaryingIndex",value:function(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;var e=Number(t);return Number.isFinite(e)?e:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var t in this.buffers){var e=this._getBufferParams(this.buffers[t]),n=e.buffer,i=e.byteSize,r=e.byteOffset;this._bindBuffer(t,n,r,i)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var t in this.buffers)this._bindBuffer(t,null)}},{key:"_bindBuffer",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,r=e&&e.handle;return r&&void 0!==i?this.gl.bindBufferRange(35982,t,r,n,i):this.gl.bindBufferBase(35982,t,r),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(t){this.gl.bindTransformFeedback(36386,this.handle)}}]),e}(ot),gn=null;function mn(t,e){var n;return new t((n=t.BYTES_PER_ELEMENT*e,(!gn||gn.byteLength<n)&&(gn=new ArrayBuffer(n)),gn),0,e)}var yn=n("K9nA"),_n=n("5ku3"),bn=n("I0ug");var xn=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,e);var a=r.id||r.program&&r.program.id;return(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({},r,{id:a})))).hasVertexArrays=e.isSupported(t),n.buffer=null,n.bufferValue=null,n.initialize(r),Object.seal(Object(it.a)(n)),n}return Object(rt.a)(e,t),Object(r.a)(e,null,[{key:"isSupported",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero?N(t)||"Chrome"===function(t){if(!t&&!Object(_n.a)())return"Node";if(Object(bn.a)(t))return"Electron";var e="undefined"!=typeof navigator?navigator:{},n=t||e.userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";var i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r?"IE":yn.b.chrome?"Chrome":yn.b.safari?"Safari":yn.b.mozInnerScreenX?"Firefox":"Unknown"}():N(t)||t.getExtension("OES_vertex_array_object")}},{key:"getDefaultArray",value:function(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new e(t,{handle:null})),t.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(t){return e.MAX_ATTRIBUTES=e.MAX_ATTRIBUTES||t.getParameter(34921),e.MAX_ATTRIBUTES}},{key:"setConstant",value:function(t,n,i){switch(i.constructor){case Float32Array:e._setConstantFloatArray(t,n,i);break;case Int32Array:e._setConstantIntArray(t,n,i);break;case Uint32Array:e._setConstantUintArray(t,n,i);break;default:w(!1)}}}]),Object(r.a)(e,[{key:"delete",value:function(){Object(ze.a)(Object(nt.a)(e.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete()}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.setProps(t)}},{key:"setProps",value:function(t){return this}},{key:"setElementBuffer",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w(!e||34963===e.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind(function(){t.gl.bindBuffer(34963,e?e.handle:null)}),this}},{key:"setBuffer",value:function(t,e,n){if(34963===e.target)return this.setElementBuffer(e,n);var i=n.size,r=n.type,a=n.stride,o=n.offset,s=n.normalized,u=n.integer,l=n.divisor,c=this.gl;return t=Number(t),this.bind(function(){c.bindBuffer(34962,e.handle),u?(w(N(c)),c.vertexAttribIPointer(t,i,r,a,o)):c.vertexAttribPointer(t,i,r,s,a,o),c.enableVertexAttribArray(t),c.vertexAttribDivisor(t,l||0)}),this}},{key:"enable",value:function(t){var n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!i&&0===t&&!e.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(function(){return i?n.gl.enableVertexAttribArray(t):n.gl.disableVertexAttribArray(t)})),this}},{key:"getConstantBuffer",value:function(t,e,n){var i=this._normalizeConstantArrayValue(e,n),r=i.byteLength*t,a=i.length*t,o=!this.buffer;if(this.buffer=this.buffer||new At(this.gl,r),o=(o=o||this.buffer.reallocate(r))||!this._compareConstantArrayValues(i,this.bufferValue)){var s=mn(e.constructor,a);!function(t){for(var e=t.target,n=t.source,i=t.start,r=void 0===i?0:i,a=t.count,o=void 0===a?1:a,s=n.length,u=o*s,l=0,c=r;l<s;l++)e[c++]=n[l];for(;l<u;)l<u-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+u-l),l=u)}({target:s,source:i,start:0,count:a}),this.buffer.subData(s),this.bufferValue=e}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(t,e){return Array.isArray(t)?new Float32Array(t):t}},{key:"_compareConstantArrayValues",value:function(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}},{key:"_createHandle",value:function(){return this.hasVertexArrays=e.isSupported(this.gl),this.hasVertexArrays?this.gl.createVertexArray():null}},{key:"_deleteHandle",value:function(t){return this.hasVertexArrays&&this.gl.deleteVertexArray(t),[this.elements]}},{key:"_bindHandle",value:function(t){this.hasVertexArrays&&this.gl.bindVertexArray(t)}},{key:"_getParameter",value:function(t,e){var n=this,i=e.location;return w(Number.isFinite(i)),this.bind(function(){switch(t){case 34373:return n.gl.getVertexAttribOffset(i,t);default:return n.gl.getVertexAttrib(i,t)}})}},{key:"MAX_ATTRIBUTES",get:function(){return e.getMaxAttributes(this.gl)}}],[{key:"_setConstantFloatArray",value:function(t,e,n){switch(n.length){case 1:t.vertexAttrib1fv(e,n);break;case 2:t.vertexAttrib2fv(e,n);break;case 3:t.vertexAttrib3fv(e,n);break;case 4:t.vertexAttrib4fv(e,n);break;default:w(!1)}}},{key:"_setConstantIntArray",value:function(t,e,n){switch(w(N(t)),n.length){case 1:t.vertexAttribI1iv(e,n);break;case 2:t.vertexAttribI2iv(e,n);break;case 3:t.vertexAttribI3iv(e,n);break;case 4:t.vertexAttribI4iv(e,n);break;default:w(!1)}}},{key:"_setConstantUintArray",value:function(t,e,n){switch(w(N(t)),n.length){case 1:t.vertexAttribI1uiv(e,n);break;case 2:t.vertexAttribI2uiv(e,n);break;case 3:t.vertexAttribI3uiv(e,n);break;case 4:t.vertexAttribI4uiv(e,n);break;default:w(!1)}}}]),e}(ot),wn=/^(.+)__LOCATION_([0-9]+)$/,Sn=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],kn=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t);var r=n.id||n.program&&n.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.vertexArrayObject=xn.isSupported(e)?new xn(e):xn.getDefaultArray(e),C(this,"VertexArray","v6.0",Sn),this.initialize(n),Object.seal(this)}return Object(r.a)(t,[{key:"delete",value:function(){this.buffer&&this.buffer.delete()}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}},{key:"reset",value:function(){this.elements=null,this.elementsAccessor=null;var t=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(t){return this.drawParams=this.drawParams||this._updateDrawParams(),Object.assign({},this.drawParams,t)}},{key:"setAttributes",value:function(t){var e=this;return this.vertexArrayObject.bind(function(){for(var n in t){var i=t[n];e._setAttribute(n,i)}e.gl.bindBuffer(34962,null)}),this}},{key:"setElementBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setElementBuffer(t,e),this}},{key:"setBuffer",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===e.target)return this.setElementBuffer(e,n);var i=this._resolveLocationAndAccessor(t,e,e.accessor,n),r=i.location,a=i.accessor;return r>=0&&(this.values[r]=e,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setBuffer(r,e,a)),this}},{key:"setConstant",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},n)),r=i.location,a=i.accessor;return r>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e,a),this.values[r]=e,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.enable(r,!1)),this}},{key:"unbindBuffers",value:function(){var t=this;return this.vertexArrayObject.bind(function(){t.elements&&t.setElementBuffer(null),t.buffer=t.buffer||new At(t.gl,{accessor:{size:4}});for(var e=0;e<t.vertexArrayObject.MAX_ATTRIBUTES;e++)t.values[e]instanceof At&&(t.gl.disableVertexAttribArray(e),t.gl.bindBuffer(34962,t.buffer.handle),t.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}},{key:"bindBuffers",value:function(){var t=this;return this.vertexArrayObject.bind(function(){t.elements&&t.setElementBuffer(t.elements);for(var e=0;e<t.vertexArrayObject.MAX_ATTRIBUTES;e++){var n=t.values[e];n instanceof At&&t.setBuffer(e,n)}}),this}},{key:"bindForDraw",value:function(t,e,n){var i,r=this;return this.vertexArrayObject.bind(function(){r._setConstantAttributes(t,e),r.vertexArrayObject.hasVertexArrays||r.bindBuffers(),i=n(),r.vertexArrayObject.hasVertexArrays||r.unbindBuffers()}),i}},{key:"_resolveLocationAndAccessor",value:function(t,e,n,i){var r=this,a=this._getAttributeIndex(t),o=a.location,u=a.name;if(!Number.isFinite(o)||o<0)return this.unused[t]=e,s.once(3,function(){return"unused value ".concat(t," in ").concat(r.id)})(),this;var l=this._getAttributeInfo(u||o);if(!l)return{location:-1,accessor:null};var c=ct.resolve(l.accessor,n,i),h=c.size,f=c.type;return w(Number.isFinite(h)&&Number.isFinite(f)),{location:o,accessor:c}}},{key:"_getAttributeInfo",value:function(t){return this.configuration&&this.configuration.getAttributeInfo(t)}},{key:"_getAttributeIndex",value:function(t){var e=Number(t);if(Number.isFinite(e))return{location:e};var n=wn.exec(t),i=n?n[1]:t,r=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+r,name:i}:{location:-1}}},{key:"_setAttribute",value:function(t,e){if(e instanceof At)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof At){var n=e[0],i=e[1];this.setBuffer(t,n,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){var r=e;this.setConstant(t,r)}else{if(!(e.buffer instanceof At))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");var a=e;this.setBuffer(t,a.buffer,a)}}},{key:"_setConstantAttributes",value:function(t,e){var n=Math.max(0|t,0|e),i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(var r=1;r<this.vertexArrayObject.MAX_ATTRIBUTES;r++)i=this.values[r],ArrayBuffer.isView(i)&&this._setConstantAttribute(r,i)}},{key:"_setConstantAttributeZero",value:function(t,e){if(xn.isSupported(this.gl,{constantAttributeZero:!0}))this._setConstantAttribute(0,t);else{var n=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}}},{key:"_setConstantAttribute",value:function(t,e){xn.setConstant(this.gl,t,e),this.vertexArrayObject.isDefault&&this.vertexArrayObject.enable(t,!1)}},{key:"_updateDrawParams",value:function(){for(var t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}},{key:"_updateDrawParamsForLocation",value:function(t,e){var n=this.values[e],i=this.accessors[e];if(n){var r=i.divisor>0;if(t.isInstanced=t.isInstanced||r,n instanceof At){var a=n;if(r){var o=a.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,o)}else{var s=a.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,s)}}}}},{key:"setElements",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}]),t}(),On=5126,Pn=5124,En=5125,Cn=function(){function t(e){var n;for(var r in Object(i.a)(this,t),this.layout={},this.size=0,e)this._addUniform(r,e[r]);this.size+=(4-this.size%4)%4;var a=new Float32Array(this.size);this.typedArray=(n={},Object(tt.a)(n,On,a),Object(tt.a)(n,Pn,new Int32Array(a.buffer)),Object(tt.a)(n,En,new Uint32Array(a.buffer)),n)}return Object(r.a)(t,[{key:"getBytes",value:function(){return 4*this.size}},{key:"getData",value:function(){return this.typedArray[On]}},{key:"getSubData",value:function(t){var e,n;if(void 0===t)e=this.data,n=0;else{var i=this.offsets[t],r=i+this.sizes[t];e=this.data.subarray(i,r),n=4*i}return{data:e,offset:n}}},{key:"setUniforms",value:function(t){for(var e in t)this._setValue(e,t[e]);return this}},{key:"_setValue",value:function(t,e){var n=this.layout[t];w(n,"UniformLayoutStd140 illegal argument");var i=this.typedArray[n.type];1===n.size?i[n.offset]=e:i.set(e,n.offset)}},{key:"_addUniform",value:function(t,e){var n=cn(e);w(n,"UniformBufferLayout illegal argument");var i=n.type,r=n.components;this.size=this._alignTo(this.size,r);var a=this.size;this.size+=r,this.layout[t]={type:i,size:r,offset:a}}},{key:"_alignTo",value:function(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}}]),t}();function Tn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.header,n=void 0===e?"Uniforms":e,i=t.program,r=t.uniforms,a=t.undefinedOnly,o=void 0!==a&&a;w(i);var s=i._uniformSetters,u={},l=Object.keys(s).sort(),c=0,h=!0,f=!1,p=void 0;try{for(var A,d=l[Symbol.iterator]();!(h=(A=d.next()).done);h=!0){var v=A.value;v.match(".*_.*")||v.match(".*Matrix")||Mn({table:u,header:n,uniforms:r,uniformName:v,undefinedOnly:o})&&c++}}catch(z){f=!0,p=z}finally{try{h||null==d.return||d.return()}finally{if(f)throw p}}var g=!0,m=!1,y=void 0;try{for(var _,b=l[Symbol.iterator]();!(g=(_=b.next()).done);g=!0){var x=_.value;x.match(".*Matrix")&&Mn({table:u,header:n,uniforms:r,uniformName:x,undefinedOnly:o})&&c++}}catch(z){m=!0,y=z}finally{try{g||null==b.return||b.return()}finally{if(m)throw y}}var S=!0,k=!1,O=void 0;try{for(var P,C=l[Symbol.iterator]();!(S=(P=C.next()).done);S=!0){var T=P.value;u[T]||Mn({table:u,header:n,uniforms:r,uniformName:T,undefinedOnly:o})&&c++}}catch(z){k=!0,O=z}finally{try{S||null==C.return||C.return()}finally{if(k)throw O}}var M=0,j={};if(!o)for(var L in r){var I=r[L];u[L]||(M++,j[L]=Object(tt.a)({Type:"NOT USED: ".concat(I)},n,E(I)))}return{table:u,count:c,unusedTable:j,unusedCount:M}}function Mn(t){var e,n=t.table,i=t.header,r=t.uniforms,a=t.uniformName,o=t.undefinedOnly,s=r[a],u=function(t){return null!=t}(s);return(!o||!u)&&(n[a]=(e={},Object(tt.a)(e,i,u?E(s):"N/A"),Object(tt.a)(e,"Uniform Type",u?s:"NOT PROVIDED"),e),!0)}function jn(t,e,n,i){var r,a,o,s,u=t.gl,l="NOT PROVIDED",c="N/A",h="N/A",f="N/A";if(n&&(l=n.type,c=n.size,a=-1!==(l=String(l).replace("Array","")).indexOf("nt")),e instanceof At){var p,A,d=e,v=d.getDebugData(),g=v.data;if(o=v.modified?"*":"",s=g,h=(f=d.byteLength)/g.BYTES_PER_ELEMENT/c,n){var m=n.divisor>0;A="".concat(m?"I ":"P "," ").concat(h," (x").concat(c,"=").concat(f," bytes ").concat(Y(u,l),")")}else a=!0,A="".concat(f," bytes");return p={},Object(tt.a)(p,i,"".concat(o).concat(E(s,{size:c,isInteger:a}))),Object(tt.a)(p,"Format ",A),p}return s=e,c=e.length,a=-1!==(l=String(e.constructor.name).replace("Array","")).indexOf("nt"),r={},Object(tt.a)(r,i,"".concat(E(s,{size:c,isInteger:a})," (constant)")),Object(tt.a)(r,"Format ","".concat(c,"x").concat(l," (constant)")),r}function Ln(t,e){var n=hn(e.type,e.size);return n?"".concat(t," (").concat(n.name,")"):t}function In(t){var e=t.accessor,n=hn(e.type,e.size);return n?"".concat(n.name," ").concat(t.name):t.name}var zn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Dn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,r=void 0===n?k("geometry"):n,a=e.drawMode,o=void 0===a?zn.TRIANGLES:a,s=e.mode,u=e.attributes,l=void 0===u?{}:u,c=e.indices,h=void 0===c?null:c,f=e.vertexCount,p=void 0===f?null:f;this.id=r,this.drawMode=0|o||0|s,this.attributes={},this.userData={},this._setAttributes(l,h),this.vertexCount=p||this._calculateVertexCount(this.attributes,this.indices)}return Object(r.a)(t,null,[{key:"DRAW_MODE",get:function(){return zn}}]),Object(r.a)(t,[{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getAttributes",value:function(){return this.indices?Object(_.a)({indices:this.indices},this.attributes):this.attributes}},{key:"_print",value:function(t){return"Geometry ".concat(this.id," attribute ").concat(t)}},{key:"_setAttributes",value:function(t,e){for(var n in e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e),t){var i=t[n];i=ArrayBuffer.isView(i)?{value:i}:i,w(ArrayBuffer.isView(i.value),"".concat(this._print(n),": must be typed array or object with value as typed array")),"indices"===n?(w(!this.indices),this.indices=i,void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed)):this.attributes[n]=i}return this}},{key:"_calculateVertexCount",value:function(t,e){if(e)return e.value.length;var n=1/0;for(var i in t){var r=t[i],a=r.value,o=r.size;!r.constant&&a&&o>=1&&(n=Math.min(n,a.length/o))}if(!Number.isFinite(n)){var s=t.POSITION||t.positions;s&&(n=s.value&&s.value.length/(s.size||3))}return w(Number.isFinite(n)),n}},{key:"mode",get:function(){return this.drawMode}}]),t}(),Bn=function t(){Object(i.a)(this,t)},Rn=n("dByZ"),Fn=[255,255,255],Nn=[0,0,1],Un=[0,0,-1],Vn=[0,0,1],Gn=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t),this.id=e.id||k("light");var n=e.color,r=void 0===n?Fn:n;this.color=r;var a=e.intensity,o=void 0===a?1:a;this.intensity=o},Wn=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.a)(this,e),(t=Object(et.a)(this,Object(nt.a)(e).call(this,n))).type="ambient",t}return Object(rt.a)(e,t),e}(Gn),Hn=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e),(t=Object(et.a)(this,Object(nt.a)(e).call(this,n))).type="directional";var r=n.direction,a=void 0===r?Un:r;return t.direction=new Rn.a(a).normalize().toArray(),t}return Object(rt.a)(e,t),e}(Gn),qn=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e),(t=Object(et.a)(this,Object(nt.a)(e).call(this,n))).type="point";var r=n.position,a=void 0===r?Vn:r;return t.position=a,t.attenuation=t._getAttenuation(n),t}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"_getAttenuation",value:function(t){return"attenuation"in t?t.attenuation:"intensity"in t?[0,0,t.intensity]:Nn}}]),e}(Gn),Zn=n("U8pU"),Xn=0,Qn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.onCreateContext,r=void 0===n?function(t){return me(t)}:n,a=e.onAddHTML,o=void 0===a?null:a,u=e.onInitialize,c=void 0===u?function(){}:u,h=e.onRender,f=void 0===h?function(){}:h,p=e.onFinalize,A=void 0===p?function(){}:p,d=e.gl,v=void 0===d?null:d,g=e.glOptions,m=void 0===g?{}:g,y=e.debug,_=void 0!==y&&y,b=e.createFramebuffer,x=void 0!==b&&b,w=e.autoResizeViewport,S=void 0===w||w,k=e.autoResizeDrawingBuffer,O=void 0===k||k,P=e.stats,E=void 0===P?l.get("animation-loop-".concat(Xn++)):P,C=e.useDevicePixels,T=void 0===C||C;"useDevicePixelRatio"in e&&(s.deprecated("useDevicePixelRatio","useDevicePixels")(),T=e.useDevicePixelRatio),this.props={onCreateContext:r,onAddHTML:o,onInitialize:c,onRender:f,onFinalize:A,gl:v,glOptions:m,debug:_,createFramebuffer:x},this.gl=v,this.needsRedraw=null,this.timeline=null,this.stats=E,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:S,autoResizeDrawingBuffer:O,useDevicePixels:T}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}return Object(r.a)(t,[{key:"delete",value:function(){this.stop(),this._setDisplay(null)}},{key:"setNeedsRedraw",value:function(t){return w("string"==typeof t),this.needsRedraw=this.needsRedraw||t,this}},{key:"setProps",value:function(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}},{key:"start",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._running?this:(this._running=!0,I().then(function(){return!t._running||t._initialized?null:(t._createWebGLContext(e),t._createFramebuffer(),t._startEventHandling(),t._initializeCallbackData(),t._updateCallbackData(),t._resizeCanvasDrawingBuffer(),t._resizeViewport(),t._gpuTimeQuery=dn.isSupported(t.gl,["timers"])?new dn(t.gl):null,t._initialized=!0,t.onInitialize(t.animationProps))}).then(function(e){t._running&&(t._addCallbackData(e||{}),!1!==e&&t._startLoop())}),this)}},{key:"redraw",value:function(){return this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this}},{key:"stop",value:function(){return this._running&&(this._finalizeCallbackData(),W(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}},{key:"attachTimeline",value:function(t){return this.timeline=t,this.timeline}},{key:"detachTimeline",value:function(){this.timeline=null}},{key:"waitForRender",value:function(){var t=this;return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(function(e){t._resolveNextFrame=e})),this._nextFramePromise}},{key:"toDataURL",value:function(){var t=Object(Pt.a)(Ot.a.mark(function t(){return Ot.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.setNeedsRedraw("toDataURL"),t.next=3,this.waitForRender();case 3:return t.abrupt("return",this.gl.canvas.toDataURL());case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"onCreateContext",value:function(){var t;return(t=this.props).onCreateContext.apply(t,arguments)}},{key:"onInitialize",value:function(){var t;return(t=this.props).onInitialize.apply(t,arguments)}},{key:"onRender",value:function(){var t;return(t=this.props).onRender.apply(t,arguments)}},{key:"onFinalize",value:function(){var t;return(t=this.props).onFinalize.apply(t,arguments)}},{key:"getHTMLControlValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=document.getElementById(t);return n?Number(n.value):e}},{key:"setViewParameters",value:function(){return s.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_startLoop",value:function(){var t=this;W(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(function e(){t._running&&(t.redraw(),t._animationFrameId=t._requestAnimationFrame(e))})}},{key:"_setDisplay",value:function(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}},{key:"_requestAnimationFrame",value:function(t){this.display&&this.display.requestAnimationFrame(t)||G(t)}},{key:"_renderFrame",value:function(){var t;this.display?(t=this.display)._renderFrame.apply(t,arguments):this.onRender.apply(this,arguments)}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._onSetupFrame?this._onSetupFrame(this.animationProps):(this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer())}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var t=this._getSizeAndAspect(),e=t.width,n=t.height,i=t.aspect;e===this.animationProps.width&&n===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(t){"object"===Object(Zn.a)(t)&&null!==t&&(this.animationProps=Object.assign({},this.animationProps,t))}},{key:"_createWebGLContext",value:function(t){if(this.offScreen=t.canvas&&"undefined"!=typeof OffscreenCanvas&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?ye(this.props.gl,t):this.onCreateContext(t),!F(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Object(c.d)(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";var e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);var n=this.props.onAddHTML(e);n&&(e.innerHTML=n)}}},{key:"_getSizeAndAspect",value:function(){var t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight,n=1,i=this.gl.canvas,r=i.clientWidth,a=i.clientHeight;return r>0&&a>0?n=r/a:t>0&&e>0&&(n=t/e),{width:t,height:e,aspect:n}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&be(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new pe(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_beginTimers",value:function(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}},{key:"_endTimers",value:function(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}},{key:"_startEventHandling",value:function(){this.gl.canvas.addEventListener("mousemove",this._onMousemove),this.gl.canvas.addEventListener("mouseleave",this._onMouseleave)}},{key:"_onMousemove",value:function(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}},{key:"_onMouseleave",value:function(t){this.animationProps._mousePosition=null}}]),t}(),Yn=new Uint8Array([0,0,0]);function Kn(t){return[t+1&255,t+1>>8&255,t+1>>16&255]}function Jn(t){var e=Object(h.a)(t,3);return e[0]+256*e[1]+65536*e[2]-1}function $n(){return Yn}var ti={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function ei(t,e){var n=(e||{}).attributeMap,i=void 0===n?ti:n;return i&&i[t]||t}function ni(t,e){var n;switch(t){case"indices":n=n||"indices";break;case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break;case"indices":e.size=e.size||1,e.isIndexed=void 0===e.isIndexed||e.isIndexed,w(e.value instanceof Uint16Array||e.value instanceof Uint32Array,'attribute array for "indices" must be of integer type')}w(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}var ii=n("yq7u"),ri=n("lQOs"),ai=n("kLp3"),oi=n.n(ai),si={},ui=function t(e,n,i){e&&(n.length>1?t(e[n[0]],n.slice(1),i):e[n[0]]=i)},li=new Map;oi.a.listenFor("luma.gl",function(t){var e=si[t.itemKey];if(e&&"edit"===t.type&&"uniforms"===t.valuePath[0]){var n=t.valuePath.slice(1);!function(t,e,n){o.d.__SEER_INITIALIZED__&&(li.has(t)||li.set(t,new Map),li.get(t).set(e,n))}(t.itemKey,n,t.value);var i=e.getUniforms();ui(i,n,t.value),e.setUniforms(i)}});var ci,hi=["renderPickingBuffer","pickingEnabled"],fi=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),w(F(e));var r=n.id,a=void 0===r?k("base-model"):r;this.id=a,this.gl=e,this.id=n.id||k("Model"),this.lastLogTime=0,this.initialize(n),this._setBaseModelProps(n)}return Object(r.a)(t,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.props={},this.program=this._createProgram(t),this.vertexArray=new kn(this.gl,{program:this.program}),this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.animatedUniforms={},this.animated=!1,this.animationLoop=null,this.timerQueryEnabled=!1,this.timeElapsedQuery=void 0,this.lastQueryReturned=!0,this.stats={accumulatedFrameTime:0,averageFrameTime:0,profileFrameCount:0},this.pickable=!0,this._setBaseModelProps(t),this.setUniforms(Object.assign({},this.getModuleUniforms(),this.getModuleUniforms(t.moduleSettings)))}},{key:"setProps",value:function(t){this._setBaseModelProps(t)}},{key:"delete",value:function(){for(var t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();var e;this.program.delete(),this.vertexArray.delete(),e=this.id,delete si[e],oi.a.deleteItem("luma.gl",e)}},{key:"destroy",value:function(){this.delete()}},{key:"isAnimated",value:function(){return this.animated}},{key:"getProgram",value:function(){return this.program}},{key:"getUniforms",value:function(){return this.program.getUniforms()}},{key:"setUniforms",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e=Object.assign({},e),function(t,e){if(o.d.__SEER_INITIALIZED__&&t){var n=li.get(t);n&&n.forEach(function(t,n){ui(e,n,t)})}}(this.id,e),e=this._extractAnimatedUniforms(e),this.program.setUniforms(e,function(){t._checkForDeprecatedUniforms(e)}),this}},{key:"updateModuleSettings",value:function(t){var e=this.getModuleUniforms(t||{});return this.setUniforms(e)}},{key:"clear",value:function(t){return Wt(this.program.gl,t),this}},{key:"drawGeometry",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.moduleSettings,i=void 0===n?null:n,r=e.framebuffer,a=e.uniforms,o=void 0===a?{}:a,u=e.attributes,l=void 0===u?{}:u,c=e.transformFeedback,h=void 0===c?this.transformFeedback:c,f=e.parameters,p=void 0===f?{}:f,A=e.vertexArray,d=void 0===A?this.vertexArray:A,v=e.animationProps;si[(t=this).id]||(si[t.id]=t,oi.a.listItem("luma.gl",t.id)),this.setAttributes(l),this.updateModuleSettings(i),this.setUniforms(o),this._refreshAnimationProps(v);var g=this._logDrawCallStart(2),m=this.vertexArray.getDrawParams(this.props);m.isInstanced&&!this.isInstanced&&s.warn("Found instanced attributes on non-instanced model",this.id)();var y=m.isIndexed,_=m.indexType,b=m.indexOffset,x=this.isInstanced,w=this.instanceCount,S=function(){},k=this.props,O=k.onBeforeRender,P=void 0===O?S:O,E=k.onAfterRender,C=void 0===E?S:E;P(),this._timerQueryStart();var T=this.program.draw(Object.assign({},e,{logPriority:g,uniforms:null,framebuffer:r,parameters:p,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:d,transformFeedback:h,isIndexed:y,indexType:_,isInstanced:x,instanceCount:w,offset:y?b:0}));return this._timerQueryEnd(),C(),this._logDrawCallEnd(g,d,r),T}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.discard,n=void 0===e||e,i=t.feedbackBuffers,r=t.unbindModels,a=void 0===r?[]:r,o=t.parameters;i&&this._setFeedbackBuffers(i),n&&(o=Object.assign({},o,Object(tt.a)({},35977,n))),a.forEach(function(t){return t.vertexArray.unbindBuffers()});try{this.draw(Object.assign({},t,{parameters:o}))}finally{a.forEach(function(t){return t.vertexArray.bindBuffers()})}return this}},{key:"_setBaseModelProps",value:function(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"timerQueryEnabled"in t&&(this.timerQueryEnabled=t.timerQueryEnabled&&dn.isSupported(this.gl,["timers"]),t.timerQueryEnabled&&!this.timerQueryEnabled&&s.warn("GPU timer not supported")()),"_animationProps"in t&&this._setAnimationProps(t._animationProps),"_animationLoop"in t&&(this.animationLoop=t._animationLoop)}},{key:"_createProgram",value:function(t){var e=t.vs,n=void 0===e?null:e,i=t.fs,r=void 0===i?null:i,a=t.modules,o=void 0===a?null:a,u=t.defines,l=void 0===u?{}:u,c=t.inject,h=void 0===c?{}:c,f=t.shaderCache,p=void 0===f?null:f,A=t.varyings,d=void 0===A?null:A,v=t.bufferMode,g=void 0===v?35981:v,m=t.program,y=void 0===m?null:m;this.getModuleUniforms=function(t){};var _=this.id;if(!y){n=n||ii.a.vs,r=r||ii.a.fs;var b=Object(ri.a)(this.gl,{vs:n,fs:r,modules:o,inject:h,defines:l,log:s});n=b.vs,r=b.fs,y=p?p.getProgram(this.gl,{id:_,vs:n,fs:r}):new An(this.gl,{id:_,vs:n,fs:r,varyings:d,bufferMode:g}),this.getModuleUniforms=b.getUniforms||function(t){}}return w(y instanceof An,"Model needs a program"),y}},{key:"_checkForDeprecatedUniforms",value:function(t){hi.forEach(function(e){e in t&&s.deprecated(e,"use picking shader module and Model class updateModuleSettings()")()})}},{key:"_refreshAnimationProps",value:function(t){(t=t||this.animationLoop&&this.animationLoop.animationProps)&&this._setAnimationProps(t)}},{key:"_evaluateAnimateUniforms",value:function(t){if(!this.animated)return{};var e={};for(var n in this.animatedUniforms){var i=this.animatedUniforms[n];e[n]=i(t)}return e}},{key:"_extractAnimatedUniforms",value:function(t){var e=!1;for(var n in t){var i=t[n];"function"==typeof i?(this.animatedUniforms[n]=i,e=!0):delete this.animatedUniforms[n]}if(this.animated=!P(this.animatedUniforms),!e)return t;var r={};for(var a in t)this.animatedUniforms[a]||(r[a]=t[a]);return r}},{key:"_timerQueryStart",value:function(){!0===this.timerQueryEnabled&&(this.timeElapsedQuery||(this.timeElapsedQuery=new dn(this.gl)),this.lastQueryReturned&&(this.lastQueryReturned=!1,this.timeElapsedQuery.beginTimeElapsedQuery()))}},{key:"_timerQueryEnd",value:function(){if(!0===this.timerQueryEnabled&&(this.timeElapsedQuery.end(),this.timeElapsedQuery.isResultAvailable())){this.lastQueryReturned=!0;var t=this.timeElapsedQuery.getTimerMilliseconds();this.stats.lastFrameTime=t,this.stats.accumulatedFrameTime+=t,this.stats.profileFrameCount++,this.stats.averageFrameTime=this.stats.accumulatedFrameTime/this.stats.profileFrameCount,s.log(2,"GPU time ".concat(this.program.id,": ").concat(this.stats.lastFrameTime,"ms average ").concat(this.stats.averageFrameTime,"ms accumulated: ").concat(this.stats.accumulatedFrameTime,"ms count: ").concat(this.stats.profileFrameCount))()}}},{key:"_logDrawCallStart",value:function(t){var e=t>3?0:1e4;if(!(s.priority<t||Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),s.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:s.priority<=2})(),t}},{key:"_logDrawCallEnd",value:function(t,e,n,i){if(void 0!==t){var r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vertexArray,n=t.header,i=void 0===n?"Attributes":n;if(!e.configuration)return{};var r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=jn(e,e.elements,null,i));var a=e.values;for(var o in a){var s=e._getAttributeInfo(o);if(s){var u="".concat(o,": ").concat(s.name),l=e.accessors[s.location];l&&(u="".concat(o,": ").concat(Ln(s.name,l))),r[u]=jn(e,a[o],l,i)}}return r}({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),a=Tn({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),o=a.table,u=a.unusedTable,l=a.unusedCount,c=Tn({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0}),h=c.table;c.count>0&&s.log("MISSING UNIFORMS",Object.keys(h))(),l>0&&s.log("UNUSED UNIFORMS",Object.keys(u))();var f=function(t){var e={},n="Accessors for ".concat(t.id),i=!0,r=!1,a=void 0;try{for(var o,s=t.attributeInfos[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;if(u){var l=In(u);e["in ".concat(l)]=Object(tt.a)({},n,JSON.stringify(u.accessor))}}}catch(g){r=!0,a=g}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}var c=!0,h=!1,f=void 0;try{for(var p,A=t.varyingInfos[Symbol.iterator]();!(c=(p=A.next()).done);c=!0){var d=p.value;if(d){var v=In(d);e["out ".concat(v)]=Object(tt.a)({},n,JSON.stringify(d.accessor))}}}catch(g){h=!0,f=g}finally{try{c||null==A.return||A.return()}finally{if(h)throw f}}return e}(this.vertexArray.configuration);s.table(t,r)(),s.table(t,o)(),s.table(t+1,f)(),function(t,e){if(oi.a.isReady()&&!oi.a.throttle("luma.gl:".concat(t.id),1e3)){var n=t.geometry?Object.assign({},t.geometry.attributes,t.attributes):t.attributes,i=Object.assign({},t.uniforms,e);oi.a.multiUpdate("luma.gl",t.id,[{path:"objects.uniforms",data:i},{path:"objects.attributes",data:n}])}}(this,n),i&&i.log({priority:2,message:"Rendered to ".concat(i.id)}),s.groupEnd(2,">>> DRAWING MODEL ".concat(this.id))()}}}]),t}(),pi=function(t){function e(t,n){Object(i.a)(this,e);var r=n.id,a=void 0===r?k("model"):r;return Object(et.a)(this,Object(nt.a)(e).call(this,t,Object(_.a)({},n,{id:a})))}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(ze.a)(Object(nt.a)(e.prototype),"initialize",this).call(this,t),this.drawMode=void 0!==t.drawMode?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced,this._setModelProps(t),this.geometry={},w(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}},{key:"setProps",value:function(t){Object(ze.a)(Object(nt.a)(e.prototype),"setProps",this).call(this,t),this._setModelProps(t)}},{key:"delete",value:function(){Object(ze.a)(Object(nt.a)(e.prototype),"delete",this).call(this),this._deleteGeometryBuffers()}},{key:"destroy",value:function(){this.delete()}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getAttributes",value:function(){return this.attributes}},{key:"setDrawMode",value:function(t){return this.drawMode=t,this}},{key:"setVertexCount",value:function(t){return w(Number.isFinite(t)),this.vertexCount=t,this}},{key:"setInstanceCount",value:function(t){return w(Number.isFinite(t)),this.instanceCount=t,this}},{key:"setGeometry",value:function(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(t,e,n){var i={};for(var r in e.attributes){var a=e.attributes[r],o=ei(r,n);if(a.constant)i[o]=a.value;else{var s=a.value,u=Object(_.a)({},a);delete u.value,i[o]=[new At(t,s),u],ni(r,u)}}return e.indices&&(i.indices=new At(t,{data:e.indices.value||e.indices,target:34963})),i}(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}},{key:"setAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(P(t))return this;var e={};for(var n in t){var i=t[n];e[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.drawGeometry(t)}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.discard,n=void 0===e||e,i=t.feedbackBuffers,r=t.unbindModels,a=void 0===r?[]:r,o=t.parameters;i&&this._setFeedbackBuffers(i),n&&(o=Object.assign({},o,Object(tt.a)({},35977,n))),a.forEach(function(t){return t.vertexArray.unbindBuffers()});try{this.draw(Object.assign({},t,{parameters:o}))}finally{a.forEach(function(t){return t.vertexArray.bindBuffers()})}return this}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}},{key:"_setModelProps",value:function(t){"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}},{key:"_deleteGeometryBuffers",value:function(){for(var t in this.geometryBuffers){var e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof At&&e.delete()}}},{key:"_setAnimationProps",value:function(t){var e=this;if(this.animated){w(t,"Model.draw(): animated uniforms but no animationProps");var n=this._evaluateAnimateUniforms(t);this.program.setUniforms(n,function(){e._checkForDeprecatedUniforms(n)})}}},{key:"_setFeedbackBuffers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(P(t))return this;var e=this.program.gl;return this.transformFeedback=this.transformFeedback||new vn(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}},{key:"_timerQueryStart",value:function(){!0===this.timerQueryEnabled&&(this.timeElapsedQuery||(this.timeElapsedQuery=new dn(this.gl)),this.lastQueryReturned&&(this.lastQueryReturned=!1,this.timeElapsedQuery.beginTimeElapsedQuery()))}},{key:"_timerQueryEnd",value:function(){if(!0===this.timerQueryEnabled&&(this.timeElapsedQuery.end(),this.timeElapsedQuery.isResultAvailable())){this.lastQueryReturned=!0;var t=this.timeElapsedQuery.getTimerMilliseconds();this.stats.lastFrameTime=t,this.stats.accumulatedFrameTime+=t,this.stats.profileFrameCount++,this.stats.averageFrameTime=this.stats.accumulatedFrameTime/this.stats.profileFrameCount,s.log(2,"GPU time ".concat(this.program.id,": ").concat(this.stats.lastFrameTime,"ms average ").concat(this.stats.averageFrameTime,"ms accumulated: ").concat(this.stats.accumulatedFrameTime,"ms count: ").concat(this.stats.profileFrameCount))()}}}]),e}(fi),Ai=n("rpxL"),di=n("y2Uh"),vi=n("YzvJ"),gi="transform_uSampler_",mi="transform_uSize_",yi="transform_position";function _i(t){var e=t.vs,n=t.sourceTextureMap,i=t.targetTextureVarying,r=t.targetTexture,a=Object.keys(n).length,o=null,s={},u=e,l={};if(a>0||i){var c=u.split("\n"),h=c.slice();if(c.forEach(function(t,e,r){if(a>0){var u=function(t,e){var n={},i=function(t){return Object(di.c)(t,["attribute","in"])}(t);if(!i)return null;var r=i.type,a=i.name;if(a&&e[a]){var o="// ".concat(t," => Replaced by Transform with a sampler"),s=function(t){var e="".concat(gi).concat(t),n="".concat(mi).concat(t),i="  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}(a),u=s.samplerName,l=s.sizeName,c=s.uniformDeclerations,h=Object(di.e)(r),f="  ".concat(r," ").concat(a," = transform_getInput(").concat(u,", ").concat(l,").").concat(h,";\n");n[u]=a;var p={"vs:#decl":c,"vs:#main-start":f};return{updatedLine:o,inject:p,samplerTextureMap:n}}return null}(t,n);if(u){var c=u.updatedLine,f=u.inject;h[e]=c,l=Object(Ai.a)([l,f]),Object.assign(s,u.samplerTextureMap),a--}}i&&!o&&(o=function(t,e){var n=Object(di.c)(t,["varying","out"]);if(!n)return null;return n.name===e?n.type:null}(t,i))}),i){w(r);var f="".concat(mi).concat(i),p={"vs:#decl":"uniform vec2 ".concat(f,";\n"),"vs:#main-start":"     vec2 ".concat(yi," = transform_getPos(").concat(f,");\n     gl_Position = vec4(").concat(yi,", 0, 1.);\n")};l=Object(Ai.a)([l,p])}u=h.join("\n")}return{vs:u,targetTextureType:o,inject:l,samplerTextureMap:s}}var bi=(ci={},Object(tt.a)(ci,10241,9728),Object(tt.a)(ci,10240,9728),Object(tt.a)(ci,10242,33071),Object(tt.a)(ci,10243,33071),ci),xi=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),w(N(e)),this.gl=e,this.model=null,this.elementCount=0,this.currentIndex=0,this.sourceBuffers=new Array(2),this.sourceTextures=new Array(2),this.feedbackBuffers=new Array(2),this.targetTextures=new Array(2),this.transformFeedbacks=new Array(2),this.framebuffers=new Array(2),this._createdBuffers={},this.elementIDBuffer=null,this._targetRefTexName=null,this._initialize(n),Object.seal(this)}return Object(r.a)(t,null,[{key:"isSupported",value:function(t){return N(t)}}]),Object(r.a)(t,[{key:"delete",value:function(){for(var t in this._createdBuffers)this._createdBuffers[t].delete();this.model.delete()}},{key:"getBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=t?this.feedbackBuffers[this.currentIndex][t]:null;return e?e instanceof At?e:e.buffer:null}},{key:"_getTargetTexture",value:function(){return this.framebuffers[this.currentIndex]?this.framebuffers[this.currentIndex].attachments[36064]:null}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.varyingName,n=void 0===e?null:e,i=t.packed,r=void 0!==i&&i,a=this.getBuffer(n);if(a)return a.getData();w(!n||n===this.targetTextureVarying);var o=Zt(this.framebuffers[this.currentIndex]);if(!r)return o;for(var s=o.constructor,u=Object(di.d)(this.targetTextureType),l=new s(o.length*u/4),c=0,h=0;h<o.length;h+=4)for(var f=0;f<u;f++)l[c++]=o[h+f];return l}},{key:"getFramebuffer",value:function(){return this.framebuffers[this.currentIndex]}},{key:"_getInputs",value:function(){var t={},e=this.currentIndex,n=Object.assign({},this.sourceBuffers[e]);if(this.hasSourceTextures||this.targetTextureVarying){for(var i in n.transform_elementID=this.elementIDBuffer,this.samplerTextureMap){var r=this.samplerTextureMap[i];t[i]=this.sourceTextures[e][r]}this._setSourceTextureParameters();var a=function(t){var e,n,i=t.sourceTextureMap,r=t.targetTextureVarying,a=t.targetTexture,o={};for(var s in r&&(e=a.width,n=a.height,o["".concat(mi).concat(r)]=[e,n]),i){var u=i[s];e=u.width,n=u.height,o["".concat(mi).concat(s)]=[e,n]}return o}({sourceTextureMap:this.sourceTextures[e],targetTextureVarying:this.targetTextureVarying,targetTexture:this.targetTextures[e]});Object.assign(t,a)}return{attributes:n,uniforms:t}}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._getInputs(),n=e.attributes,i=e.uniforms;Object.assign(i,t.uniforms);var r=Object.assign({},t.parameters),a=t.clearRenderTarget,o=void 0===a||a,s=null,u=!0;this.renderingToTexture&&(u=!1,w(s=this.framebuffers[this.currentIndex]),r.viewport=[0,0,s.width,s.height],o&&this.gl.clear(this.gl.COLOR_BUFFER_BIT)),this.model.setAttributes(n),this.model.transform(Object.assign({},t,{transformFeedback:this.transformFeedbacks[this.currentIndex],uniforms:i,discard:u,framebuffer:s,parameters:r}))}},{key:"swapBuffers",value:function(){s.deprecated("swapBuffers()","swap()")(),this.swap()}},{key:"swap",value:function(){w(this.feedbackMap||this._swapTexture),this.currentIndex=(this.currentIndex+1)%2}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.elementCount&&this._setElementCount(t.elementCount);var e=t.sourceBuffers,n=void 0===e?null:e,i=t.feedbackBuffers,r=void 0===i?null:i,a=this.currentIndex;if(n||r){for(var o in r)w(r[o]instanceof At||r[o].buffer instanceof At);Object.assign(this.sourceBuffers[a],n),Object.assign(this.feedbackBuffers[a],r),this._createFeedbackBuffers({feedbackBuffers:r}),this.transformFeedbacks[a]&&this.transformFeedbacks[a].setBuffers(this.feedbackBuffers[a]),this._setupSwapBuffers()}var s=t._sourceTextures,u=t._targetTexture;(s||u)&&(Object.assign(this.sourceTextures[a],s),this._updateTargetTexture(u||this._targetRefTexName,a),this._setupSwapTextures())}},{key:"_setSourceTextureParameters",value:function(){var t=this.currentIndex;for(var e in this.sourceTextures[t])this.sourceTextures[t][e].setParameters(bi)}},{key:"_setElementCount",value:function(t){this.elementCount!==t&&(this.elementCount<t&&this._updateElementIDBuffer(t),this.model.setVertexCount(t),this.elementCount=t)}},{key:"_updateTargetTexture",value:function(t,e){var n=this._buildTargetTexture(t);n&&(this.targetTextures[e]=n,this.framebuffers[e]&&(this.framebuffers[e].update({attachments:Object(tt.a)({},36064,this.targetTextures[e]),resizeAttachments:!1}),this.framebuffers[e].resize({width:n.width,height:n.height})))}},{key:"_initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._validateProps(t),n=e.feedbackBuffers,i=e.feedbackMap,r=t.sourceBuffers,a=t.varyings,o=t._targetTexture,s=t._targetTextureVarying,u=t._swapTexture,l=a;i&&!Array.isArray(a)&&(l=Object.values(i)),this.varyingsArray=l,this.feedbackMap=i,this._swapTexture=u,o&&(this.targetTextureVarying=s,this.renderingToTexture=!0,w(this.targetTextureVarying)),this._setupBuffers({sourceBuffers:r,feedbackBuffers:n}),this._setupTextures(t),this._setupSwapBuffers(),this._setupSwapTextures(),this._buildModel(Object.assign({},t,{id:t.id||"transform-model",drawMode:t.drawMode||0,varyings:l}))}},{key:"_validateProps",value:function(t){var e=t.feedbackBuffers,n=t.feedbackMap,i=t.destinationBuffers,r=t.sourceDestinationMap;i&&(s.deprecated("destinationBuffers","feedbackBuffers")(),e=e||i),r&&(s.deprecated("sourceDestinationMap","feedbackMap")(),n=n||r);var a=t.vs,o=t.elementCount,u=t.varyings,l=t._sourceTextures,c=t._targetTexture,h=t._targetTextureVarying,f=t._swapTexture;for(var p in w(a&&(u||n||c)&&o),e||{})w(e[p]instanceof At||e[p].buffer instanceof At);for(var A in l||{})w(l[A]instanceof St);return w(!c||h),w(!f||l[f]),{feedbackBuffers:e,feedbackMap:n}}},{key:"_setupBuffers",value:function(t){var e=t.sourceBuffers,n=void 0===e?null:e,i=t.feedbackBuffers,r=void 0===i?null:i;this.sourceBuffers[0]=Object.assign({},n),this.feedbackBuffers[0]=Object.assign({},r),this._createFeedbackBuffers({feedbackBuffers:r}),this.sourceBuffers[1]={},this.feedbackBuffers[1]={}}},{key:"_setupTextures",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t._sourceTextures,n=t._targetTexture;if(this.sourceTextures[0]=Object.assign({},e),this.sourceTextures[1]={},this.hasSourceTextures=Object.keys(this.sourceTextures[0]).length>0,this.targetTextureVarying){var i=this._buildTargetTexture(n);w(i),this.targetTextures[0]=i,this.targetTextures[1]=null}}},{key:"_buildTargetTexture",value:function(t){var e;if(t instanceof St)return t;var n=this.sourceTextures[0][t];return n?(this._targetRefTexName=t,Ae(n,{parameters:(e={},Object(tt.a)(e,10241,9728),Object(tt.a)(e,10240,9728),Object(tt.a)(e,10242,33071),Object(tt.a)(e,10243,33071),e),pixelStore:Object(tt.a)({},37440,!1)})):null}},{key:"_createFeedbackBuffers",value:function(t){var e=t.feedbackBuffers;if(this.feedbackMap){var n=this.currentIndex;for(var i in this.feedbackMap){var r=this.feedbackMap[i];if(!(r===this.targetTextureVarying||e&&e[r])){var a=this.sourceBuffers[n][i],o=a.byteLength,s=a.usage,u=a.accessor,l=new At(this.gl,{byteLength:o,usage:s,accessor:u});this._createdBuffers[r]&&this._createdBuffers[r].delete(),this._createdBuffers[r]=l,this.feedbackBuffers[n][r]=l}}}}},{key:"_createNewBuffer",value:function(t,e){var n=new At(this.gl,e);return this._createdBuffers[t]&&(this._createdBuffers[t].delete(),this._createdBuffers[t]=n),n}},{key:"_setupSwapBuffers",value:function(){if(this.feedbackMap){var t=this.currentIndex,e=(t+1)%2;for(var n in Object.assign(this.sourceBuffers[e],this.sourceBuffers[t]),Object.assign(this.feedbackBuffers[e],this.feedbackBuffers[t]),this.feedbackMap){var i=this.feedbackMap[n];i!==this.targetTextureVarying&&(this.sourceBuffers[e][n]=this.feedbackBuffers[t][i],this.feedbackBuffers[e][i]=this.sourceBuffers[t][n],w(this.feedbackBuffers[e][i]instanceof At))}this.transformFeedbacks[e]&&this.transformFeedbacks[e].setBuffers(this.feedbackBuffers[e])}}},{key:"_setupSwapTextures",value:function(){if(this._swapTexture&&this.targetTextureVarying){var t=this.currentIndex,e=(t+1)%2;Object.assign(this.sourceTextures[e],this.sourceTextures[t]),this.sourceTextures[e][this._swapTexture]=this.targetTextures[t],this._updateTargetTexture(this.sourceTextures[t][this._swapTexture],e)}}},{key:"_buildModel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._getShaders(t),n=e.vs,i=e.fs,r=e.modules,a=e.uniforms,o=e.inject,s=e.samplerTextureMap;this.model=new pi(this.gl,Object.assign({},t,{vs:n,fs:i,vertexCount:t.elementCount,modules:r,uniforms:a,inject:o})),this.samplerTextureMap=s,this._setupTransformFeedback(),this._setupFramebuffers(),this._setElementCount(t.elementCount)}},{key:"_setupTransformFeedback",value:function(){P(this.feedbackBuffers[0])||(this.transformFeedbacks[0]=new vn(this.gl,{program:this.model.program,buffers:this.feedbackBuffers[0]}),this.feedbackMap&&(this.transformFeedbacks[1]=new vn(this.gl,{program:this.model.program,buffers:this.feedbackBuffers[1]})))}},{key:"_setupFramebuffers",value:function(){if(this.renderingToTexture){var t=this.targetTextures[0],e=t.width,n=t.height;if(this.framebuffers[0]=new pe(this.gl,{id:"".concat(this.id||"transform","-framebuffer-0"),width:e,height:n,attachments:Object(tt.a)({},36064,this.targetTextures[0])}),this._swapTexture){var i=this.targetTextures[1];e=i.width,n=i.height,this.framebuffers[1]=new pe(this.gl,{id:"".concat(this.id||"transform","-framebuffer-1"),width:e,height:n,attachments:Object(tt.a)({},36064,this.targetTextures[1])})}}}},{key:"_updateElementIDBuffer",value:function(t){if(this.hasSourceTextures||this.targetTextureVarying){var e=new Float32Array(t);e.forEach(function(t,e,n){n[e]=e}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new At(this.gl,{data:e,accessor:{size:1}})}}},{key:"_getShaders",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._processVertexShader(t.vs),n=e.vs,i=e.uniforms,r=e.targetTextureType,a=e.inject,o=e.samplerTextureMap,s=Object(Ai.a)([t.inject||{},a]);return this.targetTextureType=r,{vs:n,fs:Object(di.b)({version:Ee(n),input:this.targetTextureVarying,inputType:r,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[vi.a].concat(t.modules||[]):t.modules,uniforms:i,inject:s,samplerTextureMap:o}}},{key:"_processVertexShader",value:function(t){return _i({vs:t,sourceTextureMap:this.sourceTextures[this.currentIndex],targetTextureVarying:this.targetTextureVarying,targetTexture:this.targetTextures[this.currentIndex]})}}]),t}(),wi="attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",Si=[-1,-1,1,-1,-1,1,1,1],ki=function(t){function e(t,n){var r;Object(i.a)(this,e);var a=Si.map(function(t){return-1===t?0:t});return(r=Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({},n,{vs:wi,geometry:new Dn({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(Si)},aTexCoord:{size:2,value:new Float32Array(a)},aCoordinate:{size:2,value:new Float32Array(a)}}})})))).setVertexCount(4),r}return Object(rt.a)(e,t),e}(pi),Oi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.gl,r=e._cachePrograms,a=void 0!==r&&r;Object(i.a)(this,t),w(n),this.gl=n,this.vertexShaders={},this.fragmentShaders={},this.programs={},this._cachePrograms=a}return Object(r.a)(t,[{key:"delete",value:function(){return this}},{key:"getVertexShader",value:function(t,e){w("string"==typeof e),w(this._compareContexts(t,this.gl));var n=this.vertexShaders[e];return n||(n=new Le(t,e),this.vertexShaders[e]=n),n}},{key:"getFragmentShader",value:function(t,e){w("string"==typeof e),w(this._compareContexts(t,this.gl));var n=this.fragmentShaders[e];return n||(n=new Ie(t,e),this.fragmentShaders[e]=n),n}},{key:"getProgram",value:function(t,e){w(this._compareContexts(t,this.gl)),w("string"==typeof e.vs),w("string"==typeof e.fs),w("string"==typeof e.id);var n=this._getProgramKey(e),i=this.programs[n];return i?(this._resetProgram(i),i):(i=this._createNewProgram(t,e),this._cachePrograms&&this._checkProgramProp(i)&&(i._isCached=!0,this.programs[n]=i),i)}},{key:"_getProgramKey",value:function(t){return"".concat(t.id,"-").concat(t.vs,"-").concat(t.fs)}},{key:"_checkProgramProp",value:function(t){return!t.varyings}},{key:"_createNewProgram",value:function(t,e){var n=e.vs,i=e.fs,r=this.getVertexShader(t,n),a=this.getFragmentShader(t,i);return new An(this.gl,Object.assign({},e,{vs:r,fs:a}))}},{key:"_resetProgram",value:function(t,e){t.reset()}},{key:"_compareContexts",value:function(t,e){return(t.gl||t)===(e.gl||e)}}]),t}(),Pi=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t);var r=n.onInitialize,a=void 0===r?function(){}:r,o=n.onFinalize,s=void 0===o?function(){}:o,u=n.useDevicePixels,l=void 0===u||u,c=n.autoResizeDrawingBuffer,h=void 0===c||c;this.props={onInitialize:a,onFinalize:s},this.setProps({autoResizeDrawingBuffer:h,useDevicePixels:l}),w(e instanceof Worker),this.worker=e,this.canvas=null,this.width=null,this.height=null,this._running=!1,this._animationFrameId=null,this._resolveNextFrame=null,this._nextFramePromise=null,this._onMessage=this._onMessage.bind(this),this._onEvent=this._onEvent.bind(this),this._updateFrame=this._updateFrame.bind(this)}return Object(r.a)(t,null,[{key:"createWorker",value:function(t){return function(e){t.setProps({useDevicePixels:!1,autoResizeDrawingBuffer:!1}),e.canvas=null,e.addEventListener("message",function(n){switch(n.data.command){case"start":i=n.data.opts.canvas,r=new Map,i.addEventListener=function(t,n){e.postMessage({command:"addEventListener",type:t}),r.has(t)||r.set(t,[]),r.get(t).push(n)},i.removeEventListener=function(t,n){e.postMessage({command:"removeEventListener",type:t});var i=r.get(t);i&&i.splice(i.indexOf(n),1)},i.dispatchEvent=function(t,e){var n=r.get(t);n&&n.forEach(function(t){return t(e)})},e.canvas=i,t.start(n.data.opts);break;case"stop":t.stop();break;case"resize":e.canvas.width=n.data.width,e.canvas.height=n.data.height;break;case"event":e.canvas.dispatchEvent(n.data.type,n.data.event)}var i,r})}}}]),Object(r.a)(t,[{key:"setProps",value:function(t){return"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}},{key:"start",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._running?this:(this._running=!0,this.worker.onmessage=this._onMessage,I().then(function(){return t._running?(t._createAndTransferCanvas(e),t.props.onInitialize(t)):null}).then(function(){t._running&&(t._animationFrameId=G(t._updateFrame))}),this)}},{key:"stop",value:function(){return this._running&&(W(this._animationFrameId),this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1,this.props.onFinalize(this)),this.worker.postMessage({command:"stop"}),this}},{key:"waitForRender",value:function(){var t=this;return this._nextFramePromise||(this._nextFramePromise=new Promise(function(e){t._resolveNextFrame=e})),this._nextFramePromise}},{key:"_onMessage",value:function(t){switch(t.data.command){case"addEventListener":this.canvas.addEventListener(t.data.type,this._onEvent);break;case"removeEventListener":this.canvas.removeEventListener(t.data.type,this._onEvent)}}},{key:"_onEvent",value:function(t){var e=this.useDevicePixels&&window.devicePixelRatio||1,n=t.type,i={};for(var r in t){var a=t[r],o=Object(Zn.a)(a);"offsetX"!==r&&"offsetY"!==r||(a*=e),"number"!==o&&"boolean"!==o&&"string"!==o||(i[r]=a)}this.worker.postMessage({command:"event",type:n,event:i})}},{key:"_updateFrame",value:function(){this._resizeCanvasDrawingBuffer(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._animationFrameId=G(this._updateFrame)}},{key:"_createAndTransferCanvas",value:function(t){var e=z(t);e.transferControlToOffscreen||s.error("OffscreenCanvas is not available in your browser.")();var n=e.transferControlToOffscreen();this.worker.postMessage({command:"start",opts:Object.assign({},t,{canvas:n})},[n]),this.canvas=e}},{key:"_resizeCanvasDrawingBuffer",value:function(){if(this.autoResizeDrawingBuffer){var t=this.useDevicePixels&&window.devicePixelRatio||1,e=this.canvas.clientWidth*t,n=this.canvas.clientHeight*t;this.width===e&&this.height===n||(this.width=e,this.height=n,this.worker.postMessage({command:"resize",width:e,height:n}))}}}]),t}(),Ei=function(){function t(e,n){Object(i.a)(this,t);var r=n.id,a=void 0===r?"pass":r;this.id=a,this.gl=e,this.props={enabled:!0,screen:!1,swap:!1},Object.assign(this.props,n)}return Object(r.a)(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"render",value:function(t,e){var n=this;if(this.props.enabled){var i=this.gl,r={gl:i,outputBuffer:t.writeBuffer,inputBuffer:t.readBuffer,animationProps:e,swapBuffers:function(){return t._swapFramebuffers()}};this.props.screen?(r.inputBuffer=r.outputBuffer,r.outputBuffer=pe.getDefaultFramebuffer(i)):this.props.swap&&(r.inputBuffer=t.writeBuffer,r.outputBuffer=t.readBuffer),m(i,{framebuffer:r.outputBuffer},function(){return n._renderPass(r)}),this.props.debug&&r.outputBuffer.log(1,this.id),this.props.swap&&t._swapFramebuffers()}}},{key:"_renderPass",value:function(t){t.gl,t.inputBuffer,t.outputBuffer,t.animationProps}}]),t}(),Ci=function(t){function e(t,n){return Object(i.a)(this,e),n=Array.isArray(n)?{passes:n}:n,Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({id:"composite-pass"},n)))}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"render",value:function(){var t=this.props.passes,e=void 0===t?[]:t,n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.render.apply(s,arguments)}}catch(u){i=!0,r=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}}]),e}(Ei),Ti=function(){function t(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(i.a)(this,t),this.gl=e,this.framebuffer1=new pe(e,{id:"multi-pass-1",stencil:!0}),this.framebuffer2=new pe(e,{id:"multi-pass-2",stencil:!0}),this.reset()}return Object(r.a)(t,[{key:"reset",value:function(){this.framebuffer1.resize(),this.framebuffer2.resize(),this.writeBuffer=this.framebuffer1,this.readBuffer=this.framebuffer2,this.maskActive=!1}},{key:"_swapFramebuffers",value:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}}]),t}(),Mi=function(t){function e(t,n){var r;return Object(i.a)(this,e),n=Array.isArray(n)?{passes:n}:n,(r=Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({id:"multi-pass"},n)))).renderState=new Ti(t,n),r}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"render",value:function(t){this.renderState.reset();var e=this.props.passes,n=void 0===e?[]:e,i=!0,r=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.render(this.renderState,t)}}catch(u){r=!0,a=u}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return this}}]),e}(Ci),ji=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({id:"clear-pass"},n)))}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"_renderPass",value:function(t){var e=t.gl,n=this.props.clearBits,i=void 0===n?16640:n;e.clear(i)}}]),e}(Ei),Li=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({id:"render-pass"},n)))}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"_renderPass",value:function(t){var e=t.animationProps,n=this.props,i=n.models,r=void 0===i?[]:i,a=n.drawParams,o=!0,s=!1,u=void 0;try{for(var l,c=r[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){l.value.draw(Object.assign({},a,{animationProps:e}))}}catch(h){s=!0,u=h}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}}}]),e}(Ei),Ii="uniform sampler2D uDiffuseSampler;\nuniform float uOpacity;\n\nvarying vec2 uv;\n\nvoid main() {\n  vec4 texel = texture2D(uDiffuseSampler, uv);\n  gl_FragColor = uOpacity * texel;\n}\n",zi=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({id:"copy-pass",swap:!0},r)))).clipspace=new ki(t,{id:"copy-pass",fs:Ii}),n}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"_renderPass",value:function(t){var e=t.inputBuffer,n=this.props.opacity,i=void 0===n?1:n;this.clipspace.draw({uniforms:{uDiffuseSampler:e,uOpacity:i},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(Ei),Di="uniform sampler2D uDiffuseSampler;\nuniform float uOpacity;\nvarying vec2 uv;\n\nvoid main() {\n  vec4 texel = texture2D(uDiffuseSampler, uv);\n  gl_FragColor = uOpacity * texel;\n}\n",Bi=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,e),n=Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({id:"texture-pass"},r)));var a=r.texture,o=r.opacity,s=void 0===o?1:o;return n.clipspace=new ki(t,{id:"texture-pass",fs:Di,uniforms:{uDiffuseSampler:a,uOpacity:s}}),n}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"_renderPass",value:function(){this.clipspace.draw({parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(Ei),Ri=n("HrBr"),Fi=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({swap:!0},n)))}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"_renderPass",value:function(t){var e=t.inputBuffer;t.swapBuffers;this.props.model.setUniforms(this.props),this.props.model.draw({uniforms:{texture:e,texSize:[e.width,e.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(Ei),Ni=function(t){function e(t,n){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(i.a)(this,e);var o="".concat(n.name,"-pass");Object(Ri.a)(n);var s=function(t,e,n,i){if(e.filter||e.sampler){var r=Wi(e),a=new Fi(t,{id:n,model:Ui(t,e,r,n,i),uniforms:null});return[a]}var o=e.passes||[];return o.map(function(r){var a=Wi(e,r),s="".concat(n,"-").concat(o.length+1);return new Fi(t,Object.assign({id:s,model:Ui(t,e,a,s,i),uniforms:r.uniforms},i))})}(t,n,o,a);return(r=Object(et.a)(this,Object(nt.a)(e).call(this,t,Object.assign({id:o,passes:s},a)))).module=n,r}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"_renderPass",value:function(t){var e=t.inputBuffer,n=t.swapBuffers,i=!0,r=!0,a=!1,o=void 0;try{for(var s,u=this.module.passes[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value;i||n(),i=!1,l.uniforms&&l.model.setUniforms(l.uniforms),l.model.draw({uniforms:{texture:e,texSize:[e.width,e.height]},parameters:{depthWrite:!1,depthTest:!1}})}}catch(c){a=!0,o=c}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}}}]),e}(Ci);function Ui(t,e,n,i,r){var a=new ki(t,{id:i,fs:n,modules:[e]}),o=Object.assign(e.getUniforms(),e.getUniforms(r));return a.setUniforms(o),a}var Vi=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ".concat(t,"(gl_FragColor, texSize, texCoord);\n}\n")},Gi=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ".concat(t,"(texture, texSize, texCoord);\n}\n")};function Wi(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;if(e.filter){var n="string"==typeof e.filter?e.filter:"".concat(t.name,"_filterColor");return Vi(n)}if(e.sampler){var i="string"==typeof e.sampler?e.sampler:"".concat(t.name,"_sampleColor");return Gi(i)}return null}var Hi={x:[2,0,1],y:[0,1,2],z:[1,2,0]},qi=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e);var n=t.id,r=void 0===n?k("truncated-code-geometry"):n,a=function(t){for(var e=t.bottomRadius,n=void 0===e?0:e,i=t.topRadius,r=void 0===i?0:i,a=t.height,o=void 0===a?1:a,s=t.nradial,u=void 0===s?10:s,l=t.nvertical,c=void 0===l?10:l,h=t.verticalAxis,f=void 0===h?"y":h,p=t.topCap,A=void 0!==p&&p,d=t.bottomCap,v=void 0!==d&&d,g=(A?2:0)+(v?2:0),m=(u+1)*(c+1+g),y=Math.atan2(n-r,o),_=Math.sin,b=Math.cos,x=Math.PI,w=b(y),S=_(y),k=A?-2:0,O=c+(v?2:0),P=u+1,E=new Uint16Array(u*(c+g)*6),C=Hi[f],T=new Float32Array(3*m),M=new Float32Array(3*m),j=new Float32Array(2*m),L=0,I=0,z=k;z<=O;z++){var D=z/c,B=o*D,R=void 0;z<0?(B=0,D=1,R=n):z>c?(B=o,D=1,R=r):R=n+z/c*(r-n),-2!==z&&z!==c+2||(R=0,D=0),B-=o/2;for(var F=0;F<P;F++){var N=_(F*x*2/u),U=b(F*x*2/u);T[L+C[0]]=N*R,T[L+C[1]]=B,T[L+C[2]]=U*R,M[L+C[0]]=z<0||z>c?0:N*w,M[L+C[1]]=z<0?-1:z>c?1:S,M[L+C[2]]=z<0||z>c?0:U*w,j[I+0]=F/u,j[I+1]=D,I+=2,L+=3}}for(var V=0;V<c+g;V++)for(var G=0;G<u;G++){var W=6*(V*u+G);E[W+0]=P*(V+0)+0+G,E[W+1]=P*(V+0)+1+G,E[W+2]=P*(V+1)+1+G,E[W+3]=P*(V+0)+0+G,E[W+4]=P*(V+1)+1+G,E[W+5]=P*(V+1)+0+G}return{indices:E,attributes:{POSITION:{size:3,value:T},NORMAL:{size:3,value:M},TEXCOORD_0:{size:2,value:j}}}}(t),o=a.indices,s=a.attributes;return Object(et.a)(this,Object(nt.a)(e).call(this,Object(_.a)({},t,{id:r,indices:o,attributes:Object(_.a)({},s,t.attributes)})))}return Object(rt.a)(e,t),e}(Dn);var Zi=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e);var n=t.id,r=void 0===n?k("cone-geometry"):n,a=t.radius,o=void 0===a?1:a,s=t.cap,u=void 0===s||s;return Object(et.a)(this,Object(nt.a)(e).call(this,Object(_.a)({},t,{id:r,topRadius:0,topCap:Boolean(u),bottomCap:Boolean(u),bottomRadius:o})))}return Object(rt.a)(e,t),e}(qi),Xi=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Qi=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Yi=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Ki=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),Ji={POSITION:{size:3,value:new Float32Array(Qi)},NORMAL:{size:3,value:new Float32Array(Yi)},TEXCOORD_0:{size:2,value:new Float32Array(Ki)}},$i=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e);var n=t.id,r=void 0===n?k("cube-geometry"):n;return Object(et.a)(this,Object(nt.a)(e).call(this,Object(_.a)({},t,{id:r,indices:{size:1,value:new Uint16Array(Xi)},attributes:Object(_.a)({},Ji,t.attributes)})))}return Object(rt.a)(e,t),e}(Dn),tr=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e);var n=t.id,r=void 0===n?k("cylinder-geometry"):n,a=t.radius,o=void 0===a?1:a;return Object(et.a)(this,Object(nt.a)(e).call(this,Object(_.a)({},t,{id:r,bottomRadius:o,topRadius:o})))}return Object(rt.a)(e,t),e}(qi),er=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],nr=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1],ir=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e);var n=t.id,r=void 0===n?k("ico-sphere-geometry"):n,a=function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).iterations,e=void 0===t?0:t,n=Math.PI,i=2*n,r=[].concat(er),a=[].concat(nr);r.push(),a.push();for(var o=function(){var t={};return function(e,n){var i=(e*=3)<(n*=3)?e:n,a=e>n?e:n,o="".concat(i,"|").concat(a);if(o in t)return t[o];var s=r[e],u=r[e+1],l=r[e+2],c=r[n],h=r[n+1],f=r[n+2],p=(s+c)/2,A=(u+h)/2,d=(l+f)/2,v=Math.sqrt(p*p+A*A+d*d);return p/=v,A/=v,d/=v,r.push(p,A,d),t[o]=r.length/3-1}}(),s=0;s<e;s++){for(var u=[],l=0;l<a.length;l+=3){var c=o(a[l+0],a[l+1]),h=o(a[l+1],a[l+2]),f=o(a[l+2],a[l+0]);u.push(f,a[l+0],c,c,a[l+1],h,h,a[l+2],f,c,h,f)}a=u}for(var p=new Array(3*a.length),A=new Array(2*a.length),d=a.length-3;d>=0;d-=3){var v=a[d+0],g=a[d+1],m=a[d+2],y=3*v,_=3*g,b=3*m,x=2*v,w=2*g,S=2*m,k=r[y+0],O=r[y+1],P=r[y+2],E=Math.acos(P/Math.sqrt(k*k+O*O+P*P)),C=Math.atan2(O,k)+n,T=E/n,M=1-C/i,j=r[_+0],L=r[_+1],I=r[_+2],z=Math.acos(I/Math.sqrt(j*j+L*L+I*I)),D=Math.atan2(L,j)+n,B=z/n,R=1-D/i,F=r[b+0],N=r[b+1],U=r[b+2],V=Math.acos(U/Math.sqrt(F*F+N*N+U*U)),G=Math.atan2(N,F)+n,W=V/n,H=1-G/i,q=[F-j,N-L,U-I],Z=[k-j,O-L,P-I],X=new Rn.a(q).cross(Z).normalize(),Q=void 0;(0===M||0===R||0===H)&&(0===M||M>.5)&&(0===R||R>.5)&&(0===H||H>.5)&&(r.push(r[y+0],r[y+1],r[y+2]),Q=r.length/3-1,a.push(Q),A[2*Q+0]=1,A[2*Q+1]=T,p[3*Q+0]=X.x,p[3*Q+1]=X.y,p[3*Q+2]=X.z,r.push(r[_+0],r[_+1],r[_+2]),Q=r.length/3-1,a.push(Q),A[2*Q+0]=1,A[2*Q+1]=B,p[3*Q+0]=X.x,p[3*Q+1]=X.y,p[3*Q+2]=X.z,r.push(r[b+0],r[b+1],r[b+2]),Q=r.length/3-1,a.push(Q),A[2*Q+0]=1,A[2*Q+1]=W,p[3*Q+0]=X.x,p[3*Q+1]=X.y,p[3*Q+2]=X.z),p[y+0]=p[_+0]=p[b+0]=X.x,p[y+1]=p[_+1]=p[b+1]=X.y,p[y+2]=p[_+2]=p[b+2]=X.z,A[x+0]=M,A[x+1]=T,A[w+0]=R,A[w+1]=B,A[S+0]=H,A[S+1]=W}return{indices:{size:1,value:new Uint16Array(a)},attributes:{POSITION:{size:3,value:new Float32Array(r)},NORMAL:{size:3,value:new Float32Array(p)},TEXCOORD_0:{size:2,value:new Float32Array(A)}}}}(t),o=a.indices,s=a.attributes;return Object(et.a)(this,Object(nt.a)(e).call(this,Object(_.a)({},t,{id:r,indices:o,attributes:Object(_.a)({},s,t.attributes)})))}return Object(rt.a)(e,t),e}(Dn);var rr=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e);var n=t.id,r=void 0===n?k("plane-geometry"):n,a=function(t){var e=t.type,n=void 0===e?"x,y":e,i=t.offset,r=void 0===i?0:i,a=t.flipCull,o=void 0!==a&&a,s=t.unpack,u=void 0!==s&&s,l=n.split(","),c=t["".concat(l[0],"len")],h=t["".concat(l[1],"len")],f=t["n".concat(l[0])]||1,p=t["n".concat(l[1])]||1,A=(f+1)*(p+1),d=new Float32Array(3*A),v=new Float32Array(3*A),g=new Float32Array(2*A);o&&(c=-c);for(var m=0,y=0,_=0;_<=p;_++)for(var b=0;b<=f;b++){var x=b/f,w=_/p;switch(g[m+0]=o?1-x:x,g[m+1]=w,n){case"x,y":d[y+0]=c*x-.5*c,d[y+1]=h*w-.5*h,d[y+2]=r,v[y+0]=0,v[y+1]=0,v[y+2]=o?1:-1;break;case"x,z":d[y+0]=c*x-.5*c,d[y+1]=r,d[y+2]=h*w-.5*h,v[y+0]=0,v[y+1]=o?1:-1,v[y+2]=0;break;case"y,z":d[y+0]=r,d[y+1]=c*x-.5*c,d[y+2]=h*w-.5*h,v[y+0]=o?1:-1,v[y+1]=0,v[y+2]=0}m+=2,y+=3}for(var S=f+1,k=new Uint16Array(f*p*6),O=0;O<p;O++)for(var P=0;P<f;P++){var E=6*(O*f+P);k[E+0]=(O+0)*S+P,k[E+1]=(O+1)*S+P,k[E+2]=(O+0)*S+P+1,k[E+3]=(O+1)*S+P,k[E+4]=(O+1)*S+P+1,k[E+5]=(O+0)*S+P+1}var C={indices:{size:1,value:k},attributes:{POSITION:{size:3,value:d},NORMAL:{size:3,value:v},TEXCOORD_0:{size:2,value:g}}};return u?function(t){var e=t.indices,n=t.attributes;if(!e)return t;for(var i=n.POSITION,r=n.NORMAL,a=n.TEXCOORD_0,o=new Float32Array(3*e.length),s=new Float32Array(3*e.length),u=new Float32Array(2*e.length),l=0;l<e.length;++l){var c=e[l];o[3*l+0]=i[3*c+0],o[3*l+1]=i[3*c+1],o[3*l+2]=i[3*c+2],s[3*l+0]=r[3*c+0],s[3*l+1]=r[3*c+1],s[3*l+2]=r[3*c+2],u[2*l+0]=a[2*c+0],u[2*l+1]=a[2*c+1]}return{attributes:{POSITION:o,NORMAL:s,TEXCOORD_0:u}}}(C):C}(t),o=a.indices,s=a.attributes;return Object(et.a)(this,Object(nt.a)(e).call(this,Object(_.a)({},t,{id:r,indices:o,attributes:Object(_.a)({},s,t.attributes)})))}return Object(rt.a)(e,t),e}(Dn);var ar=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e);var n=t.id,r=void 0===n?k("sphere-geometry"):n,a=function(t){var e=t.nlat,n=void 0===e?10:e,i=t.nlong,r=void 0===i?10:i,a=t.radius,o=void 0===a?1:a,s=Math.PI-0,u=2*Math.PI-0,l=(n+1)*(r+1);if("number"==typeof o){var c=o;o=function(t,e,n,i,r){return c}}for(var h=new Float32Array(3*l),f=new Float32Array(3*l),p=new Float32Array(2*l),A=new Uint16Array(n*r*6),d=0;d<=n;d++)for(var v=0;v<=r;v++){var g=v/r,m=d/n,y=v+d*(r+1),_=2*y,b=3*y,x=u*g,w=s*m,S=Math.sin(x),k=Math.cos(x),O=Math.sin(w),P=Math.cos(w),E=k*O,C=P,T=S*O,M=o(E,C,T,g,m);h[b+0]=M*E,h[b+1]=M*C,h[b+2]=M*T,f[b+0]=E,f[b+1]=C,f[b+2]=T,p[_+0]=g,p[_+1]=1-m}for(var j=n+1,L=0;L<n;L++)for(var I=0;I<r;I++){var z=6*(L*r+I);A[z+0]=I*j+L,A[z+1]=I*j+L+1,A[z+2]=(I+1)*j+L,A[z+3]=(I+1)*j+L,A[z+4]=I*j+L+1,A[z+5]=(I+1)*j+L+1}return{indices:{size:1,value:A},attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:f},TEXCOORD_0:{size:2,value:p}}}}(t),o=a.indices,s=a.attributes;return Object(et.a)(this,Object(nt.a)(e).call(this,Object(_.a)({},t,{id:r,indices:o,attributes:Object(_.a)({},s,t.attributes)})))}return Object(rt.a)(e,t),e}(Dn);var or={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},sr=function(t){function e(t){var n;return Object(i.a)(this,e),n=Object(et.a)(this,Object(nt.a)(e).call(this,t)),t=Object.assign({},or,t),Object.assign(Object(it.a)(n),t),n}return Object(rt.a)(e,t),e}(Bn),ur=function(t){function e(){return Object(i.a)(this,e),Object(et.a)(this,Object(nt.a)(e).apply(this,arguments))}return Object(rt.a)(e,t),e}(Bn),lr=n("zGma"),cr=function(){function t(e){Object(i.a)(this,t);var n=e.id;this.id=n||k(this.constructor.name),this.display=!0,this.position=new Rn.a,this.rotation=new Rn.a,this.scale=new Rn.a(1,1,1),this.matrix=new lr.a,this.userData={},this.props={},this._setScenegraphNodeProps(e)}return Object(r.a)(t,[{key:"delete",value:function(){}},{key:"setProps",value:function(t){return this._setScenegraphNodeProps(t),this}},{key:"toString",value:function(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}},{key:"setPosition",value:function(t){return w(3===t.length,"setPosition requires vector argument"),this.position=t,this}},{key:"setRotation",value:function(t){return w(3===t.length,"setRotation requires vector argument"),this.rotation=t,this}},{key:"setScale",value:function(t){return w(3===t.length,"setScale requires vector argument"),this.scale=t,this}},{key:"setMatrix",value:function(t){!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?this.matrix.copy(t):this.matrix=t}},{key:"setMatrixComponents",value:function(t){var e=t.position,n=t.rotation,i=t.scale,r=t.update,a=void 0===r||r;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),a&&this.updateMatrix(),this}},{key:"updateMatrix",value:function(){var t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.position,n=t.rotation,i=t.scale;return e&&this.setPosition(e),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}},{key:"getCoordinateUniforms",value:function(t,e){w(t),e=e||this.matrix;var n=new lr.a(t).multiplyRight(e),i=n.invert(),r=i.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:r}}},{key:"transform",value:function(){if(this.parent){var t=this.parent;this.endPosition.set(this.position.add(t.endPosition)),this.endRotation.set(this.rotation.add(t.endRotation)),this.endScale.set(this.scale.add(t.endScale))}else this.endPosition.set(this.position),this.endRotation.set(this.rotation),this.endScale.set(this.scale);for(var e=this.children,n=0;n<e.length;++n)e[n].transform();return this}},{key:"_setScenegraphNodeProps",value:function(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setPosition(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}]),t}(),hr=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e);var r=(n=Array.isArray(n)?{children:n}:n).children,a=void 0===r?[]:r;return a.every(function(t){return w(t instanceof cr)}),(t=Object(et.a)(this,Object(nt.a)(e).call(this,n))).children=a,t}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++){var a=r[i];Array.isArray(a)?this.add.apply(this,Object(f.a)(a)):this.children.push(a)}return this}},{key:"remove",value:function(t){var e=this.children,n=e.indexOf(t);return n>-1&&e.splice(n,1),this}},{key:"removeAll",value:function(){return this.children=[],this}},{key:"delete",value:function(){this.children.forEach(function(t){return t.delete()}),this.removeAll(),Object(ze.a)(Object(nt.a)(e.prototype),"delete",this).call(this)}},{key:"traverse",value:function(t){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).worldMatrix,i=void 0===n?new lr.a:n,r=new lr.a(i).multiplyRight(this.matrix),a=!0,o=!1,s=void 0;try{for(var u,l=this.children[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;c instanceof e?c.traverse(t,{worldMatrix:r}):t(c,{worldMatrix:r})}}catch(h){o=!0,s=h}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"traverseReverse",value:function(t,e){return s.warn("traverseReverse is not reverse")(),this.traverse(t,e)}}]),e}(cr),fr=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(this,e),(n=Object(et.a)(this,Object(nt.a)(e).call(this,r))).onBeforeRender=null,n.AfterRender=null,t instanceof pi?(n.model=t,n._setModelNodeProps(r)):n.model=new pi(t,r),n.managedResources=r.managedResources||[],n}return Object(rt.a)(e,t),Object(r.a)(e,[{key:"setProps",value:function(t){return Object(ze.a)(Object(nt.a)(e.prototype),"setProps",this).call(this,t),this._setModelNodeProps(t),this}},{key:"delete",value:function(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(function(t){return t.delete()}),this.managedResources=[]}},{key:"draw",value:function(){var t;return(t=this.model).draw.apply(t,arguments)}},{key:"setUniforms",value:function(){var t;return(t=this.model).setUniforms.apply(t,arguments),this}},{key:"setAttributes",value:function(){var t;return(t=this.model).setAttributes.apply(t,arguments),this}},{key:"updateModuleSettings",value:function(){var t;return(t=this.model).updateModuleSettings.apply(t,arguments),this}},{key:"_setModelNodeProps",value:function(t){this.model.setProps(t)}}]),e}(cr),pr=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.a)(this,e),(t=Object(et.a)(this,Object(nt.a)(e).call(this,n))).projectionMatrix=n.projectionMatrix,t}return Object(rt.a)(e,t),e}(cr);n.d(e,"isWebGL",function(){return F}),n.d(e,"isWebGL2",function(){return N}),n.d(e,"lumaStats",function(){return l}),n.d(e,"createGLContext",function(){return me}),n.d(e,"destroyGLContext",function(){return _e}),n.d(e,"resizeGLContext",function(){return be}),n.d(e,"setGLContextDefaults",function(){return ge}),n.d(e,"getContextInfo",function(){return re}),n.d(e,"getGLContextInfo",function(){return ie}),n.d(e,"getContextLimits",function(){return ne}),n.d(e,"FEATURES",function(){return ae}),n.d(e,"hasFeature",function(){return se}),n.d(e,"hasFeatures",function(){return ue}),n.d(e,"getFeatures",function(){return le}),n.d(e,"canCompileGLGSExtension",function(){return fe}),n.d(e,"cloneTextureFrom",function(){return Ae}),n.d(e,"getKeyValue",function(){return Q}),n.d(e,"getKey",function(){return Y}),n.d(e,"setContextDefaults",function(){return ge}),n.d(e,"glGetDebugInfo",function(){return D}),n.d(e,"trackContextState",function(){return v.a}),n.d(e,"resetParameters",function(){return c.d}),n.d(e,"getParameter",function(){return c.b}),n.d(e,"getParameters",function(){return c.c}),n.d(e,"setParameter",function(){return c.e}),n.d(e,"setParameters",function(){return d}),n.d(e,"withParameters",function(){return m}),n.d(e,"getModifiedParameters",function(){return c.a}),n.d(e,"Buffer",function(){return At}),n.d(e,"Shader",function(){return je}),n.d(e,"VertexShader",function(){return Le}),n.d(e,"FragmentShader",function(){return Ie}),n.d(e,"Program",function(){return An}),n.d(e,"Framebuffer",function(){return pe}),n.d(e,"Renderbuffer",function(){return zt}),n.d(e,"Texture2D",function(){return St}),n.d(e,"TextureCube",function(){return Ct}),n.d(e,"clear",function(){return Wt}),n.d(e,"clearBuffer",function(){return Ht}),n.d(e,"readPixelsToArray",function(){return Zt}),n.d(e,"readPixelsToBuffer",function(){return Xt}),n.d(e,"copyToDataUrl",function(){return Qt}),n.d(e,"copyToImage",function(){return Yt}),n.d(e,"copyToTexture",function(){return Kt}),n.d(e,"blit",function(){return Jt}),n.d(e,"Query",function(){return dn}),n.d(e,"Texture3D",function(){return Mt}),n.d(e,"TransformFeedback",function(){return vn}),n.d(e,"VertexArrayObject",function(){return xn}),n.d(e,"VertexArray",function(){return kn}),n.d(e,"UniformBufferLayout",function(){return Cn}),n.d(e,"setPathPrefix",function(){return bt}),n.d(e,"loadFile",function(){return xt}),n.d(e,"loadImage",function(){return wt}),n.d(e,"_Accessor",function(){return ct}),n.d(e,"_clearBuffer",function(){return Ht}),n.d(e,"Geometry",function(){return Dn}),n.d(e,"Material",function(){return Bn}),n.d(e,"AmbientLight",function(){return Wn}),n.d(e,"DirectionalLight",function(){return Hn}),n.d(e,"PointLight",function(){return qn}),n.d(e,"AnimationLoop",function(){return Qn}),n.d(e,"encodePickingColor",function(){return Kn}),n.d(e,"decodePickingColor",function(){return Jn}),n.d(e,"getNullPickingColor",function(){return $n}),n.d(e,"Model",function(){return pi}),n.d(e,"Transform",function(){return xi}),n.d(e,"ClipSpace",function(){return ki}),n.d(e,"_ShaderCache",function(){return Oi}),n.d(e,"_AnimationLoopProxy",function(){return Pi}),n.d(e,"_MultiPassRenderer",function(){return Mi}),n.d(e,"_RenderState",function(){return Ti}),n.d(e,"_Pass",function(){return Ei}),n.d(e,"_CompositePass",function(){return Ci}),n.d(e,"_ClearPass",function(){return ji}),n.d(e,"_RenderPass",function(){return Li}),n.d(e,"_CopyPass",function(){return zi}),n.d(e,"_TexturePass",function(){return Bi}),n.d(e,"_ShaderModulePass",function(){return Ni}),n.d(e,"ConeGeometry",function(){return Zi}),n.d(e,"CubeGeometry",function(){return $i}),n.d(e,"CylinderGeometry",function(){return tr}),n.d(e,"IcoSphereGeometry",function(){return ir}),n.d(e,"PlaneGeometry",function(){return rr}),n.d(e,"SphereGeometry",function(){return ar}),n.d(e,"TruncatedConeGeometry",function(){return qi}),n.d(e,"PhongMaterial",function(){return sr}),n.d(e,"PBRMaterial",function(){return ur}),n.d(e,"ScenegraphNode",function(){return cr}),n.d(e,"GroupNode",function(){return hr}),n.d(e,"ModelNode",function(){return fr}),n.d(e,"CameraNode",function(){return pr}),n.d(e,"registerShaderModules",function(){return ii.u}),n.d(e,"setDefaultShaderModules",function(){return ii.v}),n.d(e,"assembleShaders",function(){return ii.c}),n.d(e,"createShaderHook",function(){return ii.g}),n.d(e,"createModuleInjection",function(){return ii.f}),n.d(e,"combineInjects",function(){return ii.d}),n.d(e,"normalizeShaderModule",function(){return ii.p}),n.d(e,"fp32",function(){return ii.j}),n.d(e,"fp64",function(){return ii.k}),n.d(e,"project",function(){return ii.t}),n.d(e,"lights",function(){return ii.o}),n.d(e,"dirlight",function(){return ii.i}),n.d(e,"picking",function(){return ii.s}),n.d(e,"diffuse",function(){return ii.h}),n.d(e,"gouraudlighting",function(){return ii.n}),n.d(e,"phonglighting",function(){return ii.r}),n.d(e,"pbr",function(){return ii.q}),n.d(e,"_transform",function(){return ii.b}),n.d(e,"MODULAR_SHADERS",function(){return ii.a}),n.d(e,"getQualifierDetails",function(){return ii.m}),n.d(e,"getPassthroughFS",function(){return ii.l}),n.d(e,"typeToChannelSuffix",function(){return ii.x}),n.d(e,"typeToChannelCount",function(){return ii.w}),n.d(e,"convertToVec4",function(){return ii.e}),n.d(e,"log",function(){return s}),n.d(e,"assert",function(){return w}),n.d(e,"uid",function(){return k}),n.d(e,"self",function(){return o.c}),n.d(e,"window",function(){return o.d}),n.d(e,"global",function(){return o.b}),n.d(e,"document",function(){return o.a})},uzDn:function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}n.d(e,"a",function(){return i})},vpQ4:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("rePB");function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Object(i.a)(t,e,n[e])})}return t}},"w+ko":function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=n("ODXe"),r=n("1A8y"),a=n("54ZI");function o(t){var e=t.width,n=t.height,o=t.bounds,s=t.padding,u=void 0===s?0:s,l=t.offset,c=void 0===l?[0,0]:l,h=Object(i.a)(o,2),f=Object(i.a)(h[0],2),p=f[0],A=f[1],d=Object(i.a)(h[1],2),v=d[0],g=d[1];if(Number.isFinite(u)){u={top:u,bottom:u,left:u,right:u}}else Object(a.a)(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));var m=new r.a({width:e,height:n,longitude:0,latitude:0,zoom:0}),y=m.project([p,g]),_=m.project([v,A]),b=[Math.abs(_[0]-y[0]),Math.abs(_[1]-y[1])],x=[e-u.left-u.right-2*Math.abs(c[0]),n-u.top-u.bottom-2*Math.abs(c[1])];Object(a.a)(x[0]>0&&x[1]>0);var w=x[0]/b[0],S=x[1]/b[1],k=(u.right-u.left)/2/w,O=(u.bottom-u.top)/2/S,P=[(_[0]+y[0])/2+k,(_[1]+y[1])/2+O],E=m.unproject(P),C=m.zoom+Math.log2(Math.abs(Math.min(w,S)));return{longitude:E[0],latitude:E[1],zoom:C}}},xLQB:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("1A8y"),r=n("VKpO"),a=85.05113,o=-85.05113;function s(t){var e=t.width,n=t.height,s=t.longitude,u=t.latitude,l=t.zoom,c=t.pitch,h=void 0===c?0:c,f=t.bearing,p=void 0===f?0:f;(s<-180||s>180)&&(s=Object(r.c)(s+180,360)-180),(p<-180||p>180)&&(p=Object(r.c)(p+180,360)-180);var A=new i.a({width:e,height:n,longitude:s,latitude:u,zoom:l}),d=A.project([s,a])[1],v=A.project([s,o])[1],g=0;return v-d<n&&(l+=Math.log2(n/(v-d)),d=(A=new i.a({width:e,height:n,longitude:s,latitude:u,zoom:l})).project([s,a])[1],v=A.project([s,o])[1]),d>0?g=d:v<n&&(g=v-n),g&&(u=A.unproject([e/2,n/2+g])[1]),{width:e,height:n,longitude:s,latitude:u,zoom:l,pitch:h,bearing:p}}},xPWL:function(t,e,n){"use strict";var i=n("TqRt");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(n("q1tI")),a=(0,i(n("8/g6")).default)(r.default.createElement(r.default.Fragment,null,r.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),r.default.createElement("path",{d:"M12.56 14.33c-.34.27-.56.7-.56 1.17V21h7c1.1 0 2-.9 2-2v-5.98c-.94-.33-1.95-.52-3-.52-2.03 0-3.93.7-5.44 1.83z"}),r.default.createElement("circle",{cx:"18",cy:"6",r:"5"}),r.default.createElement("path",{d:"M11.5 6c0-1.08.27-2.1.74-3H5c-1.1 0-2 .9-2 2v14c0 .55.23 1.05.59 1.41l9.82-9.82C12.23 9.42 11.5 7.8 11.5 6z"})),"Streetview");e.default=a},y2Uh:function(t,e,n){"use strict";n.d(e,"c",function(){return s}),n.d(e,"b",function(){return u}),n.d(e,"e",function(){return l}),n.d(e,"d",function(){return c}),n.d(e,"a",function(){return h});var i=n("ODXe"),r=n("uzDn"),a="void main() {gl_FragColor = vec4(0);}",o="#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";function s(t,e){e=Array.isArray(e)?e:[e];var n=t.replace(/^\s+/,"").split(/\s+/),r=Object(i.a)(n,3),a=r[0],o=r[1],s=r[2];return e.includes(a)&&o&&s?{qualifier:a,type:o,name:s.split(";")[0]}:null}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.version,n=void 0===e?100:e,i=t.input,r=t.inputType,s=t.output;if(!i)return 300===n?o:a;var u=h(i,r);return 300===n?"#version 300 es\nin ".concat(r," ").concat(i,";\nout vec4 ").concat(s,";\nvoid main() {\n  ").concat(s," = ").concat(u,";\n}"):"varying ".concat(r," ").concat(i,";\nvoid main() {\n  gl_FragColor = ").concat(u,";\n}")}function l(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Object(r.a)(!1),null}}function c(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Object(r.a)(!1),null}}function h(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Object(r.a)(!1),null}}},yLV6:function(t,e,n){var i;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
!function(r,a,o,s){"use strict";var u,l=["","webkit","Moz","MS","ms","o"],c=a.createElement("div"),h="function",f=Math.round,p=Math.abs,A=Date.now;function d(t,e,n){return setTimeout(x(t,n),e)}function v(t,e,n){return!!Array.isArray(t)&&(g(t,n[e],n),!0)}function g(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==s)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function m(t,e,n){var i="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=r.console&&(r.console.warn||r.console.log);return a&&a.call(r.console,i,n),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==s&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var y=m(function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&t[i[r]]===s)&&(t[i[r]]=e[i[r]]),r++;return t},"extend","Use `assign`."),_=m(function(t,e){return y(t,e,!0)},"merge","Use `assign`.");function b(t,e,n){var i,r=e.prototype;(i=t.prototype=Object.create(r)).constructor=t,i._super=r,n&&u(i,n)}function x(t,e){return function(){return t.apply(e,arguments)}}function w(t,e){return typeof t==h?t.apply(e&&e[0]||s,e):t}function S(t,e){return t===s?e:t}function k(t,e,n){g(C(e),function(e){t.addEventListener(e,n,!1)})}function O(t,e,n){g(C(e),function(e){t.removeEventListener(e,n,!1)})}function P(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function E(t,e){return t.indexOf(e)>-1}function C(t){return t.trim().split(/\s+/g)}function T(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function M(t){return Array.prototype.slice.call(t,0)}function j(t,e,n){for(var i=[],r=[],a=0;a<t.length;){var o=e?t[a][e]:t[a];T(r,o)<0&&i.push(t[a]),r[a]=o,a++}return n&&(i=e?i.sort(function(t,n){return t[e]>n[e]}):i.sort()),i}function L(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),a=0;a<l.length;){if((i=(n=l[a])?n+r:e)in t)return i;a++}return s}var I=1;function z(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}var D="ontouchstart"in r,B=L(r,"PointerEvent")!==s,R=D&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),F=25,N=1,U=2,V=4,G=8,W=1,H=2,q=4,Z=8,X=16,Q=H|q,Y=Z|X,K=Q|Y,J=["x","y"],$=["clientX","clientY"];function tt(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){w(t.options.enable,[t])&&n.handler(e)},this.init()}function et(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,a=e&N&&i-r==0,o=e&(V|G)&&i-r==0;n.isFirst=!!a,n.isFinal=!!o,a&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=nt(e));r>1&&!n.firstMultiple?n.firstMultiple=nt(e):1===r&&(n.firstMultiple=!1);var a=n.firstInput,o=n.firstMultiple,u=o?o.center:a.center,l=e.center=it(i);e.timeStamp=A(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=st(u,l),e.distance=ot(u,l),function(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},a=t.prevInput||{};e.eventType!==N&&a.eventType!==V||(r=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y});e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}(n,e),e.offsetDirection=at(e.deltaX,e.deltaY);var c=rt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=p(c.x)>p(c.y)?c.x:c.y,e.scale=o?(h=o.pointers,f=i,ot(f[0],f[1],$)/ot(h[0],h[1],$)):1,e.rotation=o?function(t,e){return st(e[1],e[0],$)+st(t[1],t[0],$)}(o.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,r,a,o=t.lastInterval||e,u=e.timeStamp-o.timeStamp;if(e.eventType!=G&&(u>F||o.velocity===s)){var l=e.deltaX-o.deltaX,c=e.deltaY-o.deltaY,h=rt(u,l,c);i=h.x,r=h.y,n=p(h.x)>p(h.y)?h.x:h.y,a=at(l,c),t.lastInterval=e}else n=o.velocity,i=o.velocityX,r=o.velocityY,a=o.direction;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=a}(n,e);var h,f;var d=t.element;P(e.srcEvent.target,d)&&(d=e.srcEvent.target);e.target=d}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function nt(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:f(t.pointers[n].clientX),clientY:f(t.pointers[n].clientY)},n++;return{timeStamp:A(),pointers:e,center:it(e),deltaX:t.deltaX,deltaY:t.deltaY}}function it(t){var e=t.length;if(1===e)return{x:f(t[0].clientX),y:f(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:f(n/e),y:f(i/e)}}function rt(t,e,n){return{x:e/t||0,y:n/t||0}}function at(t,e){return t===e?W:p(t)>=p(e)?t<0?H:q:e<0?Z:X}function ot(t,e,n){n||(n=J);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function st(t,e,n){n||(n=J);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}tt.prototype={handler:function(){},init:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(z(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(z(this.element),this.evWin,this.domHandler)}};var ut={mousedown:N,mousemove:U,mouseup:V},lt="mousedown",ct="mousemove mouseup";function ht(){this.evEl=lt,this.evWin=ct,this.pressed=!1,tt.apply(this,arguments)}b(ht,tt,{handler:function(t){var e=ut[t.type];e&N&&0===t.button&&(this.pressed=!0),e&U&&1!==t.which&&(e=V),this.pressed&&(e&V&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var ft={pointerdown:N,pointermove:U,pointerup:V,pointercancel:G,pointerout:G},pt={2:"touch",3:"pen",4:"mouse",5:"kinect"},At="pointerdown",dt="pointermove pointerup pointercancel";function vt(){this.evEl=At,this.evWin=dt,tt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(At="MSPointerDown",dt="MSPointerMove MSPointerUp MSPointerCancel"),b(vt,tt,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=ft[i],a=pt[t.pointerType]||t.pointerType,o="touch"==a,s=T(e,t.pointerId,"pointerId");r&N&&(0===t.button||o)?s<0&&(e.push(t),s=e.length-1):r&(V|G)&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),n&&e.splice(s,1))}});var gt={touchstart:N,touchmove:U,touchend:V,touchcancel:G},mt="touchstart",yt="touchstart touchmove touchend touchcancel";function _t(){this.evTarget=mt,this.evWin=yt,this.started=!1,tt.apply(this,arguments)}b(_t,tt,{handler:function(t){var e=gt[t.type];if(e===N&&(this.started=!0),this.started){var n=function(t,e){var n=M(t.touches),i=M(t.changedTouches);e&(V|G)&&(n=j(n.concat(i),"identifier",!0));return[n,i]}.call(this,t,e);e&(V|G)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}});var bt={touchstart:N,touchmove:U,touchend:V,touchcancel:G},xt="touchstart touchmove touchend touchcancel";function wt(){this.evTarget=xt,this.targetIds={},tt.apply(this,arguments)}b(wt,tt,{handler:function(t){var e=bt[t.type],n=function(t,e){var n=M(t.touches),i=this.targetIds;if(e&(N|U)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,a,o=M(t.changedTouches),s=[],u=this.target;if(a=n.filter(function(t){return P(t.target,u)}),e===N)for(r=0;r<a.length;)i[a[r].identifier]=!0,r++;r=0;for(;r<o.length;)i[o[r].identifier]&&s.push(o[r]),e&(V|G)&&delete i[o[r].identifier],r++;if(!s.length)return;return[j(a.concat(s),"identifier",!0),s]}.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}});var St=2500,kt=25;function Ot(){tt.apply(this,arguments);var t=x(this.handler,this);this.touch=new wt(this.manager,t),this.mouse=new ht(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function Pt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout(function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)},St)}}b(Ot,tt,{handler:function(t,e,n){var i="touch"==n.pointerType,r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)(function(t,e){t&N?(this.primaryTouch=e.changedPointers[0].identifier,Pt.call(this,e)):t&(V|G)&&Pt.call(this,e)}).call(this,e,n);else if(r&&function(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],a=Math.abs(e-r.x),o=Math.abs(n-r.y);if(a<=kt&&o<=kt)return!0}return!1}.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Et=L(c.style,"touchAction"),Ct=Et!==s,Tt="auto",Mt="manipulation",jt="none",Lt="pan-x",It="pan-y",zt=function(){if(!Ct)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=!e||r.CSS.supports("touch-action",n)}),t}();function Dt(t,e){this.manager=t,this.set(e)}Dt.prototype={set:function(t){"compute"==t&&(t=this.compute()),Ct&&this.manager.element.style&&zt[t]&&(this.manager.element.style[Et]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return g(this.manager.recognizers,function(e){w(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(E(t,jt))return jt;var e=E(t,Lt),n=E(t,It);if(e&&n)return jt;if(e||n)return e?Lt:It;if(E(t,Mt))return Mt;return Tt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=E(i,jt)&&!zt[jt],a=E(i,It)&&!zt[It],o=E(i,Lt)&&!zt[Lt];if(r){var s=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(s&&u&&l)return}if(!o||!a)return r||a&&n&Q||o&&n&Y?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Bt=1,Rt=2,Ft=4,Nt=8,Ut=Nt,Vt=16;function Gt(t){this.options=u({},this.defaults,t||{}),this.id=I++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=Bt,this.simultaneous={},this.requireFail=[]}function Wt(t){return t&Vt?"cancel":t&Nt?"end":t&Ft?"move":t&Rt?"start":""}function Ht(t){return t==X?"down":t==Z?"up":t==H?"left":t==q?"right":""}function qt(t,e){var n=e.manager;return n?n.get(t):t}function Zt(){Gt.apply(this,arguments)}function Xt(){Zt.apply(this,arguments),this.pX=null,this.pY=null}function Qt(){Zt.apply(this,arguments)}function Yt(){Gt.apply(this,arguments),this._timer=null,this._input=null}function Kt(){Zt.apply(this,arguments)}function Jt(){Zt.apply(this,arguments)}function $t(){Gt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function te(t,e){return(e=e||{}).recognizers=S(e.recognizers,te.defaults.preset),new ee(t,e)}Gt.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(v(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=qt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return v(t,"dropRecognizeWith",this)?this:(t=qt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(v(t,"requireFailure",this))return this;var e=this.requireFail;return-1===T(e,t=qt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(v(t,"dropRequireFailure",this))return this;t=qt(t,this);var e=T(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}n<Nt&&i(e.options.event+Wt(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=Nt&&i(e.options.event+Wt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Bt)))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!w(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(Ut|Vt|32)&&(this.state=Bt),this.state=this.process(e),this.state&(Rt|Ft|Nt|Vt)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},b(Zt,Gt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=e&(Rt|Ft),r=this.attrTest(t);return i&&(n&G||!r)?e|Vt:i||r?n&V?e|Nt:e&Rt?e|Ft:Rt:32}}),b(Xt,Zt,{defaults:{event:"pan",threshold:10,pointers:1,direction:K},getTouchAction:function(){var t=this.options.direction,e=[];return t&Q&&e.push(It),t&Y&&e.push(Lt),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,a=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&Q?(r=0===a?W:a<0?H:q,n=a!=this.pX,i=Math.abs(t.deltaX)):(r=0===o?W:o<0?Z:X,n=o!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return Zt.prototype.attrTest.call(this,t)&&(this.state&Rt||!(this.state&Rt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Ht(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),b(Qt,Zt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Rt)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),b(Yt,Gt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Tt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||t.eventType&(V|G)&&!r)this.reset();else if(t.eventType&N)this.reset(),this._timer=d(function(){this.state=Ut,this.tryEmit()},e.time,this);else if(t.eventType&V)return Ut;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Ut&&(t&&t.eventType&V?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=A(),this.manager.emit(this.options.event,this._input)))}}),b(Kt,Zt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Rt)}}),b(Jt,Zt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Q|Y,pointers:1},getTouchAction:function(){return Xt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(Q|Y)?e=t.overallVelocity:n&Q?e=t.overallVelocityX:n&Y&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&p(e)>this.options.velocity&&t.eventType&V},emit:function(t){var e=Ht(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),b($t,Gt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Mt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&N&&0===this.count)return this.failTimeout();if(i&&r&&n){if(t.eventType!=V)return this.failTimeout();var a=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||ot(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&a?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=d(function(){this.state=Ut,this.tryEmit()},e.interval,this),Rt):Ut}return 32},failTimeout:function(){return this._timer=d(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ut&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),te.VERSION="2.0.7",te.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Kt,{enable:!1}],[Qt,{enable:!1},["rotate"]],[Jt,{direction:Q}],[Xt,{direction:Q},["swipe"]],[$t],[$t,{event:"doubletap",taps:2},["tap"]],[Yt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function ee(t,e){var n;this.options=u({},te.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(B?vt:R?wt:D?Ot:ht))(n,et),this.touchAction=new Dt(this,this.options.touchAction),ne(this,!0),g(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function ne(t,e){var n,i=t.element;i.style&&(g(t.options.cssProps,function(r,a){n=L(i.style,a),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""}),e||(t.oldCssProps={}))}ee.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&Ut)&&(r=e.curRecognizer=null);for(var a=0;a<i.length;)n=i[a],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&n.state&(Rt|Ft|Nt)&&(r=e.curRecognizer=n),a++}},get:function(t){if(t instanceof Gt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(v(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(v(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=T(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var n=this.handlers;return g(C(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this}},off:function(t,e){if(t!==s){var n=this.handlers;return g(C(t),function(t){e?n[t]&&n[t].splice(T(n[t],e),1):delete n[t]}),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=a.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&ne(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(te,{INPUT_START:N,INPUT_MOVE:U,INPUT_END:V,INPUT_CANCEL:G,STATE_POSSIBLE:Bt,STATE_BEGAN:Rt,STATE_CHANGED:Ft,STATE_ENDED:Nt,STATE_RECOGNIZED:Ut,STATE_CANCELLED:Vt,STATE_FAILED:32,DIRECTION_NONE:W,DIRECTION_LEFT:H,DIRECTION_RIGHT:q,DIRECTION_UP:Z,DIRECTION_DOWN:X,DIRECTION_HORIZONTAL:Q,DIRECTION_VERTICAL:Y,DIRECTION_ALL:K,Manager:ee,Input:tt,TouchAction:Dt,TouchInput:wt,MouseInput:ht,PointerEventInput:vt,TouchMouseInput:Ot,SingleTouchInput:_t,Recognizer:Gt,AttrRecognizer:Zt,Tap:$t,Pan:Xt,Swipe:Jt,Pinch:Qt,Rotate:Kt,Press:Yt,on:k,off:O,each:g,merge:_,extend:y,assign:u,inherit:b,bindFn:x,prefixed:L}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=te,(i=function(){return te}.call(e,n,e,t))===s||(t.exports=i)}(window,document)},yU0y:function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return r}),n.d(e,"c",function(){return a});var i=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array,a=Math.random;Math.PI},yXba:function(t,e,n){var i,r,a;
/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */r=[],void 0===(a="function"==typeof(i=function(){"use strict";function t(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var n={},i={};function r(t,e){var r,a,s;return e?(s=0<=(t>>>=0)&&t<256)&&(a=i[t])?a:(r=o(t,(0|t)<0?-1:0,!0),s&&(i[t]=r),r):(s=-128<=(t|=0)&&t<128)&&(a=n[t])?a:(r=o(t,t<0?-1:0,!1),s&&(n[t]=r),r)}function a(t,e){if(isNaN(t)||!isFinite(t))return e?d:A;if(e){if(t<0)return d;if(t>=h)return _}else{if(t<=-f)return b;if(t+1>=f)return y}return t<0?a(-t,e).neg():o(t%c|0,t/c|0,e)}function o(e,n,i){return new t(e,n,i)}t.fromInt=r,t.fromNumber=a,t.fromBits=o;var s=Math.pow;function u(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return A;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return u(t.substring(1),e,n).neg();for(var r=a(s(n,8)),o=A,l=0;l<t.length;l+=8){var c=Math.min(8,t.length-l),h=parseInt(t.substring(l,l+c),n);if(c<8){var f=a(s(n,c));o=o.mul(f).add(a(h))}else o=(o=o.mul(r)).add(a(h))}return o.unsigned=e,o}function l(e){return e instanceof t?e:"number"==typeof e?a(e):"string"==typeof e?u(e):o(e.low,e.high,e.unsigned)}t.fromString=u,t.fromValue=l;var c=4294967296,h=c*c,f=h/2,p=r(1<<24),A=r(0);t.ZERO=A;var d=r(0,!0);t.UZERO=d;var v=r(1);t.ONE=v;var g=r(1,!0);t.UONE=g;var m=r(-1);t.NEG_ONE=m;var y=o(-1,2147483647,!1);t.MAX_VALUE=y;var _=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=_;var b=o(0,-2147483648,!1);t.MIN_VALUE=b;var x=t.prototype;return x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*c+(this.low>>>0):this.high*c+(this.low>>>0)},x.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(b)){var e=a(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=a(s(t,6),this.unsigned),o=this,u="";;){var l=o.div(r),c=(o.sub(l.mul(r)).toInt()>>>0).toString(t);if((o=l).isZero())return c+u;for(;c.length<6;)c="0"+c;u=""+c+u}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(b)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},x.isZero=function(){return 0===this.high&&0===this.low},x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1==(1&this.low)},x.isEven=function(){return 0==(1&this.low)},x.equals=function(t){return e(t)||(t=l(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},x.eq=x.equals,x.notEquals=function(t){return!this.eq(t)},x.neq=x.notEquals,x.lessThan=function(t){return this.comp(t)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(t){return this.comp(t)<=0},x.lte=x.lessThanOrEqual,x.greaterThan=function(t){return this.comp(t)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(t){return this.comp(t)>=0},x.gte=x.greaterThanOrEqual,x.compare=function(t){if(e(t)||(t=l(t)),this.eq(t))return 0;var n=this.isNegative(),i=t.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(b)?b:this.not().add(v)},x.neg=x.negate,x.add=function(t){e(t)||(t=l(t));var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,a=65535&this.low,s=t.high>>>16,u=65535&t.high,c=t.low>>>16,h=0,f=0,p=0,A=0;return p+=(A+=a+(65535&t.low))>>>16,f+=(p+=r+c)>>>16,h+=(f+=i+u)>>>16,h+=n+s,o((p&=65535)<<16|(A&=65535),(h&=65535)<<16|(f&=65535),this.unsigned)},x.subtract=function(t){return e(t)||(t=l(t)),this.add(t.neg())},x.sub=x.subtract,x.multiply=function(t){if(this.isZero())return A;if(e(t)||(t=l(t)),t.isZero())return A;if(this.eq(b))return t.isOdd()?b:A;if(t.eq(b))return this.isOdd()?b:A;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(p)&&t.lt(p))return a(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,s=65535&this.low,u=t.high>>>16,c=65535&t.high,h=t.low>>>16,f=65535&t.low,d=0,v=0,g=0,m=0;return g+=(m+=s*f)>>>16,v+=(g+=r*f)>>>16,g&=65535,v+=(g+=s*h)>>>16,d+=(v+=i*f)>>>16,v&=65535,d+=(v+=r*h)>>>16,v&=65535,d+=(v+=s*c)>>>16,d+=n*f+i*h+r*c+s*u,o((g&=65535)<<16|(m&=65535),(d&=65535)<<16|(v&=65535),this.unsigned)},x.mul=x.multiply,x.divide=function(t){if(e(t)||(t=l(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?d:A;var n,i,r;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return d;if(t.gt(this.shru(1)))return g;r=d}else{if(this.eq(b))return t.eq(v)||t.eq(m)?b:t.eq(b)?v:(n=this.shr(1).div(t).shl(1)).eq(A)?t.isNegative()?v:m:(i=this.sub(t.mul(n)),r=n.add(i.div(t)));if(t.eq(b))return this.unsigned?d:A;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=A}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),u=o<=48?1:s(2,o-48),c=a(n),h=c.mul(t);h.isNegative()||h.gt(i);)h=(c=a(n-=u,this.unsigned)).mul(t);c.isZero()&&(c=v),r=r.add(c),i=i.sub(h)}return r},x.div=x.divide,x.modulo=function(t){return e(t)||(t=l(t)),this.sub(this.div(t).mul(t))},x.mod=x.modulo,x.not=function(){return o(~this.low,~this.high,this.unsigned)},x.and=function(t){return e(t)||(t=l(t)),o(this.low&t.low,this.high&t.high,this.unsigned)},x.or=function(t){return e(t)||(t=l(t)),o(this.low|t.low,this.high|t.high,this.unsigned)},x.xor=function(t){return e(t)||(t=l(t)),o(this.low^t.low,this.high^t.high,this.unsigned)},x.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):o(0,this.low<<t-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?o(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):o(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0==(t&=63))return this;var n=this.high;return t<32?o(this.low>>>t|n<<32-t,n>>>t,this.unsigned):o(32===t?n:n>>>t-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},x.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},x.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t})?i.apply(e,r):i)||(t.exports=a)},yq7u:function(t,e,n){"use strict";var i=n("P0Fk"),r=n("lQOs"),a=n("rpxL"),o=n("HrBr"),s=n("y2Uh"),u={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 0.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 0.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null};function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.fround(t),r=t-i;return e[n]=i,e[n+1]=r,e}var c="uniform float ONE;\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",h="".concat(c,"\n").concat("const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\nconst vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);\n\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\n\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\n\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09);\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09);\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10);\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11);\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12);\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13);\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14);\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15);\n\nfloat nint(float d) {\n    if (d == floor(d)) return d;\n    return floor(d + 0.5);\n}\n\nvec2 nint_fp64(vec2 a) {\n    float hi = nint(a.x);\n    float lo;\n    vec2 tmp;\n    if (hi == a.x) {\n        lo = nint(a.y);\n        tmp = quickTwoSum(hi, lo);\n    } else {\n        lo = 0.0;\n        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {\n            hi -= 1.0;\n        }\n        tmp = vec2(hi, lo);\n    }\n    return tmp;\n}\n\nvec2 exp_fp64(vec2 a) {\n\n  const int k_power = 4;\n  const float k = 16.0;\n\n  const float inv_k = 1.0 / k;\n\n  if (a.x <= -88.0) return vec2(0.0, 0.0);\n  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\n  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\n  if (a.x == 1.0 && a.y == 0.0) return E_FP64;\n\n  float m = floor(a.x / LOG2_FP64.x + 0.5);\n  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\n  vec2 s, t, p;\n\n  p = mul_fp64(r, r);\n  s = sum_fp64(r, p * 0.5);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\n\n\n\n\n\n\n  s = sum_fp64(s, t);\n  for (int i = 0; i < k_power; i++) {\n    s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  }\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = sum_fp64(s, vec2(ONE, 0.0));\n#else\n  s = sum_fp64(s, vec2(1.0, 0.0));\n#endif\n\n  return s * pow(2.0, m);\n}\n\nvec2 log_fp64(vec2 a)\n{\n  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n  vec2 x = vec2(log(a.x), 0.0);\n  vec2 s;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = vec2(ONE, 0.0);\n#else\n  s = vec2(1.0, 0.0);\n#endif\n\n  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);\n  return x;\n}\n\nvec2 sin_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(0.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  s = a;\n  r = a;\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\n  s = sum_fp64(s, t);\n\n\n\n\n\n\n  return s;\n}\n\nvec2 cos_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(1.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  r = x;\n  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\n  s = sum_fp64(s, t);\n\n\n\n\n\n\n  return s;\n}\n\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\n  if (a.x == 0.0 && a.y == 0.0) {\n    sin_t = vec2(0.0, 0.0);\n    cos_t = vec2(1.0, 0.0);\n  }\n\n  sin_t = sin_taylor_fp64(a);\n  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\n\nvec2 sin_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return sin_taylor_fp64(t);\n        } else if (j == 1) {\n            return cos_taylor_fp64(t);\n        } else if (j == -1) {\n            return -cos_taylor_fp64(t);\n        } else {\n            return -sin_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 cos_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(1.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return cos_taylor_fp64(t);\n        } else if (j == 1) {\n            return -sin_taylor_fp64(t);\n        } else if (j == -1) {\n            return sin_taylor_fp64(t);\n        } else {\n            return -cos_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 tan_fp64(vec2 a) {\n    vec2 sin_a;\n    vec2 cos_a;\n\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n    vec2 sin_t, cos_t;\n    vec2 s, c;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#else\n        if (abs_k == 1) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs_k == 2) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs_k == 3) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs_k == 4) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#endif\n        if (k > 0) {\n            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return div_fp64(sin_a, cos_a);\n}\n\nvec2 radians_fp64(vec2 degree) {\n  return mul_fp64(degree, PI_180_FP64);\n}\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sum_fp64(a[0], b[0]);\n    out_val[1] = sum_fp64(a[1], b[1]);\n}\n\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sub_fp64(a[0], b[0]);\n    out_val[1] = sub_fp64(a[1], b[1]);\n}\n\nvoid vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = mul_fp64(a[0], b[0]);\n    out_val[1] = mul_fp64(a[1], b[1]);\n}\n\nvoid vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = div_fp64(a[0], b[0]);\n    out_val[1] = div_fp64(a[1], b[1]);\n}\n\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\n  vec2 range[2];\n  vec2_sub_fp64(y, x, range);\n  vec2 portion[2];\n  portion[0] = range[0] * a;\n  portion[1] = range[1] * a;\n  vec2_sum_fp64(x, portion, out_val);\n}\n\nvec2 vec2_length_fp64(vec2 x[2]) {\n  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\n\nvoid vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {\n  vec2 length = vec2_length_fp64(x);\n  vec2 length_vec2[2];\n  length_vec2[0] = length;\n  length_vec2[1] = length;\n\n  vec2_div_fp64(x, length_vec2, out_val);\n}\n\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\n  vec2 diff[2];\n  vec2_sub_fp64(x, y, diff);\n  return vec2_length_fp64(diff);\n}\n\nvec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {\n  vec2 v[2];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n\n  return sum_fp64(v[0], v[1]);\n}\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvec2 vec3_length_fp64(vec2 x[3]) {\n  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),\n    mul_fp64(x[2], x[2])));\n}\n\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\n  vec2 diff[3];\n  vec3_sub_fp64(x, y, diff);\n  return vec3_length_fp64(diff);\n}\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\n  out_val[0].x = a[0];\n  out_val[0].y = 0.0;\n\n  out_val[1].x = a[1];\n  out_val[1].y = 0.0;\n\n  out_val[2].x = a[2];\n  out_val[2].y = 0.0;\n\n  out_val[3].x = a[3];\n  out_val[3].y = 0.0;\n}\n\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\n  out_val[0] = mul_fp64(a[0], b);\n  out_val[1] = mul_fp64(a[1], b);\n  out_val[2] = mul_fp64(a[2], b);\n  out_val[3] = mul_fp64(a[3], b);\n}\n\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\n  for (int i = 0; i < 4; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\n  vec2 v[4];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n  v[2] = mul_fp64(a[2], b[2]);\n  v[3] = mul_fp64(a[3], b[3]);\n\n  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\n\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\n  vec2 tmp[4];\n\n  for (int i = 0; i < 4; i++)\n  {\n    for (int j = 0; j < 4; j++)\n    {\n      tmp[j] = b[j + i * 4];\n    }\n    vec4_dot_fp64(a, tmp, out_val[i]);\n  }\n}\n"),f={ONE:1};var p={name:"fp64",vs:h,fs:null,fp64ify:l,fp64LowPart:function(t){return t-Math.fround(t)},fp64ifyMatrix4:function(t){for(var e=new Float32Array(32),n=0;n<4;++n)for(var i=0;i<4;++i){var r=4*n+i;l(t[4*i+n],e,2*r)}return e},getUniforms:function(){return Object.assign({},f)}},A=("".concat(c),n("zGma")),d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],v={modelMatrix:d,viewMatrix:d,projectionMatrix:d,cameraPositionWorld:[0,0,0]};var g="varying vec4 project_vPositionWorld;\nvarying vec3 project_vNormalWorld;\n\nvec4 project_getPosition_World() {\n  return project_vPositionWorld;\n}\n\nvec3 project_getNormal_World() {\n  return project_vNormalWorld;\n}\n",m={name:"project",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,e=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],{});return void 0!==t.modelMatrix&&(e.modelMatrix=t.modelMatrix),void 0!==t.viewMatrix&&(e.viewMatrix=t.viewMatrix),void 0!==t.projectionMatrix&&(e.projectionMatrix=t.projectionMatrix),void 0!==t.cameraPositionWorld&&(e.cameraPositionWorld=t.cameraPositionWorld),void 0===t.projectionMatrix&&void 0===t.viewMatrix||(e.viewProjectionMatrix=new A.a(t.projectionMatrix).multiplyRight(t.viewMatrix)),e},vs:"".concat(g,"\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform vec3 cameraPositionWorld;\n\nstruct World {\n  vec3 position;\n  vec3 normal;\n};\n\nWorld world;\n\nvoid project_setPosition(vec4 position) {\n  project_vPositionWorld = position;\n}\n\nvoid project_setNormal(vec3 normal) {\n  project_vNormalWorld = normal;\n}\n\nvoid project_setPositionAndNormal_World(vec3 position, vec3 normal) {\n  world.position = position;\n  world.normal = normal;\n}\n\nvoid project_setPositionAndNormal_Model(vec3 position, vec3 normal) {\n  world.position = (modelMatrix * vec4(position, 1.)).xyz;\n  world.normal = mat3(modelMatrix) * normal;\n}\n\nvec4 project_model_to_clipspace(vec4 position) {\n  return viewProjectionMatrix * modelMatrix * position;\n}\n\nvec4 project_model_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * modelMatrix * vec4(position, 1.);\n}\n\nvec4 project_world_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_view_to_clipspace(vec3 position) {\n  return projectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n"),fs:"\n".concat(g)},y="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",_={name:"lights",vs:y,fs:y,getUniforms:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b;if("lightSources"in e){var n=e.lightSources||{},i=n.ambientLight,r=n.pointLights,a=n.directionalLights,o=i||r&&r.length>0||a&&a.length>0;return o?Object.assign({},function(t){var e=t.ambientLight,n=t.pointLights,i=void 0===n?[]:n,r=t.directionalLights,a=void 0===r?[]:r,o={};o["lighting_uAmbientLight.color"]=e?x(e):[0,0,0];return i.forEach(function(t,e){o["lighting_uPointLight[".concat(e,"].color")]=x(t),o["lighting_uPointLight[".concat(e,"].position")]=t.position,o["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation}),o.lighting_uPointLightCount=i.length,a.forEach(function(t,e){o["lighting_uDirectionalLight[".concat(e,"].color")]=x(t),o["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction}),o.lighting_uDirectionalLightCount=a.length,o}({ambientLight:i,pointLights:r,directionalLights:a}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){var s={pointLights:[],directionalLights:[]},u=!0,l=!1,c=void 0;try{for(var h,f=(e.lights||[])[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;switch(p.type){case"ambient":s.ambientLight=p;break;case"directional":s.directionalLights.push(p);break;case"point":s.pointLights.push(p)}}}catch(A){l=!0,c=A}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}return t({lightSources:s})}return{}},defines:{MAX_LIGHTS:3}},b={};function x(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.color,n=void 0===e?[0,0,0]:e,i=t.intensity,r=void 0===i?1:i;return n.map(function(t){return t*r/255})}var w={lightDirection:new Float32Array([1,1,2])};var S={name:"dirlight",vs:null,fs:"uniform vec3 dirlight_uLightDirection;\nvec4 dirlight_filterColor(vec4 color) {\n  vec3 normal = project_getNormal_World();\n  float d = abs(dot(normalize(normal), normalize(dirlight_uLightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,e={};return t.lightDirection&&(e.dirlight_uLightDirection=t.lightDirection),e},dependencies:[m]},k={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingThreshold:1,pickingActive:!1};var O={name:"picking",vs:"uniform vec3 picking_uSelectedColor;\nuniform float picking_uThreshold;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    abs(vertexColor.r - picking_uSelectedColor.r) < picking_uThreshold &&\n    abs(vertexColor.g - picking_uSelectedColor.g) < picking_uThreshold &&\n    abs(vertexColor.b - picking_uSelectedColor.b) < picking_uThreshold;\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  picking_vRGBcolor_Aselected.a =\n    float(isVertexPicked(pickingColor));\n  picking_vRGBcolor_Aselected.rgb = pickingColor * COLOR_SCALE;\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\nvec4 picking_filterHighlightColor(vec4 color) {\n  bool selected = bool(picking_vRGBcolor_Aselected.a);\n\n  if (selected) {\n    vec4 highLightColor = picking_uHighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  vec3 pickingColor = picking_vRGBcolor_Aselected.rgb;\n  if (picking_uActive && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return picking_uActive ? vec4(pickingColor, 1.0) : color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,e={};if(void 0!==t.pickingSelectedColor)if(null===t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{var n=[t.pickingSelectedColor[0],t.pickingSelectedColor[1],t.pickingSelectedColor[2]];e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}return void 0!==t.pickingHighlightColor&&(e.picking_uHighlightColor=t.pickingHighlightColor),void 0!==t.pickingThreshold&&(e.picking_uThreshold=t.pickingThreshold),void 0!==t.pickingActive&&(e.picking_uActive=t.pickingActive?1:0),e}},P={diffuseTexture:null,diffuseColor:[.5,.5,.5,1]};var E={name:"diffuse",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P,e={};return void 0!==t.diffuseTexture&&(e.diffuse_uHasTexture=Boolean(t.diffuseTexture),e.diffuse_uTexture=t.diffuseTexture),void 0!==t.diffuseColor&&(e.diffuse_uColor=t.diffuseColor),e},vs:"out vec2 diffuse_vTexCoord;\nvoid diffuse_setTextureCoordinate(vec2 uv) {\n  diffuse_vTexCoord = uv;\n}\n",fs:"uniform vec4 diffuse_uColor;\nuniform bool diffuse_uHasTexture;\nuniform sampler2D diffuse_uTexture;\n\nin vec2 diffuse_vTexCoord;\n\n\n\nvec4 diffuse_getColor() {\n  vec2 texCoord = diffuse_vTexCoord;\n  return diffuse_uHasTexture ?\n    texture2D(diffuse_uTexture, vec2(texCoord.s, texCoord.t)) :\n    diffuse_uColor;\n}\n\nvec4 diffuse_filterColor(vec4 color) {\n  return diffuse_getColor();\n}\n"},C="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n",T={name:"gouraud-lighting",dependencies:[_],vs:C,defines:{LIGHTING_VERTEX:1},getUniforms:L},M={name:"phong-lighting",dependencies:[_],fs:C,defines:{LIGHTING_FRAGMENT:1},getUniforms:L},j={};function L(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j;if(!("material"in t))return{};var e=t.material;return e?function(t){var e={};return e.lighting_uAmbient=t.ambient,e.lighting_uDiffuse=t.diffuse,e.lighting_uShininess=t.shininess,e.lighting_uSpecularColor=t.specularColor,e}(e):{lighting_uEnabled:!1}}var I="uniform mat4 u_MVPMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_NormalMatrix;\n",z={name:"pbr",vs:"varying vec3 pbr_vPosition;\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n# ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n# else\nvarying vec3 pbr_vNormal;\n# endif\n#endif\n\nvoid pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)\n{\n  vec4 pos = u_ModelMatrix * position;\n  pbr_vPosition = vec3(pos.xyz) / pos.w;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\n  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));\n  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));\n  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;\n  pbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else\n  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n\n#ifdef HAS_UV\n  pbr_vUV = uv;\n#else\n  pbr_vUV = vec2(0.,0.);\n#endif\n}\n",fs:"#if (__VERSION__ < 300)\n#extension GL_EXT_shader_texture_lod: enable\n#extension GL_OES_standard_derivatives : enable\n#endif\n\n\n#if (__VERSION__ < 300)\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)\n#else\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)\n#endif\n\nprecision highp float;\n\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\nuniform vec2 u_ScaleIBLAmbient;\n#endif\n\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_BaseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\nuniform float u_NormalScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\nuniform vec3 u_EmissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\nuniform float u_OcclusionStrength;\n#endif\n\n#ifdef ALPHA_CUTOFF\nuniform float u_AlphaCutoff;\n#endif\n\nuniform vec2 u_MetallicRoughnessValues;\nuniform vec4 u_BaseColorFactor;\n\nuniform vec3 u_Camera;\n#ifdef PBR_DEBUG\nuniform vec4 u_ScaleDiffBaseMR;\nuniform vec4 u_ScaleFGDSpec;\n#endif\n\nvarying vec3 pbr_vPosition;\n\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n#else\nvarying vec3 pbr_vNormal;\n#endif\n#endif\n\n\nstruct PBRInfo\n{\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float LdotH;\n  float VdotH;\n  float perceptualRoughness;\n  float metalness;\n  vec3 reflectance0;\n  vec3 reflectance90;\n  float alphaRoughness;\n  vec3 diffuseColor;\n  vec3 specularColor;\n  vec3 n;\n  vec3 v;\n};\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\n  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n#else\n  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\n  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n#endif\n  return vec4(linOut,srgbIn.w);;\n#else\n  return srgbIn;\n#endif\n}\n\nvec3 getNormal()\n{\n#ifndef HAS_TANGENTS\n  vec3 pos_dx = dFdx(pbr_vPosition);\n  vec3 pos_dy = dFdy(pbr_vPosition);\n  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));\n  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n  vec3 ng = normalize(pbr_vNormal);\n#else\n  vec3 ng = cross(pos_dx, pos_dy);\n#endif\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n#else\n  mat3 tbn = pbr_vTBN;\n#endif\n\n#ifdef HAS_NORMALMAP\n  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n#else\n  vec3 n = normalize(tbn[2].xyz);\n#endif\n\n  return n;\n}\n\n\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)\n{\n  float mipCount = 9.0;\n  float lod = (pbrInputs.perceptualRoughness * mipCount);\n  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,\n    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;\n  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;\n\n#ifdef USE_TEX_LOD\n  vec3 specularLight = SRGBtoLINEAR(textureCubeLodEXT(u_SpecularEnvSampler, reflection, lod)).rgb;\n#else\n  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;\n#endif\n\n  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;\n  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);\n  diffuse *= u_ScaleIBLAmbient.x;\n  specular *= u_ScaleIBLAmbient.y;\n\n  return diffuse + specular;\n}\n#endif\n\n\nvec3 diffuse(PBRInfo pbrInputs)\n{\n  return pbrInputs.diffuseColor / M_PI;\n}\n\nvec3 specularReflection(PBRInfo pbrInputs)\n{\n  return pbrInputs.reflectance0 +\n    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *\n    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n}\n\n\n\nfloat geometricOcclusion(PBRInfo pbrInputs)\n{\n  float NdotL = pbrInputs.NdotL;\n  float NdotV = pbrInputs.NdotV;\n  float r = pbrInputs.alphaRoughness;\n\n  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\n\n\n\n\nfloat microfacetDistribution(PBRInfo pbrInputs)\n{\n  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n  return roughnessSq / (M_PI * f * f);\n}\n\nvoid PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {\n  pbrInputs.NdotL = 1.0;\n  pbrInputs.NdotH = 0.0;\n  pbrInputs.LdotH = 0.0;\n  pbrInputs.VdotH = 1.0;\n}\n\nvoid PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {\n  vec3 n = pbrInputs.n;\n  vec3 v = pbrInputs.v;\n  vec3 l = normalize(lightDirection);\n  vec3 h = normalize(l+v);\n\n  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);\n  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);\n  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);\n  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);\n}\n\nvoid PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {\n  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);\n  PBRInfo_setDirectionalLight(pbrInputs, light_direction);\n}\n\nvec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {\n  vec3 F = specularReflection(pbrInputs);\n  float G = geometricOcclusion(pbrInputs);\n  float D = microfacetDistribution(pbrInputs);\n  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);\n  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);\n}\n\nvec4 pbr_filterColor(vec4 colorUnused)\n{\n\n\n  float perceptualRoughness = u_MetallicRoughnessValues.y;\n  float metallic = u_MetallicRoughnessValues.x;\n#ifdef HAS_METALROUGHNESSMAP\n\n  vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);\n  perceptualRoughness = mrSample.g * perceptualRoughness;\n  metallic = mrSample.b * metallic;\n#endif\n  perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n  metallic = clamp(metallic, 0.0, 1.0);\n\n  float alphaRoughness = perceptualRoughness * perceptualRoughness;\n#ifdef HAS_BASECOLORMAP\n  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;\n#else\n  vec4 baseColor = u_BaseColorFactor;\n#endif\n\n#ifdef ALPHA_CUTOFF\n  if (baseColor.a < u_AlphaCutoff) {\n    discard;\n  }\n#endif\n\n  vec3 f0 = vec3(0.04);\n  vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n  diffuseColor *= 1.0 - metallic;\n  vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n  float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n\n\n  float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n  vec3 specularEnvironmentR0 = specularColor.rgb;\n  vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n  vec3 n = getNormal();\n  vec3 v = normalize(u_Camera - pbr_vPosition);\n\n  float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n  vec3 reflection = -normalize(reflect(v, n));\n\n  PBRInfo pbrInputs = PBRInfo(\n    0.0,\n    NdotV,\n    0.0,\n    0.0,\n    0.0,\n    perceptualRoughness,\n    metallic,\n    specularEnvironmentR0,\n    specularEnvironmentR90,\n    alphaRoughness,\n    diffuseColor,\n    specularColor,\n    n,\n    v\n  );\n\n  vec3 color = vec3(0, 0, 0);\n\n#ifdef USE_LIGHTS\n  PBRInfo_setAmbientLight(pbrInputs);\n  color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);\n  SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {\n    if (i < lighting_uDirectionalLightCount) {\n      PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);\n      color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);\n    }\n  }\n  SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {\n    if (i < lighting_uPointLightCount) {\n      PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);\n      float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));\n      color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);\n    }\n  }\n#endif\n#ifdef USE_IBL\n  color += getIBLContribution(pbrInputs, n, reflection);\n#endif\n#ifdef HAS_OCCLUSIONMAP\n  float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;\n  color = mix(color, color * ao, u_OcclusionStrength);\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n  vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;\n  color += emissive;\n#endif\n\n#ifdef PBR_DEBUG\n\n\n\n\n\n  color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);\n  color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);\n  color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);\n#endif\n\n  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);\n}\n",defines:{LIGHTING_FRAGMENT:1},dependencies:[{name:"project2",vs:I,fs:I},_]},D=n("YzvJ");n.d(e,"a",function(){return B}),n.d(e,"u",function(){return i.b}),n.d(e,"v",function(){return i.d}),n.d(e,"c",function(){return r.a}),n.d(e,"g",function(){return r.c}),n.d(e,"f",function(){return r.b}),n.d(e,"d",function(){return a.a}),n.d(e,"p",function(){return o.a}),n.d(e,"m",function(){return s.c}),n.d(e,"l",function(){return s.b}),n.d(e,"x",function(){return s.e}),n.d(e,"w",function(){return s.d}),n.d(e,"e",function(){return s.a}),n.d(e,"j",function(){return u}),n.d(e,"k",function(){return p}),n.d(e,"t",function(){return m}),n.d(e,"o",function(){return _}),n.d(e,"i",function(){return S}),n.d(e,"s",function(){return O}),n.d(e,"h",function(){return E}),n.d(e,"n",function(){return T}),n.d(e,"r",function(){return M}),n.d(e,"q",function(){return z}),n.d(e,"b",function(){return D.a});var B={vs:"#define SHADER_NAME luma_modular_vertex\n\n// object attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec2 texCoords;\nattribute vec3 pickingColors;\n\nvoid main(void) {\n\n  // Set up position\n#ifdef MODULE_GEOMETRY\n  geometry_setPosition(positions);\n  geometry_setNormal(normals);\n#endif\n\n#ifdef MODULE_PROJECT\n  project_setPositionAndNormal_Model(positions, normals);\n  gl_Position = project_model_to_clipspace(positions);\n#endif\n\n  // Set up depth\n#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n\n#ifdef MODULE_DIFFUSE\n  diffuse_setTextureCoordinate(texCoords);\n#endif\n\n  // Set up color calculations\n#ifdef MODULE_MATERIAL\n  material_setDiffuseColor(colors);\n  material_setDiffuseTextureCoordinates(texCoords);\n#endif\n\n#ifdef MODULE_LIGHTING\n  lighting_setPositionAndNormal(positions, normals);\n  lighting_apply_light(positions);\n  lighting_apply_reflection(positions);\n#endif\n\n#ifdef MODULE_PICKING\n  picking_setPickingColor(pickingColors);\n#endif\n\n}\n",fs:"#define SHADER_NAME luma-modular-fragment\n\nprecision highp float;\n\n// varyings\nvarying vec4 vColor;\n\nvoid main(){\n  gl_FragColor = vec4(1., 0., 1., 1.);\n\n#ifdef MODULE_DIFFUSE\n  gl_FragColor = diffuse_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth(gl_Position);\n#endif\n}\n",defaultUniforms:{}}},zGma:function(t,e,n){"use strict";var i=n("ODXe"),r=n("1OyB"),a=n("vuIU"),o=n("md7G"),s=n("foSv"),u=n("Ji7U"),l=n("g9fj"),c=n("qjXE");function h(t,e){return t.length===e&&t.every(Number.isFinite)}var f=n("S4Ro"),p=n("dByZ"),A=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Object(r.a)(this,e),t=Object(o.a)(this,Object(s.a)(e).call(this,4)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,i,a,u),t}return Object(u.a)(e,t),Object(a.a)(e,[{key:"applyMatrix4",value:function(t){return t.transformVector(this,this),this}},{key:"ELEMENTS",get:function(){return 4}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Object(c.a)(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=Object(c.a)(t)}}]),e}(n("h6m0").a),d=n("ZaHm"),v=n("ZxFD"),g=n("n+fv"),m=n("bl9R");n.d(e,"a",function(){return _});var y=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var _=function(t){function e(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return Object(r.a)(this,e),t=Object(o.a)(this,Object(s.a)(e).call(this,16)),Array.isArray(i[0])&&1===arguments.length?t.copy(i[0]):t.identity(),t}return Object(u.a)(e,t),Object(a.a)(e,[{key:"setRowMajor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,p=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,A=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,d=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return this[0]=t,this[1]=r,this[2]=u,this[3]=f,this[4]=e,this[5]=a,this[6]=l,this[7]=p,this[8]=n,this[9]=o,this[10]=c,this[11]=A,this[12]=i,this[13]=s,this[14]=h,this[15]=d,this.check()}},{key:"setColumnMajor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,p=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,A=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,d=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return this[0]=t,this[1]=e,this[2]=n,this[3]=i,this[4]=r,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this[9]=l,this[10]=c,this[11]=h,this[12]=f,this[13]=p,this[14]=A,this[15]=d,this.check()}},{key:"set",value:function(){return this.setColumnMajor.apply(this,arguments)}},{key:"getElement",value:function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this[t][e]:this[e][t]}},{key:"setElement",value:function(t,e,n){return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?this[t][e]=Object(c.a)(n):this[e][t]=Object(c.a)(n),this}},{key:"determinant",value:function(){return d.a(this)}},{key:"identity",value:function(){return this.copy(y)}},{key:"fromQuaternion",value:function(t){return d.c(this,t),this.check()}},{key:"frustum",value:function(t){var e=t.left,n=t.right,i=t.bottom,r=t.top,a=t.near,o=t.far;return d.d(this,e,n,i,r,a,o),this.check()}},{key:"lookAt",value:function(t){var e=t.eye,n=t.center,i=void 0===n?[0,0,0]:n,r=t.up,a=void 0===r?[0,1,0]:r;return d.f(this,e,i,a),this.check()}},{key:"ortho",value:function(t){var e=t.left,n=t.right,i=t.bottom,r=t.top,a=t.near,o=void 0===a?.1:a,s=t.far,u=void 0===s?500:s;return d.h(this,e,n,i,r,o,u),this.check()}},{key:"orthographic",value:function(t){var n=t.fovy,i=void 0===n?45*Math.PI/180:n,r=t.aspect,a=void 0===r?1:r,o=t.focalDistance,s=void 0===o?1:o,u=t.near,l=void 0===u?.1:u,c=t.far,h=void 0===c?500:c;if(i>2*Math.PI)throw Error("radians");var f=i/2,p=s*Math.tan(f),A=p*a;return(new e).ortho({left:-A,right:A,bottom:-p,top:p,near:l,far:h})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,n=t.fov,i=void 0===n?45*Math.PI/180:n,r=t.aspect,a=void 0===r?1:r,o=t.near,s=void 0===o?.1:o,u=t.far,l=void 0===u?500:u;if((e=e||i)>2*Math.PI)throw Error("radians");return d.i(this,e,a,s,l),this.check()}},{key:"transpose",value:function(){return d.p(this,this),this.check()}},{key:"invert",value:function(){return d.e(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return d.g(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return d.g(this,this,t),this.check()}},{key:"rotateX",value:function(t){return d.k(this,this,t),this.check()}},{key:"rotateY",value:function(t){return d.l(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return d.m(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=Object(i.a)(t,3),n=e[0],r=e[1],a=e[2];return this.rotateX(n).rotateY(r).rotateZ(a)}},{key:"rotateAxis",value:function(t,e){return d.j(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?d.n(this,this,t):d.n(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return d.o(this,this,t),this.check()}},{key:"transformVector2",value:function(t,e){return e=e||new f.a,v.h(e,t,this),h(e,2),e}},{key:"transformVector3",value:function(t,e){return e=e||new p.a,g.i(e,t,this),h(e,3),e}},{key:"transformVector4",value:function(t,e){return e=e||new A,m.c(e,t,this),h(e,4),e.check()}},{key:"transformVector",value:function(t,e){switch(t.length){case 2:return this.transformVector2(t,e);case 3:return this.transformVector3(t,e);case 4:return this.transformVector4(t,e);default:throw new Error("Illegal vector")}}},{key:"transformDirection",value:function(t,e){return this._transformVector(t,e,0)}},{key:"transformPoint",value:function(t,e){return this._transformVector(t,e,1)}},{key:"_transformVector",value:function(t,e,n){switch(t.length){case 2:e=e||new f.a,m.c(e,[t[0],t[1],0,n],this),e.length=2,h(e,2);break;case 3:e=e||new p.a,m.c(e,[t[0],t[1],t[2],n],this),e.length=3,h(e,3);break;case 4:if(Boolean(n)!==Boolean(t[3]))throw new Error("math.gl: Matrix4.transformPoint - invalid vector");e=e||new A,m.c(e,t,this),h(e,4);break;default:throw new Error("Illegal vector")}return e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,n){return this.identity().translate([t,e,n])}},{key:"ELEMENTS",get:function(){return 16}}]),e}(l.a)}},[["dCZK","5d41","9da1"]]]);